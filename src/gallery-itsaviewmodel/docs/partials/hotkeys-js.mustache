YUI(yuiconfig).use('gallery-itsaformmodel', 'gallery-itsaviewmodel', 'slider', 'json-stringify', 'gallery-itsadialog', function(Y) {
    var view, artist, template;

    // adding skin sam to body for getting the right skin for the widgets
    Y.one('body').addClass('yui3-skin-sam');

    // asynchroniously loading the 'gallerycss-itsa-special' css fonticons
    // which supplies the 'itsaicon-special-bell'-icon
    Y.use('gallerycss-itsa-special');

    // create MyFormModelClass
    Y.ArtistModel = Y.Base.create('formmodel', Y.ITSAFormModel, [], {
        sync: function (action, options, callback) {
            switch (action) {
              case 'submit':
                Y.later(4000, null, function() {
                    callback();
                });
                return;
              default:
                callback('Invalid action');
            }
        }
    }, {
        ATTRS: {
            name: {
                formtype: 'text',
                formconfig: {
                    label: 'Artist',
                    placeholder: 'artist',
                    hotkey: 'a',
                    required: true
                }
            },
            country: {
                country: 'text',
                formconfig: {
                    label: 'Country',
                    placeholder: 'country',
                    hotkey: 'c',
                    required: true,
                    initialfocus: true
                }
            },
            firstalbum: {
                formtype: 'text',
                formconfig: {
                    label: 'First album',
                    placeholder: 'first album',
                    hotkey: 'f',
                    required: true
                }
            },
            release: {
                formtype: Y.Slider,
                formconfig: {
                    label: 'Releasyear',
                    hotkey: 'r',
                    widgetconfig: {
                        min: 1950,
                        max: 2010
                    }
                }
            }
        }
    });

    artist = new Y.ArtistModel({
        name: 'U2',
        country: 'Ireland',
        firstalbum: 'Boy',
        release: 1980
    });
    artist.setLifeUpdate(true);

    template = '<fieldset>'+
                    '<legend>Editable template</legend>'+
                    '<div class="pure-control-group">{name}</div>'+
                    '<div class="pure-control-group">{country}</div>'+
                    '<div class="pure-control-group">{firstalbum}</div>'+
                    '<div class="pure-control-group">{release}</div>'+
                    '<div class="pure-controls">{imgbtn_yes}</div>'+
                    '<div class="pure-controls">{buttonAlert}</div>'+
                    // {buttonAlert} will be defined with view.addCustomBtn() later on
                    '<div class="pure-controls">{btn_reset} {spinbtn_submit}</div>';
                '</fieldset>';

    view = new Y.ITSAViewModel({
        container: '#viewcont',
        model: artist,
        template: template,
        editable: true,
        styled: true
    });

    // Now define 'buttonAlert' --> this will be available in the template with {buttonAlert}
    // itsaicon-special-bell is loaded asynchroniously at the start of this code
    view.addCustomBtn('buttonAlert', '<i class="itsaicon-special-bell"></i>ALERT', {
        value: 'alert',
        classname: 'itsabutton-iconleft itsabutton-oval bell'
    });
    view.setHotKey('s', 'spinbtn_submit');
    view.setHotKey('r', 'btn_reset');
    view.setHotKey('a', 'buttonAlert');

    view.render();

    view.after('buttonclick', function(e) {
        Y.alert('Button is clicked with value: '+e.value);
    });

    view.on('validationerror', function(e) {
        Y.alert('error', 'validation error');
    });



var buttonnode = Y.one('button[value="alert"]');
var submitnode = Y.one('button[value="submit"]');

/*
Y.later(2000, null, function() {
    artist.fire('button:click', {buttonNode: buttonnode, value: 'alert'});
});
Y.later(4000, null, function() {
    artist.fire('submit:click', {buttonNode: submitnode, value: 'submit'});
});
*/
    artist.after('button:click', function(e) {
        console.log('Button is MODEL-clicked with value: '+e.value);
    });
    artist.after('submit:click', function(e) {
        console.log('Submit is MODEL-clicked');
    });
    artist.after('submit', function(e) {
        console.log('Submitted by MODEL');
    });

    view.after('buttonclick', function(e) {
        console.log('Button is VIEW-clicked with value '+e.value);
    });
    view.after('submitclick', function(e) {
        console.log('Submit is VIEW-clicked');
    });
    view.after('modelsubmit', function(e) {
        console.log('Submitted by VIEW');
    });

});