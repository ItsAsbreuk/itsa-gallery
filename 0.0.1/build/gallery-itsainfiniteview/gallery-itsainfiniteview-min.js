YUI.add("gallery-itsainfiniteview",function(e,t){"use strict";var n=e.Lang,r=e.Array,i=function(e){return parseInt(e,10)};e.namespace("Plugin").ITSAInifiniteView=e.Base.create("itsainfiniteview",e.Plugin.Base,[],{_eventhandlers:[],_window:null,host:null,initializer:function(){var t=this,n;t.host=n=t.get("host"),n._itmsAvail=!0,t._window=e.one("window"),t._bindUI()},expandList:function(){var t=this,n=t.host,r=n.getModelListInUse&&n.getModelListInUse()||n.get("data"),i=t.get("batchSize"),s=n._prevLastModelIndex||-1,o=n._itmsAvail,u;return r&&o?(t._fireExpansion(!1),u=s>=r.size()-1,u?r.sync("readMore",{lastItem:s,batchSize:i},e.rbind(t._expansionFinished,t)):n._renderView&&(n._renderView(null,{rebuild:!1}),t._fireExpansion(!0))):(!r,!n._itmsAvail),o},checkExpansion:function(){var e=this,t=e.host,n=e._window,r=t.get("boundingBox"),s=t.getModelListInUse&&t.getModelListInUse()||t.get("data"),o=t._viewNode,u=e.get("expansionArea"),a=t.get("axis"),f=a&&a.x,l=a&&a.y,c,h,p,d,v,m;s&&t._itmsAvail?(l?(c=r.getY()+r.get("offsetHeight"),h=o.getY()+o.get("offsetHeight"),p=h-c):f?(c=r.getX()+r.get("offsetWidth"),h=o.getX()+o.get("offsetWidth"),p=h-c):n&&(v=i(n.get("winHeight")),d=i(n.get("docHeight")),m=i(n.get("docScrollY")),p=d-v-m),p<u&&e.expandList()):(!s,!t._itmsAvail)},loadAllItems:function(e){var t=this.host,n=t.getModelListInUse();t._getNodeFromModelOrIndex(null,n.size()-1,e)},destructor:function(){this._clearEventhandlers()},_bindUI:function(){var t=this,n=t.host,r=n.get("axis");r?t._eventhandlers.push(n.after("scrollEnd",e.rbind(t.checkExpansion,t))):t._eventhandlers.push(e.after("scroll",e.rbind(t.checkExpansion,t)))},_expansionFinished:function(t,r){var i=this,s=i.host,o=s.get("modelList"),u=s.get("lastItemOnTop"),a,f;try{f=e.JSON.parse(r.responseText),a=n.isArray(f)&&f.length>0,a||(s._itmsAvail=!1),a&&o.add(a)}catch(l){s._itmsAvail=!1}u>0&&!s._itmsAvail&&(s._addEmptyItem(null,u),s.syncUI()),i._fireExpansion(!0)},_fireExpansion:function(e){var t=this;t.fire("modelExpansion:"+(e?"end":"start"))},_clearEventhandlers:function(){r.each(this._eventhandlers,function(e){e.detach()})}},{NS:"itsainfiniteview",ATTRS:{batchSize:{value:100,validator:function(e){return n.isNumber(e)}},loadSize:{value:1e3,validator:function(e){return n.isNumber(e)}},maxExpansions:{value:50,validator:function(e){return n.isNumber(e)}},expansionArea:{value:2e3,validator:function(e){return n.isNumber(e)}}}})},"@VERSION@",{requires:["base-build","plugin","node-base","json-parse"]});
