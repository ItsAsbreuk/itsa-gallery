YUI.add("gallery-itsamessagecontroller",function(e,t){"use strict";function V(){V.superclass.constructor.apply(this,arguments)}var n,r=e.Array,i="application",s="boolean",o="error",u="info",a="warn",f="essage",l="m"+f,c="mail",h="e"+c,p="url",d=5e3,v="_pub_",m="new"+l,g=v+m,y=m+"_added",b=v+y,w="gallery-itsamessage",E="get",S="show",x="Confirmation",T=E+"Retry"+x,N=E+x,C=E+"Input",k=E+"Number",L=E+"E"+c,A=E+"URL",O=S+"M"+f,M=S+"Warning",_=S+"Error",D=S+"Status",P="_",H="base-build",B="textarea",j="question",F=u+"rm",I="itsaicon-dialog-",q=I+F,R=I+o,U=I+u,z=I+j,W=I+a,X="itsadialog";V.NAME="ITSAMessageControllerClass",e.ITSAMessageControllerClass=e.extend(V,e.Base),V.prototype.initializer=function(){var t=this;t.queue=[],t._targets={info:X,warn:X,error:X},e.later(d,t,t.readyPromise)},V.prototype._retrieveParams=function(e,t,n){var r=typeof t=="string",i;return r||(n=t,t=e,e=null),i=typeof t=="string",i||(n=t,t="",e=null),n||(n={}),{title:e,message:t,config:n}},V.prototype.readyPromise=function(){var t=this;return t._readyPromise||(t._readyPromise=e.usePromise(H,w).then(function(){t._intlMessageObj=new e.ITSAMessage},function(e){var n={error:e&&(e.message||e),src:"ITSAMessageViewer._processQueue"};t._lazyFireErrorEvent(n)}))},V.prototype[P+T]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_abort}{btn_ignore}{btn_retry}","btn_retry","btn_abort",T,u,W)},V.prototype[P+N]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_no}{btn_yes}","btn_yes","btn_no",N,u,z)},V.prototype[P+A]=function(e,t,n){var r=this,i=r._retrieveParams(e,t,n),s=i.config;return s.url=!0,r[P+C](i.title,i.message,s)},V.prototype[P+L]=function(e,t,n){var r=this,i=r._retrieveParams(e,t,n),s=i.config;return s.email=!0,r[P+C](i.title,i.message,s)},V.prototype[P+C]=function(t,n,r){var i=this,o=i._retrieveParams(t,n,r),a,f,l,c,d,v;return t=o.title,n=o.message,r=o.config,v=r.formconfig||{},v.fullselect=!0,l=typeof r.email===s&&r.email,c=typeof r.url===s&&r.url,v.primarybtnonenter=!r[B]||l||c,d=l?h:c?p:r[B]?B:"text",v.classname="itsa-"+d+(v.classname?" "+v.classname:""),v.required=!0,a=typeof r.required===s&&r.required,i.readyPromise().then(function(){return(r.email||r.url)&&(r.validationerror||(r.validationerror=i._intlMessageObj.translate("enterrightformat"))),f=e.Base.create("itsamessageinput",e.ITSAMessage,[],null,{ATTRS:{input:{value:r.value,formtype:d,formconfig:v,validator:r.validator,validationerror:r.validationerror}}}),n+='<fieldset class="itsa-input"><div class="pure-control-group">{input}</div></fieldset>',i._queueMessage(t,n,r,(a?"":"{btn_cancel}")+"{btn_ok}","btn_ok",a?null:"btn_cancel",C,u,U,f)})},V.prototype[P+k]=function(t,n,r){var i=this,o=i._retrieveParams(t,n,r),a,f,l;return t=o.title,n=o.message,r=o.config,l=r.formconfig||{},l.fullselect=!0,l.primarybtnonenter=!0,l.classname="itsa-number"+(l.classname?" "+l.classname:""),l.required=!0,a=typeof r.required===s&&r.required,i.readyPromise().then(function(){return r.validationerror||(r.validationerror=i._intlMessageObj.translate("entervalidnumber")),f=e.Base.create("itsamessagenumber",e.ITSAMessage,[],null,{ATTRS:{number:{value:r.value,formtype:"number",formconfig:l,validator:r.validator,validationerror:r.validationerror}}}),n+='<fieldset class="itsa-number"><div class="pure-control-group">{number}</div></fieldset>',i._queueMessage(t,n,r,(a?"":"{btn_cancel}")+"{btn_ok}","btn_ok",a?null:"btn_cancel",k,u,U,f)})},V.prototype[P+O]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_ok}","btn_ok",null,O,u,q)},V.prototype[P+M]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_ok}","btn_ok",null,M,a,W)},V.prototype[P+_]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_ok}","btn_ok",null,_,o,R)},V.prototype[P+D]=function(t,n,r){var s=this;return s.readyPromise().then(function(){var o=new e.ITSAMessage;return o.title=t,o.message=n,o.type=D,o.level=u,o.noButtons=!0,o.priority=r.priority,o.timeoutResolve=r.timeoutResolve,o.timeoutReject=r.timeoutReject,o.target=r.target,o.source=r.source||i,o.messageType=D,s.queueMessage(o),o})},V.prototype.queueMessage=function(t){var n=this,r,i,s;return r=new e.Promise(function(e,t){i=e,s=t}),t||(t={}),t.promise=r,t.resolvePromise=i,t.rejectPromise=s,n[g]||(n[g]=e._publishAsync(m,{defaultTargetOnly:!0,emitFacade:!0,broadcast:2,defaultFn:e.rbind(n._defQueueFn,n),preventedFn:n._prevDefFn})),e.fire(m,{model:t}),r},V.prototype.destructor=function(){var t=this,n=t.queue,i=t._intlMessageObj;t.removeTarget(e),r.each(n,function(e){e.detachAll(),e.destroy(),e=null}),n.length=0,i&&i.destroy()&&(t._intlMessageObj=null),t._targets={}},V.prototype._lazyFireErrorEvent=function(e){var t=this;t._errorEvent||(t._errorEvent=t.publish(o,{broadcast:1})),t.fire(o,e)},V.prototype._prevDefFn=function(e){var t=e.model;t.detachAll(),t.destroy(),t=null},V.prototype._defQueueFn=function(t){var n=this,r=t.model,i=n.queue;return i.push(r),n[b]||(n[b]=e.publish(y,{defaultTargetOnly:!0,broadcast:2,emitFacade:!0})),e.fire(y,{model:r}),r.promise.then(null,function(){return!0}).then(function(){var e=i.indexOf(r);e>-1&&i.splice(e,1),r.detachAll(),r.destroy(),r=null})},V.prototype._queueMessage=function(t,n,r,o,u,a,f,l,c,h){var p=this,d=p._retrieveParams(t,n,r),v;return t=d.title,n=d.message,r=d.config,v=typeof r.imageButtons===s&&r.imageButtons,v&&(o=o.replace(/\{btn_/g,"{imgbtn_"),u&&(u=u.replace(/btn_/g,"imgbtn_"))),p.readyPromise().then(function(){var s=h?new h:new e.ITSAMessage;return s.title=t||r.title,s.message=n||r.message,s.footer=o||r.footer,s.icon=r.icon||c,s.closeButton=r.closeButton,s.priority=r.priority,s.imageButtons=v,s.primaryButton=r.primaryButton||u,s.rejectButton=a||r.rejectButton,s.timeoutResolve=r.timeoutResolve,s.timeoutReject=r.timeoutReject,s.target=r.target,s.level=r.level||l||r.type,s.source=r.source||i,s.messageType=f||r.type,p.queueMessage(s)})},e._publishAsync=function(t,n){var r=this,i=this.publish(t,n);i._firing=new e.Promise(function(e){e()}),i.fire=function(t){var n=e.Array(arguments,0,!0),s={id:i.id,next:i,silent:i.silent,stopped
:0,prevented:0,bubbling:null,type:i.type,defaultTargetOnly:i.defaultTargetOnly},o;i._firing=i._firing.then(function(){i.details=n;var e=i._subscribers,u=[],a,f,l;u.push.apply(u,t),a=i._createFacade(u),a.target=a.target||r;if(e)for(f=0,l=e.length;f<l;++f)try{e[f].fn.call(e[f].context,a)}catch(c){}return i.bubbles&&!i.stopped&&(r.bubble(i,n,null,s),a.prevented=Math.max(a.prevented,s.prevented)),a.prevented?i.preventedFn.call(r,a).then(null,function(e){return!1}):i.defaultFn.call(r,a).then(function(){e=i._afters;if(e)for(f=0,l=e.length;f<l;++f)try{e[f].fn.call(e[f].context,a)}catch(t){}if(s.afterQueue)while(o=s.afterQueue.last())o()}).then(null,function(e){var t={error:e&&(e.message||e),src:"ITSAMessageViewer._processQueue"};return r._lazyFireErrorEvent(t),!1})})},i._fire=function(e){return i.fire(e[0])}},e.Global.ITSAMessageController||(e.Global.ITSAMessageController=new V),n=e.ITSAMessageController=e.Global.ITSAMessageController,e[T]=e.bind(n[P+T],n),e.confirm=e[N]=e.bind(n[P+N],n),e.prompt=e[C]=e.bind(n[P+C],n),e[k]=e.bind(n[P+k],n),e[L]=e.bind(n[P+L],n),e[A]=e.bind(n[P+A],n),e[O]=e.bind(n[P+O],n),e.alert=e[M]=e.bind(n[P+M],n),e[_]=e.bind(n[P+_],n),e[D]=e.bind(n[P+D],n)},"@VERSION@",{requires:["yui-base","oop","base-base","event-custom-complex","promise","gallery-itsamodulesloadedpromise"]});
