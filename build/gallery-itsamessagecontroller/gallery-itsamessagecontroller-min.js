YUI.add("gallery-itsamessagecontroller",function(e,t){"use strict";function D(){D.superclass.constructor.apply(this,arguments)}var n="application",r="error",i="info",s="warn",o="essage",u="m"+o,a=5e3,f="_pub_",l="new"+u,c=f+l,h=l+"_added",p=f+h,d="model-list",v="gallery-itsamessage",m="get",g="show",y="Date",b="Time",w="Confirmation",E=m+"Retry"+w,S=m+w,x=m+"Input",T=m+"Number",N=m+y,C=m+b,k=N+b,L=g+"M"+o,A=g+"Warning",O=g+"Error",M=m+"Login",_={error:0,warn:1,info:2};D.NAME="itsamessagecontroller",e.extend(D,e.Base),D.prototype.initializer=function(){var t=this;e.later(a,t,t.readyPromise)},D.prototype.readyPromise=function(){var t=this;return t._readyPromise||(t._readyPromise=e.usePromise(d,v).then(e.bind(t._initQueue,t)))},D.prototype._initQueue=function(){var t=this,n;n=t.queue=new e.ModelList,n.comparator=function(e){return _[e.get("level")]},e.later(2e3,null,function(){console.log(t.queue.size())},null,!0)},D.prototype[E]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_abort}{btn_ignore}{btn_retry}",E,i)},D.prototype[S]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_no}{btn_yes}",S,i)},D.prototype[x]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_cancel}{btn_ok}",x,i)},D.prototype[T]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_cancel}{btn_ok}",T,i)},D.prototype[N]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_cancel}{btn_ok}",N,i)},D.prototype[C]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_cancel}{btn_ok}",C,i)},D.prototype[k]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_cancel}{btn_ok}",k,i)},D.prototype[L]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_ok}",L,i)},D.prototype[A]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_ok}",A,s)},D.prototype[O]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_ok}",O,r)},D.prototype[M]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_cancel}{btn_ok}",M,i)},D.prototype.queueMessage=function(t){console.log("queueMessage "+t.get("message"));var n=this,r,i,s;return r=new e.Promise(function(e,t){i=e,s=t}),t||(t={}),t.promise=r,t.resolvePromise=i,t.rejectPromise=s,n[c]||(n[c]=n._publishAsync(l,{defaultTargetOnly:!0,emitFacade:!0,defaultFn:e.rbind(n._defQueueFn,n),preventedFn:n._prevDefFn})),n.readyPromise().then(function(){console.log("fireing "+l),n.fire(l,{model:t}),t instanceof e.ITSAMessage||t.rejectPromise(new Error("Param added to queueMessage is no instance of Y.ITSAMessage"))}),r},D.prototype.destructor=function(){var e=this.queue;e&&e.destroy()},D.prototype._prevDefFn=function(e){e.message.promiseReject(new Error("preventDefaulted"))},D.prototype._defQueueFn=function(e){console.log("_defQueueFn "+e.model.get("message"));var t=this,n=e.model,r=t.queue;return r.add(n),t[p]||(t[p]=t.publish(h,{defaultTargetOnly:!0,emitFacade:!0})),console.log("fireing "+h),t.fire(h,{model:n}),n.promise.then(function(){r.remove(n)},function(){r.remove(n)})},D.prototype._queueMessage=function(t,r,i,s,o,u){console.log("_queueMessage "+t);var a=this,f=typeof r=="string",l,c;return f||(i=r,r=t,t=null),c=i&&typeof i.imagebuttons=="boolean"&&i.imagebuttons,c&&(s=s.replace(/\{btn_/g,"{imgbtn_")),l=e.merge(i,{title:t,message:r,footer:s,source:n,type:o,level:u}),i.level&&(l.level=i.level),l.level||(l.level=i.type),a.readyPromise().then(function(){return a.queueMessage(new e.ITSAMessage(l))})},D.prototype._publishAsync=function(t,n){var r=this,i=this.publish(t,n);i._firing=new e.Promise(function(e){e()}),i.fire=function(t){var n=e.Array(arguments,0,!0),s={id:i.id,next:i,silent:i.silent,stopped:0,prevented:0,bubbling:null,type:i.type,defaultTargetOnly:i.defaultTargetOnly},o;i._firing=i._firing.then(function(){i.details=n;var e=i._subscribers,u=[],a,f,l;u.push.apply(u,t),a=i._createFacade(u),a.target=a.target||r;if(e)for(f=0,l=e.length;f<l;++f)try{e[f].fn.call(e[f].context,a)}catch(c){}return i.bubbles&&!i.stopped&&(r.bubble(i,n,null,s),a.prevented=Math.max(a.prevented,s.prevented)),a.prevented?i.preventedFn.call(r,a).then(null,function(e){return!1}):i.defaultFn.call(r,a).then(function(){e=i._afters;if(e)for(f=0,l=e.length;f<l;++f)try{e[f].fn.call(e[f].context,a)}catch(t){}if(s.afterQueue)while(o=s.afterQueue.last())o()}).then(null,function(e){return!1})})},i._fire=function(e){return i.fire(e[0])}},YUI.Env.ITSAMessageController=new D},"@VERSION@",{requires:["yui-base","oop","base-base","promise","gallery-itsamodulesloadedpromise"]});
