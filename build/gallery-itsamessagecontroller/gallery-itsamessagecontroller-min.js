YUI.add("gallery-itsamessagecontroller",function(e,t){"use strict";function _(){_.superclass.constructor.apply(this,arguments)}var n=e.Array,r="application",i="error",s="info",o="warn",u="essage",a="m"+u,f=5e3,l="_pub_",c="new"+a,h=l+c,p=c+"_added",d=l+p,v="gallery-itsamessage",m="get",g="show",y="Date",b="Time",w="Confirmation",E=m+"Retry"+w,S=m+w,x=m+"Input",T=m+"Number",N=m+y,C=m+b,k=N+b,L=g+"M"+u,A=g+"Warning",O=g+"Error",M=g+"Status";_.NAME="itsamessagecontroller",e.extend(_,e.Base),_.prototype.initializer=function(){var t=this;t.queue=[],e.later(f,t,t.readyPromise)},_.prototype.readyPromise=function(){var t=this;return t._readyPromise||(t._readyPromise=e.usePromise(v))},_.prototype[E]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_abort}{btn_ignore}{btn_retry}","btn_retry","btn_abort",E,s)},_.prototype[S]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_no}{btn_yes}","btn_yes","btn_no",S,s)},_.prototype[x]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_cancel}{btn_ok}","btn_ok","btn_cancel",x,s)},_.prototype[T]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_cancel}{btn_ok}","btn_ok","btn_cancel",T,s)},_.prototype[N]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_cancel}{btn_ok}","btn_ok","btn_cancel",N,s)},_.prototype[C]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_cancel}{btn_ok}","btn_ok","btn_cancel",C,s)},_.prototype[k]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_cancel}{btn_ok}","btn_ok","btn_cancel",k,s)},_.prototype[L]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_ok}","btn_ok",null,L,s)},_.prototype[A]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_ok}","btn_ok",null,A,o)},_.prototype[O]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_ok}","btn_ok",null,O,i)},_.prototype[M]=function(t,n,i){var o=this,u=typeof n=="string",a;return u||(i=n,n=t,t=null),a=e.merge(i,{title:t,message:n,footer:null,noButtons:!0,source:r,type:M,level:s}),o.readyPromise().then(function(){var t=new e.ITSAMessage(a);return o.queueMessage(t),t})},_.prototype.queueMessage=function(t){console.log("queueMessage "+t.get("message"));var n=this,r=t.get("autoDestroy"),i,s,o;return i=new e.Promise(function(e,t){s=e,o=t}),t||(t={}),t.promise=i,t.resolvePromise=s,t.rejectPromise=o,n[h]||(n[h]=e._publishAsync(c,{defaultTargetOnly:!0,emitFacade:!0,broadcast:2,defaultFn:e.rbind(n._defQueueFn,n),preventedFn:n._prevDefFn})),r>0&&t.promise.then(e.bind(n._autoDestroyMsg,n,t,r),e.bind(n._autoDestroyMsg,n,t,r)),e.fire(c,{model:t}),console.log("fireing "+c),i},_.prototype.destructor=function(){var t=this,r=t.queue;t.removeTarget(e),n.each(r,function(e){e.destroy()}),r.length=0},_.prototype._autoDestroyMsg=function(t,n){e.later(n,null,function(){console.log("DESTROYING "+t.get("title")),t.destroy(),t=null})},_.prototype._prevDefFn=function(e){e.message.promiseReject(new Error("preventDefaulted"))},_.prototype._defQueueFn=function(t){console.log("_defQueueFn "+t.model.get("message"));var n=this,r=t.model,i=n.queue;return i.push(r),n[d]||(n[d]=e.publish(p,{defaultTargetOnly:!0,broadcast:2,emitFacade:!0})),console.log("fireing "+p),e.fire(p,{model:r}),r.promise.then(null,function(){return!0}).then(function(){var e=i.indexOf(r);e>-1&&i.splice(e,1)})},_.prototype._queueMessage=function(t,n,i,s,o,u,a,f){console.log("_queueMessage "+t);var l=this,c=typeof n=="string",h,p;return c||(i=n,n=t,t=null),p=i&&typeof i.imageButtons=="boolean"&&i.imageButtons,p&&(s=s.replace(/\{btn_/g,"{imgbtn_"),o&&(o=o.replace(/btn_/g,"imgbtn_"))),h=e.merge(i,{title:t,message:n,footer:s,source:r,primaryButton:o,rejectButton:u,type:a,level:f}),i.level&&(h.level=i.level),i.primaryButton&&(h.primaryButton=i.primaryButton),h.level||(h.level=i.type),l.readyPromise().then(function(){return l.queueMessage(new e.ITSAMessage(h))})},e._publishAsync=function(t,n){var r=this,i=this.publish(t,n);i._firing=new e.Promise(function(e){e()}),i.fire=function(t){var n=e.Array(arguments,0,!0),s={id:i.id,next:i,silent:i.silent,stopped:0,prevented:0,bubbling:null,type:i.type,defaultTargetOnly:i.defaultTargetOnly},o;i._firing=i._firing.then(function(){i.details=n;var e=i._subscribers,u=[],a,f,l;u.push.apply(u,t),a=i._createFacade(u),a.target=a.target||r;if(e)for(f=0,l=e.length;f<l;++f)try{e[f].fn.call(e[f].context,a)}catch(c){}return i.bubbles&&!i.stopped&&(r.bubble(i,n,null,s),a.prevented=Math.max(a.prevented,s.prevented)),a.prevented?i.preventedFn.call(r,a).then(null,function(e){return!1}):i.defaultFn.call(r,a).then(function(){e=i._afters;if(e)for(f=0,l=e.length;f<l;++f)try{e[f].fn.call(e[f].context,a)}catch(t){}if(s.afterQueue)while(o=s.afterQueue.last())o()}).then(null,function(e){return!1})})},i._fire=function(e){return i.fire(e[0])}},e.Global.ITSAMessageController||(e.Global.ITSAMessageController=new _),e.ITSAMessageController=e.Global.ITSAMessageController},"@VERSION@",{requires:["yui-base","oop","base-base","event-custom-complex","promise","gallery-itsamodulesloadedpromise"]});
