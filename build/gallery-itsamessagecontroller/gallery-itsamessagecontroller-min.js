YUI.add("gallery-itsamessagecontroller",function(e,t){"use strict";function it(){it.superclass.constructor.apply(this,arguments)}var n=e.Array,r="application",i="boolean",s="error",o="info",u="warn",a="string",f="delete",l="destroy",c="essage",h="m"+c,p="mail",d="e"+p,v="url",m=5e3,g="model",y="sync",b="list",w="gallery-itsa",E=y+"promise",S=w+g+E,x=w+g+b+E,T=g+y,N="_pub_",C="new"+h,k=N+C,L=w+h,A="get",O="show",M="remove",_="Status",D="Confirmation",P=A+"Retry"+D,H=A+D,B=A+"Input",j=A+"Number",F=A+"E"+p,I=A+"URL",q=O+"M"+c,R=O+"Warning",U=O+"Error",z=O+_,W=M+_,X="_",V="base-build",$="textarea",J="question",K=o+"rm",Q="itsaicon-dialog-",G=Q+K,Y=Q+s,Z=Q+o,et=Q+J,tt=Q+u,nt="non-simple-message cannot be targetted to simple-messageviewer",rt="itsadialog";it.NAME="ITSAMessageControllerClass",e.ITSAMessageControllerClass=e.extend(it,e.Base),it.prototype.initializer=function(){var t=this,n;t.queue=[],n=t._eventhandlers=[],t._targets={info:rt,warn:rt,error:rt},t._simpleTargets={info:rt,warn:rt,error:rt},t.errorMidi="error.midi",t.soundWarning=!0,t.soundError=!0,t.warnMidi="warn.midi",n.push(e.on(C,function(e){var t=e.itsamessage,n=t.target;n&&!t._simpleMessage&&n.simpleMessages&&(e.preventDefault(),t._rejectPromise(new Error(nt)))})),e.later(m,t,t.isReady)},it.prototype.isReady=function(){var t=this;return t._readyPromise||(t._readyPromise=e.usePromise(V,L).then(function(){t._intlMessageObj=new e.ITSAMessage},function(e){var n={error:e&&(e.message||e),src:"ITSAMessageViewer"};t._lazyFireErrorEvent(n)}))},it.prototype.queueMessage=function(t){var n=this,r,i,s;return r=new e.Promise(function(e,t){i=e,s=t}),t||(t={}),t._promise=r,t._resolvePromise=i,t._rejectPromise=s,n[k]||(n[k]=e.publish(C,{defaultTargetOnly:!0,emitFacade:!0,defaultFn:e.rbind(n._defQueueFn,n),preventedFn:n._prevDefFn})),e.fire(C,{itsamessage:t}),r},it.prototype.sound=function(e){var t=this;t.isReady().then(function(){var n,r=e.soundfile;r?n=r:e.level===u?t.soundWarning&&(n=t.warnMidi):e.level===s&&t.soundError&&(n=t.errorMidi),n&&t._playMidi(n)})},it.prototype.destructor=function(){var t=this,r=t.queue,i=t._intlMessageObj;t._clearEventhandlers(),t.removeTarget(e),n.each(r,function(e){e.detachAll(),e.destroy(),e=null}),r.length=0,i&&i.destroy()&&(t._intlMessageObj=null),t._targets={},t._simpleTargets={}},it.prototype._clearEventhandlers=function(){var e=this;n.each(e._eventhandlers,function(e){e.detach()})},it.prototype._playMidi=function(e){console.log("playing "+e)},it.prototype._retrieveParams=function(e,t,n){var r=typeof t===a,i;return r||(n=t,t=e,e=null),i=typeof t===a,i||(n=t,t="",e=null),n||(n={}),{title:e,message:t,config:n}},it.prototype._setupModelSyncListeners=function(){var t=this,n=t._eventhandlers;n.push(e.on(["*:load","*:submit","*:save","*:destroy"],function(n){var r=n.target,i=n.type,s=n.options,o=s.remove||s[f],u=i.split(":")[1],a,c;e.usePromise(g,g+"-"+b,S,x).then(function(){(r instanceof e.Model||r instanceof e.ModelList)&&(u!==l||o)&&!r._itsamessageListener&&(c=r._defSyncMessages,a=t._showStatus(n.syncmessage||c&&c[u]||e.Intl.get(S)[u],{source:T}),n.promise.then(function(){t._removeStatus(a)},function(){t._removeStatus(a)}))})}))},it.prototype[X+P]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_abort}{btn_ignore}{btn_retry}","btn_retry","btn_abort",P,u,tt)},it.prototype[X+H]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_no}{btn_yes}","btn_yes","btn_no",H,o,et)},it.prototype[X+I]=function(e,t,n){var r=this,i=r._retrieveParams(e,t,n),s=i.config;return s.url=!0,r[X+B](i.title,i.message,s)},it.prototype[X+F]=function(e,t,n){var r=this,i=r._retrieveParams(e,t,n),s=i.config;return s.email=!0,r[X+B](i.title,i.message,s)},it.prototype[X+B]=function(t,n,r){var s=this,u=s._retrieveParams(t,n,r),a,f,l,c,h,p;return t=u.title,n=u.message,r=u.config,p=r.formconfig||{},p.fullselect=!0,l=typeof r.email===i&&r.email,c=typeof r.url===i&&r.url,p.primarybtnonenter=!r[$]||l||c,h=l?d:c?v:r[$]?$:"text",p.classname="itsa-"+h+(p.classname?" "+p.classname:""),a=typeof r.required===i&&r.required,p.required=a,s.isReady().then(function(){return(r.email||r.url)&&(r.validationerror||(r.validationerror=s._intlMessageObj.translate("enterrightformat"))),f=e.Base.create("itsamessageinput",e.ITSAMessage,[],null,{ATTRS:{input:{value:r.value,formtype:h,formconfig:p,validator:r.validator,validationerror:r.validationerror}}}),n+='<fieldset class="itsa-input"><div class="pure-control-group">{input}</div></fieldset>',s._queueMessage(t,n,r,(a?"":"{btn_cancel}")+"{btn_ok}","btn_ok",a?null:"btn_cancel",B,o,Z,null,null,f)})},it.prototype[X+j]=function(t,n,r){var s=this,u=s._retrieveParams(t,n,r),a,f,l;return t=u.title,n=u.message,r=u.config,l=r.formconfig||{},l.fullselect=!0,l.primarybtnonenter=!0,l.classname="itsa-number"+(l.classname?" "+l.classname:""),l.required=!0,a=typeof r.required===i&&r.required,s.isReady().then(function(){return r.validationerror||(r.validationerror=s._intlMessageObj.translate("entervalidnumber")),f=e.Base.create("itsamessagenumber",e.ITSAMessage,[],null,{ATTRS:{number:{value:r.value,formtype:"number",formconfig:l,validator:r.validator,validationerror:r.validationerror}}}),n+='<fieldset class="itsa-number"><div class="pure-control-group">{number}</div></fieldset>',s._queueMessage(t,n,r,(a?"":"{btn_cancel}")+"{btn_ok}","btn_ok",a?null:"btn_cancel",j,o,Z,null,null,f)})},it.prototype[X+W]=function(e){e.then(function(e){e.resolve()})},it.prototype[X+q]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_ok}","btn_ok",null,q,o,G,!1,!0)},it.prototype[X+R]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_ok}","btn_ok",null,R,u,tt,!1,!0)},it.prototype[X+U]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_ok}","btn_ok",null,U,s,Y,!1,!0)},it.prototype[X+z]=function(t,n){var i=this;return t=typeof t===a?t:"",n||(n={}),i.isReady().then(function(){var s=new e.ITSAMessage;return s.message=t,s._simpleMessage=!0,s._statusMessage=!0,s.type=z,s.level=o,s.noButtons=!0,s.priority=n.priority,s.timeoutResolve=n.timeoutResolve
,s.timeoutReject=n.timeoutReject,s.target=n.target,s.source=n.source||r,s.messageType=z,i.queueMessage(s),s})},it.prototype._lazyFireErrorEvent=function(e){var t=this;t._errorEvent||(t._errorEvent=t.publish(s,{broadcast:1})),t.fire(s,e)},it.prototype._prevDefFn=function(t){var n=t.itsamessage;return n._rejectPromise(new Error("queuemessage prevented")),new e.Promise(function(e){n.detachAll(),n.destroy(),n=null,e()})},it.prototype._defQueueFn=function(e){var t=this,n=e.itsamessage,r=t.queue;return r.push(n),n._promise.then(null,function(){return!0}).then(function(){var e=r.indexOf(n);e>-1&&r.splice(e,1),n.detachAll(),n.destroy(),n=null})},it.prototype._queueMessage=function(t,n,s,o,u,a,f,l,c,h,p,d){var v=this,m=v._retrieveParams(t,n,s),g,y,b;return t=m.title,n=m.message,s=m.config,g=typeof s.imageButtons===i&&s.imageButtons,b=typeof s.simpleMessage===i&&s.simpleMessage||typeof p===i&&p||!1,y=typeof s.required===i&&s.required||!1,g&&(o=o.replace(/\{btn_/g,"{imgbtn_"),u&&(u=u.replace(/btn_/g,"imgbtn_"))),v.isReady().then(function(){var i=d?new d:new e.ITSAMessage;return i.title=t,i.message=n,i._config=s,i._simpleMessage=b,i.footer=o,i.icon=s.icon||c,i.closeButton=y?!1:s.closeButton||h,i.priority=s.priority,i.imageButtons=g,i.primaryButton=s.primaryButton||u,i.rejectButton=a,i.timeoutResolve=s.timeoutResolve,i.timeoutReject=s.timeoutReject,i.target=s.target,i.level=s.level||l,i.source=s.source||r,i.messageType=f,v.queueMessage(i)})},e.Global.ITSAMessageController||(e.Global.ITSAMessageController=new it),e.ITSAMessageController=e.Global.ITSAMessageController},"@VERSION@",{requires:["yui-base","oop","base-base","base-build","event-custom-complex","promise","event-custom-base","yui-later","gallery-itsamodulesloadedpromise"]});
