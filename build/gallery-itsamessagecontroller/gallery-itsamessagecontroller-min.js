YUI.add("gallery-itsamessagecontroller",function(e,t){"use strict";function X(){X.superclass.constructor.apply(this,arguments)}var n=e.Array,r="application",i="boolean",s="error",o="info",u="warn",a="essage",f="m"+a,l="mail",c="e"+l,h="url",p=5e3,d="_pub_",v="queued"+f,m=d+v,g="new"+f,y=d+g,b="gallery-itsamessage",w="get",E="show",S="Confirmation",x=w+"Retry"+S,T=w+S,N=w+"Input",C=w+"Number",k=w+"E"+l,L=w+"URL",A=E+"M"+a,O=E+"Warning",M=E+"Error",_=E+"Status",D="_",P="base-build",H="textarea",B="question",j=o+"rm",F="itsaicon-dialog-",I=F+j,q=F+s,R=F+o,U=F+B,z=F+u,W="itsadialog";X.NAME="ITSAMessageControllerClass",e.ITSAMessageControllerClass=e.extend(X,e.Base),X.prototype.initializer=function(){var t=this;t.queue=[],t._targets={info:W,warn:W,error:W},t.errorMidi="error.midi",t.soundWarning=!0,t.soundError=!0,t.warnMidi="warn.midi",e.later(p,t,t.isReady)},X.prototype.queueMessage=function(t){var n=this,r,i,s;return r=new e.Promise(function(e,t){i=e,s=t}),t||(t={}),t._promise=r,t._resolvePromise=i,t._rejectPromise=s,n[m]||(n[m]=e._publishAsync(v,{defaultTargetOnly:!0,emitFacade:!0,broadcast:2,defaultFn:e.rbind(n._defQueueFn,n),preventedFn:n._prevDefFn})),e.fire(v,{itsamessage:t}),r},X.prototype.isReady=function(){var t=this;return t._readyPromise||(t._readyPromise=e.usePromise(P,b).then(function(){t._intlMessageObj=new e.ITSAMessage},function(e){var n={error:e&&(e.message||e),src:"ITSAMessageViewer._processQueue"};t._lazyFireErrorEvent(n)}))},X.prototype.sound=function(e){var t=this;t.isReady().then(function(){var n,r=e.soundfile;r?n=r:e.level===u?t.soundWarning&&(n=t.warnMidi):e.level===s&&t.soundError&&(n=t.errorMidi),n&&t._playMidi(n)})},X.prototype.destructor=function(){var t=this,r=t.queue,i=t._intlMessageObj;t.removeTarget(e),n.each(r,function(e){e.detachAll(),e.destroy(),e=null}),r.length=0,i&&i.destroy()&&(t._intlMessageObj=null),t._targets={}},X.prototype._playMidi=function(e){console.log("playing "+e)},X.prototype._retrieveParams=function(e,t,n){var r=typeof t=="string",i;return r||(n=t,t=e,e=null),i=typeof t=="string",i||(n=t,t="",e=null),n||(n={}),{title:e,message:t,config:n}},X.prototype[D+x]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_abort}{btn_ignore}{btn_retry}","btn_retry","btn_abort",x,u,z)},X.prototype[D+T]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_no}{btn_yes}","btn_yes","btn_no",T,o,U)},X.prototype[D+L]=function(e,t,n){var r=this,i=r._retrieveParams(e,t,n),s=i.config;return s.url=!0,r[D+N](i.title,i.message,s)},X.prototype[D+k]=function(e,t,n){var r=this,i=r._retrieveParams(e,t,n),s=i.config;return s.email=!0,r[D+N](i.title,i.message,s)},X.prototype[D+N]=function(t,n,r){var s=this,u=s._retrieveParams(t,n,r),a,f,l,p,d,v;return t=u.title,n=u.message,r=u.config,v=r.formconfig||{},v.fullselect=!0,l=typeof r.email===i&&r.email,p=typeof r.url===i&&r.url,v.primarybtnonenter=!r[H]||l||p,d=l?c:p?h:r[H]?H:"text",v.classname="itsa-"+d+(v.classname?" "+v.classname:""),v.required=!0,a=typeof r.required===i&&r.required,s.isReady().then(function(){return(r.email||r.url)&&(r.validationerror||(r.validationerror=s._intlMessageObj.translate("enterrightformat"))),f=e.Base.create("itsamessageinput",e.ITSAMessage,[],null,{ATTRS:{input:{value:r.value,formtype:d,formconfig:v,validator:r.validator,validationerror:r.validationerror}}}),n+='<fieldset class="itsa-input"><div class="pure-control-group">{input}</div></fieldset>',s._queueMessage(t,n,r,(a?"":"{btn_cancel}")+"{btn_ok}","btn_ok",a?null:"btn_cancel",N,o,R,null,f)})},X.prototype[D+C]=function(t,n,r){var s=this,u=s._retrieveParams(t,n,r),a,f,l;return t=u.title,n=u.message,r=u.config,l=r.formconfig||{},l.fullselect=!0,l.primarybtnonenter=!0,l.classname="itsa-number"+(l.classname?" "+l.classname:""),l.required=!0,a=typeof r.required===i&&r.required,s.isReady().then(function(){return r.validationerror||(r.validationerror=s._intlMessageObj.translate("entervalidnumber")),f=e.Base.create("itsamessagenumber",e.ITSAMessage,[],null,{ATTRS:{number:{value:r.value,formtype:"number",formconfig:l,validator:r.validator,validationerror:r.validationerror}}}),n+='<fieldset class="itsa-number"><div class="pure-control-group">{number}</div></fieldset>',s._queueMessage(t,n,r,(a?"":"{btn_cancel}")+"{btn_ok}","btn_ok",a?null:"btn_cancel",C,o,R,null,f)})},X.prototype[D+A]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_ok}","btn_ok",null,A,o,I,!1)},X.prototype[D+O]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_ok}","btn_ok",null,O,u,z,!1)},X.prototype[D+M]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_ok}","btn_ok",null,M,s,q,!1)},X.prototype[D+_]=function(t,n,i){var s=this;return s.isReady().then(function(){var u=new e.ITSAMessage;return u.title=t,u.message=n,u.type=_,u.level=o,u.noButtons=!0,u.priority=i.priority,u.timeoutResolve=i.timeoutResolve,u.timeoutReject=i.timeoutReject,u.target=i.target,u.source=i.source||r,u.messageType=_,s.queueMessage(u),u})},X.prototype._lazyFireErrorEvent=function(e){var t=this;t._errorEvent||(t._errorEvent=t.publish(s,{broadcast:1})),t.fire(s,e)},X.prototype._prevDefFn=function(t){var n=t.itsamessage;return new e.Promise(function(e){n.detachAll(),n.destroy(),n=null,e()})},X.prototype._defQueueFn=function(t){var n=this,r=t.itsamessage,i=n.queue;return i.push(r),n[y]||(n[y]=e.publish(g,{defaultTargetOnly:!0,broadcast:2,emitFacade:!0})),e.fire(g,{itsamessage:r}),r._promise.then(null,function(){return!0}).then(function(){var e=i.indexOf(r);e>-1&&i.splice(e,1),r.detachAll(),r.destroy(),r=null})},X.prototype._queueMessage=function(t,n,s,o,u,a,f,l,c,h,p){var d=this,v=d._retrieveParams(t,n,s),m,g;return t=v.title,n=v.message,s=v.config,m=typeof s.imageButtons===i&&s.imageButtons,g=typeof s.required===i&&s.required||!1,m&&(o=o.replace(/\{btn_/g,"{imgbtn_"),u&&(u=u.replace(/btn_/g,"imgbtn_"))),d.isReady().then(function(){var i=p?new p:new e.ITSAMessage;return i.title=t,i.message=n,i._config=s,i.footer=o,i.icon=s.icon||c,i.closeButton=g?!1:s.closeButton||h,i.priority=s.priority,i.imageButtons=m,
i.primaryButton=s.primaryButton||u,i.rejectButton=a,i.timeoutResolve=s.timeoutResolve,i.timeoutReject=s.timeoutReject,i.target=s.target,i.level=s.level||l,i.source=s.source||r,i.messageType=f,d.queueMessage(i)})},e._publishAsync=function(t,n){var r=this,i=this.publish(t,n);i._firing=new e.Promise(function(e){e()}),i.fire=function(t){var n=e.Array(arguments,0,!0),s={id:i.id,next:i,silent:i.silent,stopped:0,prevented:0,bubbling:null,type:i.type,defaultTargetOnly:i.defaultTargetOnly},o;i._firing=i._firing.then(function(){i.details=n;var e=i._subscribers,u=[],a,f,l;u.push.apply(u,t),a=i._createFacade(u),a.target=a.target||r;if(e)for(f=0,l=e.length;f<l;++f)try{e[f].fn.call(e[f].context,a)}catch(c){}return i.bubbles&&!i.stopped&&(r.bubble(i,n,null,s),a.prevented=Math.max(a.prevented,s.prevented)),a.prevented?i.preventedFn.call(r,a).then(null,function(e){return!1}):i.defaultFn.call(r,a).then(function(){e=i._afters;if(e)for(f=0,l=e.length;f<l;++f)try{e[f].fn.call(e[f].context,a)}catch(t){}if(s.afterQueue)while(o=s.afterQueue.last())o()}).then(null,function(e){var t={error:e&&(e.message||e),src:"ITSAMessageViewer._processQueue"};return r._lazyFireErrorEvent(t),!1})})},i._fire=function(e){return i.fire(e[0])}},e.Global.ITSAMessageController||(e.Global.ITSAMessageController=new X),e.ITSAMessageController=e.Global.ITSAMessageController},"@VERSION@",{requires:["yui-base","oop","base-base","base-build","event-custom-complex","promise","gallery-itsamodulesloadedpromise"]});
