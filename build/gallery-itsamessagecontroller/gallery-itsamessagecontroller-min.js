YUI.add("gallery-itsamessagecontroller",function(e,t){"use strict";function z(){z.superclass.constructor.apply(this,arguments)}var n,r=e.Array,i="application",s="boolean",o="error",u="info",a="warn",f="essage",l="m"+f,c="mail",h="e"+c,p="url",d=5e3,v="_pub_",m="new"+l,g=v+m,y=m+"_added",b=v+y,w="gallery-itsamessage",E="get",S="show",x="Date",T="Time",N="Confirmation",C=E+"Retry"+N,k=E+N,L=E+"Input",A=E+"Number",O=E+"E"+c,M=E+"URL",_=E+x,D=E+T,P=_+T,H=S+"M"+f,B=S+"Warning",j=S+"Error",F=S+"Status",I="_",q="base-build",R="textarea",U="slider";z.NAME="itsamessagecontroller",e.extend(z,e.Base),z.prototype.initializer=function(){var t=this;t.queue=[],e.later(d,t,t.readyPromise)},z.prototype._retreiveParams=function(e,t,n){var r=typeof t=="string",i;return r||(n=t,t=e,e=null),i=typeof t=="string",i||(n=t,t="",e=null),n||(n={}),{title:e,message:t,config:n}},z.prototype.readyPromise=function(){var t=this;return t._readyPromise||(t._readyPromise=e.usePromise(w))},z.prototype[I+C]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_abort}{btn_ignore}{btn_retry}","btn_retry","btn_abort",C,u)},z.prototype[I+k]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_no}{btn_yes}","btn_yes","btn_no",k,u)},z.prototype[I+M]=function(e,t,n){var r=this,i=r._retreiveParams(e,t,n);return i.config.url=!0,this[I+L](i.title,i.message,i.config)},z.prototype[I+O]=function(e,t,n){var r=this,i=r._retreiveParams(e,t,n);return i.config.email=!0,this[I+L](i.title,i.message,i.config)},z.prototype[I+L]=function(t,n,r){var i=this,o=i._retreiveParams(t,n,r),a,f,l,c,d;return t=o.title,n=o.message,r=o.config,r.formconfig||(r.formconfig={}),r.formconfig.classname||(r.formconfig.classname=""),r.formconfig.fullselect=!0,r.formconfig.primarybtnonenter=!r[R],l=typeof r.email===s&&r.email,c=typeof r.url===s&&r.url,d=l?h:c?p:r[R]?R:"text",r.formconfig.classname+=" itsa-"+d,a=typeof r.formconfig.required===s&&r.formconfig.required,i.readyPromise().then(function(){return e.usePromise(q)}).then(function(){return f=e.Base.create("itsamessageinput",e.ITSAMessage,[],null,{ATTRS:{input:{value:r.value,formtype:d,formconfig:r.formconfig,validator:r.validator,validationerror:r.validationerror}}}),n+='<fieldset class="itsa-input"><div class="pure-control-group">{input}</div></fieldset>',i._queueMessage(t,n,r,(a?"":"{btn_cancel}")+"{btn_ok}","btn_ok","btn_cancel",L,u,f)})},z.prototype[I+A]=function(t,n,r){var i=this,o=i._retreiveParams(t,n,r),a,f;return t=o.title,n=o.message,r=o.config,r.formconfig||(r.formconfig={}),r.formconfig.classname||(r.formconfig.classname=""),r.formconfig.fullselect=!0,r.formconfig.primarybtnonenter=!0,r.formconfig.classname+=" itsa-number",a=typeof r.formconfig.required===s&&r.formconfig.required,i.readyPromise().then(function(){return r.slider?e.usePromise(q,U):e.usePromise(q)}).then(function(){return f=e.Base.create("itsamessagenumber",e.ITSAMessage,[],null,{ATTRS:{number:{value:r.value,formtype:r.slider?e.Slider:"number",formconfig:r.formconfig,validator:r.validator,validationerror:r.validationerror}}}),n+='<fieldset class="itsa-number"><div class="pure-control-group">{number}</div></fieldset>',i._queueMessage(t,n,r,(a?"":"{btn_cancel}")+"{btn_ok}","btn_ok","btn_cancel",A,u,f)})},z.prototype[I+_]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_cancel}{btn_ok}","btn_ok","btn_cancel",_,u)},z.prototype[I+D]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_cancel}{btn_ok}","btn_ok","btn_cancel",D,u)},z.prototype[I+P]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_cancel}{btn_ok}","btn_ok","btn_cancel",P,u)},z.prototype[I+H]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_ok}","btn_ok",null,H,u)},z.prototype[I+B]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_ok}","btn_ok",null,B,a)},z.prototype[I+j]=function(e,t,n){return this._queueMessage(e,t,n,"{btn_ok}","btn_ok",null,j,o)},z.prototype[I+F]=function(t,n,r){var s=this,o=s._retreiveParams(t,n,r),a;return t=o.title,n=o.message,r=o.config,a=e.merge(r,{title:t,message:n,footer:null,noButtons:!0,source:i,type:F,level:u}),s.readyPromise().then(function(){var t=new e.ITSAMessage(a);return s.queueMessage(t),t})},z.prototype.queueMessage=function(t){console.log("queueMessage "+t.get("message"));var n=this,r=t.get("autoDestroy"),i,s,o;return i=new e.Promise(function(e,t){s=e,o=t}),t||(t={}),t.promise=i,t.resolvePromise=s,t.rejectPromise=o,t.after("submit",function(){t.resolve()}),n[g]||(n[g]=e._publishAsync(m,{defaultTargetOnly:!0,emitFacade:!0,broadcast:2,defaultFn:e.rbind(n._defQueueFn,n),preventedFn:n._prevDefFn})),r>0&&t.promise.then(e.bind(n._autoDestroyMsg,n,t,r),e.bind(n._autoDestroyMsg,n,t,r)),e.fire(m,{model:t}),console.log("fireing "+m),i},z.prototype.destructor=function(){var t=this,n=t.queue;t.removeTarget(e),r.each(n,function(e){e.detachAll(),e.destroy(),e=null}),n.length=0},z.prototype._autoDestroyMsg=function(t,n){e.later(n,null,function(){console.log("DESTROYING "+t.get("title")),t.detachAll(),t.destroy(),t=null})},z.prototype._prevDefFn=function(e){e.message.promiseReject(new Error("preventDefaulted"))},z.prototype._defQueueFn=function(t){console.log("_defQueueFn "+t.model.get("message"));var n=this,r=t.model,i=n.queue;return i.push(r),n[b]||(n[b]=e.publish(y,{defaultTargetOnly:!0,broadcast:2,emitFacade:!0})),console.log("fireing "+y),e.fire(y,{model:r}),r.promise.then(null,function(){return!0}).then(function(){var e=i.indexOf(r);e>-1&&i.splice(e,1)})},z.prototype._queueMessage=function(t,n,r,o,u,a,f,l,c){console.log("_queueMessage "+t);var h=this,p=h._retreiveParams(t,n,r),d,v;return t=p.title,n=p.message,r=p.config,v=typeof r.imageButtons===s&&r.imageButtons,v&&(o=o.replace(/\{btn_/g,"{imgbtn_"),u&&(u=u.replace(/btn_/g,"imgbtn_"))),d=e.merge(r,{title:t,message:n,footer:o,source:i,primaryButton:u,rejectButton:a,type:f,level:l}),r.level&&(d.level=r.level),r.primaryButton&&(d.primaryButton=r.primaryButton),d.level||(d.level=r.type),h.readyPromise().then(function(){return h.queueMessage(c?new c(d):new e.ITSAMessage(d))})},e._publishAsync=
function(t,n){var r=this,i=this.publish(t,n);i._firing=new e.Promise(function(e){e()}),i.fire=function(t){var n=e.Array(arguments,0,!0),s={id:i.id,next:i,silent:i.silent,stopped:0,prevented:0,bubbling:null,type:i.type,defaultTargetOnly:i.defaultTargetOnly},o;i._firing=i._firing.then(function(){i.details=n;var e=i._subscribers,u=[],a,f,l;u.push.apply(u,t),a=i._createFacade(u),a.target=a.target||r;if(e)for(f=0,l=e.length;f<l;++f)try{e[f].fn.call(e[f].context,a)}catch(c){}return i.bubbles&&!i.stopped&&(r.bubble(i,n,null,s),a.prevented=Math.max(a.prevented,s.prevented)),a.prevented?i.preventedFn.call(r,a).then(null,function(e){return!1}):i.defaultFn.call(r,a).then(function(){e=i._afters;if(e)for(f=0,l=e.length;f<l;++f)try{e[f].fn.call(e[f].context,a)}catch(t){}if(s.afterQueue)while(o=s.afterQueue.last())o()}).then(null,function(e){return!1})})},i._fire=function(e){return i.fire(e[0])}},e.Global.ITSAMessageController||(e.Global.ITSAMessageController=new z),n=e.ITSAMessageController=e.Global.ITSAMessageController,e[C]=e.bind(n[I+C],n),e.confirm=e[k]=e.bind(n[I+k],n),e.prompt=e[L]=e.bind(n[I+L],n),e[A]=e.bind(n[I+A],n),e[O]=e.bind(n[I+O],n),e[M]=e.bind(n[I+M],n),e[_]=e.bind(n[I+_],n),e[D]=e.bind(n[I+D],n),e[P]=e.bind(n[I+P],n),e[H]=e.bind(n[I+H],n),e.alert=e[B]=e.bind(n[I+B],n),e[j]=e.bind(n[I+j],n),e[F]=e.bind(n[I+F],n)},"@VERSION@",{requires:["yui-base","oop","base-base","event-custom-complex","promise","gallery-itsamodulesloadedpromise"]});
