YUI.add("gallery-itsamodellistviewextention",function(e,t){"use strict";function A(){}function O(){}var n=e.Lang,r=e.Object,i=e.Array,s=e.Node,o=e.Template.Micro,u='<ul role="presentation"></ul>',a='<li role="presentation"></li>',f="<li></li>",l="itsa-scrollview-fillelement",c="itsa-scrollviewmodel",h=c+"-changed",p="itsa-scrollviewmodellist",d=p+"-noinitialitems",v=p+"-view-noinitialitems",m=p+"-noitems",g=p+"-view-noitems",y=c+"-focus",b=c+"-selected",w=c+"-even",E=c+"-odd",S=p+"-styled",x=p+"-groupheader",T=p+"-groupheader1",N=p+"-groupheader2",C=p+"-groupheader3",k=p+"-sequelgroupheader",L=function(e,t){return parseInt(e.getStyle(t),10)};e.mix(A.prototype,{getModelAttr:function(e,t){return e&&(e.get&&n.type(e.get)==="function"?e.get(t):e[t])},setModelAttr:function(e,t,r,i){var s=this,o,u;e&&(o=!e.get||n.type(e.get)!=="function",o?(u=s.revive(e),e[t]=r,u&&(u._set("clientId",e.clientId,{silent:!0}),u.set(t,r,i),s.free(u))):e.set(t,r,i))},getModelToJSON:function(e){return e.get&&n.type(e.get)==="function"?e.toJSON():e}},!0),e.ITSAModellistAttrExtention=A,e.Base.mix(e.ModelList,[A]),O.ATTRS={modelList:{value:null,validator:function(t){return t instanceof e.ModelList||t instanceof e.LazyModelList||t===null},setter:"_setModelList"},noDups:{value:!1,validator:function(e){return n.isBoolean(e)},setter:"_setNoDups"},limitModels:{value:0,validator:function(e){return n.isNumber(e)},setter:"_setLimitModels"},viewFilter:{value:null,validator:function(e){return n.isFunction(e)||e===null},setter:"_setViewFilter"},modelsSelectable:{value:null,lazyAdd:!1,validator:function(e){return e===""||e===null||n.isBoolean(e)||e==="single"||e==="multi"},setter:"_setModelsSel"},modelsUnselectable:{value:!1,validator:function(e){return n.isBoolean(e)}},modelListStyled:{value:!1,lazyAdd:!1,validator:function(e){return n.isBoolean(e)},setter:"_setModelListStyled"},clickSensivity:{value:2,validator:function(e){return n.isNumber(e)&&e>=0&&e<11}},clickEvents:{value:!1,lazyAdd:!1,validator:function(e){return n.isBoolean(e)},setter:"_setClkEv"},dblclickEvents:{value:!1,lazyAdd:!1,validator:function(e){return n.isBoolean(e)},setter:"_setDblclkEv"},highlightAfterModelChange:{value:0,validator:function(e){return n.isNumber(e)},setter:"_setMarkModelChange"},modelsIntoViewAfterAdd:{value:!1,validator:function(e){return n.isNumber(e)&&e>=0&&e<=2},setter:"_setIntoViewAdded"},modelsIntoViewAfterChange:{value:!1,validator:function(e){return n.isNumber(e)&&e>=0&&e<=2},setter:"_setIntoViewChanged"},mouseDownUpEvents:{value:!1,lazyAdd:!1,validator:function(e){return n.isBoolean(e)},setter:"_setMouseDnUpEv"},hoverEvents:{value:!1,lazyAdd:!1,validator:function(e){return n.isBoolean(e)},setter:"_setHoverEv"},lastItemOnTop:{value:0,validator:function(e){return n.isNumber(e)&&e>-1&&e<3},setter:"_setLastItemOnTop"},groupHeader1:{value:null,validator:function(e){return n.isString(e)||e===null},setter:"_setGrpH1"},groupHeader2:{value:null,validator:function(e){return n.isString(e)||e===null},setter:"_setGrpH2"},groupHeader3:{value:null,validator:function(e){return n.isString(e)||e===null},setter:"_setGrpH3"},renderModel:{value:"{clientId}",validator:function(e){return n.isString(e)},setter:"_setRenderModel"},renderGroupHeader1:{value:null,validator:function(e){return n.isString(e)||e===null},setter:"_setRenderGrH1"},renderGroupHeader2:{value:null,validator:function(e){return n.isString(e)||e===null},setter:"_setRenderGrH2"},renderGroupHeader3:{value:null,validator:function(e){return n.isString(e)||e===null},setter:"_setRenderGrH3"},dupComparator:{value:null,validator:function(e){return n.isFunction(e)||e===null},setter:"_setDupComp"}},e.mix(O.prototype,{_handlers:[],_origModels:[],_selModelEv:null,_clkModelEv:null,_dblclkModelEv:null,_mouseentModelEv:null,_mouseUpModelEv:null,_mouseDnModelEv:null,_mouseleaveModelEv:null,_markModelChangeEv:null,_markModelAddEv:null,_modelInViewChanged:null,_modelInViewAdded:null,_selectedModels:{},_viewNode:null,_viewId:null,_currentViewPg:0,_templFns:null,_lastClkModel:null,_abModelList:null,_viewFilterInit:!1,_lastItemTopInit:!1,_grpH1Init:!1,_grpH2Init:!1,_grpH3Init:!1,_renderGrpH1Init:!1,_renderGrpH2Init:!1,_renderGrpH3Init:!1,_renderModelInit:!1,_dupCompInit:!1,_noDupsInit:!1,_limModelsInit:!1,_rerendAttrChg:!0,_itmsAvail:!0,_prevLastModelIndex:-1,_listLazy:!1,_prevH1:null,_prevH2:null,_prevH3:null,_even:!1,initializer:function(){var t=this;t._viewId=e.guid(),t._handlers.push(t.after("render",t._render,t))},setWithoutRerender:function(e,t,n){var r=this;r._rerendAttrChg=!1,r.set(e,t,n),r._rerendAttrChg=!0},getNodeFromIndex:function(e,t){return this._getNodeFromModelOrIndex(null,e,t)},getNodeFromModel:function(e,t){return this._getNodeFromModelOrIndex(e,null,t)},saveScrollTo:function(e,t){var n=this,r=n.get("boundingBox"),i=n._viewNode,s;e&&(e=Math.max(0,e),s=i.get("offsetWidth")-r.get("offsetWidth"),e=Math.min(e,s)),t&&(t=Math.max(0,t),s=i.get("offsetHeight")-r.get("offsetHeight"),t=Math.min(t,s)),n.scrollTo(e,t)},scrollIntoView:function(t,r,i){var s=this,o=s.get("boundingBox"),u=s.get("axis"),a=u.y,f=a?o.get("offsetHeight"):o.get("offsetWidth"),l=a?o.getY():o.getX(),h=s._viewNode,p=s.itsainfiniteview,d=s.pages,v,m,g,y,b,w,E,S,T,N,C,k;E=function(e){var t=a?e.getY():e.getX(),i;return a?i=t+e.get("offsetHeight")+L(e,"marginTop")+L(e,"marginBottom"):i=t+e.get("offsetWidth")+L(e,"marginLeft")+L(e,"marginRight"),t<l||r&&n.isBoolean(r.forceTop)&&r.forceTop?-1:i>l+f||r&&n.isBoolean(r.forceBottom)&&r.forceBottom?1:0},t instanceof e.Node&&(b=t),b||n.isNumber(t)?(b=b||s.getNodeFromIndex(t,i),T=E(b),d&&T!==0&&(w=h.all(">li"),w.some(function(e,n){return e.hasClass(c)||t++,n===t}))):(b=t&&s.getNodeFromModel(t,i),T=E(b),d&&T!==0&&(w=h.all(">li"),t=0,w.some(function(e,n){var r=e===b;return r&&(t=n),r}))),(!r||!n.isBoolean(r.noFocus)||!r.noFocus)&&s._focusModelNode(b);if(b&&T!==0){S=T===-1;if(S&&r&&n.isBoolean(r.showHeaders)&&r.showHeaders){k=b.previous();while(k&&k.hasClass(x))b=k,k=k.previous()}a?(v=b.getY(),m=s.get("scrollY"
),N=b.get("offsetHeight")+L(b,"marginTop")+L(b,"marginBottom"),g=h.get("offsetHeight")-f):(v=b.getX(),m=s.get("scrollX"),N=b.get("offsetWidth")+L(b,"marginLeft")+L(b,"marginRight"),g=h.get("offsetWidth")-f),p&&!S&&p.checkExpansion();if(d){if(!S){while(N<f&&t>0)C=!0,t--,b=b.previous("li"),a?N+=b.get("offsetHeight")+L(b,"marginTop")+L(b,"marginBottom"):N+=b.get("offsetWidth")+L(b,"marginLeft")+L(b,"marginRight");C&&t++,t=Math.min(t,s._getMaxPaginatorGotoIndex(t,i))}d.scrollToIndex(t)}else y=Math.round(m+v-l-(S?0:f-N)),a?s.saveScrollTo(null,y):s.saveScrollTo(y,null)}else!b},modelIsSelected:function(e){var t=this,r;return n.isArray(e)?i.some(e,function(e){return r=t._selectedModels[t.getModelAttr(e,"clientId")],r?!1:!0}):r=t._selectedModels[t.getModelAttr(e,"clientId")],n.isValue(r)},selectModels:function(e,t,r,s,o){var u=this,a=n.isArray(e),f=u.get("modelsSelectable")==="single",l,c;f&&u.clearSelectedModels(!0,!0),s||(c=u.get("contentBox"),l=c.all("."+b).size()),a&&!f?(i.each(e,function(e){u._selectModel(e,!0,o)}),t&&e.length>0&&u.scrollIntoView(e[0],r,o)):(a&&(e=e[0]),u._selectModel(e,!0,o),t&&u.scrollIntoView(e,r,o)),!s&&l!==c.all("."+b).size()&&u._fireSelectedModels()},unselectModels:function(e,t){var r=this,s,o;t||(o=r.get("contentBox"),s=o.all("."+b).size()),n.isArray(e)?i.each(e,function(e){r._selectModel(e,!1)}):r._selectModel(e,!1),!t&&s!==o.all("."+b).size()&&r._fireSelectedModels()},clearSelectedModels:function(e,t){var n=this,r=n.get("contentBox"),i,s,o,u,a,f,l;i=function(){s.each(function(e){e.blur()})},s=r.all("."+b),u=s.size()>0&&s.item(0),e?(i(),s.removeClass(b)):(o=s.size()>0,i(),s.removeClass(b),o&&n._fireSelectedModels()),n._selectedModels={},n.get("modelsUnselectable")&&u&&!t&&(a=u.getData("modelClientId"),l=n.getModelListInUse(),f=l.getByClientId(a),n.selectModels(f,!1,null,!0))},getSelectedModels:function(e){var t=this,n;return e?(n=[],r.each(t._selectedModels,function(e){var r=t._origModels[t.getModelAttr(e,"clientId")];(!r||i.indexOf(n,r)===-1)&&n.push(r||e)})):n=r.values(t._selectedModels),n},renderView:function(){this._renderView()},getModelListInUse:function(){return this._abModelList||this.get("modelList")},getModelAttr:function(e,t){return e&&(e.get&&n.type(e.get)==="function"?e.get(t):e[t])},setModelAttr:function(e,t,r,i){var s=this,o,u,a;e&&(o=!e.get||n.type(e.get)!=="function",o?(u=s.get("modelList"),a=u.revive(e),e[t]=r,a&&(a._set("clientId",e.clientId,{silent:!0}),a.set(t,r,i),u.free(a))):e.set(t,r,i))},getModelToJSON:function(e){return e.get&&n.type(e.get)==="function"?e.toJSON():e},destructor:function(){var e=this,t=e.get("modelList");e._clearEventhandlers(),t.removeTarget(e),e._selModelEv&&e._selModelEv.detach(),e._clkModelEv&&e._clkModelEv.detach(),e._dblclkModelEv&&e._dblclkModelEv.detach(),e._mouseDnModelEv&&e._mouseDnModelEv.detach(),e._mouseUpModelEv&&e._mouseUpModelEv.detach(),e._mouseentModelEv&&e._mouseentModelEv.detach(),e._mouseleaveModelEv&&e._mouseleaveModelEv.detach(),e._markModelChangeEv&&e._markModelChangeEv.detach(),e._markModelAddEv&&e._markModelAddEv.detach(),e._modelInViewChanged&&e._modelInViewChanged.detach(),e._modelInViewAdded&&e._modelInViewAdded.detach(),e._clearAbberantModelList(),e._viewNode.destroy(!0)},_render:function(){var e=this,t=e.get("modelList"),n;e._viewNode=n=s.create(u),n.set("id",e._viewId),n.addClass(g).addClass(v),e.get("boundingBox").addClass(m).addClass(d),e._templFns=e._getAllTemplateFuncs(),e._extraBindUI(),t&&e._renderView(null,{incrementbuild:!0,initbuild:!0})},_focusModelNode:function(e){e&&(this._viewNode.all("."+y).removeClass(y),e.addClass(y),e.focus())},_getMaxPaginatorGotoIndex:function(e,t){var n=this,r=n.hasPlugin("pages"),i=n.getModelListInUse(),s=n.get("axis"),o=s.y,u=n.get("boundingBox").get(o?"offsetHeight":"offsetWidth"),a=0,f,l,c;if(r&&i.size()>0){f=n.getNodeFromIndex(Math.min(e,i.size()-1),t),o?l=f.get("offsetHeight")+L(f,"marginTop")+L(f,"marginBottom"):l=f.get("offsetWidth")+L(f,"marginLeft")+L(f,"marginRight"),c=n._viewNode.all(">li"),a=c.size();while(f&&--a>=0&&l<u)f=c.item(a),o?l+=f.get("offsetHeight")+L(f,"marginTop")+L(f,"marginBottom"):l+=f.get("offsetWidth")+L(f,"marginLeft")+L(f,"marginRight");l>=u&&a++}return a},_extraBindUI:function(){var t=this,n=t.get("boundingBox"),r=t.get("modelList"),i=t._handlers;r&&(r.addTarget(t),n.addClass(p)),i.push(t.after("modelListChange",function(e){var r=e.newVal,i=e.prevVal;i&&i.removeTarget(t),r?(r.addTarget(t),n.addClass(p),t._renderView(null,{incrementbuild:!i,initbuild:!i})):(n.removeClass(p),t.get("contentBox").setHTML(""))})),i.push(n.delegate("click",function(){t._gesture=null},function(){var e=Math.abs(t.lastScrolledAmt)>t.get("clickSensivity");return!e})),i.push(t.after("*:change",function(){var e=t.get("modelList");e&&t.get("modelList").comparator&&e.sort()})),i.push(n.delegate("click",function(e){var n=t.lastScrolledAmt;n&&Math.abs(n)>t.get("clickSensivity")&&(e.preventDefault(),e.stopImmediatePropagation())},function(){var e=this.get("tagName");return e==="A"||e==="BUTTON"})),i.push(n.delegate("mousedown",function(e){e.preventDefault()},"a")),i.push(t.after(["modelList:remove","lazyModelList:remove","modelList:add","lazyModelList:add","*:change"],e.bind(t._renderView,t,null,null))),i.push(t.after(["modelList:reset","lazyModelList:reset"],e.bind(t._renderView,t,null,{keepstyles:!1}))),t.get("highlightAfterModelChange"),t.get("modelsIntoViewAfterAdd"),t.get("modelsIntoViewAfterChange")},_setModelList:function(t){var n=this;n._listLazy=t instanceof e.LazyModelList},_setNoDups:function(e){var t=this;t._noDupsInit?t._rerendAttrChg&&t._renderView({noDups:e}):t._noDupsInit=!0},_setLimitModels:function(e){var t=this;t._limModelsInit?t._rerendAttrChg&&t._renderView({limitModels:e}):t._limModelsInit=!0},_setViewFilter:function(e){var t=this;t._viewFilterInit?t._rerendAttrChg&&t._renderView({viewFilter:e}):t._viewFilterInit=!0},_setLastItemOnTop:function(e){var t=this;t._lastItemTopInit?e?(t._addEmptyItem(null,e),t.syncUI()):(t._removeEmptyItem(),t.
syncUI()):t._lastItemTopInit=!0},_setDupComp:function(e){var t=this;t._dupCompInit?t._rerendAttrChg&&t.get("noDups")&&t._renderView({dupComparator:e}):t._dupCompInit=!0},_setGrpH1:function(e){var t=this;t._grpH1Init?(t._templFns=t._getAllTemplateFuncs({groupHeader1:e}),t._rerendAttrChg&&t._renderView({groupHeader1:e})):t._grpH1Init=!0},_setGrpH2:function(e){var t=this;t._grpH2Init?(t._templFns=t._getAllTemplateFuncs({groupHeader2:e}),t._rerendAttrChg&&t._renderView({groupHeader2:e})):t._grpH2Init=!0},_setGrpH3:function(e){var t=this;t._grpH3Init?(t._templFns=t._getAllTemplateFuncs({groupHeader3:e}),t._rerendAttrChg&&t._renderView({groupHeader3:e})):t._grpH3Init=!0},_setRenderGrH1:function(e){var t=this;t._renderGrpH1Init?(t._templFns=t._getAllTemplateFuncs({renderGroupHeader1:e}),t._rerendAttrChg&&t._renderView({renderGroupHeader1:e})):t._renderGrpH1Init=!0},_setRenderGrH2:function(e){var t=this;t._renderGrpH2Init?(t._templFns=t._getAllTemplateFuncs({renderGroupHeader2:e}),t._rerendAttrChg&&t._renderView({renderGroupHeader2:e})):t._renderGrpH2Init=!0},_setRenderGrH3:function(e){var t=this;t._renderGrpH3Init?(t._templFns=t._getAllTemplateFuncs({renderGroupHeader3:e}),t._rerendAttrChg&&t._renderView({renderGroupHeader3:e})):t._renderGrpH3Init=!0},_setRenderModel:function(e){var t=this;t._renderModelInit?(t._templFns=t._getAllTemplateFuncs({renderModel:e}),t._rerendAttrChg&&t._renderView({renderModel:e})):t._renderModelInit=!0},_setModelsSel:function(e){var t=this;return e===""||!e?e=null:n.isBoolean(e)&&(e="multi"),t._setSelectableEvents(e),e},_setModelListStyled:function(e){var t=this;t.get("boundingBox").toggleClass(S,e)},_setSelectableEvents:function(t){var n=this,r=n.get("contentBox");n.clearSelectedModels(),t&&!n._selModelEv?n._selModelEv=r.delegate("click",e.rbind(n._handleModelSelectionChange,n),function(){var e=Math.abs(n.lastScrolledAmt)>n.get("clickSensivity");return!e&&this.hasClass(c)}):!t&&n._selModelEv&&(n._selModelEv.detach(),n._selModelEv=null)},_setClkEv:function(e){var t=this,n=t.get("contentBox");e&&!t._clkModelEv?t._clkModelEv=n.delegate("click",function(e){var n=e.currentTarget,r=t.get("modelList"),i=n.getData("modelClientId"),s=r&&r.getByClientId(i);t.fire("modelClick",{node:n,model:s})},function(){var e=Math.abs(t.lastScrolledAmt)>t.get("clickSensivity");return!e&&this.hasClass(c)}):!e&&t._clkModelEv&&(t._clkModelEv.detach(),t._clkModelEv=null)},_setDblclkEv:function(e){var t=this,n=t.get("contentBox");e&&!t._dblclkModelEv?t._dblclkModelEv=n.delegate("dblclick",function(e){var n=e.currentTarget,r=t.get("modelList"),i=n.getData("modelClientId"),s=r&&r.getByClientId(i);t.fire("modelDblclick",{node:n,model:s})},"."+c):!e&&t._dblclkModelEv&&(t._dblclkModelEv.detach(),t._dblclkModelEv=null)},_setMarkModelChange:function(t){var n=this;t&&t>0&&!n._markModelChangeEv?n._markModelChangeEv=n.after("*:change",function(r){var i=r.target,s=n.getNodeFromModel(i);s&&(s.addClass(h),e.later(t,n,function(){s&&s.removeClass(h)}))}):!t&&n._markModelChangeEv&&(n._markModelChangeEv.detach(),n._markModelChangeEv=null),t&&t>0&&!n._markModelAddEv?n._markModelAddEv=n.after(["modelList:add","lazyModelList:add"],function(r){var i=n.getNodeFromIndex(r.index);i&&(i.addClass(h),e.later(t,n,function(){i&&i.removeClass(h)}))}):!t&&n._markModelAddEv&&(n._markModelAddEv.detach(),n._markModelAddEv=null)},_setIntoViewAdded:function(e){var t=this;e>0&&!t._modelInViewAdded?t._modelInViewAdded=t.after(["modelList:add","lazyModelList:add"],function(n){t.scrollIntoView(n.index,{noFocus:!0,showHeaders:e===2})}):e===0&&t._modelInViewAdded&&(t._modelInViewAdded.detach(),t._modelInViewAdded=null)},_setIntoViewChanged:function(e){var t=this;e>0&&!t._modelInViewChanged?t._modelInViewChanged=t.after("*:change",function(n){var r=n.target,i=t.getNodeFromModel(r);i&&t.scrollIntoView(i,{noFocus:!0,showHeaders:e===2})}):e===0&&t._modelInViewChanged&&(t._modelInViewChanged.detach(),t._modelInViewChanged=null)},_setMouseDnUpEv:function(e){var t=this,n=t.get("contentBox");e&&!t._mouseDnModelEv?t._mouseDnModelEv=n.delegate("mousedown",function(e){var n=e.currentTarget,r=t.get("modelList"),i=n.getData("modelClientId"),s=r&&r.getByClientId(i);t.fire("modelMouseDown",{node:n,model:s})},"."+c):!e&&t._mouseDnModelEv&&(t._mouseDnModelEv.detach(),t._mouseDnModelEv=null),e&&!t._mouseUpModelEv?t._mouseUpModelEv=n.delegate("mouseup",function(e){var n=e.currentTarget,r=t.get("modelList"),i=n.getData("modelClientId"),s=r&&r.getByClientId(i);t.fire("modelMouseUp",{node:n,model:s})},"."+c):!e&&t._mouseUpModelEv&&(t._mouseUpModelEv.detach(),t._mouseUpModelEv=null)},_setHoverEv:function(e){var t=this,n=t.get("contentBox");e&&!t._mouseentModelEv?t._mouseentModelEv=n.delegate("mouseenter",function(e){var n=e.currentTarget,r=t.get("modelList"),i=n.getData("modelClientId"),s=r&&r.getByClientId(i);t.fire("modelMouseEnter",{node:n,model:s})},"."+c):!e&&t._mouseentModelEv&&(t._mouseentModelEv.detach(),t._mouseentModelEv=null),e&&!t._mouseleaveModelEv?t._mouseleaveModelEv=n.delegate("mouseleave",function(e){var n=e.currentTarget,r=t.get("modelList"),i=n.getData("modelClientId"),s=r&&r.getByClientId(i);t.fire("modelMouseLeave",{node:n,model:s})},"."+c):!e&&t._mouseleaveModelEv&&(t._mouseleaveModelEv.detach(),t._mouseleaveModelEv=null)},_handleModelSelectionChange:function(e){var t=this,n=e.currentTarget,r=t.getModelListInUse(),i=n.getData("modelClientId"),s=r&&r.getByClientId(i),o=t.get("modelsSelectable"),u=o==="single",a=e.shiftKey&&!u,f=e.metaKey||e.ctrlKey,l=t.get("viewFilter"),c,h,p,d,v,m,g,y,w,E;c=s&&t.modelIsSelected(s);if(s){if(u||!f)t.get("modelsUnselectable")&&(w=t._viewNode.all("."+b),E=w.size()>0&&w.item(0)),t.clearSelectedModels(!0,!0);if(a&&t._lastClkModel){h=[],p=r.indexOf(s),d=r.indexOf(t._lastClkModel),v=Math.min(p,d),m=Math.max(p,d);for(g=v;g<=m;g++)y=r.item(g),(!l||l(y))&&h.push(y);t.selectModels(h,!1,null,!0)}else c&&!E?t.unselectModels(s,!0):t.selectModels(s,!1,null,!0),t._lastClkModel=c?null:s;t._focusModelNode(n)}t._fireSelectedModels
()},_getAllTemplateFuncs:function(e){var t=this,r=e&&e.renderModel||t.get("renderModel"),i=e&&e.groupHeader1||t.get("groupHeader1"),s=e&&e.groupHeader2||t.get("groupHeader2"),u=e&&e.groupHeader3||t.get("groupHeader3"),a=e&&e.renderGroupHeader1||t.get("renderGroupHeader1")||i,f=e&&e.renderGroupHeader2||t.get("renderGroupHeader2")||s,l=e&&e.renderGroupHeader3||t.get("renderGroupHeader3")||u,c=i&&i.length>0,h=s&&s.length>0,p=u&&u.length>0,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A;return A=function(e){var t=/<%(.+)%>/;return t.test(e)},A(r)?(v=o.compile(r),d=function(e){return v(t.getModelToJSON(e))}):d=function(e){return n.sub(r,t.getModelToJSON(e))},c&&A(i)?(g=o.compile(i),m=function(e){return g(t.getModelToJSON(e))}):m=function(e){return n.sub(i,t.getModelToJSON(e))},h&&A(s)?(b=o.compile(s),y=function(e){return b(t.getModelToJSON(e))}):y=function(e){return n.sub(s,t.getModelToJSON(e))},p&&A(u)?(E=o.compile(u),w=function(e){return E(t.getModelToJSON(e))}):w=function(e){return n.sub(u,t.getModelToJSON(e))},c&&A(a)?(x=o.compile(a),S=function(e){return x(t.getModelToJSON(e))}):S=function(e){return n.sub(a,t.getModelToJSON(e))},h&&A(f)?(N=o.compile(f),T=function(e){return N(t.getModelToJSON(e))}):T=function(e){return n.sub(f,t.getModelToJSON(e))},p&&A(l)?(k=o.compile(l),C=function(e){return k(t.getModelToJSON(e))}):C=function(e){return n.sub(l,t.getModelToJSON(e))},L={renderModel:d,groupH1:m,groupH2:y,groupH3:w,renderGH1:S,renderGH2:T,renderGH3:C,activeGH1:c,activeGH2:h,activeGH3:p},L},_tryRenderModel:function(t,n,r,s,o,u,a){var f=this,l,c,h,p,d;return p=e.rbind(u,f),d=e.rbind(s,f),h=function(e){var t=!1,n=p(e);return i.some(r,function(r){return r===e?!0:(t=p(r)===n,t)}),t},c=(!s||d(t))&&(!o||!u&&(l=a.renderModel(t))!==n||u&&!h(t)),c&&(l||a.renderModel(t))},_clearAbberantModelList:function(){var e=this;e._abModelList&&e._abModelList.destroy(),e._abModelList=null},_renderView:function(e,t){var r=this,i=r._viewNode,o=r.get("contentBox"),a=r.get("modelList"),f=e&&e.noDups||r.get("noDups"),l=e&&e.dupComparator||r.get("dupComparator"),h=e&&e.viewFilter||r.get("viewFilter"),p=r.pages,w=e&&e.limitModels,E=w||r.get("limitModels"),S=r._templFns,x=e&&e.lastItemOnTop||r.get("lastItemOnTop"),T=r.itsainfiniteview,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W;t=t||{},t.page=t.page||r._currentViewPg,j=r._currentViewPg!==t.page,t.rebuild=j||(n.isBoolean(t.rebuild)?t.rebuild:!0),t.incrementbuild=n.isBoolean(t.incrementbuild)?t.incrementbuild:!t.rebuild,t.keepstyles=n.isBoolean(t.keepstyles)?t.keepstyles:!0,o.one("#"+r._viewId)||(o.setHTML(i),r._set("srcNode",o)),R=a._items.concat(),W=R.length,t.rebuild?(F=t.page*E-1,r._prevH1=null,r._prevH2=null,r._prevH3=null,r._even=!1,T&&(r._itmsAvail=!0),r.get("boundingBox").addClass(m),i.addClass(g)):F=r._prevLastModelIndex||-1,t.incrementbuild||(B=s.create(u)),r._generateAbberantModelList?(O=e&&e.modelConfig||r.get("modelConfig"),O&&O.date&&(O.enddate||O.count)?(r._generateAbberantModelList(T,t.rebuild),a=r._abModelList,R=a._items.concat(),W=R.length):r._clearAbberantModelList()):r._clearAbberantModelList(),P=E>0?Math.min(W,(t.page+1)*E):W,H=P<W,z=0,U=T?Math.min(r.itsainfiniteview.get("batchSize"),W):W,F>0&&r._removeEmptyItem();while(z<U&&++F<P){q=R[F],_=r._tryRenderModel(q,D,R,h,f,l,S);if(_){z===0&&(r.get("boundingBox").removeClass(m),i.removeClass(g),t.initbuild&&(r.get("boundingBox").removeClass(d),i.removeClass(v))),z++,M=r._createModelNode(q,_);for(I=0;I<M.length;I++)t.incrementbuild?i.append(M[I]):B.append(M[I]);r._even=!r._even,f&&!l&&(D=_)}}r._prevLastModelIndex=F-1,t.incrementbuild||(t.keepstyles&&(k=function(e,t){var n;return t.some(function(t){var r=t.getData("modelClientId")===e;return r&&(n=t),r}),n},L=i.all("."+c),A=B.all("."+c),L.each(function(e){var t=e.hasClass(b),n=e.hasClass(y),r;if(t||n)r=k(e.getData("modelClientId"),A),r&&(r.toggleClass(b,t),r.toggleClass(y,n))})),i.replace(B),r._viewNode=B,B.set("id",r._viewId)),M&&x&&(!T||!r._itmsAvail||H)&&r._addEmptyItem(M[M.length-1],x),r._currentViewPg=t.page,r.syncUI(),p&&(N=p.get("index"),C=i.get("children").size()-1,N>C&&p.set("index",C)),T&&T.checkExpansion(),r.fire("modelListRender")},_createModelNode:function(e,t){var n=this,r=n.getModelAttr(e,"clientId"),i=[],o=s.create(a),u,f,l,h,p;return p=n._templFns,p.activeGH1&&(u=p.groupH1(e),u!==n._prevH1&&(h=s.create(a),h.addClass(x),h.addClass(T),n._prevH1&&h.addClass(k),h.setHTML(p.renderGH1(e)),i.push(h),n._prevH1=u,n._even=!1,n._prevH2=null)),p.activeGH2&&(f=p.groupH2(e),f!==n._prevH2&&(h=s.create(a),h.addClass(x),h.addClass(N),n._prevH2&&h.addClass(k),h.setHTML(p.renderGH2(e)),i.push(h),n._prevH2=f,n._even=!1,n._prevH3=null)),p.activeGH3&&(l=p.groupH3(e),l!==n._prevH3&&(h=s.create(a),h.addClass(x),h.addClass(C),n._prevH3&&h.addClass(k),h.setHTML(p.renderGH3(e)),i.push(h),n._prevH3=l,n._even=!1)),o.setData("modelClientId",r),o.addClass(c),o.addClass(r),o.addClass(n._even?w:E),o.setHTML(t||p.renderModel(e)),i.push(o),i},_addEmptyItem:function(e,t){var n=this,r=n.get("axis"),i=r.y,o=n.get("boundingBox"),u=t||n.get("lastItemOnTop"),a=n._viewNode,h,p,d,v,m;e||(v=a.all("."+c),m=v.size(),m>0&&(e=v.item(m-1))),h=s.create(f),h.addClass(l),p=o.get(i?"offsetHeight":"offsetWidth"),e&&(i?d=p-e.get("offsetHeight")-L(e,"marginTop")-L(e,"marginBottom"):d=p-e.get("offsetWidth")-L(e,"marginLeft")-L(e,"marginRight")),e=e&&e.previous();if(u===2)while(e&&e.hasClass(x))i?d-=e.get("offsetHeight")+L(e,"marginTop")+L(e,"marginBottom"):d-=e.get("offsetWidth")+L(e,"marginLeft")+L(e,"marginRight"),e=e.previous();h.setStyle(i?"height":"width",d+"px"),d>0&&a.append(h)},_removeEmptyItem:function(){var e=this,t;t=e._viewNode.one("."+l),t&&t.remove(!0)},_getNodeFromModelOrIndex:function(e,t,r){var i=this,s=i.hasPlugin("itsainfiniteview"),o=n.isNumber(r)?r:s&&s.get("maxExpansions")||0,u=0,a=!1,f,l,h;e&&(h=i.getModelAttr(e,"clientId")),l=function(n,r){var i=e?n.getData("modelClientId")===h:r===t;return i&&(a=n),i};do f=i._viewNode.all("."+c),f.some(l),u++;while(!a&&s&&u<o&&s.expandList());return a},_selectModel
:function(e,t,n){var i=this,s=i.getModelAttr(e,"clientId"),o=i.get("contentBox"),u=!t&&i.get("modelsUnselectable")&&r.size(i._selectedModels)===1,a;s&&!u?(i.hasPlugin("itsainfiniteview")&&i._getNodeFromModelOrIndex(e,null,n),a=o.one("."+s),a&&(t||a.blur(),a.toggleClass(b,t)),t?i._selectedModels[s]=e:delete i._selectedModels[s]):!s},_fireSelectedModels:function(){var e=this,t,n;t=e.getSelectedModels(),n=e._abModelList?e.getSelectedModels(!0):t,e.fire("modelSelectionChange",{newModelSelection:t,originalModelSelection:n})},_clearEventhandlers:function(){i.each(this._handlers,function(e){e.detach()})}},!0),e.ITSAModellistViewExtention=O},"@VERSION@",{requires:["base-build","node-base","node-event-delegate","dom-screen","pluginhost-base","event-mouseenter","event-custom","model","model-list","lazy-model-list","template-micro"]});
