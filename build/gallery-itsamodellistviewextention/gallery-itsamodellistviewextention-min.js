YUI.add("gallery-itsamodellistviewextention",function(e,t){"use strict";function I(){}function q(){}var n=e.Lang,r=e.Object,i=e.Array,s=e.Node,o=e.Template.Micro,u='<ul role="presentation"></ul>',a='<li role="presentation"></li>',f="<li>{content}</li>",l='<tr><td colspan="{cols}">{content}</td></tr>',c='<table role="presentation"></table>',h="<tbody></tbody>",p='<tr role="presentation"></tr>',d="<div>{loading}</div>",v="itsa-scrollview-fillelement",m="itsa-scrollviewmodel",g=m+"-changed",y="itsa-modellistview",b=y+"-lastitem",w=y+"-noinitialitems",E=y+"-view-noinitialitems",S=y+"-noitems",x=y+"-view-noitems",T=m+"-focus",N=m+"-selected",C=m+"-even",k=m+"-odd",L=y+"-styled",A=y+"-groupheader",O=y+"-groupheader1",M=y+"-groupheader2",_=y+"-groupheader3",D=y+"-sequelgroupheader",P=y+"-unselectable",H=y+"-showloading",B="Loading...",j="No data to display",F=function(e,t){return parseInt(e.getStyle(t),10)};e.mix(I.prototype,{getModelAttr:function(e,t){return e&&(e.get&&n.type(e.get)==="function"?e.get(t):e[t])},setModelAttr:function(e,t,r,i){var s=this,o,u;e&&(o=!e.get||n.type(e.get)!=="function",o?(u=s.revive(e),e[t]=r,u&&(u._set("clientId",e.clientId,{silent:!0}),u.set(t,r,i),s.free(u))):e.set(t,r,i))},getModelToJSON:function(e){return e.get&&n.type(e.get)==="function"?e.toJSON():e}},!0),e.ITSAModellistAttrExtention=I,e.Base.mix(e.ModelList,[I]),q.ATTRS={modelList:{value:null,validator:function(t){return t instanceof e.ModelList||t instanceof e.LazyModelList||t===null},setter:"_setModelList"},noDups:{value:!1,validator:function(e){return n.isBoolean(e)},setter:"_setNoDups"},listType:{value:"ul",validator:function(e){return e==="ul"||e==="table"},writeOnce:"initOnly"},limitModels:{value:0,validator:function(e){return n.isNumber(e)},setter:"_setLimitModels"},viewFilter:{value:null,validator:function(e){return n.isFunction(e)||e===null},setter:"_setViewFilter"},modelsSelectable:{value:null,lazyAdd:!1,validator:function(e){return e===""||e===null||n.isBoolean(e)||e==="single"||e==="multi"},setter:"_setModelsSel"},modelsUnselectable:{value:!1,validator:function(e){return n.isBoolean(e)}},modelListStyled:{value:!0,lazyAdd:!1,validator:function(e){return n.isBoolean(e)},setter:"_setModelListStyled"},clickSensivity:{value:2,validator:function(e){return n.isNumber(e)&&e>=0&&e<11}},clickEvents:{value:!1,lazyAdd:!1,validator:function(e){return n.isBoolean(e)},setter:"_setClkEv"},dblclickEvents:{value:!1,lazyAdd:!1,validator:function(e){return n.isBoolean(e)},setter:"_setDblclkEv"},highlightAfterModelChange:{value:0,validator:function(e){return n.isNumber(e)},setter:"_setMarkModelChange"},modelsIntoViewAfterAdd:{value:!1,validator:function(e){return n.isNumber(e)&&e>=0&&e<=2},setter:"_setIntoViewAdded"},modelsIntoViewAfterChange:{value:!1,validator:function(e){return n.isNumber(e)&&e>=0&&e<=2},setter:"_setIntoViewChanged"},mouseDownUpEvents:{value:!1,lazyAdd:!1,validator:function(e){return n.isBoolean(e)},setter:"_setMouseDnUpEv"},hoverEvents:{value:!1,lazyAdd:!1,validator:function(e){return n.isBoolean(e)},setter:"_setHoverEv"},groupHeader1:{value:null,validator:function(e){return n.isString(e)||e===null},setter:"_setGrpH1"},groupHeader2:{value:null,validator:function(e){return n.isString(e)||e===null},setter:"_setGrpH2"},groupHeader3:{value:null,validator:function(e){return n.isString(e)||e===null},setter:"_setGrpH3"},renderModel:{value:"{clientId}",validator:function(e){return n.isString(e)},setter:"_setRenderModel"},renderClassName:{value:null,validator:function(e){return n.isString(e)},setter:"_setRenderClass"},renderGroupHeader1:{value:null,validator:function(e){return n.isString(e)||e===null},setter:"_setRenderGrH1"},renderGroupHeader2:{value:null,validator:function(e){return n.isString(e)||e===null},setter:"_setRenderGrH2"},renderGroupHeader3:{value:null,validator:function(e){return n.isString(e)||e===null},setter:"_setRenderGrH3"},dupComparator:{value:null,validator:function(e){return n.isFunction(e)||e===null},setter:"_setDupComp"},showLoadMessage:{value:!1,validator:function(e){return n.isBoolean(e)}}},e.mix(q.prototype,{_handlers:[],_origModels:[],_selModelEv:null,_clkModelEv:null,_dblclkModelEv:null,_mouseentModelEv:null,_mouseUpModelEv:null,_mouseDnModelEv:null,_mouseleaveModelEv:null,_markModelChangeEv:null,_markModelAddEv:null,_modelInViewChanged:null,_modelInViewAdded:null,_selectedModels:{},_viewNode:null,_viewId:null,_currentViewPg:0,_templFns:null,_lastClkModel:null,_abModelList:null,_viewFilterInit:!1,_grpH1Init:!1,_grpH2Init:!1,_grpH3Init:!1,_renderGrpH1Init:!1,_renderGrpH2Init:!1,_renderGrpH3Init:!1,_renderModelInit:!1,_renderClassInit:!1,_dupCompInit:!1,_noDupsInit:!1,_limModelsInit:!1,_rerendAttrChg:!0,_itmsAvail:!1,_prevLastModelIndex:-1,_listLazy:!1,_prevH1:null,_prevH2:null,_prevH3:null,_even:!1,initializer:function(){var t=this;t._viewId=e.guid(),t._handlers.push(t.after("render",t._render,t))},setWithoutRerender:function(e,t,n){var r=this;r._rerendAttrChg=!1,r.set(e,t,n),r._rerendAttrChg=!0},getNodeFromIndex:function(e,t){return this._getNodeFromModelOrIndex(null,e,t)},getNodeFromModel:function(e,t){return this._getNodeFromModelOrIndex(e,null,t)},saveScrollTo:function(){},scrollIntoView:function(){},modelIsSelected:function(e){var t=this,r;return n.isArray(e)?i.some(e,function(e){return r=t._selectedModels[t.getModelAttr(e,"clientId")],r?!1:!0}):r=t._selectedModels[t.getModelAttr(e,"clientId")],n.isValue(r)},selectModels:function(e,t,r,s,o){var u=this,a=n.isArray(e),f=u.get("modelsSelectable")==="single",l,c;f&&u.clearSelectedModels(!0,!0),s||(c=u.get("contentBox"),l=c.all("."+N).size()),a&&!f?(i.each(e,function(e){u._selectModel(e,!0,o)}),t&&e.length>0&&u.scrollIntoView(e[0],r,o)):(a&&(e=e[0]),u._selectModel(e,!0,o),t&&u.scrollIntoView(e,r,o)),!s&&l!==c.all("."+N).size()&&u._fireSelectedModels()},unselectModels:function(e,t){var r=this,s,o;t||(o=r.get("contentBox"),s=o.all("."+N).size()),n.isArray(e)?i.each(e,function(e){r._selectModel(e,!1)}):r._selectModel(e,!1),!t&&s!==o
.all("."+N).size()&&r._fireSelectedModels()},clearSelectedModels:function(e,t){var n=this,r=n.get("contentBox"),i,s,o,u,a,f,l;i=function(){s.each(function(e){e.blur()})},s=r.all("."+N),u=s.size()>0&&s.item(0),e?(i(),s.removeClass(N)):(o=s.size()>0,i(),s.removeClass(N),o&&n._fireSelectedModels()),n._selectedModels={},n.get("modelsUnselectable")&&u&&!t&&(a=u.getData("modelClientId"),l=n.getModelListInUse(),f=l.getByClientId(a),n.selectModels(f,!1,null,!0))},getSelectedModels:function(e){var t=this,n;return e?(n=[],r.each(t._selectedModels,function(e){var r=t._origModels[t.getModelAttr(e,"clientId")];(!r||i.indexOf(n,r)===-1)&&n.push(r||e)})):n=r.values(t._selectedModels),n},renderView:function(){this._renderView()},getModelListInUse:function(){return this._abModelList||this.get("modelList")},getModelAttr:function(e,t){return e&&(e.get&&n.type(e.get)==="function"?e.get(t):e[t])},setModelAttr:function(e,t,r,i){var s=this,o,u,a;e&&(o=!e.get||n.type(e.get)!=="function",o?(u=s.get("modelList"),a=u.revive(e),e[t]=r,a&&(a._set("clientId",e.clientId,{silent:!0}),a.set(t,r,i),u.free(a))):e.set(t,r,i))},getModelToJSON:function(e){return e.get&&n.type(e.get)==="function"?e.toJSON():e},destructor:function(){var e=this,t=e.get("modelList");e._clearEventhandlers(),t.removeTarget(e),e._selModelEv&&e._selModelEv.detach(),e._clkModelEv&&e._clkModelEv.detach(),e._dblclkModelEv&&e._dblclkModelEv.detach(),e._mouseDnModelEv&&e._mouseDnModelEv.detach(),e._mouseUpModelEv&&e._mouseUpModelEv.detach(),e._mouseentModelEv&&e._mouseentModelEv.detach(),e._mouseleaveModelEv&&e._mouseleaveModelEv.detach(),e._markModelChangeEv&&e._markModelChangeEv.detach(),e._markModelAddEv&&e._markModelAddEv.detach(),e._modelInViewChanged&&e._modelInViewChanged.detach(),e._modelInViewAdded&&e._modelInViewAdded.detach(),e._clearAbberantModelList(),e._viewNode.destroy(!0)},_render:function(){var e=this,t=e.get("modelList"),r=e.get("listType"),i=e.get("boundingBox"),o;e.get("contentBox").setHTML(n.sub(d,{loading:B})),e._viewNode=o=s.create(r==="ul"?u:h),o.set("id",e._viewId),o.addClass(x).addClass(E),i.addClass(S).addClass(w),e.get("showLoadMessage")&&i.addClass(H),e._templFns=e._getAllTemplateFuncs(),e._extraBindUI(),t&&e._renderView(null,{incrementbuild:!0,initbuild:!0})},_focusModelNode:function(e){e&&(this._viewNode.all("."+T).removeClass(T),e.addClass(T),e.focus())},_getMaxPaginatorGotoIndex:function(e,t){var n=this,r=n.hasPlugin("pages"),i=n.getModelListInUse(),s=n.get("axis"),o=s.y,u=n.get("boundingBox").get(o?"offsetHeight":"offsetWidth"),a=0,f,l,c;if(r&&i.size()>0){f=n.getNodeFromIndex(Math.min(e,i.size()-1),t),o?l=f.get("offsetHeight")+F(f,"marginTop")+F(f,"marginBottom"):l=f.get("offsetWidth")+F(f,"marginLeft")+F(f,"marginRight"),c=n._viewNode.all(">li"),a=c.size();while(f&&--a>=0&&l<u)f=c.item(a),o?l+=f.get("offsetHeight")+F(f,"marginTop")+F(f,"marginBottom"):l+=f.get("offsetWidth")+F(f,"marginLeft")+F(f,"marginRight");l>=u&&a++}return a},_extraBindUI:function(){var t=this,n=t.get("boundingBox"),r=t.get("modelList"),i=t._handlers;r&&(r.addTarget(t),n.addClass(y)),i.push(t.after("modelListChange",function(e){var r=e.newVal,i=e.prevVal;i&&i.removeTarget(t),r?(r.addTarget(t),n.addClass(y),t._renderView(null,{incrementbuild:!i,initbuild:!i})):(n.removeClass(y),t.get("contentBox").setHTML(""))})),i.push(n.delegate("click",function(){t._gesture=null},function(){var e=Math.abs(t.lastScrolledAmt)>t.get("clickSensivity");return!e})),i.push(t.after("*:change",function(){var e=t.get("modelList");e&&t.get("modelList").comparator&&e.sort()})),i.push(n.delegate("click",function(e){Math.abs(t.lastScrolledAmt)>t.get("clickSensivity")&&(e.preventDefault(),e.stopImmediatePropagation())},function(){var e=this.get("tagName");return e==="A"||e==="BUTTON"})),i.push(n.delegate("mousedown",function(e){e.preventDefault()},"a")),i.push(t.after(["modelList:remove","lazyModelList:remove","modelList:add","lazyModelList:add","*:change"],e.bind(t._renderView,t,null,null))),i.push(t.after(["modelList:reset","lazyModelList:reset"],e.bind(t._renderView,t,null,{keepstyles:!1}))),t.get("highlightAfterModelChange"),t.get("modelsIntoViewAfterAdd"),t.get("modelsIntoViewAfterChange")},_setModelList:function(t){var n=this;n._listLazy=t instanceof e.LazyModelList,n._itmsAvail=t&&t.size()>0},_setNoDups:function(e){var t=this;t._noDupsInit?t._rerendAttrChg&&t._renderView({noDups:e}):t._noDupsInit=!0},_setLimitModels:function(e){var t=this;t._limModelsInit?t._rerendAttrChg&&t._renderView({limitModels:e}):t._limModelsInit=!0},_setViewFilter:function(e){var t=this;t._viewFilterInit?t._rerendAttrChg&&t._renderView({viewFilter:e}):t._viewFilterInit=!0},_setDupComp:function(e){var t=this;t._dupCompInit?t._rerendAttrChg&&t.get("noDups")&&t._renderView({dupComparator:e}):t._dupCompInit=!0},_setGrpH1:function(e){var t=this;t._grpH1Init?(t._templFns=t._getAllTemplateFuncs({groupHeader1:e}),t._rerendAttrChg&&t._renderView()):t._grpH1Init=!0},_setGrpH2:function(e){var t=this;t._grpH2Init?(t._templFns=t._getAllTemplateFuncs({groupHeader2:e}),t._rerendAttrChg&&t._renderView()):t._grpH2Init=!0},_setGrpH3:function(e){var t=this;t._grpH3Init?(t._templFns=t._getAllTemplateFuncs({groupHeader3:e}),t._rerendAttrChg&&t._renderView()):t._grpH3Init=!0},_setRenderGrH1:function(e){var t=this;t._renderGrpH1Init?(t._templFns=t._getAllTemplateFuncs({renderGroupHeader1:e}),t._rerendAttrChg&&t._renderView()):t._renderGrpH1Init=!0},_setRenderGrH2:function(e){var t=this;t._renderGrpH2Init?(t._templFns=t._getAllTemplateFuncs({renderGroupHeader2:e}),t._rerendAttrChg&&t._renderView()):t._renderGrpH2Init=!0},_setRenderGrH3:function(e){var t=this;t._renderGrpH3Init?(t._templFns=t._getAllTemplateFuncs({renderGroupHeader3:e}),t._rerendAttrChg&&t._renderView()):t._renderGrpH3Init=!0},_setRenderModel:function(e){var t=this;t._renderModelInit?(t._templFns=t._getAllTemplateFuncs({renderModel:e}),t._rerendAttrChg&&t._renderView()):t._renderModelInit=!0},_setRenderClass:function(e){var t=this;t._renderClassInit?(t._templFns=
t._getAllTemplateFuncs({renderClassName:e}),t._rerendAttrChg&&t._renderView()):t._renderClassInit=!0},_setModelsSel:function(t){var r=this,i=r.get("contentBox");return t===""||!t?t=null:n.isBoolean(t)&&(t="multi"),e.UA.ie>0&&i.setAttribute("unselectable",t==="multi"?"on":""),i.toggleClass(P,t==="multi"),r._setSelectableEvents(t),t},_setModelListStyled:function(e){var t=this;t.get("boundingBox").toggleClass(L,e)},_setSelectableEvents:function(t){var n=this,r=n.get("contentBox");n.clearSelectedModels(),t&&!n._selModelEv?n._selModelEv=r.delegate("click",e.rbind(n._handleModelSelectionChange,n),function(){var e=Math.abs(n.lastScrolledAmt)>n.get("clickSensivity");return!e&&this.hasClass(m)}):!t&&n._selModelEv&&(n._selModelEv.detach(),n._selModelEv=null)},_setClkEv:function(e){var t=this,n=t.get("contentBox");e&&!t._clkModelEv?t._clkModelEv=n.delegate("click",function(e){var n=e.currentTarget,r=t.get("modelList"),i=n.getData("modelClientId"),s=r&&r.getByClientId(i);t.fire("modelClick",{node:n,model:s})},function(){var e=Math.abs(t.lastScrolledAmt)>t.get("clickSensivity");return!e&&this.hasClass(m)}):!e&&t._clkModelEv&&(t._clkModelEv.detach(),t._clkModelEv=null)},_setDblclkEv:function(e){var t=this,n=t.get("contentBox");e&&!t._dblclkModelEv?t._dblclkModelEv=n.delegate("dblclick",function(e){var n=e.currentTarget,r=t.get("modelList"),i=n.getData("modelClientId"),s=r&&r.getByClientId(i);t.fire("modelDblclick",{node:n,model:s})},"."+m):!e&&t._dblclkModelEv&&(t._dblclkModelEv.detach(),t._dblclkModelEv=null)},_setMarkModelChange:function(t){var n=this;t&&t>0&&!n._markModelChangeEv?n._markModelChangeEv=n.after("*:change",function(r){var i=r.target,s=n.getNodeFromModel(i);s&&(s.addClass(g),e.later(t,n,function(){s&&s.removeClass(g)}))}):!t&&n._markModelChangeEv&&(n._markModelChangeEv.detach(),n._markModelChangeEv=null),t&&t>0&&!n._markModelAddEv?n._markModelAddEv=n.after(["modelList:add","lazyModelList:add"],function(r){var i=n.getNodeFromIndex(r.index);i&&(i.addClass(g),e.later(t,n,function(){i&&i.removeClass(g)}))}):!t&&n._markModelAddEv&&(n._markModelAddEv.detach(),n._markModelAddEv=null)},_setIntoViewAdded:function(e){var t=this;e>0&&!t._modelInViewAdded?t._modelInViewAdded=t.after(["modelList:add","lazyModelList:add"],function(n){t.scrollIntoView(n.index,{noFocus:!0,showHeaders:e===2})}):e===0&&t._modelInViewAdded&&(t._modelInViewAdded.detach(),t._modelInViewAdded=null)},_setIntoViewChanged:function(e){var t=this;e>0&&!t._modelInViewChanged?t._modelInViewChanged=t.after("*:change",function(n){var r=n.target,i=t.getNodeFromModel(r);i&&t.scrollIntoView(i,{noFocus:!0,showHeaders:e===2})}):e===0&&t._modelInViewChanged&&(t._modelInViewChanged.detach(),t._modelInViewChanged=null)},_setMouseDnUpEv:function(e){var t=this,n=t.get("contentBox");e&&!t._mouseDnModelEv?t._mouseDnModelEv=n.delegate("mousedown",function(e){var n=e.currentTarget,r=t.get("modelList"),i=n.getData("modelClientId"),s=r&&r.getByClientId(i);t.fire("modelMouseDown",{node:n,model:s})},"."+m):!e&&t._mouseDnModelEv&&(t._mouseDnModelEv.detach(),t._mouseDnModelEv=null),e&&!t._mouseUpModelEv?t._mouseUpModelEv=n.delegate("mouseup",function(e){var n=e.currentTarget,r=t.get("modelList"),i=n.getData("modelClientId"),s=r&&r.getByClientId(i);t.fire("modelMouseUp",{node:n,model:s})},"."+m):!e&&t._mouseUpModelEv&&(t._mouseUpModelEv.detach(),t._mouseUpModelEv=null)},_setHoverEv:function(e){var t=this,n=t.get("contentBox");e&&!t._mouseentModelEv?t._mouseentModelEv=n.delegate("mouseenter",function(e){var n=e.currentTarget,r=t.get("modelList"),i=n.getData("modelClientId"),s=r&&r.getByClientId(i);t.fire("modelMouseEnter",{node:n,model:s})},"."+m):!e&&t._mouseentModelEv&&(t._mouseentModelEv.detach(),t._mouseentModelEv=null),e&&!t._mouseleaveModelEv?t._mouseleaveModelEv=n.delegate("mouseleave",function(e){var n=e.currentTarget,r=t.get("modelList"),i=n.getData("modelClientId"),s=r&&r.getByClientId(i);t.fire("modelMouseLeave",{node:n,model:s})},"."+m):!e&&t._mouseleaveModelEv&&(t._mouseleaveModelEv.detach(),t._mouseleaveModelEv=null)},_handleModelSelectionChange:function(e){var t=this,n=e.currentTarget,r=t.getModelListInUse(),i=n.getData("modelClientId"),s=r&&r.getByClientId(i),o=t.get("modelsSelectable"),u=o==="single",a=e.shiftKey&&!u,f=e.metaKey||e.ctrlKey,l=t.get("viewFilter"),c,h,p,d,v,m,g,y,b,w;c=s&&t.modelIsSelected(s);if(s){if(u||!f)t.get("modelsUnselectable")&&(b=t._viewNode.all("."+N),w=b.size()>0&&b.item(0)),t.clearSelectedModels(!0,!0);if(a&&t._lastClkModel){h=[],p=r.indexOf(s),d=r.indexOf(t._lastClkModel),v=Math.min(p,d),m=Math.max(p,d);for(g=v;g<=m;g++)y=r.item(g),(!l||l(y))&&h.push(y);t.selectModels(h,!1,null,!0)}else c&&!w?t.unselectModels(s,!0):t.selectModels(s,!1,null,!0),t._lastClkModel=c?null:s;t._focusModelNode(n)}t._fireSelectedModels()},_getAllTemplateFuncs:function(e){var t=this,r=e&&e.renderModel||t.get("renderModel"),i=e&&e.renderModel||t.get("renderClassName"),s=e&&e.groupHeader1||t.get("groupHeader1"),u=e&&e.groupHeader2||t.get("groupHeader2"),a=e&&e.groupHeader3||t.get("groupHeader3"),f=e&&e.renderGroupHeader1||t.get("renderGroupHeader1")||s,l=e&&e.renderGroupHeader2||t.get("renderGroupHeader2")||u,c=e&&e.renderGroupHeader3||t.get("renderGroupHeader3")||a,h=i&&i.length>0,p=s&&s.length>0,d=u&&u.length>0,v=a&&a.length>0,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_;return M=function(e){var t=/<%(.+)%>/;return t.test(e)},M(r)?(g=o.compile(r),m=function(e){return g(t.getModelToJSON(e))}):m=function(e){return n.sub(r,t.getModelToJSON(e))},M(i)?(g=o.compile(i),_=function(e){return g(t.getModelToJSON(e))}):_=function(e){return n.sub(i,t.getModelToJSON(e))},p&&M(s)?(b=o.compile(s),y=function(e){return b(t.getModelToJSON(e))}):y=function(e){return n.sub(s,t.getModelToJSON(e))},d&&M(u)?(E=o.compile(u),w=function(e){return E(t.getModelToJSON(e))}):w=function(e){return n.sub(u,t.getModelToJSON(e))},v&&M(a)?(x=o.compile(a),S=function(e){return x(t.getModelToJSON(e))}):S=function(e){return n.sub(a,t.getModelToJSON(e))},p&&M(f)?(N=o.compile(f),T=function(e)
{return N(t.getModelToJSON(e))}):T=function(e){return n.sub(f,t.getModelToJSON(e))},d&&M(l)?(k=o.compile(l),C=function(e){return k(t.getModelToJSON(e))}):C=function(e){return n.sub(l,t.getModelToJSON(e))},v&&M(c)?(A=o.compile(c),L=function(e){return A(t.getModelToJSON(e))}):L=function(e){return n.sub(c,t.getModelToJSON(e))},O={renderModel:m,renderClassName:_,groupH1:y,groupH2:w,groupH3:S,renderGH1:T,renderGH2:C,renderGH3:L,activeClass:h,activeGH1:p,activeGH2:d,activeGH3:v},O},_tryRenderModel:function(t,n,r,s,o,u,a){var f=this,l,c,h,p,d;return p=e.rbind(u,f),d=e.rbind(s,f),h=function(e){var t=!1,n=p(e);return i.some(r,function(r){return r===e?!0:(t=p(r)===n,t)}),t},c=(!s||d(t))&&(!o||!u&&(l=a.renderModel(t))!==n||u&&!h(t)),c&&(l||a.renderModel(t))},_clearAbberantModelList:function(){var e=this;e._abModelList&&e._abModelList.destroy(),e._abModelList=null},_renderView:function(e,t){var r=this,i=r._viewNode,o=r.get("contentBox"),a=r.get("modelList"),p=e&&e.noDups||r.get("noDups"),d=e&&e.dupComparator||r.get("dupComparator"),v=e&&e.viewFilter||r.get("viewFilter"),g=r.pages,y=e&&e.limitModels,C=y||r.get("limitModels"),k=r._templFns,L=e&&e.lastItemOnTop||r.get("lastItemOnTop"),A=r.itsainfiniteview,O,M,_,D,P,H,B,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y;t=t||{},t.page=t.page||r._currentViewPg,z=r._currentViewPg!==t.page,t.rebuild=z||(n.isBoolean(t.rebuild)?t.rebuild:!0),t.incrementbuild=n.isBoolean(t.incrementbuild)?t.incrementbuild:!t.rebuild,t.keepstyles=n.isBoolean(t.keepstyles)?t.keepstyles:!0,o.one("#"+r._viewId)||(r.get("listType")==="ul"?o.setHTML(i):(o.setHTML(c),G=o.one("table"),G&&G.append(i)),r._set("srcNode",o)),$=a._items.concat(),Q=$.length,t.rebuild?(W=t.page*C-1,r._prevH1=null,r._prevH2=null,r._prevH3=null,r._even=!1,A&&(r._itmsAvail=!0),r.get("boundingBox").addClass(S),i.addClass(x)):(i.all("."+b).removeClass(b),W=r._prevLastModelIndex||-1),t.incrementbuild||(U=s.create(r.get("listType")==="ul"?u:h)),r._generateAbberantModelList?(H=e&&e.modelConfig||r.get("modelConfig"),H&&H.date&&(H.enddate||H.count)?(r._generateAbberantModelList(A,t.rebuild),a=r._abModelList,$=a._items.concat(),Q=$.length):r._clearAbberantModelList()):r._clearAbberantModelList(),q=C>0?Math.min(Q,(t.page+1)*C):Q,R=q<Q,K=0,J=A?Math.min(r.itsainfiniteview.get("batchSize"),Q):Q,W>0&&r._removeEmptyItem();while(K<J&&++W<q){V=$[W],F=r._tryRenderModel(V,I,$,v,p,d,k);if(F){K===0&&(r.get("boundingBox").removeClass(S),i.removeClass(x),t.initbuild&&(r.get("boundingBox").removeClass(w),i.removeClass(E))),K++,B=r._createModelNode(V,F);for(X=0;X<B.length;X++)t.incrementbuild?i.append(B[X]):U.append(B[X]);r._even=!r._even,p&&!d&&(I=F)}}B&&B.length>0&&L===0&&B[B.length-1].addClass(b),r._prevLastModelIndex=W,t.incrementbuild||(t.keepstyles&&(_=function(e,t){var n;return t.some(function(t){var r=t.getData("modelClientId")===e;return r&&(n=t),r}),n},D=i.all("."+m),P=U.all("."+m),D.each(function(e){var t=e.hasClass(N),n=e.hasClass(T),r;if(t||n)r=_(e.getData("modelClientId"),P),r&&(r.toggleClass(N,t),r.toggleClass(T,n))})),i.replace(U),r._viewNode=U,U.set("id",r._viewId)),i.getHTML()===""&&(Y=r.get("listType")==="ul"?f:l,i.setHTML(n.sub(Y,{cols:1,content:j}))),B&&L>0&&(!A||!r._itmsAvail||R)&&r._addEmptyItem(B[B.length-1],L),r._currentViewPg=t.page,r.syncUI(),g&&(O=g.get("index"),M=i.get("children").size()-1,O>M&&g.set("index",M)),A&&A.checkExpansion(),r.fire("modelListRender")},_createModelNode:function(e,t){var n=this,r=n.getModelAttr(e,"clientId"),i=[],o=n.get("listType")==="ul"?a:p,u=s.create(o),f,l,c,h,d;return d=n._templFns,d.activeGH1&&(f=d.groupH1(e),f!==n._prevH1&&(h=s.create(o),h.addClass(A),h.addClass(O),n._prevH1&&h.addClass(D),h.setHTML(d.renderGH1(e)),i.push(h),n._prevH1=f,n._even=!1,n._prevH2=null)),d.activeGH2&&(l=d.groupH2(e),l!==n._prevH2&&(h=s.create(o),h.addClass(A),h.addClass(M),n._prevH2&&h.addClass(D),h.setHTML(d.renderGH2(e)),i.push(h),n._prevH2=l,n._even=!1,n._prevH3=null)),d.activeGH3&&(c=d.groupH3(e),c!==n._prevH3&&(h=s.create(o),h.addClass(A),h.addClass(_),n._prevH3&&h.addClass(D),h.setHTML(d.renderGH3(e)),i.push(h),n._prevH3=c,n._even=!1)),u.setData("modelClientId",r),d.activeClass&&u.addClass(d.renderClassName(e)),u.addClass(m),u.addClass(r),u.addClass(n._even?C:k),u.setHTML(t||d.renderModel(e)),i.push(u),i},_addEmptyItem:function(e,t){var r=this,i=r.get("axis"),o=i.y,u=r.get("boundingBox"),a=t||r.get("lastItemOnTop"),c=r._viewNode,h=r.get("listType")==="ul",p=h?f:l,d,g,y,b,w,E;r._removeEmptyItem(),e||(b=c.all("."+m),w=b.size(),w>0&&(e=b.item(w-1))),h||(E=e.all(">td").size()),p=n.sub(p,{cols:E,content:""}),d=s.create(p),d.addClass(v),g=u.get(o?"offsetHeight":"offsetWidth"),e&&(o?y=g-e.get("offsetHeight")-F(e,"marginTop")-F(e,"marginBottom"):y=g-e.get("offsetWidth")-F(e,"marginLeft")-F(e,"marginRight")),e=e&&e.previous();if(a===2)while(e&&e.hasClass(A))o?y-=e.get("offsetHeight")+F(e,"marginTop")+F(e,"marginBottom"):y-=e.get("offsetWidth")+F(e,"marginLeft")+F(e,"marginRight"),e=e.previous();d.setStyle(o?"height":"width",y+"px"),y>0&&c.append(d)},_removeEmptyItem:function(){var e=this,t;t=e._viewNode.one("."+v),t&&t.remove(!0)},_getNodeFromModelOrIndex:function(e,t,r){var i=this,s=i.hasPlugin("itsainfiniteview"),o=n.isNumber(r)?r:s&&s.get("maxExpansions")||0,u=0,a=!1,f,l,c;e&&(c=i.getModelAttr(e,"clientId")),l=function(n,r){var i=e?n.getData("modelClientId")===c:r===t;return i&&(a=n),i};do f=i._viewNode.all("."+m),f.some(l),u++;while(!a&&s&&u<o&&s.expandList());return a},_selectModel:function(e,t,n){var i=this,s=i.getModelAttr(e,"clientId"),o=i.get("contentBox"),u=!t&&i.get("modelsUnselectable")&&r.size(i._selectedModels)===1,a;s&&!u?(i.hasPlugin("itsainfiniteview")&&i._getNodeFromModelOrIndex(e,null,n),a=o.one("."+s),a&&(t||a.blur(),a.toggleClass(N,t)),t?i._selectedModels[s]=e:delete i._selectedModels[s]):!s},_fireSelectedModels:function(){var e=this,t,n;t=e.getSelectedModels(),n=e._abModelList?e.getSelectedModels(!0):t,e.fire("modelSelectionChange",{newModelSelection:t,originalModelSelection:n})},_clearEventhandlers:
function(){i.each(this._handlers,function(e){e.detach()})}},!0),e.ITSAModellistViewExtention=q},"@VERSION@",{requires:["base-build","node-base","node-event-delegate","dom-screen","pluginhost-base","event-mouseenter","event-custom","model","model-list","lazy-model-list","template-micro"]});
