YUI.add("gallery-itsaviewmodel",function(e,t){"use strict";function Mt(){}var n,r=e.Lang,i=e.Array,s=e.Intl,o="itsabutton-iconleft",u='<i class="itsaicon-form-{type}"></i>',a=e.Template.Micro,f="gallery-",l="itsaviewmodel",c="button",h="model",p="Save",d="Submit",v="Load",m="Destroy",g="Reset",y="Promise",b="destroyed",w="_defFn_",E="boolean",S="string",x="function",T="editable",N="container",C={destroy:!0,remove:!0,reset:!0,save:!0,submit:!0,load:!0},k={btn_abort:!0,btn_cancel:!0,btn_destroy:!0,btn_ignore:!0,btn_load:!0,btn_no:!0,btn_ok:!0,btn_remove:!0,btn_reset:!0,btn_retry:!0,btn_save:!0,btn_submit:!0,btn_yes:!0,imgbtn_abort:!0,imgbtn_cancel:!0,imgbtn_destroy:!0,imgbtn_ignore:!0,imgbtn_load:!0,imgbtn_no:!0,imgbtn_ok:!0,imgbtn_remove:!0,imgbtn_reset:!0,imgbtn_retry:!0,imgbtn_save:!0,imgbtn_submit:!0,imgbtn_yes:!0,spinbtn_load:!0,spinbtn_remove:!0,spinbtn_save:!0,spinbtn_submit:!0,spinbtn_yes:!0},L="destroy",A="remove",O="load",M="reset",_="save",D="submit",P="click",H="abort",B="cancel",j="ignore",F="no",I="ok",q="retry",R="yes",U="btn_",z=U+H,W=U+B,X=U+L,V=U+j,$=U+O,J=U+F,K=U+I,Q=U+A,G=U+M,Y=U+q,Z=U+_,et=U+D,tt=U+R,nt="img",rt=nt+z,it=nt+W,st=nt+X,ot=nt+V,ut=nt+$,at=nt+J,ft=nt+K,lt=nt+Q,ct=nt+G,ht=nt+Y,pt=nt+Z,dt=nt+et,vt=nt+tt,mt="spin",gt=mt+$,yt=mt+Q,bt=mt+Z,wt=mt+et,Et="focusnext",St="validationerror",xt="uichanged",Tt=c+P,Nt=L+P,Ct=A+P,kt=O+P,Lt=D+P,At=M+P,Ot=_+P;e.mix(Mt.prototype,{cleanupWidgets:function(t){var n=this,r=e.Widget;r&&n.all(".yui3-widget").each(function(e){if(n.one("#"+e.get("id"))){var i=r.getByNode(e);i&&i.destroy(t)}})},cleanup:function(){var e=this;e.cleanupWidgets(!0),e.empty()}},!0),e.Node.ITSANodeCleanup=Mt,e.Base.mix(e.Node,[Mt]),n=e.ITSAViewModel=e.Base.create(l,e.View,[],{},{ATTRS:{editable:{value:!1,validator:function(e){return typeof e===E},getter:function(e){var t=this.get(h);return e&&t&&t.toJSONUI}},model:{value:{},validator:function(e){return e===null||r.isObject(e)||typeof e===S||e.get&&typeof e.get===x&&e.get("clientId")},setter:"_setModel"},template:{value:null,validator:function(e){return typeof e===S},getter:function(e){var t=this;return t._textTemplate||e||t._intl.undefined_template}}}}),n.prototype.initializer=function(){var t=this,n=t.get(h);i.each([Nt,Ct,At,Ot,Lt,Tt,kt,St,xt],function(n){t["_defPrevFn_"+n]=function(e){e.modelEventFacade.preventDefault()},t.publish(n,{preventedFn:e.bind(t["_defPrevFn_"+n],t),emitFacade:!0})}),t.publish(Et,{defaultFn:e.bind(t[w+Et],t),emitFacade:!0}),t._isMicroTemplate=null,t._modelRenderer=null,t._eventhandlers=[],t._textTemplate=null,t._setTemplateRenderer(t.get(T)),n&&n.addTarget&&n.addTarget(t),t._intl=s.get(f+l),t._customBtns={},t._customBtnLabels={},t._createButtons()},n.prototype.addCustomBtn=function(e,t,n){k[e]||(this._customBtns[e]={propertykey:e,config:n,labelHTML:t||e})},n.prototype.removeButtonLabel=function(e){delete this._customBtnLabels[e]},n.prototype.removeCustomBtn=function(e){delete this._customBtns[e]},n.prototype.removeButtonLabel=function(e){delete this._customBtnLabels[e]},n.prototype.render=function(t){var n=this,r=n.get(N),i=r.itsatabkeymanager,s=n.get(h),o=n.get(T),u=e.Global.ItsaDateTimePicker,a=t||!s?"":n._modelRenderer(s);if(o||n._isMicroTemplate)o&&(n._initialEditAttrs=s.getAttrs()),r.cleanupWidgets(!0);return n._rendered||(r.inDoc()||e.one("body").append(r),r.addClass(l),n._bindUI()),n._rendered=!0,r.setHTML(a),o&&e.use(f+"itsatabkeymanager",function(){i?i.refresh(r):(r.plug(e.Plugin.ITSATabKeyManager),i=r.itsatabkeymanager),n.get("focused")&&i.focusInitialItem()}),u&&u.panel.get("visible")&&u.hide(!0),n.fire("viewrendered",{target:n}),n},n.prototype.setButtonLabel=function(e,t){var n=this;C[e]&&typeof t===S&&t.length>0&&(n._customBtnLabel[e]=t)},n.prototype.toJSON=function(){var t=this.get(h);return t instanceof e.Model?t.toJSON():t},n.prototype.destructor=function(){var e=this,t=e.get(h),n=e.get(N);t&&t.removeTarget&&t.removeTarget(e),e._clearEventhandlers(),e._customBtns={},e._customBtnLabels={},n.hasPlugin("itsatabkeymanager")&&n.unplug("itsatabkeymanager")},n.prototype._bindUI=function(){var t=this,n=t.get(N),r=t._eventhandlers;r.push(t.after("modelChange",function(e){var n=e.prevVal,r=e.newVal,i=n&&n.toJSONUI,s=r&&r.toJSONUI;n&&n.removeTarget&&n.removeTarget(t),r&&r.addTarget&&r.addTarget(t),i!==s&&t._setTemplateRenderer(t.get("template"),s&&t.get(T)),t.render()})),r.push(t.after("templateChange",function(){t._setTemplateRenderer(t.get(T)),t.render()})),r.push(t.after("*:resetclick",function(){var e=n.itsatabkeymanager;t._isMicroTemplate&&t.render(),e&&e.focusInitialItem()})),r.push(t.after("editableChange",function(e){var n=e.newVal,r=t.get(h);r&&r.toJSONUI&&(t._setTemplateRenderer(n),t.render())})),r.push(t.after("*:change",function(n){n.target instanceof e.Model&&!t.get(T)&&t.render()})),r.push(t.after([h+D,h+_,h+O,h+M],function(e){var t=n.itsatabkeymanager;t&&(e.model.enableUI(),t.focusInitialItem())})),r.push(t.after("*:destroy",function(e){e.target!==t&&t.render(!0)})),r.push(e.Intl.after("intl:langChange",function(){t._intl=e.Intl.get(f+l)})),i.each([L,A,M,_,D,O,Nt,Ct,At,Ot,Lt,Tt,kt,St,xt,Et],function(e){r.push(t.on("*:"+e,function(n){var r;n.target!==t&&(C[e]&&(e=h+e),r={type:e,model:t.get(h),modelEventFacade:n,target:t,value:n.value,node:n.node,nodeid:n.nodeid,formElement:n.formElement},t.fire(e,r))}))})},i.each([p,d,v,m,g],function(t){n.prototype[h+t]=function(){var n=this,r=n.get(h);r instanceof e.Model&&!r.get(b)&&r[w+t]&&r[w+t]()}}),i.each([p,d,v,m],function(t){n.prototype[h+t+y]=function(){var n=this,r=n.get(h),i=t.toLowerCase();return r instanceof e.Model&&!r.get(b)&&r[i+y]||null}}),n.prototype._clearEventhandlers=function(){i.each(this._eventhandlers,function(e){e.detach()})},n.prototype._createButtons=function(){var e=this,t=e._customBtnLabels;e._buttons=[{propertykey:z,type:c,value:H,labelHTML:t[H]?r.sub(t[H],{label:e._intl[H]}):e._intl[H]},{propertykey:W,type:c,value:B,labelHTML:t[B]?r.sub(t[B],{label:e._intl[B]}):e._intl[B]},{propertykey:X,type:L,value
:L,labelHTML:t[L]?r.sub(t[L],{label:e._intl[L]}):e._intl[L]},{propertykey:V,type:c,value:j,labelHTML:t[j]?r.sub(t[j],{label:e._intl[j]}):e._intl[j]},{propertykey:$,type:O,value:O,labelHTML:t[O]?r.sub(t[O],{label:e._intl[O]}):e._intl[O]},{propertykey:J,type:c,value:F,labelHTML:t[F]?r.sub(t[F],{label:e._intl[F]}):e._intl[F]},{propertykey:K,type:c,value:I,labelHTML:t[I]?r.sub(t[I],{label:e._intl[I]}):e._intl[I]},{propertykey:Q,type:A,value:A,labelHTML:t[A]?r.sub(t[A],{label:e._intl[A]}):e._intl[A]},{propertykey:G,type:M,value:M,labelHTML:t[M]?r.sub(t[M],{label:e._intl[M]}):e._intl[M]},{propertykey:Y,type:c,value:q,labelHTML:t[q]?r.sub(t[q],{label:e._intl[q]}):e._intl[q]},{propertykey:Z,type:_,value:_,labelHTML:t[_]?r.sub(t[_],{label:e._intl[_]}):e._intl[_]},{propertykey:et,type:D,value:D,labelHTML:t[D]?r.sub(t[D],{label:e._intl[D]}):e._intl[D]},{propertykey:tt,type:c,value:R,labelHTML:t[R]?r.sub(t[R],{label:e._intl[R]}):e._intl[R]},{propertykey:rt,type:c,value:H,config:{classname:o},labelHTML:t[H]?r.sub(t[H],{label:e._intl[H]}):r.sub(u,{type:H})+e._intl[H]},{propertykey:it,type:c,value:B,config:{classname:o},labelHTML:t[B]?r.sub(t[B],{label:e._intl[B]}):r.sub(u,{type:B})+e._intl[B]},{propertykey:st,type:L,value:L,config:{classname:o},labelHTML:t[L]?r.sub(t[L],{label:e._intl[L]}):r.sub(u,{type:L})+e._intl[L]},{propertykey:ot,type:c,value:j,config:{classname:o},labelHTML:t[j]?r.sub(t[j],{label:e._intl[j]}):r.sub(u,{type:j})+e._intl[j]},{propertykey:ut,type:O,value:O,config:{classname:o},labelHTML:t[O]?r.sub(t[O],{label:e._intl[O]}):r.sub(u,{type:O})+e._intl[O]},{propertykey:at,type:c,value:F,config:{classname:o},labelHTML:t[F]?r.sub(t[F],{label:e._intl[F]}):r.sub(u,{type:F})+e._intl[F]},{propertykey:ft,type:c,value:I,config:{classname:o},labelHTML:t[I]?r.sub(t[I],{label:e._intl[I]}):r.sub(u,{type:I})+e._intl[I]},{propertykey:lt,type:A,value:A,config:{classname:o},labelHTML:t[A]?r.sub(t[A],{label:e._intl[A]}):r.sub(u,{type:A})+e._intl[A]},{propertykey:ct,type:M,value:M,config:{classname:o},labelHTML:t[M]?r.sub(t[M],{label:e._intl[M]}):r.sub(u,{type:M})+e._intl[M]},{propertykey:ht,type:c,value:q,config:{classname:o},labelHTML:t[q]?r.sub(t[q],{label:e._intl[q]}):r.sub(u,{type:q})+e._intl[q]},{propertykey:pt,type:_,value:_,config:{classname:o},labelHTML:t[_]?r.sub(t[_],{label:e._intl[_]}):r.sub(u,{type:_})+e._intl[_]},{propertykey:dt,type:D,value:D,config:{classname:o},labelHTML:t[D]?r.sub(t[D],{label:e._intl[D]}):r.sub(u,{type:D})+e._intl[D]},{propertykey:vt,type:c,value:R,config:{classname:o},labelHTML:t[R]?r.sub(t[R],{label:e._intl[R]}):r.sub(u,{type:R})+e._intl[R]},{propertykey:gt,type:O,value:O,config:{spinbusy:!0,classname:o},labelHTML:t[O]?r.sub(t[O],{label:e._intl[O]}):r.sub(u,{type:O})+e._intl[O]},{propertykey:yt,type:A,value:A,config:{spinbusy:!0,classname:o},labelHTML:t[A]?r.sub(t[A],{label:e._intl[A]}):r.sub(u,{type:A})+e._intl[A]},{propertykey:bt,type:_,value:_,config:{spinbusy:!0,classname:o},labelHTML:t[_]?r.sub(t[_],{label:e._intl[_]}):r.sub(u,{type:_})+e._intl[_]},{propertykey:wt,type:D,value:D,config:{spinbusy:!0,classname:o},labelHTML:t[D]?r.sub(t[D],{label:e._intl[D]}):r.sub(u,{type:D})+e._intl[D]}]},n.prototype[w+Et]=function(){var e=this,t=e.get(N),n=t&&t.itsatabkeymanager;n&&n.next()},n.prototype._setModel=function(e){var t=this;return typeof e===S?(t._textTemplate=e,e={}):t._textTemplate=null,e},n.prototype._setTemplateRenderer=function(t){var n=this,s=n.get("template"),o,u,f,l;o=function(){var e=/<%(.+)%>/;return e.test(s)},l=function(t,r){var s,o,u,a;i.each(n._buttons,function(n){s=n.propertykey,o=n.type,u=n.labelHTML,a=n.config,t[s]=e.bind(r._renderBtnFns[o],r,u,a)()}),i.each(n._customBtns,function(n){s=n.propertykey,u=n.labelHTML,a=n.config,t[s]=e.bind(r._renderBtnFns[c],r,u,a)()})},u=n._isMicroTemplate=o(),u?(f=a.compile(s),n._modelRenderer=function(e){var r=t?e.toJSONUI():n.toJSON();return e.toJSONUI&&l(r,e),f(r)}):n._modelRenderer=function(e){var i=t?e.toJSONUI():n.toJSON();return e.toJSONUI&&l(i,e),r.sub(s,i)}}},"@VERSION@",{requires:["intl","base-build","view","template-micro","model","event-custom","pluginhost-base","gallerycss-itsa-base","gallerycss-itsa-form"],lang:["ar","de","en","es","fr","hu","it","ja","nb","nl","pt","ru","zh"],skinnable:!0});
