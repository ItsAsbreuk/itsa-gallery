YUI.add("gallery-itsaviewmodel",function(e,t){"use strict";function f(){}var n=e.Lang,r=e.Array,i=e.Template.Micro,s="itsa-modelview-styled",o="yui3-form",u="yui3-itsaformelement",a=u+"-changed";e.mix(f.prototype,{cleanup:function(){var t=this,n=e.Widget;n&&t.all(".yui3-widget").each(function(e){if(t.one("#"+e.get("id"))){var r=n.getByNode(e);r&&r.destroy()}}),t.empty()}},!0),e.Node.ITSANodeCleanup=f,e.Base.mix(e.Node,[f]),e.ITSAViewModel=e.Base.create("itsaviewmodel",e.Widget,[],{view:null,_isMicroTemplate:null,_modelRenderer:null,_eventhandlers:[],initializer:function(){var t=this,n=t.get("boundingBox"),r=t.get("contentBox"),i=t.get("events"),u=t.get("model"),a=t.get("modelEditable"),f=a&&u.itsaeditmodel,l=f?u.itsaeditmodel.get("template"):t.get("template"),c=t.get("styled"),h;c&&n.addClass(s).addClass(o),h=t.view=new e.View({container:r,model:u}),h.events=i,h.template=l,t._setTemplateRenderer(l,f),h.render=e.rbind(t._viewRenderer,t),u&&u.addTarget&&u.addTarget(h)},bindUI:function(){var e=this,t=e.get("boundingBox"),n=e.get("model"),r=e._eventhandlers,i=e.view;r.push(e.after("modelChange",function(e){var t=e.prevVal,n=e.newVal;t&&t.removeTarget&&t.removeTarget(i),n&&n.addTarget&&n.addTarget(i),i.set("model",n),i.render()})),r.push(n.after("templateChange",function(t){var r=t.newVal,s=e.get("modelEditable");if(!s||!n.itsaeditmodel)i.template=r,e._setTemplateRenderer(r,!1),i.render()})),r.push(e.after("modelEditableChange",function(t){var r=t.newVal,s;n.itsaeditmodel&&(s=r?n.itsaeditmodel.get("template"):e.get("template"),i.template=s,e._setTemplateRenderer(s,r),i.render())})),r.push(e.after("editmodelConfigAttrsChange",function(){n.itsaeditmodel&&e.get("modelEditable")&&i.render()})),r.push(i.after("itsaeditmodel:destroy",function(){if(e.get("modelEditable")){var t=e.get("template");i.template=t,e._setTemplateRenderer(t,!1),i.render()}})),r.push(i.after("itsaeditmodel:pluggedin",function(){if(e.get("modelEditable")){var t=n.itsaeditmodel.get("template");i.template=t,e._setTemplateRenderer(t,!0),i.render()}})),r.push(e.after("eventsChange",function(e){i.events=e.newVal})),r.push(e.after("styledChange",function(e){t.toggleClass(s,e.newVal).toggleClass(o,e.newVal)})),r.push(i.after("*:change",function(){!e.get("modelEditable")||!n.itsaeditmodel?i.render(!1):i.get("container").all("."+a).removeClass(a)})),r.push(i.after("model:destroy",function(){i.render(!0)})),r.push(t.after("click",function(){var n=t.itsafocusmanager;n?n.retreiveFocus():e.focus()}))},getModelToJSON:function(e){return e.get&&n.type(e.get)==="function"?e.toJSON():e},syncUI:function(){this.view.render()},destructor:function(){var e=this;e._clearEventhandlers(),e.view.destroy()},_setTemplateRenderer:function(e,t){var r=this,s,o,u;s=function(){var t=/<%(.+)%>/;return t.test(e)},o=r._isMicroTemplate=s(),o?(u=i.compile(e),r._modelRenderer=function(e){var n=t?e.itsaeditmodel.toJSON(r.get("editmodelConfigAttrs")):r.getModelToJSON(e);return u(n)}):r._modelRenderer=function(i){var s=t?i.itsaeditmodel.toJSON(r.get("editmodelConfigAttrs")):r.getModelToJSON(i);return n.sub(e,s)}},_viewRenderer:function(e){var t=this,n=t.get("boundingBox"),r=t.view,i=r.get("container"),s=r.get("model"),o=e?"":t._modelRenderer(s);return(t._isMicroTemplate||s.itsaeditmodel&&t.get("modelEditable"))&&i.cleanup(),i.setHTML(o),n.get("focused")&&n.itsafocusmanager&&n.itsafocusmanager.focusInitialItem(),t},_clearEventhandlers:function(){r.each(this._eventhandlers,function(e){e.detach()})}},{ATTRS:{editmodelConfigAttrs:{value:{},validator:function(e){return n.isObject(e)}},events:{value:{},validator:function(e){return n.isObject(e)}},modelEditable:{value:!1,lazyAdd:!1,validator:function(e){return n.isBoolean(e)}},model:{value:null,validator:function(t){return t instanceof e.Model||n.isObject(t)||t===null}},styled:{value:!0,validator:function(e){return n.isBoolean(e)}},template:{value:"{clientId}",validator:function(e){return n.isString(e)}}}})},"@VERSION@",{requires:["base-build","widget","view","template-micro","model","pluginhost-base"],skinnable:!0});
