YUI.add("gallery-itsascrollviewmodellist",function(e,t){"use strict";function E(){}function S(){}var n=e.Lang,r=e.Object,i=e.Array,s=e.Node,o='<ul role="presentation"></ul>',u='<li role="presentation"></li>',a="<li></li>",f="itsa-scrollview-fillelement",l="itsa-scrollviewmodel",c="itsa-scrollviewmodellist",h=l+"-selected",p=l+"-even",d=l+"-odd",v=c+"-styled",m=c+"-groupheader",g=c+"-groupheader1",y=c+"-groupheader2",b=c+"-groupheader3",w=c+"-sequelgroupheader";e.mix(E.prototype,{getModelAttr:function(e,t){return e&&(e.get&&n.type(e.get)==="function"?e.get(t):e[t])},setModelAttr:function(e,t,r,i,s){var o=this,u;e&&(u=!e.get||n.type(e.get)!=="function",u?t?t?(o.revive(e),e.set(r,i,s),o.free(e)):e.set(r,i,s):e[r]=i:e.set(r,i,s))}},!0),e.LazyModelList.ITSALazyModelListAttrExtention=E,e.Base.mix(e.LazyModelList,[E]),S.ATTRS={modelList:{value:null,validator:function(t){return t instanceof e.ModelList||t instanceof e.LazyModelList||t===null},setter:"_setModelList"},noDups:{value:!1,validator:function(e){return n.isBoolean(e)},setter:"_setNoDups"},viewFilter:{value:null,validator:function(e){return n.isFunction(e)||e===null},setter:"_setViewFilter"},modelsSelectable:{value:null,lazyAdd:!1,validator:function(e){return e===""||e===null||e===!0||e===!1||e==="single"||e==="multi"},setter:"_setModelsSelectable"},modelListStyled:{value:!1,lazyAdd:!1,validator:function(e){return n.isBoolean(e)},setter:"_setModelListStyled"},clickSensivity:{value:2,validator:function(e){return n.isNumber(e)&&e>=0&&e<11}},clickEvents:{value:!1,lazyAdd:!1,validator:function(e){return n.isBoolean(e)},setter:"_setClickEvents"},mouseDownUpEvents:{value:!1,lazyAdd:!1,validator:function(e){return n.isBoolean(e)},setter:"_setMouseDownUpEvents"},hoverEvents:{value:!1,lazyAdd:!1,validator:function(e){return n.isBoolean(e)},setter:"_setHoverEvents"},lastItemOnTop:{value:null,validator:function(e){return n.isBoolean(e)},setter:"_setLastItemOnTop"},groupHeader1:{value:null,validator:function(e){return n.isFunction(e)||e===null},setter:"_setGroupHeader1"},groupHeader2:{value:null,validator:function(e){return n.isFunction(e)||e===null},setter:"_setGroupHeader2"},groupHeader3:{value:null,validator:function(e){return n.isFunction(e)||e===null},setter:"_setGroupHeader3"},renderModel:{value:function(e){return this.getModelAttr(e,"clientId")},validator:function(e){return n.isFunction(e)||e===null},setter:"_setRenderModel"},dupComparator:{value:null,validator:function(e){return n.isFunction(e)||e===null},setter:"_setDupComparator"},renderGroupHeader1:{value:null,validator:function(e){return n.isFunction(e)||e===null},setter:"_setRenderGroupHeader1"},renderGroupHeader2:{value:null,validator:function(e){return n.isFunction(e)||e===null},setter:"_setRenderGroupHeader2"},renderGroupHeader3:{value:null,validator:function(e){return n.isFunction(e)||e===null},setter:"_setRenderGroupHeader3"}},e.mix(S.prototype,{_eventhandlers:[],_originalModels:[],_selectableModelEvent:null,_clickModelEvent:null,_mouseenterModelEvent:null,_mouseUpModelEvent:null,_mouseDownModelEvent:null,_mouseleaveModelEvent:null,_selectedModels:{},_viewNode:null,_viewId:null,_lastClickedModel:null,_abberantModelList:null,_setViewFilterInitiated:null,_setLastItemOnTopInitiated:null,_setGroupHeader1Initiated:null,_setGroupHeader2Initiated:null,_setGroupHeader3Initiated:null,_setRenderGroupHeader1Initiated:null,_setRenderGroupHeader2Initiated:null,_setRenderGroupHeader3Initiated:null,_setRenderModelInitiated:null,_setDupComparatorInitiated:null,_setNoDupsInitiated:null,_rerenderAttributesOnChange:!0,_moreItemsAvailable:!0,_prevLastModelIndex:null,_modelListIsLazy:!1,_prevHeader1:null,_prevHeader2:null,_prevHeader3:null,_even:!1,initializer:function(){var t=this;t._viewId=e.guid(),t._eventhandlers.push(t.after("render",t._render,t))},setWithoutRerender:function(e,t,n){var r=this;r._rerenderAttributesOnChange=!1,r.set(e,t,n),r._rerenderAttributesOnChange=!0},modelIsSelected:function(e){var t=this,r;return n.isArray(e)?i.some(e,function(e){return r=t._selectedModels[t.getModelAttr(e,"clientId")],r?!1:!0}):r=t._selectedModels[t.getModelAttr(e,"clientId")],n.isValue(r)},selectModels:function(e){var t=this;n.isArray(e)?i.each(e,function(e){t._selectModel(e,!0)}):t._selectModel(e,!0)},unselectModels:function(e){var t=this;n.isArray(e)?i.each(e,function(e){t._selectModel(e,!1)}):t._selectModel(e,!1)},clearSelectedModels:function(){var e=this,t=e.get("contentBox");t.all("."+h).removeClass(h),e._selectedModels={}},getSelectedModels:function(e){var t=this,n;return e?(n=[],r.each(t._selectedModels,function(e){var r=t._originalModels[t.getModelAttr(e,"clientId")];(!r||i.indexOf(n,r)===-1)&&n.push(r||e)})):n=r.values(t._selectedModels),n},renderView:function(){this._renderView()},getModelAttr:function(e,t){return e&&(e.get&&n.type(e.get)==="function"?e.get(t):e[t])},setModelAttr:function(e,t,r,i,s){var o=this,u,a;e&&(u=!e.get||n.type(e.get)!=="function",u?t?(a=o.get("modelList"),o._modelListIsLazy&&t&&a.revive(e),e.set(r,i,s),o._modelListIsLazy&&t&&a.free(e)):e[r]=i:e.set(r,i,s))},destructor:function(){var e=this,t=e.get("modelList");e._clearEventhandlers(),t.removeTarget(e),e._selectableModelEvent&&e._selectableModelEvent.detach(),e._clickModelEvent&&e._clickModelEvent.detach(),e._mouseDownModelEvent&&e._mouseDownModelEvent.detach(),e._mouseUpModelEvent&&e._mouseUpModelEvent.detach(),e._mouseenterModelEvent&&e._mouseenterModelEvent.detach(),e._mouseleaveModelEvent&&e._mouseleaveModelEvent.detach(),e._viewNode.destroy(!0)},_render:function(){var e=this,t=e.get("modelList"),n;e._viewNode=n=s.create(o),n.set("id",e._viewId),e._extraBindUI(),t&&e.renderView()},_extraBindUI:function(){var e=this,t=e.get("boundingBox"),n=e.get("modelList"),r=e._eventhandlers;n&&(n.addTarget(e),t.addClass(c)),r.push(e.after("modelListChange",function(n){var r=n.newVal,i=n.prevVal;i&&i.removeTarget(e),r?(r.addTarget(e),t.addClass(c),e.renderView()):(t.removeClass(c),e.get("contentBox").setHTML(""))})),r.push(e.after("reset"
,e._resetView,e)),r.push(e.after("remove",e._renderView,e)),r.push(e.after("add",e._renderViewCheckAppend,e)),r.push(e.after("*:change",e._renderModelOrView,e))},_setModelList:function(t){var n=this;n._modelListIsLazy=t instanceof e.LazyModelList},_setNoDups:function(e){var t=this;t._setNoDupsInitiated?t._rerenderAttributesOnChange&&t._renderView({noDups:e}):t._setNoDupsInitiated=!0},_setViewFilter:function(e){var t=this;t._setViewFilterInitiated?t._rerenderAttributesOnChange&&t._renderView({viewFilter:e}):t._setViewFilterInitiated=!0},_setLastItemOnTop:function(e){var t=this;t._setLastItemOnTopInitiated?t._rerenderAttributesOnChange&&t._renderView({lastItemOnTop:e}):t._setLastItemOnTopInitiated=!0},_setDupComparator:function(e){var t=this;t._setDupComparatorInitiated?t._rerenderAttributesOnChange&&t.get("noDups")&&t._renderView({dupComparator:e}):t._setDupComparatorInitiated=!0},_setGroupHeader1:function(e){var t=this;t._setGroupHeader1Initiated?t._rerenderAttributesOnChange&&t._renderView({groupHeader1:e}):t._setGroupHeader1Initiated=!0},_setGroupHeader2:function(e){var t=this;t._setGroupHeader2Initiated?t._rerenderAttributesOnChange&&t._renderView({groupHeader2:e}):t._setGroupHeader2Initiated=!0},_setGroupHeader3:function(e){var t=this;t._setGroupHeader3Initiated?t._rerenderAttributesOnChange&&t._renderView({groupHeader3:e}):t._setGroupHeader3Initiated=!0},_setRenderGroupHeader1:function(e){var t=this;t._setRenderGroupHeader1Initiated?t._rerenderAttributesOnChange&&t._renderView({renderGroupHeader1:e}):t._setRenderGroupHeader1Initiated=!0},_setRenderGroupHeader2:function(e){var t=this;t._setRenderGroupHeader2Initiated?t._rerenderAttributesOnChange&&t._renderView({renderGroupHeader2:e}):t._setRenderGroupHeader2Initiated=!0},_setRenderGroupHeader3:function(e){var t=this;t._setRenderGroupHeader3Initiated?t._rerenderAttributesOnChange&&t._renderView({renderGroupHeader3:e}):t._setRenderGroupHeader3Initiated=!0},_setRenderModel:function(e){var t=this;t._setRenderModelInitiated?t._rerenderAttributesOnChange&&t._renderView({renderModel:e}):t._setRenderModelInitiated=!0},_setModelsSelectable:function(e){var t=this;return e===""||!e?e=null:n.isBoolean(e)&&(e="multi"),t._setSelectableEvents(e),e},_setModelListStyled:function(e){var t=this;t.get("boundingBox").toggleClass(v,e)},_setSelectableEvents:function(t){var n=this,r=n.get("contentBox");n.clearSelectedModels(),t&&!n._selectableModelEvent?n._selectableModelEvent=r.delegate("click",e.rbind(n._handleModelSelectionChange,n),function(){var e=Math.abs(n.lastScrolledAmt)>n.get("clickSensivity");return!e&&this.hasClass(l)}):!t&&n._selectableModelEvent&&(n._selectableModelEvent.detach(),n._selectableModelEvent=null)},_setClickEvents:function(e){var t=this,n=t.get("contentBox");e&&!t._clickModelEvent?t._clickModelEvent=n.delegate("click",function(e){var n=e.currentTarget,r=t.get("modelList"),i=n.getData("modelClientId"),s=r&&r.getByClientId(i);t.fire("modelClick",{node:n,model:s})},function(){var e=Math.abs(t.lastScrolledAmt)>t.get("clickSensivity");return!e&&this.hasClass(l)}):!e&&t._clickModelEvent&&(t._clickModelEvent.detach(),t._clickModelEvent=null)},_setMouseDownUpEvents:function(e){var t=this,n=t.get("contentBox");e&&!t._mouseDownModelEvent?t._mouseDownModelEvent=n.delegate("mousedown",function(e){var n=e.currentTarget,r=t.get("modelList"),i=n.getData("modelClientId"),s=r&&r.getByClientId(i);t.fire("modelMouseDown",{node:n,model:s})},"."+l):!e&&t._mouseDownModelEvent&&(t._mouseDownModelEvent.detach(),t._mouseDownModelEvent=null),e&&!t._mouseUpModelEvent?t._mouseUpModelEvent=n.delegate("mouseup",function(e){var n=e.currentTarget,r=t.get("modelList"),i=n.getData("modelClientId"),s=r&&r.getByClientId(i);t.fire("modelMouseUp",{node:n,model:s})},"."+l):!e&&t._mouseUpModelEvent&&(t._mouseUpModelEvent.detach(),t._mouseUpModelEvent=null)},_setHoverEvents:function(e){var t=this,n=t.get("contentBox");e&&!t._mouseenterModelEvent?t._mouseenterModelEvent=n.delegate("mouseenter",function(e){var n=e.currentTarget,r=t.get("modelList"),i=n.getData("modelClientId"),s=r&&r.getByClientId(i);t.fire("modelMouseEnter",{node:n,model:s})},"."+l):!e&&t._mouseenterModelEvent&&(t._mouseenterModelEvent.detach(),t._mouseenterModelEvent=null),e&&!t._mouseleaveModelEvent?t._mouseleaveModelEvent=n.delegate("mouseleave",function(e){var n=e.currentTarget,r=t.get("modelList"),i=n.getData("modelClientId"),s=r&&r.getByClientId(i);t.fire("modelMouseLeave",{node:n,model:s})},"."+l):!e&&t._mouseleaveModelEvent&&(t._mouseleaveModelEvent.detach(),t._mouseleaveModelEvent=null)},_handleModelSelectionChange:function(e){var t=this,n=e.currentTarget,r=t._abberantModelList||t.get("modelList"),i=n.getData("modelClientId"),s=r&&r.getByClientId(i),o=t.get("modelsSelectable"),u=o==="single",a=e.shiftKey&&!u,f=e.metaKey||e.ctrlKey,l=t.get("viewFilter"),c,h,p,d,v,m,g,y;c=s&&t.modelIsSelected(s),(u||!f)&&t.clearSelectedModels();if(s){if(a&&t._lastClickedModel){h=[],p=r.indexOf(s),d=r.indexOf(t._lastClickedModel),v=Math.min(p,d),m=Math.max(p,d);for(g=v;g<=m;g++)y=r.item(g),(!l||l(y))&&h.push(y);t.selectModels(h)}else c?t.unselectModels(s):t.selectModels(s),t._lastClickedModel=c?null:s;e.currentTarget.focus()}t._fireSelectedModels()},_renderView:function(e,t){var r=this,o=r._viewNode,c=r.get("contentBox"),h=r.get("modelList"),v=h&&h.size()>0&&h.item(0),E=e&&e.noDups||r.get("noDups"),S=e&&e.dupComparator||r.get("dupComparator"),x=e&&e.viewFilter||r.get("viewFilter"),T=e&&e.renderModel||r.get("renderModel"),N=e&&e.groupHeader1||r.get("groupHeader1"),C=e&&e.groupHeader2||r.get("groupHeader2"),k=e&&e.groupHeader3||r.get("groupHeader3"),L=e&&e.renderGroupHeader1||r.get("renderGroupHeader1")||N,A=e&&e.renderGroupHeader2||r.get("renderGroupHeader2")||C,O=e&&e.renderGroupHeader3||r.get("renderGroupHeader3")||k,M=e&&e.lastItemOnTop||r.get("lastItemOnTop"),_=v&&N&&n.isValue(N(v)),D=v&&C&&n.isValue(C(v)),P=v&&k&&n.isValue(k(v)),H=r.hasPlugin("itssvinfinite"),B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st;
st=function(e){var t=!1,n=S(e);return i.some(tt,function(r){return r===e?!0:(t=S(r)===n,t)}),t},c.one("#"+r._viewId)||(c.setHTML(o),r._set("srcNode",c)),tt=h._items.concat(),it=tt.length,!H||t?(o.setHTML(""),Z=0,nt=it,r._prevHeader1=null,r._prevHeader2=null,r._prevHeader3=null,r._even=!1):(Z=(r._prevLastModelIndex||-1)+1,nt=Math.min(r.itssvinfinite.get("batchSize"),it)),r._generateAbberantModelList?(I=e&&e.modelConfig||r.get("modelConfig"),I&&I.date&&(I.enddate||I.count)?(r._generateAbberantModelList(H,t),h=r._abberantModelList,tt=h._items.concat(),it=tt.length):r._abberantModelList=null):r._abberantModelList=null,rt=0;while(rt<nt&&Z<it)et=tt[Z],G=r.getModelAttr(et,"clientId"),(!x||x(et))&&(!E||!S&&(K=T(et))!==Q||S&&!st(et))&&(rt++,q=s.create(u),_&&(B=N(et),B!==r._prevHeader1&&(Y=s.create(u),Y.addClass(m),Y.addClass(g),r._prevHeader1&&Y.addClass(w),Y.setHTML(L(et)),o.append(Y),r._prevHeader1=B,r._even=!1,r._prevHeader2=null)),D&&(j=C(et),j!==r._prevHeader2&&(Y=s.create(u),Y.addClass(m),Y.addClass(y),r._prevHeader2&&Y.addClass(w),Y.setHTML(A(et)),o.append(Y),r._prevHeader2=j,r._even=!1,r._prevHeader3=null)),P&&(F=k(et),F!==r._prevHeader3&&(Y=s.create(u),Y.addClass(m),Y.addClass(b),r._prevHeader3&&Y.addClass(w),Y.setHTML(O(et)),o.append(Y),r._prevHeader3=F,r._even=!1)),q.setData("modelClientId",G),q.addClass(l),q.addClass(G),q.addClass(r._even?p:d),q.setHTML(K||T(et)),o.append(q),r._even=!r._even,E&&!S&&(Q=K)),Z++;r._prevLastModelIndex=Z-1;if(q&&M&&(!H||!r._moreItemsAvailable)){$=q,R=r.get("axis"),U=R.x,z=R.y,W=r.get("boundingBox"),q=s.create(a),q.addClass(f),J=U?"offsetWidth":"offsetHeight",X=W.get(J),V=X-$.get(J),$=$.previous();while($&&$.hasClass(m))V-=$.get(J),$=$.previous();q.setStyle(U?"width":"height",V+"px"),V>0&&o.append(q)}r.syncUI(),H&&r.itssvinfinite._checkExpansion(),r.fire("modelListRender")},_resetView:function(){this._resetView(null,!0)},_renderViewCheckAppend:function(e){var t=this,n=t.hasPlugin("itssvinfinite");t._renderView(null,n)},_renderModelOrView:function(e){var t=this,n=t.get("modelList");t._renderView()},_selectModel:function(e,t){var n=this,r=n.getModelAttr(e,"clientId"),i=n.get("contentBox"),s;r&&(s=i.one("."+r),s&&s.toggleClass(h,t),t?n._selectedModels[r]=e:delete n._selectedModels[r])},_fireSelectedModels:function(){var e=this,t,n;t=e.getSelectedModels(),n=e._abberantModelList?e.getSelectedModels(!0):t,e.fire("modelSelectionChange",{newModelSelection:t,originalModelSelection:n})},_clearEventhandlers:function(){i.each(this._eventhandlers,function(e){e.detach()})}},!0),e.ScrollView.ITSAScrollViewModelListExtention=S,e.Base.mix(e.ScrollView,[S])},"@VERSION@",{requires:["base-build","node-base","node-event-delegate","pluginhost-base","event-mouseenter","event-custom","model","model-list","lazy-model-list"],skinnable:!0});
