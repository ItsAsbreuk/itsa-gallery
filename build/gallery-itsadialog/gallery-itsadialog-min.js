YUI.add("gallery-itsadialog",function(e,t){"use strict";function N(){N.superclass.constructor.apply(this,arguments)}var n=e.Array,r=e.Lang,i=5e3,s='<i class="itsa-dialogicon {icon}"></i>',o="suspended",u="boolean",a="model",f="title",l="footer",c="info",h="warn",p="error",d="value",v="uppercase",m="lowercase",g="capitalize",y="itsa-dialog",b="escape:hide",w="visible",E="Transform",S="button"+E,x="label"+E,T=function(t){if(typeof t=="string")try{return e.JSON.parse(t)}catch(n){return this.fire(p,{error:n,response:t,src:"parse"}),{}}return t||{}};N.NAME="itsadialog",e.extend(N,e.ITSAMessageViewer,{},{ATTRS:{buttonTransform:{value:null,validator:function(e){return e===null||e===v||e===m||e===g}},labelTransform:{value:null,validator:function(e){return e===null||e===v||e===m||e===g}},showIcon:{value:!0,validator:function(e){return typeof e===u}}}}),N.prototype.initializer=function(){var t=this;t._eventhandlers=[],e.later(i,t,t.renderPromise)},N.prototype.renderPromise=function(){var t=this;return t._renderPromise||(t._renderPromise=e.usePromise("gallery-itsaviewmodelpanel","gallerycss-itsa-dialog").then(e.bind(t._renderPanels,t)))},N.prototype._renderPanels=function(){var t=this,n={visible:!1,centered:!0,modal:!0,editable:!0,minWidth:200,dragable:!0,maxWidth:550,buttonTransform:t.get(S),labelTransform:t.get(x),className:y},r=t._eventhandlers,i;i=t.panels={},i[c]=new e.ITSAViewModelPanel(n),i[h]=new e.ITSAViewModelPanel(n),i[p]=new e.ITSAViewModelPanel(n),r.push(i[c].after("*:hide",function(e){var n=e.target,r=n.get(a),i=e.buttonNode,s=i&&i.get(d),o=r.rejectButton,u=i.hasClass("itsa-panelclosebtn"),f=u&&i.getAttribute("data-itsaforgot")==="true",l=e.type===b||u&&!f||o&&(new RegExp("btn_"+s+"$")).test(o),c;l?r.rejectPromise(s):i&&i.getAttribute("data-itsalogin")==="forgotbutton"?(console.log("forgotbutton"),c=r.forgotMessage,c?t._showPanel(n,c):r.rejectPromise(s)):s==="forgotusername"?(console.log("forgot username"),c=r.forgotMessage,c?t._showPanel(n,c):r.rejectPromise(s)):s==="forgotpassword"?(console.log("forgot password"),c=r.forgotMessage,c?t._showPanel(n,c):r.rejectPromise(s)):f?(console.log("close forgot"),c=r.forgotMessage,c?t._showPanel(n,c):r.rejectPromise(s)):s==="sendusername"?(console.log("send username"),c=r.forgotMessage,c?t._showPanel(n,c):r.rejectPromise(s)):s==="resetpassword"?(console.log("reset password"),c=r.forgotMessage,c?t._showPanel(n,c):r.rejectPromise(s)):(r.UIToModel(),r._set("button",s),r.resolvePromise(r.toJSON()))})),r.push(i[c].after("*:submit",function(t){var n=t.target;t.promise.then(function(t){var r=T(t),s=i[c],o,u,a;r&&r.status?r.status==="OK"?(n._set("button","submit"),n.resolvePromise(n.toJSON())):r.status==="BLOCKED"?(u=r.message||"Login is blocked",e.showError(r.title||"error",u),n.rejectPromise(u)):r.status==="RETRY"?(r.title&&s.set("title",r.title),r.message&&(o=s.get("contentBox"),o.one("#itsa-messagewrapper").setHTML(r.message))):(u="Wrong response.status found: "+r.status+". You should return one of these: OK | RETRY | BLOCKED",a={src:"Y.ITSADialog.submit()",msg:u},s.fire("warn",a),n.rejectPromise(u)):(u="Response returned without response.status",a={src:"Y.ITSADialog.submit()",msg:u},s.fire("warn",a),n.rejectPromise(u))}).then(null,function(t){var n=t&&(t.message||t)||"Undefined error during submission";e.showWarning(n)})})),r.push(i[h].after("*:hide",function(e){var t=e.target,n=t.get(a),r=e.buttonNode,i=r&&r.get(d),s=n.rejectButton,o=r.hasClass("itsa-panelclosebtn"),u=e.type===b||o||s&&(new RegExp("btn_"+i+"$")).test(s);u?n.rejectPromise(i):n.UIToModel()&&n._set("button",i)&&n.resolvePromise(n.toJSON())})),r.push(i[p].after("*:hide",function(e){var t=e.target,n=t.get(a),r=e.buttonNode,i=r&&r.get(d),s=n.rejectButton,o=r.hasClass("itsa-panelclosebtn"),u=e.type===b||o||s&&(new RegExp("btn_"+i+"$")).test(s);u?n.rejectPromise(i):n.UIToModel()&&n._set("button",i)&&n.resolvePromise(n.toJSON())})),r.push(t.on(x+"Change",function(e){var t=e.newVal;i[c].set(x,t),i[h].set(x,t),i[p].set(x,t)})),r.push(t.on(S+"Change",function(e){var t=e.newVal;i[c].set(S,t),i[h].set(S,t),i[p].set(S,t)})),i[c].render(),i[h].render(),i[p].render()},N.prototype.viewMessage=function(t){var n=this;return n.renderPromise().then(function(){return new e.Promise(function(r){var i=n.panels,s=i[t.level];n._showPanel(s,t),t.promise.then(function(){return s.set(w,!1,{silent:!0})},function(){return s.set(w,!1,{silent:!0})}).then(r).then(null,function(t){e.soon(function(){throw t})})})})},N.prototype._showPanel=function(e,t){var n=this,i=t.primaryButton,c=t.rejectButton,h=t.buttonLabels,p=t.hotKeys,d=t.customBtns,v=t.noButtons,m=typeof t.noHideOnSubmit===u?t.noHideOnSubmit:!1,g=t[l],y=/btn_/.test(g),b=t.icon,w=b&&n.get("showIcon"),E,S;e.set("noHideOnSubmit",m),e.removeButtonLabel(),e.removeCustomBtn(),e.removeHotKey(),e.set("closeButton",t.closeButton||!y&&!v),e.set("closableByEscape",typeof c=="string"),e.set(l+"Template",v?null:g),h&&e.setButtonLabels(h),p&&e.setHotKeys(p),d&&e.addCustomBtns(d),!v&&g&&r.isValue(i)&&(E=e.get("footerView"),S=typeof i=="boolean"&&!i,S?E.removePrimaryButton():E.setPrimaryButton(i)),e.set(f,t[f]),e.set(a,t),e._body.toggleClass("itsa-hasicon",w),e.set("template",(w?r.sub(s,{icon:b}):"")+t.message),t[o]||e.show()},N.prototype.resurrect=function(e){var t=this;t.renderPromise().then(function(){var n=t.panels[e.level];n&&n.set(w,!0,{silent:!0})})},N.prototype.suspend=function(e){var t=this;t.renderPromise().then(function(){var n=t.panels[e.level];n&&n.set(w,!1,{silent:!0})})},N.prototype.destructor=function(){var e=this.panels;this._clearEventhandlers(),e[c].destroy(),e[h].destroy(),e[p].destroy()},N.prototype._clearEventhandlers=function(){var e=this;n.each(e._eventhandlers,function(e){e.detach()})},e.Global.ITSADialog||(e.Global.ITSADialog=new N),e.ITSADialog=e.Global.ITSADialog},"@VERSION@",{requires:["yui-base","promise","event-custom-base","yui-later","oop","gallery-itsaviewmodelpanel","gallery-itsamodulesloadedpromise","gallery-itsamessageviewer"],skinnable:!0
});
