YUI.add("gallery-itsafilemanager",function(e,t){"use strict";var n=e.Lang,r=e.Array,i=e.UA.ie,s="\0",o="An error occured during processing",u=["all files","images","non-images","word","excel","pdf"],a=["list","thumbnails","tree","coverflow"],f=["copy file","rename file","delete file","copy dir","rename dir","delete dir"],l='<img src="{thumbnail}" />',c="yui3-itsafilemanager-hidden",h="yui3-treeview-notouch",p="yui3-treeview-selected",d="<div></div>",v='<button class="pure-button pure-button-toolbar">{text}</button>',m="Filemanager",g="ready",y="yui3-itsafilemanager",b=y+"-title",w=y+"-toolbar",E=y+"-hidden",S=y+"-border",x=y+"-shadow",T=y+"-itsaresehandlerx",N=y+"-itsaresehandlery",C=y+"-tree",k=y+"-roottreeview",L="yui3-treeview-node",A="yui3-treeview-row",O=y+"-treeview",M=y+"-main",_=y+"-flow",D=y+"-items",P='<div class="'+b+'">{title}</div><div class="'+w+'"></div>',H="<div class='"+C+"'>"+"<div class='"+k+" "+L+" "+c+"'>"+"<div class='"+A+"'>{root}</div>"+"</div>"+"<div class='"+O+"'></div>"+"</div>"+"<div class='"+M+"'>"+"<div class='"+_+"'></div>"+"<div class='"+D+"'></div>"+"</div>",B="error",j=function(e){return parseInt(e,10)},F=function(t){if(typeof t=="string")try{return e.JSON.parse(t)}catch(n){return this.fire(B,{error:n,response:t,src:"parse"}),null}return t};e.Tree.Node.prototype.getTreeInfo=function(e){var t=this,n=t.isRoot()?"/":"/"+t[e],r=t.parent;while(r&&!r.isRoot())n="/"+r[e]+n,r=r.parent;return n},e.SortableTreeView=e.Base.create("sortableTreeView",e.TreeView,[e.TreeView.Sortable],{sortComparator:function(e){return(e.canHaveChildren?s:"")+e.label}}),e.ITSAFileManager=e.Base.create("itsafilemanager",e.Panel,[],{initializer:function(){var t=this,n=t.get("boundingBox");t._inlineblock="inline"+(i>0&&i<8?"":"-block"),t._eventhandlers=[],t._resizeApprovedX=!1,t._resizeApprovedY=!1,t._bodyNode=null,t._resizeEvent=null,t._busyResize=!1,t._panelHD=null,t._panelBD=null,t._panelFT=null,t._nodeFilemanTree=null,t._nodeFilemanTreeView=null,t._nodeFilemanFlow=null,t._nodeFilemanItems=null,t._borderTreeArea=0,t._halfBorderTreeArea=0,t._borderFlowArea=0,t._halfBorderFlowArea=0,t._mouseOffset=0,t._bodyNode=e.one("body"),t.publish(B,{preventable:!1,broadcast:1}),t._createPromises(),n.addClass(c),(t.get("delayView")?t.dataPromise:t.readyPromise).then(function(){t._setConstraints(!0),t._correctHeightAfterResize(),n.removeClass(c)})},bindUI:function(){var e=this,t=e._eventhandlers,r=e.get("boundingBox"),i=e.get("contentBox"),s;e.set("headerContent",n.sub(P,{title:e.get("title")})),e.set("bodyContent",n.sub(H,{root:"root"})),e.set("footerContent",g),e._panelHD=i.one(".yui3-widget-hd"),s=e._panelBD=i.one(".yui3-widget-bd"),e._panelFT=i.one(".yui3-widget-ft"),e.get("statusBar")||e._panelFT.setStyle("display","none"),t.push(s.on(["mousemove","touchstart"],e._checkResizeAprovement,e)),t.push(s.on("mouseleave",e._checkEndResizeApprovement,e)),t.push(s.on(["mousedown","touchstart"],e._startResize,e)),t.push(e._bodyNode.on(["mouseup","mouseleave","touchend"],e._stopResize,e)),t.push(e.on("sortableTreeView:select",e._loadFilePane,e)),e.get("visible")||r.addClass(E),t.push(e.after("visibleChange",function(e){r.toggleClass(E,!e.newVal)}))},getCurrentDir:function(){return this._currentDir},getCurrentDirTreeNode:function(){return this._currentDirTreeNode},hideFlow:function(){this.set("flow",!1)},hideTree:function(){this.set("tree",!1)},showFlow:function(){this.set("flow",!0)},showTree:function(){this.set("tree",!0)},sync:function(){return new e.Promise(function(e,t){t(new Error("The sync()-method was not overridden"))})},destructor:function(){var e=this;e._resizeEvent&&e._resizeEvent.detach(),e._clearEventhandlers(),e.files.destroy(),e.filescrollview.destroy(),e.tree.destroy()},_createPromises:function(){var t=this;t._resizeConstrainPromise=new e.Promise(function(n){t.renderPromise().then(function(){t.hasPlugin("resize")?t.resize.hasPlugin("con")?(t.resize.con.set("preserveRatio",!1),n()):e.use("resize-constrain",function(){t.resize.plug(e.Plugin.ResizeConstrained,{preserveRatio:!1}),n()}):n()})}),t.readyPromise=new e.Promise(function(n){t.renderPromise().then(e.rbind(t._afterRender,t)).then(e.rbind(t._allWidgetsRenderedPromise,t)).then(n)}),t.dataPromise=new e.Promise(function(n){t._createMethods(),t.readyPromise.then(e.batch(t.loadFiles(),t.get("lazyRender")?t.loadTreeLazy():t.loadTree())).then(n)})},_allWidgetsRenderedPromise:function(){var t=this;return e.batch(t._resizeConstrainPromise,t.filterSelect.renderPromise(),t.viewSelect.renderPromise(),t.editSelect.renderPromise(),t.filescrollview.renderPromise())},_afterRender:function(){var e=this,t=e._eventhandlers,n=e.get("boundingBox"),r,i,s,o;e._nodeFilemanToolbar=n.one("."+w),e._nodeFilemanTree=r=n.one("."+C),e._nodeFilemanTreeRoot=r.one("."+k),e._nodeFilemanTreeView=r.one("."+O),e._nodeFilemanFlow=i=n.one("."+_),e._nodeFilemanItems=n.one("."+D),e._borderTreeArea=s=j(r.getStyle("borderRightWidth")),e._borderFlowArea=o=j(i.getStyle("borderBottomWidth")),e._halfBorderTreeArea=Math.round(s/2),e._halfBorderFlowArea=Math.round(o/2),e.set("sizeTreeArea",e.get("sizeTreeArea")),e.set("sizeFlowArea",e.get("sizeFlowArea")),e.hasPlugin("dd")&&e.dd.addHandle("."+b),e.hasPlugin("resize")&&(t.push(e.resize.on("resize:resize",e._correctHeightAfterResize,e)),t.push(e.resize.on("resize:end",function(){e._correctHeightAfterResize(),e.filescrollview.syncUI()}))),e._renderToolbar(),e._renderTree(),e._selectRootNode(!0),e._renderFiles()},_renderFiles:function(){var t=this,n,r,i;t.files=n=new e.LazyModelList,n.comparator=function(e){return e.filename||""},r=l,t.filescrollview=i=new e.ITSAScrollViewModellist({boundingBox:t._nodeFilemanItems,modelTemplate:r,axis:"y",modelListStyled:!1,showLoadMessage:!1,modelList:n}),i.addTarget(t),i.render()},_renderToolbar:function(){var t=this,r=t._eventhandlers,i,s,o,l,c,h,p,m;i=t.filterSelect=new e.ITSASelectList({items:u,selectionOnButton:!1,defaultButtonText:"filter",btnSize:1,buttonWidth:60}),i.after("selectChange",function(n){var r=
n.value;e.alert(r),t.filescrollview.set("viewFilter",r==="all files"?null:function(e){return!0})}),l=e.Node.create(d),t._nodeFilemanToolbar.append(l),i.render(l),s=t.viewSelect=new e.ITSASelectList({items:a,selectionOnButton:!1,defaultButtonText:"view",btnSize:1,buttonWidth:60}),s.after("selectChange",function(t){var n=t.value;e.alert(n)}),c=e.Node.create(d),t._nodeFilemanToolbar.append(c),s.render(c),o=t.editSelect=new e.ITSASelectList({items:f,selectionOnButton:!1,defaultButtonText:"edit",btnSize:1,buttonWidth:60}),o.after("selectChange",function(n){var r=n.index,i;switch(r){case 0:break;case 1:break;case 2:break;case 3:i=t._currentDirTreeNode.label,e.prompt("Duplicate directory "+i,"Enter the directory-name of the duplicated directory:",{value:i+"-copy"}).then(function(n){t.cloneDir(e.Escape.html(n.value))});break;case 4:i=t._currentDirTreeNode.label,e.prompt("Rename directory "+i,"Enter new directory-name:",{value:i}).then(function(n){t.renameDir(e.Escape.html(n.value))});break;case 5:i=t._currentDirTreeNode.label,e.confirm("Delete directory","Are you sure you want to delete '"+i+"'<br />and all of its content?").then(function(){t.deleteDir()})}}),h=e.Node.create(d),t._nodeFilemanToolbar.append(h),o.render(h),p=e.Node.create(n.sub(v,{text:"create dir"})),r.push(p.on("click",function(){var n=t._currentDirTreeNode.label;e.prompt("Create sub-directory of "+n,"Enter new directory-name:",{value:"New Directory"}).then(function(n){t.createDir(e.Escape.html(n.value))})})),t._nodeFilemanToolbar.append(p),m=e.Node.create(n.sub(v,{text:"upload files"})),t._nodeFilemanToolbar.append(m)},_renderTree:function(){var t=this,n=t._nodeFilemanTreeRoot,r=t._eventhandlers,i,s;s=t.get("lazyRender"),t.tree=i=new e.SortableTreeView({container:t._nodeFilemanTreeView,lazyRender:s,multiSelect:!1}),i.addTarget(t),i.render(),t._nodeFilemanTreeView.hasClass(h)&&t._nodeFilemanTreeRoot.addClass(h),s&&e.use("tree-lazy",function(){i.plug(e.Plugin.Tree.Lazy,{load:function(e,n){t.loadTreeLazy(e).then(function(){n()},function(e){n(new Error(e))})}})}),i.after("sortableTreeView:select",function(){n.removeAttribute("tabIndex"),n.removeClass(p)}),r.push(n.on("click",t._selectRootNode,t))},_selectRootNode:function(e){var t=this,n=t.tree,i=t._nodeFilemanTreeRoot;i.set("tabIndex",0),i.addClass(p),i.focus(),t._currentDir="/",t._currentDirTreeNode=n.rootNode,e||t.loadFiles(),r.each(n.getSelectedNodes(),function(e){e.unselect()})},_checkEndResizeApprovement:function(){var e=this;(e._resizeApprovedX||e._resizeApprovedY)&&!e._busyResize&&e._endResizeApprovement()},_checkResizeAprovement:function(t){if(!this._busyResize){var n=this,r=n._panelBD,i=n._nodeFilemanFlow,s=t.pageX,o=t.pageY,u=r.getX(),a=r.getY(),f=n.get("contentBox"),l=n.get("tree"),c=n.get("flow"),h=i.get("offsetHeight"),p=e.UA.mobile?n.get("resizeMarginTouchDevice"):n.get("resizeMargin"),d=Math.round(p/2),v=Math.abs(s-u+n._halfBorderTreeArea),m=Math.abs(o-(a+h-n._halfBorderFlowArea));n._resizeApprovedX=l&&v<=d,n._resizeApprovedY=c&&m<=d&&(!l||s>u+d),f.toggleClass(T,n._resizeApprovedX),f.toggleClass(N,n._resizeApprovedY)}},_clearEventhandlers:function(){var e=this;r.each(this._eventhandlers,function(e){e.detach()})},_correctHeightAfterResize:function(){var e=this,t=e._panelHD,n=e._panelFT,r=e._nodeFilemanItems,i=t?t.get("offsetHeight"):0,s=n?n.get("offsetHeight"):0,o=j(e.get("boundingBox").getStyle("height"))-i-s,u=o-e.get("sizeFlowArea");e._panelBD.setStyle("height",o+"px"),r&&r.setStyle("height",u+"px")},_createMethods:function(){var t=this;r.each(["loadFiles","loadMoreFiles","loadTree","loadTreeLazy","renameFiles","renameDir","deleteFiles","deleteDir","createDir","moveDir","moveFiles","cloneDir","copyFiles"],function(n){t[n]=function(r){var i={};return t.get("rendered")||t.render(),n==="loadFiles"?i.currentDir=t.getCurrentDir():n==="loadAppendFiles"?(i.currentDir=t.getCurrentDir(),i.batchSize=t.get("batchSize"),i.size=t.files.size(),i.lastFileId=t._lastFileId):n==="loadTree"?i.showTreefiles=t.get("showTreefiles"):n==="loadTreeLazy"?(i.showTreefiles=t.get("showTreefiles"),i.directory=r?r.getTreeInfo("label")+"/":"/"):n==="renameFiles"?(i.selectedFiles=t.getSelectedFiles(),i.newFilename=r):n==="renameDir"?(i.currentDir=t.getCurrentDir(),i.newDirName=r):n==="deleteFiles"?(i.selectedFiles=t.getSelectedFiles(),i.currentDir=t.getCurrentDir()):n==="deleteDir"?i.currentDir=t.getCurrentDir():n==="createDir"?(i.currentDir=t.getCurrentDir(),i.dirName=r):n==="moveDir"?(i.currentDir=t.getCurrentDir(),i.newParentDir=r):n==="moveFiles"?(i.currentDir=t.getCurrentDir(),i.selectedFiles=t.getSelectedFiles(),i.destinationDir=r):n==="cloneDir"?(i.currentDir=t.getCurrentDir(),i.clonedDirName=r):n==="copyFiles"&&(i.selectedFiles=t.getSelectedFiles(),i.currentDir=t.getCurrentDir(),i.destinationDir=r),t.readyPromise.then(e.bind(t.sync,t,n,i)).then(e.rbind(t._handleSync,t,n,i,r),e.rbind(t._handleSyncError,t,n,i))}})},_handleSyncError:function(t,n,r){var i=this,s;return i.fire(B),e.fire(B),s={options:r,error:t,src:n},i.fire(B,s),e.fire(B,s),t},_handleSync:function(e,t,n,r){var i=this,s=F(e),u=s.error,a=i.tree,f=i.get("lazyRender"),l,h,p,d;if(u)return i._handleSyncError(u.description||o,t,n);l={response:e,options:n},i["_"+t]||(i["_"+t]=i.publish(t,{preventable:!1}));if(t==="loadFiles")i.files.reset(s);else if(t!=="loadAppendFiles")if(t==="loadTreeLazy"&&f)i._rootVisible||(i._rootVisible=i._nodeFilemanTreeRoot.removeClass(c)),a.insertNode(r,s);else if(t!=="renameFiles")if(t==="renameDir")h=i._currentDirTreeNode,h.label=n.newDirName,h.parent.sort(),i._currentDir=h.getTreeInfo("label")+"/";else if(t!=="deleteFiles")if(t==="deleteDir")h=i._currentDirTreeNode,d=h.parent,a.removeNode(h,{destroy:!0}),d===a.rootNode?i._selectRootNode():a.selectNode(d);else if(t==="createDir"){h=i._currentDirTreeNode;if(!f||h.state.loaded||h===a.rootNode)p=s.result,a.insertNode(h,{label:p,canHaveChildren:!0});a.openNode(h)}else t!=="moveDir"&&t!=="moveFiles"&&t!=="cloneDir"&&t!=="copyFiles"&&t==="loadTree"&&!f&&(i._rootVisible||
(i._rootVisible=i._nodeFilemanTreeRoot.removeClass(c)),a.insertNode(a.rootNode,s));return i.fire(t,l),e},_endResizeApprovement:function(){var e=this,t=e.get("contentBox");e._resizeApprovedX=!1,e._resizeApprovedY=!1,t.toggleClass(T,!1),t.toggleClass(N,!1)},_loadFilePane:function(e){var t=this,n=e.node;n.canHaveChildren&&(t._currentDir=n.getTreeInfo("label")+"/",t._currentDirTreeNode=n,t.loadFiles())},_resizeTree:function(e){if(this._busyResize){var t=this,n=t._nodeFilemanTree,r=n.getX(),i=Math.round(e.pageX-r-t._mouseOffset);t.set("sizeTreeArea",i)}},_resizeFlow:function(e){if(this._busyResize){var t=this,n=t._nodeFilemanFlow,r=n.getY(),i=Math.round(e.pageY-r-t._mouseOffset);t.set("sizeFlowArea",i)}},_setConstraints:function(e){e&&(this._constraintsSetable=!0);if(this._constraintsSetable){var t=this,n=t.resize&&t.resize.con,r=t._panelHD,i=t._panelFT,s=r?r.get("offsetHeight"):0,o=i?i.get("offsetHeight"):0,u=(t.get("tree")?Math.max(t.get("sizeTreeArea"),t._borderTreeArea):0)+t.get("minWidthFileArea"),a=(t.get("flow")?Math.max(t.get("sizeFlowArea"),t._borderFlowArea):0)+t.get("minHeightFileArea")+s+o,f=t.get("boundingBox");n&&(n.set("minWidth",u),n.set("minHeight",a)),j(f.getStyle("width"))<u&&(f.setStyle("width",u+"px"),t.set("sizeTreeArea",t.get("sizeTreeArea"))),j(f.getStyle("height"))<a&&(f.setStyle("height",a+"px"),t._panelBD.setStyle("height",a-s-o+"px"),t.set("sizeFlowArea",t.get("sizeFlowArea")))}},_setShowTreefiles:function(e){},_setSizeFlowArea:function(e,t,n){var r=this,i=r._borderFlowArea,s=r._nodeFilemanFlow,o=n?0:Math.max(r.get("minSizeFlowArea")-i,0),u=r._panelBD.get("offsetHeight")-r.get("minHeightFileArea")-i,a=Math.max(e-i,o);return a=Math.min(a,u),s&&(s.setStyle("height",a+"px"),r.resize&&r.resize.hasPlugin("con")&&r._setConstraints()),a},_setSizeTreeArea:function(e,t,n){var r=this,i=r._nodeFilemanTree,s=r._borderTreeArea,o=n?0:Math.max(r.get("minSizeTreeArea"),s),u=r.get("contentBox").get("offsetWidth")-r.get("minWidthFileArea"),a=Math.max(e,o),f;return a=Math.min(a,u),f=a-s,i.setStyle("width",f+"px"),i.setStyle("marginLeft",-a+"px"),r._panelBD.setStyle("marginLeft",a+"px"),r.resize&&r.resize.hasPlugin("con")&&r._setConstraints(),a},_startResize:function(e){var t=this,n=t._nodeFilemanTree,r=t._nodeFilemanFlow,i,s,o,u;t._resizeApprovedX?(t._busyResize=!0,i=n.getX(),o=n.get("offsetWidth"),t._mouseOffset=e.pageX-(i+o),t._resizeEvent&&t._resizeEvent.detach(),t._resizeEvent=t._bodyNode.on(["mousemove","touchmove"],t._resizeTree,t)):t._resizeApprovedY&&(t._busyResize=!0,s=r.getY(),u=r.get("offsetHeight"),t._mouseOffset=e.pageY-(s+u),t._resizeEvent&&t._resizeEvent.detach(),t._resizeEvent=t._bodyNode.on(["mousemove","touchmove"],t._resizeFlow,t))},_stopResize:function(){var e=this;e._busyResize&&(e._busyResize=!1,e._resizeEvent&&e._resizeEvent.detach())}},{ATTRS:{batchSize:{value:500,validator:function(e){return typeof e=="number"&&e>0}},border:{value:!0,lazyAdd:!1,validator:function(e){return typeof e=="boolean"},setter:function(e){this.get("boundingBox").toggleClass(S,e)}},delayView:{value:!1,validator:function(e){return typeof e=="boolean"}},tree:{value:!0,validator:function(e){return typeof e=="boolean"},setter:function(e){var t=this;t._nodeFilemanTree.setStyle("display",e?t._inlineblock:"none"),t.resize&&t.resize.hasPlugin("con")&&t._setConstraints(),t._setSizeTreeArea(e?t.get("sizeTreeArea"):0,null,!0)},getter:function(){return this._nodeFilemanTree.getStyle("display")!=="none"}},flow:{value:!1,validator:function(e){return typeof e=="boolean"},setter:function(e){var t=this;t._nodeFilemanFlow.setStyle("display",e?"block":"none"),t.resize&&t.resize.hasPlugin("con")&&t._setConstraints(),t._setSizeFlowArea(e?t.get("sizeFlowArea"):0,null,!0)},getter:function(){return this._nodeFilemanFlow.getStyle("display")!=="none"}},lazyRender:{value:!1,writeOnce:"initOnly",validator:function(e){return typeof e=="boolean"}},showTreefiles:{value:!1,validator:function(e){return typeof e=="boolean"},setter:"_setShowTreefiles"},sizeTreeArea:{value:200,validator:function(e){return typeof e=="number"},setter:"_setSizeTreeArea"},sizeFlowArea:{value:150,validator:function(e){return typeof e=="number"},setter:"_setSizeFlowArea"},minSizeTreeArea:{value:100,validator:function(e){return typeof e=="number"&&e>=0},setter:function(){var e=this;e.resize&&e.resize.hasPlugin("con")&&e._setConstraints()}},minSizeFlowArea:{value:100,validator:function(e){return typeof e=="number"&&e>=0},setter:function(){var e=this;e.resize&&e.resize.hasPlugin("con")&&e._setConstraints()}},minWidthFileArea:{value:200,validator:function(e){return typeof e=="number"&&e>=50},setter:function(){var e=this;e.resize&&e.resize.hasPlugin("con")&&e._setConstraints()}},minHeightFileArea:{value:100,validator:function(e){return typeof e=="number"&&e>=50},setter:function(){var e=this;e.resize&&e.resize.hasPlugin("con")&&e._setConstraints()}},title:{value:m,validator:function(e){return typeof e=="string"},setter:function(e){this.set("headerContent",e)}},resizeMargin:{value:6,validator:function(e){return n.isNumber(e)&&e>=2&&e<=60}},resizeMarginTouchDevice:{value:32,validator:function(e){return typeof e=="number"&&e>=2&&e<=60}},statusBar:{value:!0,validator:function(e){return typeof e=="boolean"},setter:function(e){var t=this;t._panelFT.setStyle("display",e?"":"none"),t._correctHeightAfterResize()}},shadow:{value:!0,lazyAdd:!1,validator:function(e){return n.isBoolean(e)},setter:function(e){this.get("boundingBox").toggleClass(x,e)}}}})},"@VERSION@",{requires:["base-build","panel","event","event-custom","event-touch","node-base","node-screen","node-event-delegate","pluginhost-base","lazy-model-list","promise","json-parse","gallery-sm-treeview","gallery-sm-treeview-sortable","gallery-itsaerrorreporter","gallery-itsadialog","gallery-itsascrollviewmodellist","gallery-itsawidgetrenderpromise","gallery-itsaselectlist"],skinnable:!1});
