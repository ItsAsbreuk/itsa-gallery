YUI.add("gallery-itsaeditmodel",function(e,t){"use strict";var n=e.Array,r=e.Object,i=e.ITSAFormElement,s="click",o="save",u="destroy",a="cancel",f="edit",l="submit",c="reset",h="date",p="time",d="picker",v="data",m="value",g="button",y="type",b=v+"-"+g+"sub"+y,w=v+"-"+g+y,E="focusnext",S="uichanged",x=g+s,T=u+s,N=l+s,C=a+s,k=c+s,L=f+s,A=o+s,O=h+d+s,M=p+d+s,_=h+p+d+s;e.ITSAEditModel=e.Base.create("itsaeditmodel",e.Model,[],{initializer:function(){var t=this;t._eventhandlers=[],t._FORMelements={},t._ATTRS_nodes={},t._lifeUpdate=!1,t._needAutoSaved=!1,t._autoSaveTimer=null,t.publish(E,{defaultFn:e.bind(t.defFnFocusNext,t),emitFacade:!0}),t.publish(S,{defaultFn:e.bind(t._defFnUIChanged,t),emitFacade:!0}),t.publish(T,{defaultFn:e.bind(t._defFnDestroy,t),emitFacade:!0}),t.publish(N,{defaultFn:e.bind(t._defFnSubmit,t),emitFacade:!0}),t.publish(C,{defaultFn:e.bind(t._defFnCancel,t),emitFacade:!0}),t.publish(k,{defaultFn:e.bind(t._defFnReset,t),emitFacade:!0}),t.publish(A,{defaultFn:e.bind(t._defFnSave,t),emitFacade:!0}),t.publish(O,{defaultFn:e.bind(t._defFnChangeDate,t),emitFacade:!0}),t.publish(M,{defaultFn:e.bind(t._defFnChangeDate,t),emitFacade:!0}),t.publish(_,{defaultFn:e.bind(t._defFnChangeDate,t),emitFacade:!0}),t._bindUI()},defFnFocusNext:function(){},renderBtn:function(e,t){return this._renderBtn(e,t,g,!0)},renderCancelBtn:function(e,t){return this._renderBtn(e,t,a,!0)},renderDestroyBtn:function(e,t){return this._renderBtn(e,t,u,!0)},renderEditBtn:function(e,t){return this._renderBtn(e,t,f,!0)},renderResetBtn:function(e,t){return this._renderBtn(e,t,c)},renderSaveBtn:function(e,t){return this._renderBtn(e,t,o,!0)},renderSubmitBtn:function(e,t){return this._renderBtn(e,t,l)},renderFormElement:function(t){var n=this,r,s,o,u,a,f,l,c,h,p,d;return r=n._FORMelements,s=n._ATTRS_nodes,o=n.get(t),o&&(u=n._getAttrCfg(t),l=u.formtype||"text",c=u.formconfig||{},h=n._getWidgetValueField(l),c[h]=o,c.modelattribute=!0,c.name=t,a=i.getElement(l,c),p=a.nodeid,r[p]=a,s[t]||(s[t]=[]),s[t].push(p),d=a.widget,d&&n._eventhandlers.push(d.after(h+"Change",e.rbind(n._updateSimularWidgetUI,n,p,t,h))),f=a.html,a.widget&&a.widget.addTarget(n)),f},destructor:function(){var e=this;e._autoSaveTimer&&e._autoSaveTimer.cancel(),e._fireEventTimer&&e._fireEventTimer.cancel(),e._clearEventhandlers(),e._removeTargets(),e._FORMelements={},e._ATTRS_nodes={}},_bindUI:function(){var t=this,n=t._eventhandlers,r=e.one("body");n.push(r.delegate([O,M,_,x,A,T,L,C,N,k],function(e){var n=e.target,r=e.type,i=n.getAttribute(m),s={target:t,value:r===O||r===M||r===_?(new Date).setTime(parseInt(i,10)):i,formElement:t._FORMelements[n.get("id")],buttonNode:n,type:r};t.fire(r,s)},function(e,n){return t._FORMelements[n.target.get("id")]})),n.push(r.delegate("valuechange",function(e){var n=e.target,r=S,i={target:t,value:n.get(m),formElement:t._FORMelements[n.get("id")],node:n,type:r};t.fire(r,i)},function(e,n){return t._FORMelements[n.target.get("id")]})),n.push(t.after("*:change",function(n){e.confirm("Data has been changed from another source. Load it into the formelements?").then(e.bind(t._modelToUI,t))}))},_clearEventhandlers:function(){n.each(this._eventhandlers,function(e){e.detach()})},_defFnUIChanged:function(e){var t=this,n=e.formElement.name,r=e.node;t._updateSimularUI(r,n,e.value),t._lifeUpdate&&t._UItoModel(e.node)},_defFnDestroy:function(){var e=this;e.destroyPromise()},_defFnEdit:function(){},_defFnSubmit:function(){var e=this;e.submitPromise()},_defFnCancel:function(){},_defFnReset:function(){},_defFnSave:function(){var e=this;e._UItoModel(),e.savePromise()},_defFnChangeDate:function(t){e.use("gallery-itsadatetimepicker",function(){var n=t.target,r=t.type,i=t.buttonNode,s=e.ItsaDateTimePicker,o=t.formElement,u,a;r===O?u=e.bind(s.getDate,s):r===M?u=e.bind(s.getTime,s):r===_&&(u=e.bind(s.getDateTime,s)),u(new Date(t.value),o.config).then(function(e){i.setAttribute("value",e.getTime()),a=o.config.format,n._updateDateTimeUI(o.name,e,r,a),n._lifeUpdate&&n._UItoModel(i.get("id"))},function(){return!0}).then(function(){i&&i.focus()})})},_getWidgetValue:function(e,t){return e&&e.get(this._getWidgetValueField(t))},_getWidgetValueField:function(e){var t=typeof e=="function"&&e.prototype.BOUNDING_TEMPLATE,n,r;return t&&(n=e.NAME,n==="itsacheckbox"&&(r="checked")),r||"value"},_modelToUI:function(){console.log("_modelToUI")},_removeTargets:function(){var e=this;r.each(e._FORMelements,function(t){var n=t.widget;n&&n.removeTarget(e)})},_renderBtn:function(e,t,n,r){var s=this,o=s._BUTTONelements,u,a;return t||(t={}),n||(n=g),e||(e=n),a=t.value||e,o[a]||(t.buttonText=e,t.data||(t.data=""),r&&(t.data+=" "+b+'="'+n+'"'),u=i.getElement(n===l||n===c?n:g,t),o[a]=s._FORMelements[u.nodeid]=u),o[a].html},_UItoModel:function(t){var n=this,i,s,o,u,a,f,l;s=n._FORMelements,i=t&&s[t],i&&(u=e.one("#"+t))&&u.getData("modelattribute")?(l=i.widget,a=l?n._getWidgetValue(l,i.type):u.getAttribute(m),f=u.get("name"),a&&(o={formelement:!0},n.set(f,a,o))):t||r.each(n._FORMelements,function(e,t){n._UItoModel(t)})},_updateDateTimeUI:function(t,r,i,s){var o=this,u=o._ATTRS_nodes[t];u&&(s||(i==="date"?s="%x":i==="time"?s="%X":s="%x %X"),n.each(u,function(t){var n=e.one('label[for="'+t+'"]');n=n&&n.one("span.formatvalue"),n&&n.set("text",e.Date.format(r,{format:s}))}))},_updateSimularUI:function(t,r,i){var s=this,o=s._ATTRS_nodes[r];o&&n.each(o,function(n){var r=e.one("#"+n);r&&r!==t&&r.set("value",i)})},_updateSimularWidgetUI:function(t,r,i,s){var o=this,u=o._ATTRS_nodes[i],a=t.newVal,f,l;u&&n.each(u,function(t){f=o._FORMelements[t],l=f&&f.widget,t!==r&&l&&l.set(s,a);if(l&&l.getClassName()==="yui3-slider"){var n=e.one('span[for="'+t+'"]');n&&n.set("text",a)}})}},{_ATTR_CFG:["formtype","formconfig"]}),n.each([g,o,u,f,a],function(t){e.Event.define(t+s,{on:function(e,n,r){n._handle=e.on(s,function(e){var n=e.target;n.getAttribute(w)===g&&n.getAttribute(b)===t&&r.fire(e)})},detach:function(e,t){t._handle.detach()},delegate:function(e,n,r,i){n._delegatehandle=e.on(s,function(e
){var n=e.target;i&&n.getAttribute(w)===g&&n.getAttribute(b)===t&&r.fire(e)},i)},detachDelegate:function(e,t){t._delegatehandle.detach()}})})},"@VERSION@",{requires:["yui-base","attribute-base","base-build","node-base","node-event-delegate","event-synthetic","event-valuechange","gallery-itsamodelsyncpromise","gallery-itsaformelement","gallery-itsadialog"]});
