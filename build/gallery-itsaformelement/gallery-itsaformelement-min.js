YUI.add("gallery-itsaformelement",function(e,t){"use strict";var n,r,i,s=e.Array,o=e.Lang,u=e.one("body"),a=a,f="disabled",l="itsa-widget-parent",c="pure",h="button",p=c+"-"+h,d="date",v="time",m=d+v,g=p+"-"+m,y=p+"-"+f,b=p+"-primary",w="modelattribute",E="hideatstartup",S="itsa-invisible",x="error",T="boolean",N="picker",C="click",k="itsa-icon",L=k+d,A=k+v,O=k+m,M=' data-formelement="true"',_='<span class="format',D="</span>",P="^[\\w!#$%&'*+/=?`{|}~^-]+(?:\\.[\\w!#$%&'*+/=?`{|}~^-]+)*@(?:[a-zA-Z0-9-]+\\.)+[a-zA-Z]{2,}$",H="[a-zA-Z0-9-]+(\\.[a-zA-Z0-9-]+)+(/[\\w-]+)*",B="^(http://)?"+H,j="^(https://)?"+H,F="^(https?://)?"+H,I="^(([-]?[1-9][0-9]*)|0)$",q="^[-]?(([1-9][0-9]*)|0)(\\.[0-9]+)?$",R='<label for="',U="</label>",z="text",W="password",X="email",V="url",$="radio",J="checkbox",K="hidden",Q="textarea",G="div",Y="label",Z="span",et="plain",tt="initialfocus",nt="fullselect",rt="number",it=c+"-"+$,st=c+"-"+J,ot="readonly",ut="checked",at="required",ft="name",lt="value",ct="placeholder",ht="pattern",pt="data",dt="class",vt="buttonText",mt="switch",gt=mt+"ed",yt=mt+Y,bt=mt+lt,wt=m+dt,Et=Y+pt,St=lt+gt,xt=lt+"non"+gt,Tt="focusable",Nt="{"+f+"}",Ct="{"+ot+"}",kt="{"+ut+"}",Lt="{"+at+"}",At="{"+ft+"}",Ot="{"+lt+"}",Mt="{"+ct+"}",_t="{"+ht+"}",Dt="{"+pt+"}",Pt="{"+dt+"}",Ht="{"+K+"}",Bt='id="{id}"',jt='<label for="{id}"',Ft="{"+St+"}",It="{"+xt+"}",qt="{"+Et+"}",Rt="{"+wt+"}",Ut="{"+vt+"}",zt="{"+Tt+"}",Wt="type",Xt="submit",Vt="reset",$t="<input "+Wt+'="',Jt="<"+h+" "+Wt+'="',Kt=dt+ft,Qt=Y+"Class"+ft,Gt="widget",Yt="{"+Wt+"}",Zt=' data-labeldatetime="true"',en=pt+"-"+m+"=",tn=pt+"-"+h+Wt,nn=pt+"-"+h+"sub"+Wt,rn="<"+Z+" "+Bt+">UNDEFINED ELEMENTTYPE</"+Z+">",sn="<"+Z+" "+Bt+At+Dt+Ht+Pt+">"+Ot+"</"+Z+">",on=$t+z+'" '+Bt+At+Ot+Mt+Nt+Lt+Ct+_t+Dt+zt+Ht+Pt+" />",un=$t+W+'" '+Bt+At+Ot+Mt+Nt+Lt+Ct+_t+Dt+zt+Ht+Pt+" />",an=$t+X+'" '+Bt+At+Ot+Mt+Nt+Lt+Ct+Dt+zt+Ht+Pt+_t+" />",fn=$t+V+'" '+Bt+At+Ot+Mt+Nt+Lt+Ct+Dt+zt+Ht+Pt+_t+" />",ln=$t+z+'" '+Bt+At+Ot+Mt+Nt+Lt+Ct+Dt+zt+Ht+Pt+_t+" />",cn=$t+$+'" '+Bt+At+Ot+Nt+kt+Dt+zt+Ht+Pt+" />",hn=$t+J+'" '+Bt+At+Ot+Nt+Ct+kt+Dt+zt+Ht+Pt+" />",pn=$t+K+'" '+Bt+At+Ot+" />",dn="<"+Q+" "+Bt+At+Mt+Nt+Lt+Ct+Dt+zt+Ht+Pt+">"+Ot+"</"+Q+">",vn=It+"<"+G+" "+Bt+At+Ht+Dt+zt+Pt+"></"+G+">"+Ft,mn=Jt+Yt+'" '+Bt+At+Ot+Dt+zt+Ht+Pt+">"+Ut+"</"+h+">",gn=jt+Ht+Lt+Zt+Pt+">"+It+Jt+h+'" '+Bt+At+Ot+Ct+" "+en+'"'+d+'"'+Dt+zt+" "+dt+'="'+Rt+'"><i '+dt+'="'+L+'"></i></'+h+">"+Ft+"</"+Y+">",yn=jt+Ht+Lt+Zt+Pt+">"+It+Jt+h+'" '+Bt+At+Ot+Ct+" "+en+'"'+v+'"'+Dt+zt+" "+dt+'="'+Rt+'"><i '+dt+'="'+A+'"></i></'+h+">"+Ft+"</"+Y+">",bn=jt+Ht+Lt+Zt+Pt+">"+It+Jt+h+'" '+Bt+At+Ot+Ct+" "+en+'"'+m+'"'+Dt+zt+" "+dt+'="'+Rt+'"><i '+dt+'="'+O+'"></i></'+h+">"+Ft+"</"+Y+">",wn={widget:vn,plain:sn,text:on,password:un,email:an,url:fn,number:ln,radio:cn,checkbox:hn,hidden:pn,textarea:dn,button:mn,reset:mn,submit:mn,date:gn,time:yn,datetime:bn},En=function(t,n,r,i,s){return i||(t==="date"?i="%x":t==="time"?i="%X":i="%x %X"),e.use("gallery-itsadatetimepicker"),_+"value formattime-"+n+'" data-for="'+s+'">'+e.Date.format(r,{format:i})+D},Sn=/\{\s*([^|}]+?)\s*(?:\|([^}]*))?\s*\}/g,xn=function(t,n){return t.replace?t.replace(Sn,function(t,r){return e.Lang.isUndefined(n[r])?"":n[r]}):t};n=e.ITSAFormElement={},n.getElement=function(t,r,i){var s,o,u,a;i=i||e.guid(),r=r||{},o=typeof t=="function"&&t.NAME,typeof t=="string"&&(t=t.toLowerCase()),s={type:t,nodeid:i,config:r,name:r.name,html:n._renderedElement(o?t.NAME:t,r,i,o)};if(o){u=t;try{a=s.widget=new u(r.widgetconfig),t.NAME==="editorBase"?e.use("gallery-itsaeditorrenderpromise",function(){a.renderOnAvailable("#"+i)}):e.use("gallery-itsawidgetrenderpromise",function(){a.renderOnAvailable("#"+i)})}catch(f){e.fire(x,f)}}return s},n._renderedElement=function(t,n,r,i){var s=e.merge(n),u=typeof s[yt]===T?s[yt]:!1,a=typeof s[Tt]===T?s[Tt]:!0,c=typeof s[nt]===T?s[nt]:!1,x=typeof s[E]===T?s[E]:!1,N=n.tooltip,C=n.tooltipinvalid,k=n.nossl,L=n.onlyssl,A=n.digits,O=n[lt],H=n[w],G=n[bt],Z=n[pt],mt=M,gt,Nt,Ct,kt,Lt,At,Ot,Mt,_t,Dt,Pt,Bt;n["remove"+at]&&delete s[at],Z&&(mt+=" "+Z),H&&(mt+=" data-"+w+'="true"'),s[pt]=mt,N&&(N=N.replace(/"/g,"''"),s[pt]+=' data-content="'+N+'" data-contentvalid="'+N+'"'),C&&typeof C=="string"&&C.length>0&&(s[pt]+=' data-contentinvalid="'+C.replace(/"/g,"''")+'"'),n[tt]&&(s[pt]+=" data-"+tt+'="true"'),n[ft]&&(s[ft]=" "+ft+'="'+s[ft]+'"'),At=typeof n[K]===T?n[K]:!1,s[K]=At?" "+K+'="'+K+'"':"";if(i)s[pt]+=' data-type="'+t+'"',s[dt]=' class="'+(n[Kt]||"")+" "+l+(x?" "+S:"")+'"',n[Y]&&(s[Et]=s[Et]||"",s[Et]+=' data-widgetlabel="true"'),s[Tt]=a?" data-"+Tt+'="true"':"",t==="slider"&&(s[G?St:xt]=_+"value formatslider-"+n.name+'" data-for="'+r+'"'+Ht+">"+O+D),t=Gt;else{Ot=typeof s[f]===T?s[f]:!1,Mt=typeof s[at]===T?s[at]:t===W,Pt=typeof s[ot]===T?s[ot]:!1,s[Tt]=a?" data-"+Tt+'="true"':"",s[f]=Ot?" "+f+'="'+f+'"':"",s[at]=Mt?" "+at+'="'+at+'"':"",s[ot]=Pt?" "+ot+'="'+ot+'"':"",n[ct]&&(s[ct]=" "+ct+'="'+s[ct]+'"'),n[ht]&&(s[ht]=" "+ht+'="'+s[ht]+'"'),t!==Q&&t!==et&&O&&(s[lt]=" "+lt+'="'+s[lt]+'"');if(t===X)s[ht]=" "+ht+'="'+P+'"';else if(t===V)typeof k===T&&k?s[ht]=" "+ht+'="'+B+'"':typeof L===T&&L?s[ht]=" "+ht+'="'+j+'"':s[ht]=" "+ht+'="'+F+'"';else if(t===rt)s[ht]=" "+ht+'="'+(typeof A===T&&A?q:I)+'"';else if(t===$||t===J)Lt=t===$?it:st,_t=typeof s[ut]===T?s[ut]:!1,s[ut]=_t?" "+ut+'="'+ut+'"':"",s[f]=Ot?" "+f+'="'+f+'"':"";else if(t===h||t===Xt||t===Vt)delete s[Y],Dt=!0,s[Wt]=t,s[pt]+=" data-"+h+Wt+'="'+(n[h+Wt]||t)+'"',Ct=n.primary,Nt=Ot,n[vt]||(s[vt]=O||t),s[lt]||(s[lt]=" "+lt+'="'+s[vt]+'"');else if(t===d||t===v||t===m)o.isDate(O)||(O=new Date),s[lt]=' value="'+O.getTime()+'"',s[pt]+=" data-"+m+'picker="true"',s[wt]=p+" "+g+(Ot?" "+y:"")+(n.primary?" "+b:""),s[G?St:xt]=En(t,n.name||"",O,s.format,r);n.removepattern&&s[ht]&&(s[pt]+=" data-"+ht+"="+s[ht].substr(9),delete s[ht]),c&&(t===z||t===rt||t===W||t===Q||t===X||t===V)&&(s[pt]+=" data-"+nt+'="true"'),(n[Kt]||Dt||x)&&(s[dt]=' class="'+(n[Kt]||"")+(Dt?" "+p:"")+(Nt?" "+y:"")+(Ct?" "+b:"")+(x?" "+S:"")+'"')}return kt=wn[
t]||rn,s[Y]&&(Lt?(s[Y]='<span class="formatlabel">'+s[Y]+D,gt=' class="'+Lt+(n[Qt]?" "+n[Qt]:"")+'"',kt=R+'{id}"'+Ht+qt+gt+">"+(u?kt+"{label}":"{label}"+kt)+U):(gt=n[Qt]?' class="'+n[Qt]+'"':"",Bt=R+'{id}"'+Ht+qt+gt+">{label}"+U,u?kt+=Bt:kt=Bt+kt)),s.id=r,xn(kt,s)},n.tooltipReadyPromise=function(){return n._tooltipreadypromise||(n._tooltipreadypromise=new e.Promise(function(t,n){r=(new e.Tipsy({placement:"right",selector:'[data-formelement][data-content]:not([data-valid="false"])',showOn:["touchstart","focus"],hideOn:["touchend","blur","keypress"]})).render(),i=(new e.Tipsy({placement:"right",selector:'[data-formelement][data-content][data-valid="false"]',showOn:["touchstart","focus"],hideOn:["touchend","blur","keypress"]})).render(),r.get("boundingBox").addClass("tipsy-formelement"),i.get("boundingBox").addClass("tipsy-formelement-invalid"),e.batch(r.renderPromise(),i.renderPromise()).then(t,n)})),n._tooltipreadypromise},e.later(500,null,n.tooltipReadyPromise),u.delegate("focus",function(t){var n=t.target,r=n.getAttribute(pt+"-"+nt)==="true",i;!r&&n.test("input")&&t.preventDefault(),i=n.getData(a),e.ITSAFormElement._activeNode=n,i?n.clearData(a):r?n.select():(n.set("selectionStart",n.get("value").length),n.set("scrollTop",999999))},function(e,t){var n=t.target;return e===n&&n.test("input[type=text],input[type=password],input[type=url],input[type=email],textarea")}),u.delegate("mousedown",function(t){var n=t.target;e.ITSAFormElement._activeNode!==n&&n.setData(a,!0)},function(e,t){var n=t.target;return e===n&&n.test("input[type=text],input[type=password],input[type=url],input[type=email],textarea")}),s.each([d,v,m],function(t){var n={on:function(e,n,r){n._handle=e.on(C,function(e){var n=e.target;n.getAttribute(pt+"-"+m)===t&&r.fire(e)})},detach:function(e,t){t._handle.detach()}};n.delegate=n.on,n.detachDelegate=n.detach,e.Event.define(t+N+C,n)}),s.each([Xt,Vt],function(t){var n={on:function(e,n,r){n._handle=e.on(C,function(e){var n=e.target;(n.getAttribute(tn)===t||n.getAttribute(tn)===h&&n.getAttribute(nn)===t)&&r.fire(e)})},detach:function(e,t){t._handle.detach()}};n.delegate=n.on,n.detachDelegate=n.detach,e.Event.define(t+C,n)})},"@VERSION@",{requires:["yui-base","datatype-date-format","event-synthetic","yui-later","promise","event-tap","gallery-tipsy","gallery-itsawidgetrenderpromise"],skinnable:!0});
