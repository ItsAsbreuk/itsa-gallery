YUI.add("gallery-itsaformelement",function(e,t){"use strict";var n,r,i,s=e.Array,o=e.Lang,u=e.one("body"),a=a,f="disabled",l="widget",c="string",h="itsa-"+l+"-parent",p="pure",d="button",v=p+"-"+d,m=v+"-active",g=" itsa"+d+"-bordered",y="date",b="time",w=y+b,E=" "+v+"-"+w+" "+v+"-notext",S=v+"-"+f,x=v+"-primary",T="modelattribute",N="hideatstartup",C="itsa-invisible",k="renderpromise",L="gallery",A="-itsa",O="editor",M="error",_="boolean",D="picker",P="click",H="itsaicon-datetime-",B=H+y,j=H+b,F=H+w,I=' data-formelement="true"',q='<span class="format',R="</span>",U="hotkey",z="itsa-"+U,W='<span class="'+z+'" data-'+U+'="{'+U+'}">$1'+R,X="itsabutton-asktoclick",V="^[\\w!#$%&'*+/=?`{|}~^-]+(?:\\.[\\w!#$%&'*+/=?`{|}~^-]+)*@(?:[a-zA-Z0-9-]+\\.)+[a-zA-Z]{2,}$",$="[a-zA-Z0-9-]+(\\.[a-zA-Z0-9-]+)+(/[\\w-]+)*",J="^(http://)?"+$,K="^(https://)?"+$,Q="^(https?://)?"+$,G="^(([-]?[1-9][0-9]*)|0)$",Y="^[-]?(([1-9][0-9]*)|0)(\\.[0-9]+)?$",Z='<label for="',et="</label>",tt="text",nt="password",rt="email",it="url",st="radio",ot="checkbox",ut="hidden",at="textarea",ft="div",lt="label",ct="span",ht="plain",pt="initialfocus",dt="fullselect",vt="number",mt=p+"-"+st,gt=p+"-"+ot,yt="readonly",bt="checked",wt="required",Et="name",St="value",xt="placeholder",Tt="pattern",Nt="data",Ct="class",kt="labelHTML",Lt="switch",At=Lt+"ed",Ot=Lt+lt,Mt=Lt+St,_t=lt+Nt,Dt=St+At,Pt=St+"non"+At,Ht="focusable",Bt="spinbusy",jt="{"+f+"}",Ft="{"+yt+"}",It="{"+bt+"}",qt="{"+wt+"}",Rt="{"+Et+"}",Ut="{"+St+"}",zt="{"+xt+"}",Wt="{"+Tt+"}",Xt="{"+Nt+"}",Vt="{"+Ct+"}",$t="{"+ut+"}",Jt='id="{id}"',Kt="{"+Dt+"}",Qt="{"+Pt+"}",Gt="{"+_t+"}",Yt="{"+kt+"}",Zt="{"+Ht+"}",en="type",tn="submit",nn="reset",rn="<input "+en+'="',sn="<"+d+" "+en+'="',on=Ct+Et,un=lt+"Class"+Et,an="{"+en+"}",fn=' data-labeldatetime="true"',ln=Nt+"-"+w+"=",cn=Nt+"-"+d+en,hn=Nt+"-"+d+"sub"+en,pn="<"+ct+" "+Jt+">UNDEFINED ELEMENTTYPE</"+ct+">",dn="<"+ct+" "+Jt+Rt+Xt+$t+Vt+">"+Ut+"</"+ct+">",vn=rn+tt+'" '+Jt+Rt+Ut+zt+jt+qt+Ft+Wt+Xt+Zt+$t+Vt+" />",mn=rn+nt+'" '+Jt+Rt+Ut+zt+jt+qt+Ft+Wt+Xt+Zt+$t+Vt+" />",gn=rn+rt+'" '+Jt+Rt+Ut+zt+jt+qt+Ft+Xt+Zt+$t+Vt+Wt+" />",yn=rn+it+'" '+Jt+Rt+Ut+zt+jt+qt+Ft+Xt+Zt+$t+Vt+Wt+" />",bn=rn+tt+'" '+Jt+Rt+Ut+zt+jt+qt+Ft+Xt+Zt+$t+Vt+Wt+" />",wn=rn+st+'" '+Jt+Rt+Ut+jt+It+Xt+Zt+$t+Vt+" />",En=rn+ot+'" '+Jt+Rt+Ut+jt+Ft+It+Xt+Zt+$t+Vt+" />",Sn=rn+ut+'" '+Jt+Rt+Ut+" />",xn="<"+at+" "+Jt+Rt+zt+jt+qt+Ft+Xt+Zt+$t+Vt+">"+Ut+"</"+at+">",Tn=Qt+"<"+ft+" "+Jt+Rt+$t+Xt+Zt+Vt+"></"+ft+">"+Kt,Nn=sn+an+'" '+Jt+Rt+Ut+Xt+Zt+$t+Vt+">"+Yt+"</"+d+">",Cn=Qt+sn+d+'" '+Jt+Rt+Ut+$t+qt+fn+Ft+" "+ln+'"'+y+'"'+Xt+Zt+Vt+"><i "+Ct+'="'+B+'"></i></'+d+">"+Kt,kn=Qt+sn+d+'" '+Jt+Rt+Ut+$t+qt+fn+Ft+" "+ln+'"'+b+'"'+Xt+Zt+Vt+"><i "+Ct+'="'+j+'"></i></'+d+">"+Kt,Ln=Qt+sn+d+'" '+Jt+Rt+Ut+$t+qt+fn+Ft+" "+ln+'"'+w+'"'+Xt+Zt+Vt+"><i "+Ct+'="'+F+'"></i></'+d+">"+Kt,An={widget:Tn,plain:dn,text:vn,password:mn,email:gn,url:yn,number:bn,radio:wn,checkbox:En,hidden:Sn,textarea:xn,button:Nn,reset:Nn,submit:Nn,date:Cn,time:kn,datetime:Ln},On=function(t,n,r,i,s,o,u,a,f){var l=s?" "+s:"",h=a?" "+C:"",p=typeof n===c&&n.length>0?" formattime-"+n:"";return i||(t==="date"?i="%x":t==="time"?i="%X":i="%x %X"),e.use(L+A+"datetimepicker"),q+"value"+p+l+h+'" data-for="'+f+'"'+l+o+u+">"+e.Date.format(r,{format:i})+R},Mn={date:!0,time:!0,datetime:!0},_n={text:!0,number:!0,password:!0,textarea:!0,email:!0,url:!0},Dn={button:!0,submit:!0,reset:!0},Pn={radio:!0,checkbox:!0},Hn=/\{\s*([^|}]+?)\s*(?:\|([^}]*))?\s*\}/g,Bn=function(t,n){return t.replace?t.replace(Hn,function(t,r){return e.Lang.isUndefined(n[r])?"":n[r]}):t};n=e.ITSAFormElement={},n.getElement=function(t,r,i){var s,o,u,a;i=i||e.guid(),r=r||{},o=typeof t=="function"&&t.NAME,typeof t===c&&(t=t.toLowerCase()),s={type:t,nodeid:i,config:r,name:r.name,html:n._renderedElement(o?t.NAME:t,r,i,o)};if(o){u=t;try{a=s.widget=new u(r.widgetconfig),t.NAME===O+"Base"?e.use(L+A+O+k,function(){a.renderOnAvailable("#"+i)}):e.use(L+A+l+k,function(){a.renderOnAvailable("#"+i)})}catch(f){e.fire(M,f)}}return s},n._renderedElement=function(t,r,i,s){var u=e.merge(r),a=typeof u[Ot]===_?u[Ot]:!1,p=typeof u[Ht]===_?u[Ht]:!0,m=typeof u[dt]===_?u[dt]:!1,y=typeof u[N]===_?u[N]:!1,b=r.tooltip,k=r.tooltipinvalid,O=r.nossl,M=r.onlyssl,D=r.digits,P=r[St],H=r[T],B=r[Mt],j=r[Nt],F=I,z=Mn[t],X=r[U],$,tt,ot,ft,ct,Lt,At,jt,Ft,It,qt,Rt,Ut;return j&&(F+=" "+j),H&&(F+=" data-"+T+'="true"'),u[Nt]=F,b&&(b=b.replace(/"/g,"''"),u[Nt]+=' data-content="'+b+'" data-contentvalid="'+b+'"'),k&&typeof k===c&&k.length>0&&(u[Nt]+=' data-contentinvalid="'+k.replace(/"/g,"''")+'"'),r[pt]&&(u[Nt]+=" data-"+pt+'="true"'),r[Et]&&(u[Et]=" "+Et+'="'+u[Et]+'"'),Lt=typeof r[ut]===_?r[ut]:!1,At=typeof u[f]===_?u[f]:!1,u[ut]=Lt?" "+ut+'="'+ut+'"':"",u[f]=At?" "+f+'="'+f+'"':"",X=X&&typeof X===c&&X.length===1?X.toLowerCase():null,s?(u[Nt]+=' data-type="'+t+'"',u[Ct]=' class="'+(r[on]||"")+" "+h+(y?" "+C:"")+'"',r[lt]&&(u[_t]=u[_t]||"",u[_t]+=" data-"+l+lt+'="true"'),u[Ht]=p?" data-"+Ht+'="true"':"",t==="slider"&&(u[B?Dt:Pt]=q+"value formatslider-"+r.name+(r[on]?" "+r[on]:"")+'" data-for="'+i+'"'+u[ut]+u[f]+">"+P+R),t=l):(jt=!r["remove"+wt]&&(typeof u[wt]===_?u[wt]:t===nt),qt=typeof u[yt]===_?u[yt]:!1,u[Ht]=p?" data-"+Ht+'="true"':"",u[wt]=jt?" "+wt+'="'+wt+'"':"",u[yt]=qt?" "+yt+'="'+yt+'"':"",r[xt]&&(u[xt]=" "+xt+'="'+u[xt]+'"'),r[Tt]&&(u[Tt]=" "+Tt+'="'+u[Tt]+'"'),t!==at&&t!==ht&&P&&(u[St]=" "+St+'="'+u[St]+'"'),t===rt?u[Tt]=" "+Tt+'="'+V+'"':t===it?typeof O===_&&O?u[Tt]=" "+Tt+'="'+J+'"':typeof M===_&&M?u[Tt]=" "+Tt+'="'+K+'"':u[Tt]=" "+Tt+'="'+Q+'"':t===vt?u[Tt]=" "+Tt+'="'+(typeof D===_&&D?Y:G)+'"':Pn[t]?(ct=t===st?mt:gt,Ft=typeof u[bt]===_?u[bt]:!1,u[bt]=Ft?" "+bt+'="'+bt+'"':""):Dn[t]?(delete u[lt],It=!0,u[en]=t,u[Nt]+=" data-"+d+en+'="'+(r[d+en]||t)+'"',ot=r.primary,tt=At,r[Bt]&&(u[Nt]+=" data-"+Bt+'="true"',e.use(L+"css"+A+"-animatespin")),r[kt]||(u[kt]=P||t),u[St]=" "+St+'="'+(r[St]||e.Escape.html(u[kt]))+'"',X&&(Ut=new RegExp("("+X+")","i"))&&Ut.test(u[kt])&&(u[kt]=u[kt].replace(Ut,o.sub(W,{hotkey:X})),n.
_HKList||n._actHKList())):z&&(e.use(L+"css"+A+"-"+w),o.isDate(P)||(P=new Date),It=!0,tt=At,u[St]=' value="'+P.getTime()+'"',u[Nt]+=" data-"+w+'picker="true"',u[B?Dt:Pt]=On(t,r.name||"",P,u.format,r[on],u[ut],u[f],y,i)),r.removepattern&&u[Tt]&&(u[Nt]+=" data-"+Tt+"="+u[Tt].substr(9),delete u[Tt]),m&&_n[t]&&(u[Nt]+=" data-"+dt+'="true"'),(r[on]||It||y||z)&&(u[Ct]=' class="'+(z?"":r[on]||"")+(It?" "+v+g:"")+(z?E:"")+(tt?" "+S:"")+(ot?" "+x:"")+(y?" "+C:"")+'"')),ft=An[t]||pn,u[lt]&&(X&&(Ut=new RegExp("("+X+")","i"))&&Ut.test(u[lt])&&(u[lt]=u[lt].replace(Ut,o.sub(W,{hotkey:X})),n._HKList||n._actHKList()),ct?(u[lt]='<span class="formatlabel">'+u[lt]+R,$=' class="'+ct+(r[un]?" "+r[un]:"")+'"',ft=Z+'{id}"'+$t+Gt+$+">"+(a?ft+"{label}":"{label}"+ft)+et):($=r[un]?' class="'+r[un]+'"':"",Rt=(z?"<"+lt:Z+'{id}"')+$t+Gt+$+">{label}"+et,a?ft+=Rt:ft=Rt+ft)),u.id=i,Bn(ft,u)},n.tooltipReadyPromise=function(){return n._tooltipreadypromise||(n._tooltipreadypromise=new e.Promise(function(t,n){e.use(L+"-tipsy",L+A+l+k,function(){r=(new e.Tipsy({placement:"right",selector:'[data-formelement][data-content]:not([data-valid="false"])',showOn:["touchstart","focus"],hideOn:["touchend","blur","keypress"]})).render(),i=(new e.Tipsy({placement:"right",selector:'[data-formelement][data-content][data-valid="false"]',showOn:["touchstart","focus"],hideOn:["touchend","blur","keypress"]})).render(),r.get("boundingBox").addClass("tipsy-formelement"),i.get("boundingBox").addClass("tipsy-formelement-invalid"),e.batch(r.renderPromise(),i.renderPromise()).then(t,n)})})),n._tooltipreadypromise},n._pressedBtn=null,n._actHKList=function(){n._HKList=!0,u.on("keydown",function(t){var r=t.charCode,i,s;console.log(r),t.altKey&&(console.log("alt+key button down"),i=String.fromCharCode(r).toLowerCase(),s=e.one("."+z+"[data-"+U+'="'+i+'"]'),s&&(console.log("hotkey "+i+" found"),t.preventDefault(),s.focus(),s.get("tagName")==="BUTTON"&&(s.addClass(m),console.log("hotkey was button --> fire clickevent"),e.fire(X,{buttonNode:s}),n._pressedBtn=s)))}),u.on("keyup",function(){var e=n._pressedBtn;e&&(console.log("button up"),e.removeClass(m),n._pressedBtn=null)})},e.later(500,null,n.tooltipReadyPromise),u.delegate("focus",function(t){var n=t.target,r=n.getAttribute(Nt+"-"+dt)==="true",i;!r&&n.test("input")&&t.preventDefault(),i=n.getData(a),e.ITSAFormElement._activeNode=n,i?n.clearData(a):r?n.select():(n.set("selectionStart",n.get("value").length),n.set("scrollTop",999999))},function(e,t){var n=t.target;return e===n&&n.test("input[type=text],input[type=password],input[type=url],input[type=email],textarea")}),u.delegate("mousedown",function(t){var n=t.target;e.ITSAFormElement._activeNode!==n&&n.setData(a,!0)},function(e,t){var n=t.target;return e===n&&n.test("input[type=text],input[type=password],input[type=url],input[type=email],textarea")}),s.each([y,b,w],function(t){var n={on:function(e,n,r){n._handle=e.on(P,function(e){var n=e.target;n&&n.get("tagName")!=="BUTTON"&&(n=n.get("parentNode"),e.target=n),n&&n.getAttribute(Nt+"-"+w)===t&&r.fire(e)})},detach:function(e,t){t._handle.detach()}};n.delegate=n.on,n.detachDelegate=n.detach,e.Event.define(t+D+P,n)}),s.each([tn,nn],function(t){var n={on:function(e,n,r){n._handle=e.on(P,function(e){var n=e.target;n&&n.get("tagName")!=="BUTTON"&&(n=n.get("parentNode"),e.target=n),n&&(n.getAttribute(cn)===t||n.getAttribute(cn)===d&&n.getAttribute(hn)===t)&&r.fire(e)})},detach:function(e,t){t._handle.detach()}};n.delegate=n.on,n.detachDelegate=n.detach,e.Event.define(t+":"+P,n)})},"@VERSION@",{requires:["yui-base","node-core","node-event-delegate","datatype-date-format","event-base","event-synthetic","yui-later","promise","event-tap","event-custom","escape","gallerycss-itsa-base"],skinnable:!0});
