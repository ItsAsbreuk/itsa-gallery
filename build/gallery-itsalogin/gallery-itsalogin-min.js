YUI.add("gallery-itsalogin",function(e,t){"use strict";var n=e.ITSAMessageControllerClass,r=e.ITSAMessageController,i=e.ITSADialog,s=e.Lang,o=e.Intl,u="boolean",a="info",f="warn",l="error",c="_",h="ogin",p="l"+h,d="get",v=d+"L"+h,m="application",g="itsaicon-dialog-",y=g+a,b=g+"question",w="username",E="password",S="forgot",x="email",T=w+"or"+E,N=S+w,C=S+E,k=S+T,L="send",A="reset",O=L+w,M=A+E,_="message",D=_+"resolve",P="stayloggedin",H="gallery-itsalogin",B,j,F,I=function(t){if(typeof t=="string")try{return e.JSON.parse(t)}catch(n){return this.fire(l,{error:n,response:t,src:"parse"}),{}}return t||{}};r._intl=o.get(H),F=function(t){var n=r._intl,i=typeof t.imageButtons===u&&t.imageButtons,s="<form>"+(t.messageForgotUsernameOrPassword||n[S+"what"])+'<div class="itsa-dialog-forgotbutton itsadialog-firstbutton">{'+(i?"img":"")+"btn_"+N+"}</div>"+'<div class="itsa-dialog-forgotbutton">{'+(i?"img":"")+"btn_"+C+"}</div>"+"</form>",o=new e.ITSAMessage;return o.icon=t.iconquestion||b,o.title=t.titleForgotUsernameOrPassword||n[k],o.level=f,o.target="itsadialog",o.source=t.source||m,o.messageType=k,o.message=s,o.closeButton=!0,i?o.customBtns=[{buttonId:"imgbtn_"+N,labelHTML:'<i class="itsaicon-dialog-user"></i>'+n[N],config:{value:N,classname:"itsabutton-iconleft"}},{buttonId:"imgbtn_"+C,labelHTML:'<i class="itsaicon-dialog-key"></i>'+n[C],config:{value:C,classname:"itsabutton-iconleft"}}]:o.customBtns=[{buttonId:"btn_"+N,labelHTML:n[N],config:{value:N}},{buttonId:"btn_"+C,labelHTML:n[C],config:{value:C}}],r.queueMessage(o)},B=function(t){var n,i,s,o,a,l;return l=r._intl,n=t.formconfigForgotUsername||{},n.label||n.placeholder||(n.label=l[x]),n.fullselect=!0,n.primarybtnonenter=!1,n.classname="itsa-login"+(n.classname?" "+n.classname:""),n.required=!0,i=e.Base.create("itsamessageforgotun",e.ITSAMessage,[],null,{ATTRS:{emailaddress:{formtype:"email",formconfig:n,validator:t.validatorForgotUsername,validationerror:t.validationerrorForgotUsername}}}),s=(t.messageForgotUsername||l.entersignupaddress)+'<fieldset class="'+"itsa-login"+'">'+'<div class="pure-control-group">{emailaddress}</div>'+"</fieldset>",o=new i,a=typeof t.imageButtons===u&&t.imageButtons,o.icon=t.iconquestion||b,o.title=t.titleForgotUsername||l[N],o.message=s,o.level=f,o.target="itsadialog",o.source=t.source||m,o.messageType=N,o.closeButton=!0,a?(o.footer="{imgbtn_"+O+"}",o.customBtns=[{buttonId:"imgbtn_"+O,labelHTML:'<i class="itsaicon-dialog-mail"></i>'+l[O],config:{value:O,classname:"itsabutton-iconleft"}}]):(o.footer="{imgbtn_"+O+"}",o.customBtns=[{buttonId:"btn_"+O,labelHTML:l[O],config:{value:O}}]),r.queueMessage(o)},j=function(t){var n,i,s,o,a,l;return l=r._intl,n=t.formconfigForgotPassword||{},n.label||n.placeholder||(n.label=l[w]),n.fullselect=!0,n.primarybtnonenter=!1,n.classname="itsa-login"+(n.classname?" "+n.classname:""),n.required=!0,i=e.Base.create("itsamessageforgotpw",e.ITSAMessage,[],null,{ATTRS:{username:{formtype:"text",formconfig:n,validator:t.validatorUsername,validationerror:t.validationerrorUsername}}}),s=(t.messageForgotPassword||l.retrievepasswordinstructions)+'<fieldset class="'+"itsa-login"+'">'+'<div class="pure-control-group">{username}</div>'+"</fieldset>",o=new i,a=typeof t.imageButtons===u&&t.imageButtons,o.icon=t.iconquestion||b,o.title=t.titleForgotPassword||l[C],o.message=s,o.level=f,o.target="itsadialog",o.source=t.source||m,o.messageType=C,o.closeButton=!0,a?(o.footer="{imgbtn_"+M+"}",o.customBtns=[{buttonId:"imgbtn_"+M,labelHTML:'<i class="itsaicon-dialog-mail"></i>'+l[M],config:{value:M,classname:"itsabutton-iconleft"}}]):(o.footer="{imgbtn_"+M+"}",o.customBtns=[{buttonId:"btn_"+M,labelHTML:l[M],config:{value:M}}]),r.queueMessage(o)},i.renderPromise().then(function(){var t=i.panels[a];i._eventhandlers.push(t.after("*:submit",function(n){var r=n.target;n.promise.then(function(n){var i=I(n),s,o,u;i&&i.status?i.status==="OK"?(r._set("button","submit"),r.resolve(r.toJSON())):i.status==="BLOCKED"?(o=i.message||"Login is blocked",e.showError(i.title||"error",o),r.reject(o)):i.status==="RETRY"?(i.title&&t.set("title",i.title),i.message&&(s=t.get("contentBox"),s.one("#itsa-messagewrapper").setHTML(i.message))):(o="Wrong response.status found: "+i.status+". You should return one of these: OK | RETRY | BLOCKED",u={src:"Y.ITSADialog.submit()",msg:o},t.fire("warn",u),r.reject(o)):(o="Response returned without response.status",u={src:"Y.ITSADialog.submit()",msg:o},t.fire("warn",u),r.reject(o))}).then(null,function(t){var n=t&&(t.message||t)||"Undefined error during submission";e.showWarning(n)})}))}),n.prototype.translate=function(e){return this._intl[e]||e},n.translatePromise=function(t){return e.usePromise("intl").then(function(){var e=o.get(H);return e[t]||t},function(){return t})},n.prototype.translatePromise=n.translatePromise,n.prototype[c+v]=function(t,n,r,i){var s=this,o=s._intl,f=s._retrieveLoginParams(t,n,r,i),l,c,h,d,g,b,x,k,L,A,O;return t=f.title,n=f.message,r=f.config,g=f.syncPromise,L="btn_submit",x=typeof r.imageButtons===u&&r.imageButtons,b=r.regain,A=typeof r.forgotButton===u&&r.forgotButton||b,k=(A?"{btn_forgot}":"")+"{btn_submit}",x&&(k=k.replace(/\{btn_/g,"{imgbtn_"),L=L.replace(/btn_/g,"imgbtn_")),c=r.formconfigUsername||{},c.label||c.placeholder||(c.label=o[w]),c.fullselect=!0,c.primarybtnonenter=!1,c.classname="itsa-login"+(c.classname?" "+c.classname:""),c.required=!0,h=r.formconfigPassword||{},h.label||h.placeholder||(h.label=o[E]),h.fullselect=!0,h.primarybtnonenter=!0,h.classname="itsa-login"+(h.classname?" "+h.classname:""),h.required=!0,d=r.formconfigRemember||{},c.label&&!h.label&&(h.label=" "),h.label&&!c.label&&(c.label=" "),d.label||(d.label=o[P]),d.switchlabel=!0,s.readyPromise().then(function(){var i;return l=e.Base.create("itsamessageinput",e.ITSAMessage,[],null,{ATTRS:{username:{value:c.value||"",formtype:"text",formconfig:c,validator:r.validatorUsername,validationerror:r.validationerrorUsername},password:{value:h.value||"",formtype:E,formconfig:h,validator:r.validatorPassword
,validationerror:r.validationerrorPassword},remember:{value:d.value||!1,formtype:e.ITSACheckbox,formconfig:d}}}),n='<span id="itsa-messagewrapper">'+n+"</span>"+'<fieldset class="'+"itsa-login"+'">'+'<div class="pure-control-group">{'+w+"}</div>"+'<div class="pure-control-group">{'+E+"}</div>"+'<div class="itsa-login-checkbox">{remember}</div>'+"</fieldset>",i=new l,i.syncPromise=g,i.icon=r.icon||y,i.target="itsadialog",i.title=t,i.message=n,i.footer=k,i.imageButtons=x,i.closeButton=!0,i.primaryButton=r.primaryButton||L,i.timeoutReject=r.timeoutReject,i.level=a,i.source=r.source||m,i.messageType=v,i.buttonLabels=[{buttonType:"btn_submit",labelHTML:o[p]},{buttonType:"imgbtn_submit",labelHTML:'<i class="itsaicon-dialog-login"></i>'+o[p]}],A&&(i.customBtns=[{buttonId:"btn_forgot",labelHTML:o[S],config:{value:"forgot"}},{buttonId:"imgbtn_forgot",labelHTML:'<i class="itsaicon-dialog-question"></i>'+o[S],config:{value:"forgot",classname:"itsabutton-iconleft"}}],i.on(D,function(t){t.attrs&&t.attrs.button==="forgot"&&(t.preventDefault(),O=b===T?F(r):j(r),O.then(function(e){if(e.button===N)return B(r);if(e.button===C)return j(r)}).then(function(){e.ITSADialog.resurrect(i)},function(){e.ITSADialog.resurrect(i)}))})),s.queueMessage(i)})},n.prototype[c+k]=function(t,n,r,i){var s=this,o=s._intl,f=s._retrieveLoginParams(t,n,r,i),l,c,h,d,g,x,T,N,C,k,L,A,O,M;return t=f.title,n=f.message,r=f.config,x=f.syncPromise,k="btn_submit",N=typeof r.imageButtons===u&&r.imageButtons,T=r.regain,L=typeof r.forgotButton===u&&r.forgotButton||T,C=(L?"{btn_forgot}":"")+"{btn_submit}",N&&(C=C.replace(/\{btn_/g,"{imgbtn_"),k=k.replace(/btn_/g,"imgbtn_")),h=r.formconfigUsername||{},h.label||h.placeholder||(h.label=o[w]),h.fullselect=!0,h.primarybtnonenter=!1,h.classname="itsa-login"+(h.classname?" "+h.classname:""),h.required=!0,d=r.formconfigPassword||{},d.label||d.placeholder||(d.label=o[E]),d.fullselect=!0,d.primarybtnonenter=!0,d.classname="itsa-login"+(d.classname?" "+d.classname:""),d.required=!0,g=r.formconfigRemember||{},h.label&&!d.label&&(d.label=" "),d.label&&!h.label&&(h.label=" "),g.label||(g.label=o[P]),g.switchlabel=!0,s.readyPromise().then(function(){var i,u;return l=e.Base.create("itsamessageinput",e.ITSAMessage,[],null,{ATTRS:{username:{value:h.value||"",formtype:"text",formconfig:h,validator:r.validatorUsername,validationerror:r.validationerrorUsername},password:{value:d.value||"",formtype:E,formconfig:d,validator:r.validatorPassword,validationerror:r.validationerrorPassword},remember:{value:g.value||!1,formtype:e.ITSACheckbox,formconfig:g}}}),n='<span id="itsa-messagewrapper">'+n+"</span>"+'<fieldset class="'+"itsa-login"+'">'+'<div class="pure-control-group">{'+w+"}</div>"+'<div class="pure-control-group">{'+E+"}</div>"+'<div class="itsa-login-checkbox">{remember}</div>'+"</fieldset>",i=new l,i.syncPromise=x,i.icon=r.icon||y,i.target="itsadialog",i.title=t,i.message=n,i.footer=C,i.imageButtons=N,i.closeButton=!0,i.primaryButton=r.primaryButton||k,i.timeoutReject=r.timeoutReject,i.level=r.level||a,i.source=r.source||m,i.messageType=v,i.buttonLabels=[{buttonType:"btn_submit",labelHTML:o[p]},{buttonType:"imgbtn_submit",labelHTML:'<i class="itsaicon-dialog-login"></i>'+o[p]}],L&&(A=r.formconfigForgotEmail||{},i.customBtns=[{buttonId:"btn_forgot",labelHTML:o[S],config:{value:"forgot"}},{buttonId:"imgbtn_forgot",labelHTML:'<i class="itsaicon-dialog-question"></i>'+o[S],config:{value:"forgot",classname:"itsabutton-iconleft"}}],O=T===w+"or"+E,M=T===E,O&&(c=e.Base.create("itsamessageforgot",e.ITSAMessage,[],null,{ATTRS:{emailaddress:{formtype:"email",formconfig:e.merge(A,{required:!0})},username:{formtype:"text",formconfig:e.merge(h,{required:!0}),validator:r.validatorUsername,validationerror:r.validationerrorUsername}}}),n="<form>"+(r.forgotMessage||o[S+"what"])+'<div class="itsa-dialog-forgotbutton itsadialog-firstbutton">{btn_'+S+w+"}</div>"+'<div class="itsa-dialog-forgotbutton">{btn_'+S+E+"}</div>"+"</form>",u=new c,u.icon=r.iconquestion||b,u.title=r.titleForgotUsernameOrPassword||o[S+w+"or"+E],u.message=n,u.closeButton=!0,u.customBtns=[{buttonId:"btn_"+S+w,labelHTML:o[S+w],config:{value:S+w}},{buttonId:"btn_"+S+E,labelHTML:o[S+E],config:{value:S+E}}]),i.forgotMessage=u),s.queueMessage(i)})},n.prototype._retrieveLoginParams=function(t,n,r,i){var o=typeof n=="string",u,a;return o||(i=r,r=n,n=t,t=null),u=typeof n=="string",u||(i=r,r=n,n="",t=null),a=s.isObject(r),a||(i=r,r={},n="",t=null),typeof i=="function"||(i=function(){return new e.Promise(function(e,t){t(new Error("no syncPromise defined"))})}),{title:t,message:n,config:r,syncPromise:i}},e[p]=e.bind(r[c+v],r)},"@VERSION@",{requires:["yui-base","intl","gallery-itsamessagecontroller","gallery-itsacheckbox","gallery-itsadialog","gallery-itsamessage","gallery-itsaviewmodelpanel","gallerycss-itsa-base","gallerycss-itsa-animatespin","gallerycss-itsa-dialog"],lang:["ar","bg","bs","cs","da","de","en","es","fa","fi","fr","he","hi","hr","hu","it","ja","nb","nl","pl","pt","ru","sk","sr","sv","uk","zh"],skinnable:!0});
