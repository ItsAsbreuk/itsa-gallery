YUI.add("gallery-itsalogin",function(e,t){"use strict";var n=e.ITSAMessageControllerClass,r=e.ITSAMessageController,i=e.ITSADialogClass,s=e.ITSADialog,o=e.Array,u=e.Intl,a="boolean",f="info",l="warn",c="error",h="_",p="ogin",d="l"+p,v="text",m="get",g=m+"L"+p,y="application",b="type",w="itsaicon-dialog-",E=w+f,S=w+"question",x="username",T="password",N="forgot",C="mail",k="e"+C,L="address",A=k+L,O=x+"or"+T,M=N+x,_=N+T,D=_+k,P=N+O,H="createaccount",B="send",j="reset",F=B+x,I="change",q=j+T,R=I+T,U="show"+T,z=T+I,W=z+"d",X="verify",V=X+T,$="verification"+c,J=I+"your"+T,K="verifyNewPassword",Q="message",G=Q+"resolve",Y="stayloggedin",Z="gallery-itsalogin",et="check",tt="recievedmailwithinstructions",nt=et+"spambox",rt=et+"mail",it="classname",st="primarybtnonenter",ot="fullselect",ut="label",at="placeholder",ft="required",lt="itsa",ct=lt+"-"+d,ht="dialog",pt=lt+ht,dt='<span class="itsa-messagewrapper">',vt='<fieldset class="'+ct+'">',mt="</span>",gt='<div class="pure-control-group">',yt="</div>",bt='<div class="itsa-',wt="</fieldset>",Et="img",St="submit",xt="btn_",Tt=xt+St,Nt="contentBox",Ct=Et+xt,kt="button",Lt=ht+"-"+N+kt,At='input[name="',Ot="itsabutton-iconleft",Mt='<i class="itsaicon-dialog',_t="loggedin",Dt="string",Pt,Ht,Bt,jt,Ft=function(t){if(typeof t=="string")try{return e.JSON.parse(t)}catch(n){return this.fire(c,{error:n,response:t,src:"parse"}),{}}return t||{}};i.prototype._intl=u.get(Z),i.prototype.translate=function(e){return this._intl[e]||e},jt=function(t){var n=t.config,i=typeof n[K]===a&&n[K]||!0,o=s._intl,u,f,c,h,p,d,m;return f=n.formconfigPassword||{},f[ut]||f[at]||(f[ut]=o[T]),f[ot]=!0,f[st]=!i,f[it]=ct+(f[it]?" "+f[it]:""),f[ft]=!0,i&&(c=n.formconfigVerifyPassword||{},c[ut]||c[at]||(c[ut]=o[X]),c[ot]=!0,c[st]=!0,c[it]=ct+(f[it]?" "+f[it]:""),c[ft]=!0),h=n.formconfigShowPassword||{},h[ut]||h[at]||(h[ut]=o[U]),h.switchlabel=!0,p=e.Base.create("itsamessagechangepw",e.ITSAMessage,[],{crossValidation:function(){var e=this,t=[];return i&&e.get(T)!==e.get(V)&&(t.push({attribute:T,validationerror:o[$]}),t.push({attribute:V,validationerror:o[$]})),t}},{ATTRS:{password:{formtype:T,formconfig:f,validator:n.validatorPassword,validationerror:n.validationerrorPassword},verifypassword:{formtype:T,formconfig:c,validator:n.validatorPassword,validationerror:n.validationerrorPassword},showpassword:{value:!1,formtype:e.ITSACheckbox,formconfig:h}}}),d=dt+(n.messageChangePassword||o.needchangepassword)+mt+vt+gt+"{"+T+"}"+yt+(i?gt+"{"+V+"}"+yt+bt+'login-checkbox">{'+U+"}"+yt:"")+wt,u=new p,u.syncPromise=t.syncPromise,m=typeof n.imageButtons===a&&n.imageButtons,u.icon=n.iconquestion||E,u.title=n.titleChangePassword||o[J],u.message=d,u.level=l,u.config=n,u.target=pt,u.source=n.source||y,u.messageType=R,u.closeButton=t.config.closeButton||!0,u.footer="{"+(m?Et:"")+Tt+"}",u.primaryButton=(m?Et:"")+Tt,u._submitBtn=R,u.buttonLabels=[{buttonType:(m?Et:"")+Tt,labelHTML:(m?Mt+'-switch"></i>':"")+o[R]}],i&&(u.setLifeUpdate(!0),u.after("showpasswordChange",function(e){var t=s.panels[l],n=t.get(Nt).one(At+T+'"]'),r=t.get(Nt).one(At+V+'"]'),i=e.newVal;n.setAttribute(b,i?v:T),r.setAttribute(b,i?v:T)})),r.queueMessage(u)},Bt=function(t){var n=s._intl,i=typeof t.imageButtons===a&&t.imageButtons,o="<form>"+(t.messageForgotUsernameOrPassword||n[N+"what"])+bt+Lt+" "+pt+'-firstbutton">{'+(i?Et:"")+xt+M+"}"+yt+bt+Lt+'">{'+(i?Et:"")+xt+_+"}"+yt+"</form>",u=new e.ITSAMessage;return u.icon=t.iconquestion||S,u.title=t.titleForgotUsernameOrPassword||n[P],u.level=l,u.config=t,u.target=pt,u.source=t.source||y,u.messageType=P,u.message=o,u.closeButton=!0,i?u.customBtns=[{buttonId:Ct+M,labelHTML:Mt+'-user"></i>'+n[M],config:{value:M,classname:Ot}},{buttonId:Ct+_,labelHTML:Mt+'-key"></i>'+n[_],config:{value:_,classname:Ot}}]:u.customBtns=[{buttonId:xt+M,labelHTML:n[M],config:{value:M}},{buttonId:xt+_,labelHTML:n[_],config:{value:_}}],r.queueMessage(u)},Pt=function(t,n){var i,o,u,f,c,h;return h=s._intl,i=t.formconfigForgotUsername||{},i[ut]||i[at]||(i[ut]=h[k]),i[ot]=!0,i[st]=!0,i[it]=ct+(i[it]?" "+i[it]:""),i[ft]=!0,o=e.Base.create("itsamessageforgotun",e.ITSAMessage,[],null,{ATTRS:{emailaddress:{formtype:k,formconfig:i,validator:t.validatorForgotUsername,validationerror:t.validationerrorForgotUsername}}}),u=dt+(t.messageForgotUsername||h.entersignupaddress)+mt+vt+gt+"{"+A+"}"+yt+wt,f=new o,f.syncPromise=n,c=typeof t.imageButtons===a&&t.imageButtons,f.icon=t.iconquestion||S,f.title=t.titleForgotUsername||h[M],f.message=u,f.level=l,f.config=t,f.target=pt,f.source=t.source||y,f.messageType=M,f._submitBtn=M,f.closeButton=!0,f.primaryButton=(c?Et:"")+Tt,f.footer="{"+(c?Et:"")+Tt+"}",f.buttonLabels=[{buttonType:(c?Et:"")+Tt,labelHTML:(c?Mt+'-mail"></i>':"")+h[F]}],r.queueMessage(f)},Ht=function(t,n){var i,o,u,f,c,h,p;return h=s._intl,p=typeof t.usernameIsEmail===a&&t.usernameIsEmail||!1,i=t.formconfigForgotPassword||{},i.label||i[at]||(i.label=h[p?A:x]),i[ot]=!0,i[st]=!0,i[it]=ct+(i[it]?" "+i[it]:""),i[ft]=!0,o=e.Base.create("itsamessageforgotpw",e.ITSAMessage,[],null,{ATTRS:{username:{formtype:p?"email":"text",formconfig:i,validator:t.validatorUsername,validationerror:t.validationerrorUsername}}}),u=dt+(t.messageForgotPassword||(p?h.retrievepasswordinstructionsmaillogin:h.retrievepasswordinstructions))+mt+vt+gt+"{"+x+"}"+yt+wt,f=new o,f.syncPromise=n,c=typeof t.imageButtons===a&&t.imageButtons,f.icon=t.iconquestion||S,f.title=t.titleForgotPassword||h[_],f.message=u,f.level=l,f.config=t,f.target=pt,f.source=t.source||y,f.messageType=p?D:_,f._submitBtn=_,f.closeButton=!0,f.primaryButton=(c?Et:"")+Tt,f.footer="{"+(c?Et:"")+Tt+"}",f.buttonLabels=[{buttonType:(c?Et:"")+Tt,labelHTML:(c?Mt+'-mail"></i>':"")+h[q]}],r.queueMessage(f)},s.renderPromise().then(function(){o.each([f,l],function(t){var n=s.panels[t];s._eventhandlers.push(n.on("*:submit",function(e){var t=e.target,n=t.messageType;(n===g||n===R||n===M||n===_||n===D)&&t._set(kt,t._submitBtn)})),s._eventhandlers.push(n.after("*:submit",function(t){var r=t.target;t.promise.then
(function(t){var i=Ft(t),o=s._intl,u=r.messageType,a,f,h,p,d;i&&i.status?(i.status==="ERROR"&&(f=i.message||o.unspecifiederror,e.showError(i.title||o[c],f),r.reject(f)),i.status==="OK"?(h=r.toJSON(),r.resolve(h),u===g?(h.loginlevels=i.loginlevels,s.fire(_t,h)):u===M||u===_||u===D?(d=r.config,f=d.instructionMessage||o[tt]+", "+o[nt],p={level:l,target:pt,source:d.source||y,messageType:"instructions"},e.showMessage(p.instructionTitle||o[rt],f,p)):u===z&&(d=r.config,f=d.passwordChangedMessage||o[W],p={level:l,target:pt,source:d.source||y,messageType:W},e.showMessage(p.passwordChangeTitle||o[z],f,p),r.resolve(r.get(T)))):u===g&&i.status==="NOACCESS"?(f=i.message||o.loginblocked,e.showError(i.title||o[c],f),r.reject(f)):i.status!=="RETRY"||u!==g&&u!==M&&u!==_&&u!==D&&u!==R?u===g&&i.status==="CHANGEPASSWORD"?(r._resurrectable=!1,jt(r).then(function(e){h=r.toJSON(),h[T]=e.password,r.resolve(h),h.loginlevels=i.loginlevels,s.fire(_t,h)},function(){f=o.passwordnotchanged,e.showError(o[c],f)})):(f="Wrong response.status found: "+i.status,h={src:"Y.ITSALogin.submit()",msg:f},n.fire("warn",h),r.reject(f)):(i.title&&n.set("title",i.title),u===g&&(f=i.message||o.unknownlogin),u===R&&(f=i.message||o.passwordnotaccepted),u===_&&(f=i.message||o.unknownusername),u===D&&(f=i.message||o.unknownemail),u===M&&(f=i.message||o.unknownemail),f&&(a=n.get(Nt),a.one(".itsa-messagewrapper").setHTML(f)))):(f="Response returned without response.status",h={src:"Y.ITSALogin.submit()",msg:f},n.fire("warn",h),r.reject(f))}).then(null,function(t){var n=t&&(t.message||t)||"Undefined error during submission";e.showWarning(n)})}))})}),n.prototype[h+g]=function(t,n,r,i){var o=this,u=s._intl,l=o._retrieveLoginParams(t,n,r,i),c,h,p,v,b,w,S,C,k,L,D,P,B,j,F,I;return t=l.title,n=l.message,r=l.config,b=l.syncPromise,B=r.createAccount instanceof e.LazyPromise&&r.createAccount,L=Tt,j=typeof r.required===a&&r.required||!1,I=typeof r.usernameIsEmail===a&&r.usernameIsEmail||!1,F=typeof r.showStayLoggedin===a&&r.showStayLoggedin||!1,C=typeof r.imageButtons===a&&r.imageButtons,w=r.regain,w&&I&&(w=T),D=w===O||w===x||w===T,k=D?"{"+xt+N+"}":"",B&&(k+="{"+xt+H+"}"),k+="{"+Tt+"}",C&&(k=k.replace(/\{btn_/g,"{"+Ct),L=L.replace(/btn_/g,Ct)),h=r.formconfigUsername||{},h[ut]||h[at]||(h[ut]=u[I?A:x]),h[ot]=!0,h[st]=!1,h[it]=ct+(h[it]?" "+h[it]:""),h[ft]=!0,p=r.formconfigPassword||{},p[ut]||p[at]||(p[ut]=u[T]),p[ot]=!0,p[st]=!0,p[it]=ct+(p[it]?" "+p[it]:""),p[ft]=!0,v=r.formconfigRemember||{},v.widgetconfig={primarybtnonenter:!0},h[ut]&&!p[ut]&&(p[ut]=" "),p[ut]&&!h[ut]&&(h[ut]=" "),v[ut]||(v[ut]=u[Y]),v.switchlabel=!0,S=typeof r.valueRemember===a&&r.valueRemember||!1,o.readyPromise().then(function(){var i;return c=e.Base.create("itsamessageinput",e.ITSAMessage,[],null,{ATTRS:{username:{value:r.valueUsername||"",formtype:I?"email":"text",formconfig:h,validator:r.validatorUsername,validationerror:r.validationerrorUsername},password:{value:r.valuePassword||"",formtype:T,formconfig:p,validator:r.validatorPassword,validationerror:r.validationerrorPassword},remember:{value:F&&S||!1,formtype:e.ITSACheckbox,formconfig:v}}}),n=dt+n+mt+vt+gt+"{"+x+"}"+yt+gt+"{"+T+"}"+yt+(F?bt+'login-checkbox">'+"{remember}"+yt:"")+wt,i=new c,i.syncPromise=b,i.config=r,i.icon=r.icon||E,i.target=pt,i.title=t,i.message=n,i.footer=k,i.imageButtons=C,i.closeButton=!j,i.priority=r.priority,i.primaryButton=r.primaryButton||L,i.timeoutReject=r.timeoutReject,i.level=f,i.source=r.source||y,i.messageType=g,i._submitBtn=m+d,i.buttonLabels=[{buttonType:Tt,labelHTML:u[d]},{buttonType:Et+Tt,labelHTML:Mt+'-login"></i>'+u[d]}],i.customBtns=[],B&&i.customBtns.push(C?{buttonId:Ct+H,labelHTML:Mt+'-user"></i>'+u[H],config:{value:H,classname:Ot}}:{buttonId:xt+H,labelHTML:u[H],config:{value:H}}),D&&(i.customBtns.push(C?{buttonId:Ct+N,labelHTML:Mt+'-question"></i>'+u[N],config:{value:N,classname:Ot}}:{buttonId:xt+N,labelHTML:u[N],config:{value:N}}),i.on(G,function(t){t.attrs&&t.attrs.button===N&&(t.preventDefault(),P=w===O?Bt(r):Ht(r,b),s.panels[f].focusInitialItem().then(null,function(){return!0}).then(function(){return P}).then(function(e){if(e.button===M)return Pt(r,b);if(e.button===_&&!I)return Ht(r,b)},function(t){t instanceof Error&&e.showError(t)}))})),B?o.queueMessage(i).then(function(e){return e.button===H?B.then():e}):o.queueMessage(i)})},n.prototype._retrieveLoginParams=function(t,n,r,i){var s=typeof n===Dt,o,u;return s||(i=r,r=n,n=t,t=null),o=typeof n===Dt,o||(i=r,r=n,n="",t=null),u=typeof r=="object",u||(i=r,r={}),typeof i=="function"||(i=function(){var t="no syncPromise defined";return new e.Promise(function(e,n){n(new Error(t))})}),{title:t,message:n,config:r,syncPromise:i}},e[d]=e.bind(r[h+g],r)},"@VERSION@",{requires:["yui-base","intl","promise","gallery-lazy-promise","gallery-itsamessagecontroller","gallery-itsacheckbox","gallery-itsadialog","gallery-itsamessage","gallery-itsaviewmodelpanel","gallerycss-itsa-base","gallerycss-itsa-animatespin","gallerycss-itsa-dialog"],lang:["ar","bg","bs","cs","da","de","en","es","fa","fi","fr","he","hi","hr","hu","it","ja","nb","nl","pl","pt","ru","sk","sr","sv","uk","zh"],skinnable:!0});
