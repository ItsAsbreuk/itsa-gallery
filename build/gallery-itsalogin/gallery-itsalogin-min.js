YUI.add("gallery-itsalogin",function(e,t){"use strict";var n=e.ITSAMessageControllerClass,r=e.ITSAMessageController,i=e.ITSADialogClass,s=e.ITSADialog,o=e.Lang,u=e.Array,a=e.Intl,f="boolean",l="info",c="warn",h="error",p="_",d="ogin",v="l"+d,m="text",g="get",y=g+"L"+d,b="application",w="type",E="itsaicon-dialog-",S=E+l,x=E+"question",T="username",N="password",C="forgot",k="mail",L="e"+k,A=T+"or"+N,O=C+T,M=C+N,_=C+A,D="createaccount",P="send",H="reset",B=P+T,j="change",F=H+N,I=j+N,q="show"+N,R=N+j,U=R+"d",z="verify",W=z+N,X="verification"+h,V=j+"your"+N,$="verifyNewPassword",J="message",K=J+"resolve",Q="stayloggedin",G="gallery-itsalogin",Y="check",Z="recievedmailwithinstructions",et=Y+"spambox",tt=Y+"mail",nt="classname",rt="primarybtnonenter",it="fullselect",st="label",ot="placeholder",ut="required",at="itsa",ft=at+"-"+v,lt="dialog",ct=at+lt,ht='<span class="itsa-messagewrapper">',pt='<fieldset class="'+ft+'">',dt="</span>",vt='<div class="pure-control-group">',mt="</div>",gt='<div class="itsa-',yt="</fieldset>",bt="img",wt="submit",Et="btn_",St=Et+wt,xt="contentBox",Tt=bt+Et,Nt="button",Ct=lt+"-"+C+Nt,kt='input[name="',Lt="itsabutton-iconleft",At='<i class="itsaicon-dialog',Ot="loggedin",Mt="string",_t="address",Dt,Pt,Ht,Bt,jt=function(t){if(typeof t=="string")try{return e.JSON.parse(t)}catch(n){return this.fire(h,{error:n,response:t,src:"parse"}),{}}return t||{}};i.prototype._intl=a.get(G),i.prototype.translate=function(e){return this._intl[e]||e},Bt=function(t){var n=t.config,i=typeof n[$]===f&&n[$]||!0,o=s._intl,u,a,l,h,p,d,v;return a=n.formconfigPassword||{},a[st]||a[ot]||(a[st]=o[N]),a[it]=!0,a[rt]=!i,a[nt]=ft+(a[nt]?" "+a[nt]:""),a[ut]=!0,i&&(l=n.formconfigVerifyPassword||{},l[st]||l[ot]||(l[st]=o[z]),l[it]=!0,l[rt]=!0,l[nt]=ft+(a[nt]?" "+a[nt]:""),l[ut]=!0),h=n.formconfigShowPassword||{},h[st]||h[ot]||(h[st]=o[q]),h.switchlabel=!0,p=e.Base.create("itsamessagechangepw",e.ITSAMessage,[],{crossValidation:function(){var e=this,t=[];return i&&e.get(N)!==e.get(W)&&(t.push({attribute:N,validationerror:o[X]}),t.push({attribute:W,validationerror:o[X]})),t}},{ATTRS:{password:{formtype:N,formconfig:a,validator:n.validatorPassword,validationerror:n.validationerrorPassword},verifypassword:{formtype:N,formconfig:l,validator:n.validatorPassword,validationerror:n.validationerrorPassword},showpassword:{value:!1,formtype:e.ITSACheckbox,formconfig:h}}}),d=ht+(n.messageChangePassword||o.needchangepassword)+dt+pt+vt+"{"+N+"}"+mt+(i?vt+"{"+W+"}"+mt+gt+'login-checkbox">{'+q+"}"+mt:"")+yt,u=new p,u.syncPromise=t.syncPromise,v=typeof n.imageButtons===f&&n.imageButtons,u.icon=n.iconquestion||S,u.title=n.titleChangePassword||o[V],u.message=d,u.level=c,u.config=n,u.target=ct,u.source=n.source||b,u.messageType=I,u.closeButton=t.config.closeButton||!0,u.footer="{"+(v?bt:"")+St+"}",u.primaryButton=(v?bt:"")+St,u._submitBtn=I,u.buttonLabels=[{buttonType:(v?bt:"")+St,labelHTML:(v?At+'-switch"></i>':"")+o[I]}],i&&(u.setLifeUpdate(!0),u.after("showpasswordChange",function(e){var t=s.panels[c],n=t.get(xt).one(kt+N+'"]'),r=t.get(xt).one(kt+W+'"]'),i=e.newVal;n.setAttribute(w,i?m:N),r.setAttribute(w,i?m:N)})),r.queueMessage(u)},Ht=function(t){var n=s._intl,i=typeof t.imageButtons===f&&t.imageButtons,o="<form>"+(t.messageForgotUsernameOrPassword||n[C+"what"])+gt+Ct+" "+ct+'-firstbutton">{'+(i?bt:"")+Et+O+"}"+mt+gt+Ct+'">{'+(i?bt:"")+Et+M+"}"+mt+"</form>",u=new e.ITSAMessage;return u.icon=t.iconquestion||x,u.title=t.titleForgotUsernameOrPassword||n[_],u.level=c,u.config=t,u.target=ct,u.source=t.source||b,u.messageType=_,u.message=o,u.closeButton=!0,i?u.customBtns=[{buttonId:Tt+O,labelHTML:At+'-user"></i>'+n[O],config:{value:O,classname:Lt}},{buttonId:Tt+M,labelHTML:At+'-key"></i>'+n[M],config:{value:M,classname:Lt}}]:u.customBtns=[{buttonId:Et+O,labelHTML:n[O],config:{value:O}},{buttonId:Et+M,labelHTML:n[M],config:{value:M}}],r.queueMessage(u)},Dt=function(t,n){var i,o,u,a,l,h;return h=s._intl,i=t.formconfigForgotUsername||{},i[st]||i[ot]||(i[st]=h[L]),i[it]=!0,i[rt]=!0,i[nt]=ft+(i[nt]?" "+i[nt]:""),i[ut]=!0,o=e.Base.create("itsamessageforgotun",e.ITSAMessage,[],null,{ATTRS:{emailaddress:{formtype:L,formconfig:i,validator:t.validatorForgotUsername,validationerror:t.validationerrorForgotUsername}}}),u=ht+(t.messageForgotUsername||h.entersignupaddress)+dt+pt+vt+"{"+L+_t+"}"+mt+yt,a=new o,a.syncPromise=n,l=typeof t.imageButtons===f&&t.imageButtons,a.icon=t.iconquestion||x,a.title=t.titleForgotUsername||h[O],a.message=u,a.level=c,a.config=t,a.target=ct,a.source=t.source||b,a.messageType=O,a._submitBtn=O,a.closeButton=!0,a.primaryButton=(l?bt:"")+St,a.footer="{"+(l?bt:"")+St+"}",a.buttonLabels=[{buttonType:(l?bt:"")+St,labelHTML:(l?At+'-mail"></i>':"")+h[B]}],r.queueMessage(a)},Pt=function(t,n){var i,o,u,a,l,h;return h=s._intl,i=t.formconfigForgotPassword||{},i.label||i[ot]||(i.label=h[T]),i[it]=!0,i[rt]=!0,i[nt]=ft+(i[nt]?" "+i[nt]:""),i[ut]=!0,o=e.Base.create("itsamessageforgotpw",e.ITSAMessage,[],null,{ATTRS:{username:{formtype:"text",formconfig:i,validator:t.validatorUsername,validationerror:t.validationerrorUsername}}}),u=ht+(t.messageForgotPassword||h.retrievepasswordinstructions)+dt+pt+vt+"{"+T+"}"+mt+yt,a=new o,a.syncPromise=n,l=typeof t.imageButtons===f&&t.imageButtons,a.icon=t.iconquestion||x,a.title=t.titleForgotPassword||h[M],a.message=u,a.level=c,a.config=t,a.target=ct,a.source=t.source||b,a.messageType=M,a._submitBtn=M,a.closeButton=!0,a.primaryButton=(l?bt:"")+St,a.footer="{"+(l?bt:"")+St+"}",a.buttonLabels=[{buttonType:(l?bt:"")+St,labelHTML:(l?At+'-mail"></i>':"")+h[F]}],r.queueMessage(a)},s.renderPromise().then(function(){u.each([l,c],function(t){var n=s.panels[t];s._eventhandlers.push(n.on("*:submit",function(e){var t=e.target,n=t.messageType;(n===y||n===I||n===O||n===M)&&t._set(Nt,t._submitBtn)})),s._eventhandlers.push(n.after("*:submit",function(t){var r=t.target;t.promise.then(function(t){var i=jt(t),o=s._intl,u=r.messageType,a,f,l,p,d;i&&i.status?(i.status==="ERROR"&&(f=i.message||o.unspecifiederror,e
.showError(i.title||o[h],f),r.reject(f)),i.status==="OK"?(l=r.toJSON(),r.resolve(l),u===y?(l.loginlevels=i.loginlevels,s.fire(Ot,l)):u===O||u===M?(d=r.config,f=d.instructionMessage||o[Z]+", "+o[et],p={level:c,target:ct,source:d.source||b,messageType:"instructions"},e.showMessage(p.instructionTitle||o[tt],f,p)):u===R&&(d=r.config,f=d.passwordChangedMessage||o[U],p={level:c,target:ct,source:d.source||b,messageType:U},e.showMessage(p.passwordChangeTitle||o[R],f,p),r.resolve(r.get(N)))):u===y&&i.status==="NOACCESS"?(f=i.message||o.loginblocked,e.showError(i.title||o[h],f),r.reject(f)):i.status!=="RETRY"||u!==y&&u!==O&&u!==M&&u!==I?u===y&&i.status==="CHANGEPASSWORD"?(r._resurrectable=!1,Bt(r).then(function(e){l=r.toJSON(),l[N]=e.password,r.resolve(l),l.loginlevels=i.loginlevels,s.fire(Ot,l)},function(){f=o.passwordnotchanged,e.showError(o[h],f)})):(f="Wrong response.status found: "+i.status,l={src:"Y.ITSALogin.submit()",msg:f},n.fire("warn",l),r.reject(f)):(i.title&&n.set("title",i.title),u===y&&(f=i.message||o.unknownlogin),u===I&&(f=i.message||o.passwordnotaccepted),u===M&&(f=i.message||o.unknownusername),u===O&&(f=i.message||o.unknownemail),f&&(a=n.get(xt),a.one(".itsa-messagewrapper").setHTML(f)))):(f="Response returned without response.status",l={src:"Y.ITSALogin.submit()",msg:f},n.fire("warn",l),r.reject(f))}).then(null,function(t){var n=t&&(t.message||t)||"Undefined error during submission";e.showWarning(n)})}))})}),n.prototype[p+y]=function(t,n,r,i){var o=this,u=s._intl,a=o._retrieveLoginParams(t,n,r,i),c,h,p,d,m,w,E,x,k,L,_,P,H,B,j;return t=a.title,n=a.message,r=a.config,m=a.syncPromise,H=r.createAccount instanceof e.LazyPromise&&r.createAccount,L=St,B=typeof r.required===f&&r.required||!1,j=typeof r.stayLoggedin===f&&r.stayLoggedin||!1,x=typeof r.imageButtons===f&&r.imageButtons,w=r.regain,_=typeof r.forgotButton===f&&r.forgotButton||w,k=_?"{"+Et+C+"}":"",H&&(k+="{"+Et+D+"}"),k+="{"+St+"}",x&&(k=k.replace(/\{btn_/g,"{"+Tt),L=L.replace(/btn_/g,Tt)),h=r.formconfigUsername||{},h[st]||h[ot]||(h[st]=u[T]),h[it]=!0,h[rt]=!1,h[nt]=ft+(h[nt]?" "+h[nt]:""),h[ut]=!0,p=r.formconfigPassword||{},p[st]||p[ot]||(p[st]=u[N]),p[it]=!0,p[rt]=!0,p[nt]=ft+(p[nt]?" "+p[nt]:""),p[ut]=!0,d=r.formconfigRemember||{},h[st]&&!p[st]&&(p[st]=" "),p[st]&&!h[st]&&(h[st]=" "),d[st]||(d[st]=u[Q]),d.switchlabel=!0,E=typeof d.value===f&&d.value||!1,o.readyPromise().then(function(){var i;return c=e.Base.create("itsamessageinput",e.ITSAMessage,[],null,{ATTRS:{username:{value:h.value||"",formtype:"text",formconfig:h,validator:r.validatorUsername,validationerror:r.validationerrorUsername},password:{value:p.value||"",formtype:N,formconfig:p,validator:r.validatorPassword,validationerror:r.validationerrorPassword},remember:{value:j&&E||!1,formtype:e.ITSACheckbox,formconfig:d}}}),n=ht+n+dt+pt+vt+"{"+T+"}"+mt+vt+"{"+N+"}"+mt+(j?gt+'login-checkbox">'+"{remember}"+mt:"")+yt,i=new c,i.syncPromise=m,i.config=r,i.icon=r.icon||S,i.target=ct,i.title=t,i.message=n,i.footer=k,i.imageButtons=x,i.closeButton=!B,i.priority=r.priority,i.primaryButton=r.primaryButton||L,i.timeoutReject=r.timeoutReject,i.level=l,i.source=r.source||b,i.messageType=y,i._submitBtn=g+v,i.buttonLabels=[{buttonType:St,labelHTML:u[v]},{buttonType:bt+St,labelHTML:At+'-login"></i>'+u[v]}],i.customBtns=[],H&&i.customBtns.push(x?{buttonId:Tt+D,labelHTML:At+'-user"></i>'+u[D],config:{value:D,classname:Lt}}:{buttonId:Et+D,labelHTML:u[D],config:{value:D}}),_&&(i.customBtns.push(x?{buttonId:Tt+C,labelHTML:At+'-question"></i>'+u[C],config:{value:C,classname:Lt}}:{buttonId:Et+C,labelHTML:u[C],config:{value:C}}),i.on(K,function(t){t.attrs&&t.attrs.button===C&&(t.preventDefault(),P=w===A?Ht(r):Pt(r,m),s.panels[l].focusInitialItem().then(null,function(){return!0}).then(function(){return P}).then(function(e){if(e.button===O)return Dt(r,m);if(e.button===M)return Pt(r,m)},function(t){t instanceof Error&&e.showError(t)}))})),H?o.queueMessage(i).then(function(e){return e.button===D?H.then():e}):o.queueMessage(i)})},n.prototype._retrieveLoginParams=function(t,n,r,i){var s=typeof n===Mt,u,a;return s||(i=r,r=n,n=t,t=null),u=typeof n===Mt,u||(i=r,r=n,n="",t=null),a=o.isObject(r),a||(i=r,r={},n="",t=null),typeof i=="function"||(i=function(){return new e.Promise(function(e,t){t(new Error("no syncPromise defined"))})}),{title:t,message:n,config:r,syncPromise:i}},e[v]=e.bind(r[p+y],r)},"@VERSION@",{requires:["yui-base","intl","promise","gallery-lazy-promise","gallery-itsamessagecontroller","gallery-itsacheckbox","gallery-itsadialog","gallery-itsamessage","gallery-itsaviewmodelpanel","gallerycss-itsa-base","gallerycss-itsa-animatespin","gallerycss-itsa-dialog"],lang:["ar","bg","bs","cs","da","de","en","es","fa","fi","fr","he","hi","hr","hu","it","ja","nb","nl","pl","pt","ru","sk","sr","sv","uk","zh"],skinnable:!0});
