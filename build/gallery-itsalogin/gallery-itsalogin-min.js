YUI.add("gallery-itsalogin",function(e,t){"use strict";var n=e.ITSAMessageControllerClass,r=e.ITSAMessageController,i=e.ITSADialogClass,s=e.ITSADialog,o=e.Lang,u=e.Array,a=e.Intl,f="boolean",l="info",c="warn",h="error",p="_",d="ogin",v="l"+d,m="text",g="get",y=g+"L"+d,b="application",w="type",E="itsaicon-dialog-",S=E+l,x=E+"question",T="username",N="password",C="forgot",k="email",L=T+"or"+N,A=C+T,O=C+N,M=C+L,_="send",D="reset",P=_+T,H="change",B=D+N,j=H+N,F=N+H,I="show"+N,q="verify",R=q+N,U="verification"+h,z=H+"your"+N,W="message",X=W+"resolve",V="stayloggedin",$="gallery-itsalogin",J="check",K="recievedmailwithinstructions",Q=J+"spambox",G=J+"mail",Y,Z,et,tt,nt=function(t){if(typeof t=="string")try{return e.JSON.parse(t)}catch(n){return this.fire(h,{error:n,response:t,src:"parse"}),{}}return t||{}};i.prototype._intl=a.get($),i.prototype.translate=function(e){return this._intl[e]||e},i.translatePromise=function(t){return e.usePromise("intl").then(function(){var e=a.get($);return e[t]||t},function(){return t})},n.prototype.translatePromise=n.translatePromise,tt=function(t){var n=t.config,i=typeof n.verifyNewPassword===f&&n.verifyNewPassword||!0,o=s._intl,u,a,l,h,p,d,v;return a=n.formconfigPassword||{},a.label||a.placeholder||(a.label=o[N]),a.fullselect=!0,a.primarybtnonenter=!i,a.classname="itsa-login"+(a.classname?" "+a.classname:""),a.required=!0,i&&(l=n.formconfigVerifyPassword||{},l.label||l.placeholder||(l.label=o[q]),l.fullselect=!0,l.primarybtnonenter=!0,l.classname="itsa-login"+(a.classname?" "+a.classname:""),l.required=!0),h=n.formconfigShowPassword||{},h.label||h.placeholder||(h.label=o[I]),h.switchlabel=!0,p=e.Base.create("itsamessagechangepw",e.ITSAMessage,[],{crossValidation:function(){var e=this,t=[];return i&&e.getUI(R)!==e.getUI(R)&&(t.push({attribute:N,validationerror:o[U]}),t.push({attribute:R,validationerror:o[U]})),t}},{ATTRS:{password:{formtype:N,formconfig:a,validator:n.validatorPassword,validationerror:n.validationerrorPassword},verifypassword:{formtype:N,formconfig:l,validator:n.validatorPassword,validationerror:n.validationerrorPassword},showpassword:{value:!1,formtype:e.ITSACheckbox,formconfig:h}}}),d=(n.messageChangePassword||o.needchangepassword)+'<fieldset class="'+"itsa-login"+'">'+'<div class="pure-control-group">{password}</div>'+(i?'<div class="pure-control-group">{verifypassword}</div><div class="itsa-login-checkbox">{showpassword}</div>':"")+"</fieldset>",u=new p,u.syncPromise=t.syncPromise,v=typeof n.imageButtons===f&&n.imageButtons,u.icon=n.iconquestion||S,u.title=n.titleChangePassword||o[z],u.message=d,u.level=c,u.target="itsadialog",u.source=n.source||b,u.messageType=j,u.closeButton=t.config.closeButton||!0,u.footer="{"+(v?"img":"")+"btn_submit}",u.buttonLabels=[{buttonType:(v?"img":"")+"btn_submit",labelHTML:(v?'<i class="itsaicon-dialog-switch"></i>':"")+o[j]}],i&&(u.setLifeUpdate(!0),u.after("showpasswordChange",function(e){var t=s.panels[c],n=t.get("contentBox").one('input[name="password"]'),r=t.get("contentBox").one('input[name="verifypassword"]'),i=e.newVal;n.setAttribute(w,i?m:N),r.setAttribute(w,i?m:N)})),r.queueMessage(u)},et=function(t){var n=s._intl,i=typeof t.imageButtons===f&&t.imageButtons,o="<form>"+(t.messageForgotUsernameOrPassword||n[C+"what"])+'<div class="itsa-dialog-forgotbutton itsadialog-firstbutton">{'+(i?"img":"")+"btn_"+A+"}</div>"+'<div class="itsa-dialog-forgotbutton">{'+(i?"img":"")+"btn_"+O+"}</div>"+"</form>",u=new e.ITSAMessage;return u.icon=t.iconquestion||x,u.title=t.titleForgotUsernameOrPassword||n[M],u.level=c,u.target="itsadialog",u.source=t.source||b,u.messageType=M,u.message=o,u.closeButton=!0,i?u.customBtns=[{buttonId:"imgbtn_"+A,labelHTML:'<i class="itsaicon-dialog-user"></i>'+n[A],config:{value:A,classname:"itsabutton-iconleft"}},{buttonId:"imgbtn_"+O,labelHTML:'<i class="itsaicon-dialog-key"></i>'+n[O],config:{value:O,classname:"itsabutton-iconleft"}}]:u.customBtns=[{buttonId:"btn_"+A,labelHTML:n[A],config:{value:A}},{buttonId:"btn_"+O,labelHTML:n[O],config:{value:O}}],r.queueMessage(u)},Y=function(t,n){var i,o,u,a,l,h;return h=s._intl,i=t.formconfigForgotUsername||{},i.label||i.placeholder||(i.label=h[k]),i.fullselect=!0,i.primarybtnonenter=!0,i.classname="itsa-login"+(i.classname?" "+i.classname:""),i.required=!0,o=e.Base.create("itsamessageforgotun",e.ITSAMessage,[],null,{ATTRS:{emailaddress:{formtype:"email",formconfig:i,validator:t.validatorForgotUsername,validationerror:t.validationerrorForgotUsername}}}),u=(t.messageForgotUsername||h.entersignupaddress)+'<fieldset class="'+"itsa-login"+'">'+'<div class="pure-control-group">{emailaddress}</div>'+"</fieldset>",a=new o,a.syncPromise=n,l=typeof t.imageButtons===f&&t.imageButtons,a.icon=t.iconquestion||x,a.title=t.titleForgotUsername||h[A],a.message=u,a.level=c,a.target="itsadialog",a.source=t.source||b,a.messageType=A,a.closeButton=!0,a.footer="{"+(l?"img":"")+"btn_submit}",a.buttonLabels=[{buttonType:(l?"img":"")+"btn_submit",labelHTML:(l?'<i class="itsaicon-dialog-mail"></i>':"")+h[P]}],r.queueMessage(a).then(function(){a.resolve()})},Z=function(t,n){var i,o,u,a,l,h;return h=s._intl,i=t.formconfigForgotPassword||{},i.label||i.placeholder||(i.label=h[T]),i.fullselect=!0,i.primarybtnonenter=!0,i.classname="itsa-login"+(i.classname?" "+i.classname:""),i.required=!0,o=e.Base.create("itsamessageforgotpw",e.ITSAMessage,[],null,{ATTRS:{username:{formtype:"text",formconfig:i,validator:t.validatorUsername,validationerror:t.validationerrorUsername}}}),u=(t.messageForgotPassword||h.retrievepasswordinstructions)+'<fieldset class="'+"itsa-login"+'">'+'<div class="pure-control-group">{username}</div>'+"</fieldset>",a=new o,a.syncPromise=n,l=typeof t.imageButtons===f&&t.imageButtons,a.icon=t.iconquestion||x,a.title=t.titleForgotPassword||h[O],a.message=u,a.level=c,a.target="itsadialog",a.source=t.source||b,a.messageType=O,a.closeButton=!0,a.footer="{"+(l?"img":"")+"btn_submit}",a.buttonLabels=[{buttonType:(l?"img":"")+"btn_submit",labelHTML:(l?'<i class="itsaicon-dialog-mail"></i>'
:"")+h[B]}],r.queueMessage(a).then(function(){a.resolve()})},s.renderPromise().then(function(){u.each([l,c],function(t){var n=s.panels[t];s._eventhandlers.push(n.after("*:submit",function(r){var i=r.target;r.promise.then(function(r){var o=nt(r),u=s._intl,a,f,p,d;o&&o.status?o.status==="OK"?(i._set("button","submit"),i.resolve(i.toJSON()),t===l&&(p=i.toJSON(),p.loginlevels=o.loginlevels,s.fire("loggedin",p))):o.status==="NOACCESS"?(f=o.message||u.loginblocked,e.showError(o.title||u[h],f),i.reject(f)):o.status==="RETRY"?(o.title&&n.set("title",o.title),f=o.message||u.unknownlogin,o.message&&(a=n.get("contentBox"),a.one("#itsa-messagewrapper").setHTML(o.message))):o.status==="REINIT"?(f=o.message||u[K]+", "+u[Q],d={level:c,target:"itsadialog",source:d.source||b,messageType:"reinitialization"},e.showMessage(o.title||u[G],f,d)):o.status==="CHANGEPASSWORD"?tt(i).then(e.showMessage(u[F],u.passwordchanged,{level:c})):(f="Wrong response.status found: "+o.status+". You should return one of these: OK | RETRY | NOACCESS | REINIT | CHANGEPASSWORD",p={src:"Y.ITSALogin.submit()",msg:f},n.fire("warn",p),i.reject(f)):(f="Response returned without response.status",p={src:"Y.ITSALogin.submit()",msg:f},n.fire("warn",p),i.reject(f))}).then(null,function(t){var n=t&&(t.message||t)||"Undefined error during submission";e.showWarning(n)})}))})}),n.prototype[p+y]=function(t,n,r,i){var o=this,u=s._intl,a=o._retrieveLoginParams(t,n,r,i),h,p,d,m,g,w,E,x,k,M,_;return t=a.title,n=a.message,r=a.config,g=a.syncPromise,k="btn_submit",E=typeof r.imageButtons===f&&r.imageButtons,w=r.regain,M=typeof r.forgotButton===f&&r.forgotButton||w,x=(M?"{btn_forgot}":"")+"{btn_submit}",E&&(x=x.replace(/\{btn_/g,"{imgbtn_"),k=k.replace(/btn_/g,"imgbtn_")),p=r.formconfigUsername||{},p.label||p.placeholder||(p.label=u[T]),p.fullselect=!0,p.primarybtnonenter=!1,p.classname="itsa-login"+(p.classname?" "+p.classname:""),p.required=!0,d=r.formconfigPassword||{},d.label||d.placeholder||(d.label=u[N]),d.fullselect=!0,d.primarybtnonenter=!0,d.classname="itsa-login"+(d.classname?" "+d.classname:""),d.required=!0,m=r.formconfigRemember||{},p.label&&!d.label&&(d.label=" "),d.label&&!p.label&&(p.label=" "),m.label||(m.label=u[V]),m.switchlabel=!0,o.readyPromise().then(function(){var i;return h=e.Base.create("itsamessageinput",e.ITSAMessage,[],null,{ATTRS:{username:{value:p.value||"",formtype:"text",formconfig:p,validator:r.validatorUsername,validationerror:r.validationerrorUsername},password:{value:d.value||"",formtype:N,formconfig:d,validator:r.validatorPassword,validationerror:r.validationerrorPassword},remember:{value:m.value||!1,formtype:e.ITSACheckbox,formconfig:m}}}),n='<span id="itsa-messagewrapper">'+n+"</span>"+'<fieldset class="'+"itsa-login"+'">'+'<div class="pure-control-group">{'+T+"}</div>"+'<div class="pure-control-group">{'+N+"}</div>"+'<div class="itsa-login-checkbox">{remember}</div>'+"</fieldset>",i=new h,i.syncPromise=g,i.config=r,i.icon=r.icon||S,i.target="itsadialog",i.title=t,i.message=n,i.footer=x,i.imageButtons=E,i.closeButton=r.closeButton||!0,i.primaryButton=r.primaryButton||k,i.timeoutReject=r.timeoutReject,i.level=l,i.source=r.source||b,i.messageType=y,i.buttonLabels=[{buttonType:"btn_submit",labelHTML:u[v]},{buttonType:"imgbtn_submit",labelHTML:'<i class="itsaicon-dialog-login"></i>'+u[v]}],M&&(i.customBtns=[{buttonId:"btn_forgot",labelHTML:u[C],config:{value:"forgot"}},{buttonId:"imgbtn_forgot",labelHTML:'<i class="itsaicon-dialog-question"></i>'+u[C],config:{value:"forgot",classname:"itsabutton-iconleft"}}],i.on(X,function(t){t.attrs&&t.attrs.button==="forgot"&&(t.preventDefault(),_=w===L?et(r):Z(r,g),_.then(function(e){if(e.button===A)return Y(r,g);if(e.button===O)return Z(r,g)}).then(function(){var t=r.instructionMessage||u[K]+", "+u[Q],n={level:c,target:"itsadialog",source:r.source||b,messageType:"instructions"};e.showMessage(r.instructionTitle||u[G],t,n)},function(){e.ITSADialogInstance.resurrect(i)}))})),o.queueMessage(i)})},n.prototype._retrieveLoginParams=function(t,n,r,i){var s=typeof n=="string",u,a;return s||(i=r,r=n,n=t,t=null),u=typeof n=="string",u||(i=r,r=n,n="",t=null),a=o.isObject(r),a||(i=r,r={},n="",t=null),typeof i=="function"||(i=function(){return new e.Promise(function(e,t){t(new Error("no syncPromise defined"))})}),{title:t,message:n,config:r,syncPromise:i}},e[v]=e.bind(r[p+y],r)},"@VERSION@",{requires:["yui-base","intl","gallery-itsamessagecontroller","gallery-itsacheckbox","gallery-itsadialog","gallery-itsamessage","gallery-itsaviewmodelpanel","gallerycss-itsa-base","gallerycss-itsa-animatespin","gallerycss-itsa-dialog"],lang:["ar","bg","bs","cs","da","de","en","es","fa","fi","fr","he","hi","hr","hu","it","ja","nb","nl","pl","pt","ru","sk","sr","sv","uk","zh"],skinnable:!0});
