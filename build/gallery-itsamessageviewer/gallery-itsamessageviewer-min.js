YUI.add("gallery-itsamessageviewer",function(e,t){"use strict";function l(){l.superclass.constructor.apply(this,arguments)}var n="message",r=5e3,i="new"+n,s="processing",o="error",u="info",a="level",f=i+"_added";l.NAME="itsamessageviewer",e.extend(l,e.Base,{},{NAME:"itsamessageviewer",ATTRS:{handleAnonymous:{value:!1,validator:function(e){return typeof e=="boolean"}},interrupt:{value:!0,validator:function(e){return typeof e=="boolean"}}}}),l.prototype.initializer=function(){var t=this;YUI.Env.ITSAMessageController.addTarget(t),e.later(r,e,e.usePromise,"gallerycss-itsa-form"),e.soon(e.bind(t._processQueue,t)),t.get("interrupt")&&(t.interruptHandler=t.on("*:"+f,function(e){var n=e.model,r=t._lastLevel,i=n.get(a);r&&r!==i&&(i===o||r===u)&&(console.log("going to interupt"),t._rejectQueuePromise(),t._processQueue())}))},l.prototype._processQueue=function(){var t=this,n,r;console.log("_processQueue started"),n=function(){return console.log("handlePromise"),t._nextMessagePromise().then(e.rbind(t.viewMessage,t),function(){console.log("_nextMessagePromise rejected")})},r=function(){return n().then(r).then(function(){console.log("HANDLELOOP ENDED")},function(){console.log("HANDLELOOP INTERUPTED")})},r()},l.prototype.viewMessage=function(){console.log("viewMessage itsamessageviewer")},l.prototype._nextMessagePromise=function(){var t=this,n=YUI.Env.ITSAMessageController;return n.readyPromise().then(function(){return new e.Promise(function(e,r){t._rejectQueuePromise=r,t.get("destroyed")&&r(),t.once("destroy",r);var i=n.queue,o=t.get("handleAnonymous"),u=t.constructor.NAME,l,c;i.some(function(e){return l=(o||e.target===u)&&!e.get(s)&&e,l}),l?e(t._lastLevel=l.get(a)&&l._set(s,!0)&&l):c=t.on("*:"+f,function(n){console.log("event caught: "+n.type);var r=n.model;if(o||r.target===u)console.log("event HANDLED!"),t._lastLevel=r.get(a),e(r._set(s,!0)&&r),c.detach()})})})},l.prototype.destructor=function(){var e=this;YUI.Env.ITSAMessageController.removeTarget(e),e.interruptHandler&&e.interruptHandler.detach()},e.ITSAMessageViewer=l},"@VERSION@",{requires:["yui-base","yui-later","timers","gallery-itsamodulesloadedpromise","gallery-itsamessagecontroller"]});
