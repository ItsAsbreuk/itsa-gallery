YUI.add("gallery-itsamessageviewer",function(e,t){"use strict";function j(){j.superclass.constructor.apply(this,arguments)}var n=e.Array,r=e.ITSAMessageController,i="essage",s="m"+i,o="mail",u=5e3,a="_processing",f="error",l="warn",c="info",h="level",p="target",d="_suspended",v="new"+s,m="destroyed",g="priority",y="levelclear",b="timeoutResolve",w="timeoutReject",E="get",S="show",x="Confirmation",T=E+"Retry"+x,N=E+x,C=E+"Input",k=E+"Number",L=E+"E"+o,A=E+"URL",O=S+"M"+i,M=S+"Warning",_=S+"Error",D=S+"Status",P="_",H="itsadialog",B={info:!0,warn:!0,error:!0};j.NAME="itsamessageviewer",e.extend(j,e.Base),j.prototype.initializer=function(){var t=this;t.simpleMessages=!1,t._lastMessage={},t._viewName=e.guid(),r.addTarget(t),e.later(u,e,e.usePromise,["gallerycss-itsa-base","gallerycss-itsa-animatespin","gallerycss-itsa-form"]),t._processQueue(c),t._processQueue(l),t._processQueue(f)},j.prototype.countMessages=function(e,t){var i=this,s=r.queue,o=i._viewName,u=i.simpleMessages,d=0,v,m,g,y;return y=function(t){var i=0,f=r._targets[t]===o,l=r._simpleTargets[t]===o;return n.each(s,function(n){m=n._simpleMessage,v=n[p]===o&&(!u||m)||!n[p]&&(m?l:f),g=v&&n[h]===t&&(e||!n[a]),g&&i++}),i},(t===c||!t)&&(d+=y(c)),(t===l||!t)&&(d+=y(l)),(t===f||!t)&&(d+=y(f)),d},j.prototype.handleLevel=function(e){var t=this._viewName;B[e]&&(r._simpleTargets[e]=t,this.simpleMessages||(r._targets[e]=t))},j.prototype.resurrect=function(){},j.prototype.suspend=function(){},j.prototype.viewMessage=function(){},j.prototype.destructor=function(){var e=this,t=e._viewName,n=r._targets,i=r._simpleTargets;r.removeTarget(e),n[c]===t&&(n[c]=H),n[l]===t&&(n[l]=H),n[f]===t&&(n[f]=H),i[c]===t&&(i[c]=H),i[l]===t&&(i[l]=H),i[f]===t&&(i[f]=H),e._lastMessage={}},j.prototype._nextMessagePromise=function(t){var i=this;return r.isReady().then(function(){return new e.Promise(function(s,o){var u=r.queue,b=i._viewName,w=i.simpleMessages,E=r._targets[t]===b,S=r._simpleTargets[t]===b,x,T,N,C,k,L;i.get(m)&&o(),n.some(u,function(e){return L=e._simpleMessage,k=e[p]===b&&(!w||L)||!e[p]&&(L?S:E),x=k&&e[h]===t&&e[g]&&!e[a]&&e,x}),x||n.some(u,function(e){return L=e._simpleMessage,k=e[p]===b&&(!w||L)||!e[p]&&(L?S:E),x=k&&e[h]===t&&!e[g]&&!e[a]&&e,x}),x?(i._lastMessage[t]=x,(N=i._lastMessage[c])&&(t!==c||i._lastMessage[l]||i._lastMessage[f])&&(N[d]=!0)&&i._suspend(N),(N=i._lastMessage[l])&&(t===f||i._lastMessage[f])&&(N[d]=!0)&&i._suspend(N),s(x)):(t===f?N=i._lastMessage[l]||i._lastMessage[c]:t===l&&!i._lastMessage[f]&&(N=i._lastMessage[c]),N&&N[d]&&(N[d]=!1,i._resurrect(N)),i._lastMessage[t]=null,t!==c&&i.fire(y),C=i.once("destroy",o),T=e.on(v,function(e){var n=e.itsamessage;L=n._simpleMessage,k=n[p]===b&&(!w||L)||!n[p]&&(L?S:E),k&&n[h]===t&&(T.detach(),C.detach(),i._lastMessage[t]=n,(N=i._lastMessage[c])&&(t!==c||i._lastMessage[l]||i._lastMessage[f])&&(N[d]=!0)&&i._suspend(N),(N=i._lastMessage[l])&&(t===f||i._lastMessage[f])&&(N[d]=!0)&&i._suspend(N),s(n))}))})}).then(function(n){var r=t===f||!i._lastMessage[f]&&(t===l||!i._lastMessage[l]);return r?n:new e.Promise(function(e){var s=i.on(y,function(){r=!i._lastMessage[f]&&(t===l||!i._lastMessage[l]),r&&s.detach()&&e(n)})})})},j.prototype._processQueue=function(e){var t=this,n,r;n=function(){return t._nextMessagePromise(e).then(function(e){return e[a]=!0,(e[b]||e[w])&&e._startTimer(),t._viewMessage(e)}).then(null,function(e){})},r=function(){return t.get(m)||n().then(r,r)},r()},j.prototype._resurrect=function(e){var t=this;e.get(m)||((e[b]||e[w])&&e._startTimer(),r.sound(e),t.resurrect(e))},j.prototype._suspend=function(e){var t=this;(e[b]||e[w])&&e._stopTimer(),t.suspend(e)},j.prototype._viewMessage=function(e){return r.sound(e),this.viewMessage(e)},e.ITSAMessageViewer=j,e[T]=e.bind(r[P+T],r),e.confirm=e[N]=e.bind(r[P+N],r),e[A]=e.bind(r[P+A],r),e[L]=e.bind(r[P+L],r),e.prompt=e[C]=e.bind(r[P+C],r),e[k]=e.bind(r[P+k],r),e[O]=e.bind(r[P+O],r),e.alert=e[M]=e.bind(r[P+M],r),e[_]=e.bind(r[P+_],r),e[D]=e.bind(r[P+D],r)},"@VERSION@",{requires:["yui-base","yui-later","timers","promise","gallery-itsamodulesloadedpromise","gallery-itsamessagecontroller"]});
