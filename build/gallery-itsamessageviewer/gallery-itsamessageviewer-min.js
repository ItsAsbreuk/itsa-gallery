YUI.add("gallery-itsamessageviewer",function(e,t){"use strict";function f(){f.superclass.constructor.apply(this,arguments)}var n="message",r="new"+n,i="processing",s="error",o="info",u="level",a=r+"_added";f.NAME="itsamessageviewer",e.extend(f,e.Base,{},{NAME:"itsamessageviewer",ATTRS:{handleAnonymous:{value:!1,validator:function(e){return typeof e=="boolean"}}}}),f.prototype.initializer=function(){console.log("initializer itsamessageviewer");var t=this;YUI.Env.ITSAMessageController.addTarget(t),e.soon(e.bind(t._processQueue,t)),t.interruptHandler=t.on("*:"+a,function(e){var n=e.model,r=t._lastLevel,i=n.get(u);r&&r!==i&&(i===s||r===o)&&(t._rejectQueuePromise(),t._processQueue())})},f.prototype._processQueue=function(){var t=this,n,r;n=function(){return console.log("handlePromise"),t._nextMessagePromise().then(e.rbind(t.viewMessage,t))},r=function(){return n().then(r)},r()},f.prototype.viewMessage=function(){console.log("viewMessage itsamessageviewer")},f.prototype._nextMessagePromise=function(){var t=this,n=YUI.Env.ITSAMessageController;return n.readyPromise().then(function(){return new e.Promise(function(e,r){t._rejectQueuePromise=r,t.get("destroyed")&&r(),t.once("destroy",r);var s=n.queue,o=t.get("handleAnonymous"),f=t.constructor.NAME,l,c;s.some(function(e){return l=(o||e.target===f)&&!e.get(i)&&e,l}),l?e(t._lastLevel=l.get(u)&&l._set(i,!0)&&l):c=t.on("*:"+a,function(n){console.log("event caught: "+n.type);var r=n.model;if(o||r.target===f)console.log("event HANDLED!"),t._lastLevel=r.get(u),e(r._set(i,!0)&&r),c.detach()})})})},f.prototype.destructor=function(){var e=this;YUI.Env.ITSAMessageController.removeTarget(e)},e.ITSAMessageViewer=f},"@VERSION@",{requires:["yui-base","gallery-itsamessagecontroller"]});
