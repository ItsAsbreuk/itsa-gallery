YUI.add("gallery-itsamessageviewer",function(e,t){"use strict";function w(){w.superclass.constructor.apply(this,arguments)}var n=e.Array,r="message",i=5e3,s="new"+r,o="processing",u="error",a="warn",f="info",l="level",c="target",h="suspended",p=s+"_added",d="destroyed",v="priority",m="levelclear",g="timeoutResolve",y="timeoutReject",b={info:!0,warn:!0,error:!0};w.NAME="itsamessageviewer",e.extend(w,e.Base,{},{NAME:"itsamessageviewer",ATTRS:{interrupt:{value:!0,validator:function(e){return typeof e=="boolean"}}}}),w.prototype.initializer=function(){var t=this;t._lastMessage={},e.ITSAMessageController.addTarget(t),e.later(i,e,e.usePromise,["gallerycss-itsa-base","gallerycss-itsa-animatespin","gallerycss-itsa-form"]),t._processQueue(f),t._processQueue(a),t._processQueue(u)},w.prototype._processQueue=function(e){var t=this,n,r;n=function(){return t._nextMessagePromise(e).then(function(e){return e[o]=!0,(e[g]||e[y])&&e._startTimer(),t.viewMessage(e)}).then(null,function(e){})},r=function(){return t.get(d)||n().then(r)},r()},w.prototype.handleLevel=function(t){b[t]&&(e.ITSAMessageController._targets[t]=this.constructor.NAME)},w.prototype.resurrect=function(){},w.prototype.suspend=function(){},w.prototype.viewMessage=function(){},w.prototype._lazyFireErrorEvent=function(e){var t=this;t._errorEvent||(t._errorEvent=t.publish(u,{broadcast:1})),t.fire(u,e)},w.prototype._nextMessagePromise=function(t){var r=this,i=e.ITSAMessageController;return i.readyPromise().then(function(){var n=t===u||!r._lastMessage[u]&&(t===a||!r._lastMessage[a]);return n||new e.Promise(function(e){var i=r.on(m,function(){n=!r._lastMessage[u]&&(t===a||!r._lastMessage[a]),n&&i.detach()&&e()})})}).then(function(){return new e.Promise(function(s,g){var y=i.queue,b=r.constructor.NAME,w=i._targets[t]===b,E,S,x,T,N;r.get(d)&&g(),n.some(y,function(e){return N=e[c]===b||!e[c]&&w,E=N&&e[l]===t&&e[v]&&!e[o]&&e,E}),E||n.some(y,function(e){return N=e[c]===b||!e[c]&&w,E=N&&e[l]===t&&!e[v]&&!e[o]&&e,E}),E?(r._lastMessage[t]=E,(x=r._lastMessage[f])&&(t!==f||r._lastMessage[a]||r._lastMessage[u])&&(x[h]=!0)&&r._suspend(x),(x=r._lastMessage[a])&&(t===u||r._lastMessage[u])&&(x[h]=!0)&&r._suspend(x),s(E)):(t===u?x=r._lastMessage[a]||r._lastMessage[f]:t===a&&!r._lastMessage[u]&&(x=r._lastMessage[f]),x&&x[h]&&(x[h]=!1,r._resurrect(x)),r._lastMessage[t]=null,t!==f&&r.fire(m),T=r.once("destroy",g),S=e.on(p,function(e){var n=e.model,i=n[c]===b||!n[c]&&w;i&&n[l]===t&&(S.detach(),T.detach(),r._lastMessage[t]=n,(x=r._lastMessage[f])&&(t!==f||r._lastMessage[a]||r._lastMessage[u])&&(x[h]=!0)&&r._suspend(x),(x=r._lastMessage[a])&&(t===u||r._lastMessage[u])&&(x[h]=!0)&&r._suspend(x),s(n))}))})})},w.prototype.destructor=function(){var t=this;e.ITSAMessageController.removeTarget(t),t.interruptHandler&&t.interruptHandler.detach(),t._lastMessage={}},w.prototype._resurrect=function(e){var t=this;e.get(d)||((e[g]||e[y])&&e._startTimer(),t.resurrect(e))},w.prototype._suspend=function(e){var t=this;(e[g]||e[y])&&e._stopTimer(),t.suspend(e)},e.ITSAMessageViewer=w},"@VERSION@",{requires:["yui-base","yui-later","timers","promise","gallery-itsamodulesloadedpromise","gallery-itsamessagecontroller"]});
