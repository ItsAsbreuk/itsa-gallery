YUI.add("gallery-itsamessageviewer",function(e,t){"use strict";function y(){y.superclass.constructor.apply(this,arguments)}var n=e.Array,r="message",i=5e3,s="new"+r,o="processing",u="error",a="warn",f="info",l="level",c="target",h="suspended",p=s+"_added",d="levelclear",v="timeoutResolve",m="timeoutReject",g={info:!0,warn:!0,error:!0};y.NAME="itsamessageviewer",e.extend(y,e.Base,{},{NAME:"itsamessageviewer",ATTRS:{interrupt:{value:!0,validator:function(e){return typeof e=="boolean"}}}}),y.prototype.initializer=function(){var t=this;t._lastMessage={},e.ITSAMessageController.addTarget(t),e.later(i,e,e.usePromise,["gallerycss-itsa-base","gallerycss-itsa-animatespin","gallerycss-itsa-form"]),t._processQueue(f),t._processQueue(a),t._processQueue(u)},y.prototype._processQueue=function(e){var t=this,n,r;n=function(){return t._nextMessagePromise(e).then(function(e){return e[o]=!0,(e[v]||e[m])&&e._startTimer(),t.viewMessage(e)}).then(null,function(e){})},r=function(){return t.get("destroyed")||n().then(r)},r()},y.prototype.handleLevel=function(t){g[t]&&(e.ITSAMessageController._targets[t]=this.constructor.NAME)},y.prototype.resurrect=function(){},y.prototype.suspend=function(){},y.prototype.viewMessage=function(){},y.prototype._lazyFireErrorEvent=function(e){var t=this;t._errorEvent||(t._errorEvent=t.publish(u,{broadcast:1})),t.fire(u,e)},y.prototype._nextMessagePromise=function(t){var r=this,i=e.ITSAMessageController;return i.readyPromise().then(function(){var n=t===u||!r._lastMessage[u]&&(t===a||!r._lastMessage[a]);return n||new e.Promise(function(e){var i=r.on(d,function(){n=!r._lastMessage[u]&&(t===a||!r._lastMessage[a]),n&&i.detach()&&e()})})}).then(function(){return new e.Promise(function(s,v){var m=i.queue,g=r.constructor.NAME,y=i._targets[t]===g,b,w,E,S,x;r.get("destroyed")&&v(),n.some(m,function(e){return x=e[c]===g||!e[c]&&y,b=x&&e[l]===t&&!e[o]&&e,b}),b?(r._lastMessage[t]=b,(E=r._lastMessage[f])&&(t!==f||r._lastMessage[a]||r._lastMessage[u])&&(E[h]=!0)&&r._suspend(E),(E=r._lastMessage[a])&&(t===u||r._lastMessage[u])&&(E[h]=!0)&&r._suspend(E),s(b)):(t===u?E=r._lastMessage[a]||r._lastMessage[f]:t===a&&!r._lastMessage[u]&&(E=r._lastMessage[f]),E&&E[h]&&(E[h]=!1,r._resurrect(E)),r._lastMessage[t]=null,t!==f&&r.fire(d),S=r.once("destroy",v),w=e.on(p,function(e){var n=e.model,i=n[c]===g||!n[c]&&y;i&&n[l]===t&&(w.detach(),S.detach(),r._lastMessage[t]=n,(E=r._lastMessage[f])&&(t!==f||r._lastMessage[a]||r._lastMessage[u])&&(E[h]=!0)&&r._suspend(E),(E=r._lastMessage[a])&&(t===u||r._lastMessage[u])&&(E[h]=!0)&&r._suspend(E),s(n))}))})})},y.prototype.destructor=function(){var t=this;e.ITSAMessageController.removeTarget(t),t.interruptHandler&&t.interruptHandler.detach(),t._lastMessage={}},y.prototype._resurrect=function(e){var t=this;(e[v]||e[m])&&e._startTimer(),t.resurrect(e)},y.prototype._suspend=function(e){var t=this;(e[v]||e[m])&&e._stopTimer(),t.suspend(e)},e.ITSAMessageViewer=y},"@VERSION@",{requires:["yui-base","yui-later","timers","promise","gallery-itsamodulesloadedpromise","gallery-itsamessagecontroller"]});
