YUI.add("gallery-itsamessageviewer",function(e,t){"use strict";function B(){B.superclass.constructor.apply(this,arguments)}var n=e.Array,r=e.ITSAMessageController,i="essage",s="m"+i,o="mail",u=5e3,a="_processing",f="error",l="warn",c="info",h="level",p="target",d="_suspended",v="new"+s,m="destroyed",g="priority",y="levelclear",b="timeoutResolve",w="timeoutReject",E="get",S="show",x="Confirmation",T=E+"Retry"+x,N=E+x,C=E+"Input",k=E+"Number",L=E+"E"+o,A=E+"URL",O=S+"M"+i,M=S+"Warning",_=S+"Error",D=S+"Status",P="_",H={info:!0,warn:!0,error:!0};B.NAME="itsamessageviewer",e.extend(B,e.Base),B.prototype.initializer=function(){var t=this;t.simpleMessages=!1,t._lastMessage={},e.ITSAMessageController.addTarget(t),e.later(u,e,e.usePromise,["gallerycss-itsa-base","gallerycss-itsa-animatespin","gallerycss-itsa-form"]),t._processQueue(c),t._processQueue(l),t._processQueue(f)},B.prototype.handleLevel=function(t){H[t]&&(e.ITSAMessageController._targets[t]=this.constructor.NAME)},B.prototype.resurrect=function(){},B.prototype.suspend=function(){},B.prototype.viewMessage=function(){},B.prototype.destructor=function(){var t=this;e.ITSAMessageController.removeTarget(t),t._lastMessage={}},B.prototype._nextMessagePromise=function(t){var r=this,i=e.ITSAMessageController;return i.isReady().then(function(){var n=t===f||!r._lastMessage[f]&&(t===l||!r._lastMessage[l]);return n||new e.Promise(function(e){var i=r.on(y,function(){n=!r._lastMessage[f]&&(t===l||!r._lastMessage[l]),n&&i.detach()&&e()})})}).then(function(){return new e.Promise(function(s,o){var u=i.queue,b=r.constructor.NAME,w=i._targets[t]===b,E,S,x,T,N;r.get(m)&&o(),n.some(u,function(e){return N=e[p]===b||!e[p]&&w,E=N&&e[h]===t&&(!r.simpleMessages||e._simpleMessage)&&e[g]&&!e[a]&&e,E}),E||n.some(u,function(e){return N=e[p]===b||!e[p]&&w,E=N&&e[h]===t&&(!r.simpleMessages||e._simpleMessage)&&!e[g]&&!e[a]&&e,E}),E?(r._lastMessage[t]=E,(x=r._lastMessage[c])&&(t!==c||r._lastMessage[l]||r._lastMessage[f])&&(x[d]=!0)&&r._suspend(x),(x=r._lastMessage[l])&&(t===f||r._lastMessage[f])&&(x[d]=!0)&&r._suspend(x),s(E)):(t===f?x=r._lastMessage[l]||r._lastMessage[c]:t===l&&!r._lastMessage[f]&&(x=r._lastMessage[c]),x&&x[d]&&(x[d]=!1,r._resurrect(x)),r._lastMessage[t]=null,t!==c&&r.fire(y),T=r.once("destroy",o),S=e.on(v,function(e){var n=e.itsamessage,i=n[p]===b||!n[p]&&w;i&&n[h]===t&&(S.detach(),T.detach(),r._lastMessage[t]=n,(x=r._lastMessage[c])&&(t!==c||r._lastMessage[l]||r._lastMessage[f])&&(x[d]=!0)&&r._suspend(x),(x=r._lastMessage[l])&&(t===f||r._lastMessage[f])&&(x[d]=!0)&&r._suspend(x),s(n))}))})})},B.prototype._processQueue=function(e){var t=this,n,r;n=function(){return t._nextMessagePromise(e).then(function(e){return e[a]=!0,(e[b]||e[w])&&e._startTimer(),t.viewMessage(e)}).then(null,function(e){})},r=function(){return t.get(m)||n().then(r,r)},r()},B.prototype._resurrect=function(t){var n=this;t.get(m)||((t[b]||t[w])&&t._startTimer(),e.ITSAMessageController.sound(t),n.resurrect(t))},B.prototype._suspend=function(e){var t=this;(e[b]||e[w])&&e._stopTimer(),t.suspend(e)},B.prototype._viewMessage=function(t){return e.ITSAMessageController.sound(t),this.viewMessage(t)},e.ITSAMessageViewer=B,e[T]=e.bind(r[P+T],r),e.confirm=e[N]=e.bind(r[P+N],r),e[A]=e.bind(r[P+A],r),e[L]=e.bind(r[P+L],r),e.prompt=e[C]=e.bind(r[P+C],r),e[k]=e.bind(r[P+k],r),e[O]=e.bind(r[P+O],r),e.alert=e[M]=e.bind(r[P+M],r),e[_]=e.bind(r[P+_],r),e[D]=e.bind(r[P+D],r)},"@VERSION@",{requires:["yui-base","yui-later","timers","promise","gallery-itsamodulesloadedpromise","gallery-itsamessagecontroller"]});
