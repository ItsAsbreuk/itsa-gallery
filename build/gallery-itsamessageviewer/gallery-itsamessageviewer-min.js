YUI.add("gallery-itsamessageviewer",function(e,t){"use strict";function d(){d.superclass.constructor.apply(this,arguments)}var n=e.Array,r="message",i=5e3,s="new"+r,o="processing",u="error",a="warn",f="info",l="level",c="suspended",h="target",p=s+"_added";d.NAME="itsamessageviewer",e.extend(d,e.Base,{},{NAME:"itsamessageviewer",ATTRS:{handleAnonymous:{value:!1,validator:function(e){return typeof e=="boolean"}},interrupt:{value:!0,validator:function(e){return typeof e=="boolean"}}}}),d.prototype.initializer=function(){var t=this;e.ITSAMessageController.addTarget(t),e.later(i,e,e.usePromise,["gallerycss-itsa-base","gallerycss-itsa-animatespin","gallerycss-itsa-form"]),e.soon(e.bind(t._processQueue,t)),t.get("interrupt")&&(t.interruptHandler=e.on(p,function(e){var n=e.model,r=t._lastMessage,i=n[l],s=r&&r[l];s&&s!==i&&(i===u||s===f)&&(r[c]=!0,t.suspend(s),t._lastMessage=n,t._processQueue())}))},d.prototype._processQueue=function(t){var n=this,r,i,s;r=function(){return n._nextMessagePromise().then(function(e){if(e[c])throw e[c]=!1,n.resurrect(e[l]),new Error("promiseloop ended because of resurrection");return e[o]=!0,n.viewMessage(e)},function(e){var t={error:e&&(e.message||e),src:"ITSAMessageViewer._processQueue"};return n._lazyFireErrorEvent(t),!1})},i=function(){return r().then(i)},s=function(t){var n=new e.Promise(function(e){e(t)});return n.then(i)},t?s(t):i(t)},d.prototype.viewMessage=function(){},d.prototype.suspend=function(){},d.prototype.resurrect=function(){},d.prototype._lazyFireErrorEvent=function(e){var t=this;t._errorEvent||(t._errorEvent=t.publish(u,{broadcast:1})),t.fire(u,e)},d.prototype._nextMessagePromise=function(){var t=this,r=e.ITSAMessageController;return r.readyPromise().then(function(){return new e.Promise(function(i,s){t.get("destroyed")&&s(),t.once("destroy",s);var f=r.queue,d=t.get("handleAnonymous"),v=t.constructor.NAME,m,g;n.some(f,function(e){return m=(d||e[h]===v)&&e[l]===u&&(!e[o]||e[c])&&e,m}),m||n.some(f,function(e){return m=(d||e[h]===v)&&e[l]===a&&(!e[o]||e[c])&&e,m}),m||n.some(f,function(e){return m=(d||e[h]===v)&&(!e[o]||e[c])&&e,m}),m?(t._lastMessage=m)&&i(m):g=e.on(p,function(e){var n=e.model;if(d||n[h]===v)t._lastMessage=n,i(n),g.detach()})})})},d.prototype.destructor=function(){var t=this;e.ITSAMessageController.removeTarget(t),t.interruptHandler&&t.interruptHandler.detach()},e.ITSAMessageViewer=d},"@VERSION@",{requires:["yui-base","yui-later","timers","promise","gallery-itsamodulesloadedpromise","gallery-itsamessagecontroller"]});
