YUI.add("gallery-itsastorage",function(e,t){"use strict";e.ITSASTORAGE=e.Base.create("itsastorage",e.Base,[],{DB_NAME:"itsa_storage",DB_DISPLAYNAME:"ITSA Storage data",DB_MAXSIZE:1048576,DB_VERSION:"1.0",EVT_READY:"itsastorage:ready",MODE_NOOP:0,MODE_HTML5:1,MODE_GECKO:2,MODE_DB:3,MODE_USERDATA:4,MODE_SERVER:5,USERDATA_PATH:"itsa_storage",USERDATA_NAME:"itsadata",COOKIE_ID:"itsastorageid",TYPE_STRING:"A",TYPE_INT:"B",TYPE_FLOAT:"C",TYPE_BOOLEAN:"D",TYPE_ARRAY:"E",TYPE_DATE:"F",TYPE_REGEXP:"G",TYPE_OBJECT:"H",data:{},storageDriver:null,storageMode:null,initialised_DB_USER_DATA:!1,server:null,uriSetItem:null,uriGetItem:null,uriGetLength:null,uriRemoveItem:null,uriClear:null,_serverBkpExists:!1,_serverStorageCanbemade:!1,_serverTimeout:8e3,initializer:function(){var t=this,n=e.config.win;try{n.localStorage?t.storageMode=t.MODE_HTML5:n.globalStorage?t.storageMode=t.MODE_GECKO:n.openDatabase&&e.UA.userAgent.indexOf("Chrome")===-1?t.storageMode=t.MODE_DB:e.UA.ie>=5?t.storageMode=t.MODE_USERDATA:t.storageMode=t.MODE_SERVER}catch(r){t.storageMode=t.MODE_SERVER}if(t.storageMode===t.MODE_DB||t.storageMode===t.MODE_USERDATA)t.storageMode=t.MODE_SERVER;t.storageMode===t.MODE_HTML5&&(t.storageDriver=n.localStorage),t.storageMode===t.MODE_GECKO&&(t.storageDriver=n.globalStorage[n.location.hostname]),t.storageMode===t.MODE_HTML5&&(e.Node.DOM_EVENTS.pageshow=1,e.on("pageshow",function(){t.storageDriver=n.localStorage},n)),(t.storageMode===t.MODE_DB||t.storageMode===t.MODE_USERDATA)&&e.on(t.EVT_READY,function(){this.initialised_DB_USER_DATA=!0},t),t.storageMode===t.MODE_DB&&(t.storageDriver=n.openDatabase(t.DB_NAME,t.DB_VERSION,t.DB_DISPLAYNAME,t.DB_MAXSIZE),t.storageDriver.transaction(e.bind(function(t){var n=this;t.executeSql("CREATE TABLE IF NOT EXISTS "+n.DB_NAME+"(name TEXT PRIMARY KEY, value TEXT NOT NULL)"),t.executeSql("SELECT value FROM "+n.DB_NAME+" WHERE name = 'data'",[],e.bind(function(t,n){var r=this;if(n.rows.length)try{r.data=e.JSON.parse(n.rows.item(0).value)}catch(i){r.data={}}e.fire(r.EVT_READY)},n))},t))),t.storageMode===t.MODE_USERDATA&&(t.storageDriver=e.config.doc.createElement("span"),t.storageDriver.addBehavior("#default#userData"),e.on("domready",e.bind(function(){var t=this;e.config.doc.body.appendChild(t.storageDriver),t.storageDriver.load(t.USERDATA_PATH);try{t.data=e.JSON.parse(t.storageDriver.getAttribute(t.USERDATA_NAME)||"{}")}catch(n){t.data={}}e.fire(t.EVT_READY)},t)))},clear:function(e,t,n){var r=this;r.storageMode===r.MODE_SERVER?r._clearServer(e,t,n):r.serverStoragePosible()?r._clearLocal(function(i){r._clearServer(e,t,n,i)},r):r._clearLocal(e,t,n)},_clearLocal:function(t,n,r){var i=this,s=null,o;try{if(i.storageMode===i.MODE_HTML5)i.storageDriver.clear();else if(i.storageMode===i.MODE_GECKO)for(o in i.storageDriver)i.storageDriver.hasOwnProperty(o)&&(i.storageDriver.removeItem(o),delete i.storageDriver[o])}catch(u){s=u.message}i.storageMode===i.MODE_DB||i.storageMode===i.MODE_USERDATA?i.initialised_DB_USER_DATA?(i.data={},i._setItemLocal_OldBrowsers(null,null,t,n,r)):e.on(i.EVT_READY,function(){i.data={},i._setItemLocal_OldBrowsers(null,null,t,n,r)},i):e.Lang.isFunction(t)&&e.rbind(t,n,s,r)()},_clearServer:function(t,n,r,i){var s=this,o,u;if(!s._serverBkpExists){e.Lang.isFunction(t)&&e.rbind(t,n,null,r)();return}s.server?s._storageCookieEnabled()?(o=s.server+"?"+s.uriClear+"&"+s.COOKIE_ID+"="+s._readCookie()+"&callback={callback}",e.jsonp(o,{on:{success:function(o){e.Lang.isFunction(t)&&(e.rbind(t,n,i,r)(),s._serverBkpExists=!1)},failure:function(){e.Lang.isFunction(t)&&e.rbind(t,n,(i?i+" + ":"")+"failed to connect to server",r)()},timeout:function(){e.Lang.isFunction(t)&&e.rbind(t,n,(i?i+" + ":"")+"connection time-out server",r)()}},context:s,timeout:s._serverTimeout})):e.Lang.isFunction(t)&&e.rbind(t,n,(i?i+" + ":"")+"Cookie-errror: You must accept Cookies in order to store data",null,r)():e.Lang.isFunction(t)&&e.rbind(t,n,(i?i+" + ":"")+"setRemoteStorageServer is not set in the right way",r)()},getItem:function(t,n,r,i){var s=this;s.storageMode===s.MODE_SERVER?s._getItemServer(t,n,r,i):s.serverStoragePosible()?s._getItemLocal(t,function(o,u){!o&&u?e.Lang.isFunction(n)&&e.rbind(n,r,null,u,i)():s._getItemServer(t,n,r,i,o)},s):s._getItemLocal(t,n,r,i)},_getItemLocal:function(t,n,r,i){var s=this,o=null,u=null,a;if(s.storageMode===s.MODE_HTML5||s.storageMode===s.MODE_GECKO){try{s.storageMode===s.MODE_HTML5?a=s.storageDriver.getItem(t):s.storageMode===s.MODE_GECKO&&(a=s.storageDriver[t].value),o=s._getCorrectItemType(a)}catch(f){u=f.message}e.Lang.isFunction(n)&&e.rbind(n,r,u,o,i)()}else s.storageMode===s.MODE_DB||s.storageMode===s.MODE_USERDATA?s.initialised_DB_USER_DATA?(a=s.data.hasOwnProperty(t)?s.data[t]:null,e.Lang.isFunction(n)&&e.rbind(n,r,null,s._getCorrectItemType(a),i)()):e.on(s.EVT_READY,function(){var s=this,o=s.data.hasOwnProperty(t)?s.data[t]:null;e.Lang.isFunction(n)&&e.rbind(n,r,null,s._getCorrectItemType(o),i)()},s):e.Lang.isFunction(n)&&e.rbind(n,r,"no appropriate storageMode for _getItemLocal",null,i)()},_getItemServer:function(t,n,r,i,s){var o=this,u,a;if(!o._serverBkpExists){e.Lang.isFunction(n)&&e.rbind(n,r,null,null,i)();return}o.server?o._storageCookieEnabled()?(u=o.server+"?"+o.uriGetItem+"&"+o.COOKIE_ID+"="+o._readCookie()+"&key="+encodeURIComponent(t)+"&callback={callback}",e.jsonp(u,{on:{success:function(t){var s=this,o=s._getCorrectItemType(t);e.rbind(n,r,null,o,i)()},failure:function(){e.Lang.isFunction(n)&&e.rbind(n,r,(s?s+" + ":"")+"failed to connect to server",null,i)()},timeout:function(){e.Lang.isFunction(n)&&e.rbind(n,r,(s?s+" + ":"")+"connection time-out server",null,i)()}},context:o,timeout:o._serverTimeout})):e.Lang.isFunction(n)&&e.rbind(n,r,(s?s+" + ":"")+"Cookie-errror: You must accept Cookies in order to store data",null,i)():e.Lang.isFunction(n)&&e.rbind(n,r,(s?s+" + ":"")+"setRemoteStorageServer is not set in the right way",null,i)()},getItems:function(t,n,r,i){var s=this;s.storageMode===s.MODE_SERVER?s._getItemsServer(t,n,r
,i):s.serverStoragePosible()?s._getItemsLocal(t,function(t,o,u){!t&&o&&!e.Lang.isValue(u)?e.Lang.isFunction(n)&&e.rbind(n,r,null,o,i)():s._getItemsServer(u,n,r,i,t,o)},s):s._getItemsLocal(t,n,r,i)},_getItemsLocal:function(t,n,r,i){var s=this,o=null,u=null,a={},f=[],l=new e.Parallel,c=e.Lang.isArray(t);if(s.storageMode===s.MODE_NOOP||s.storageMode===s.MODE_SERVER||!c){!c,e.Lang.isFunction(n)&&e.rbind(n,r,c?"no appropriate storageMode for _getItemsLocal":"Supplied keys is not an array",null,null,i)();return}e.Array.each(t,function(e,t,n){s._getItemLocal(e,l.add(function(t,n){!t&&n?a[e]=n:(t&&(u=t),f.push(e))}),s)},s),l.done(function(){e.Lang.isFunction(n)&&e.rbind(n,r,u,a,f,i)()})},_getItemsServer:function(t,n,r,i,s,o){var u=this,a,f=e.Lang.isArray(t),l;if(!f){e.Lang.isFunction(n)&&e.rbind(n,r,"Supplied keys is not an array",null,null,i)();return}if(!u._serverBkpExists){e.Lang.isFunction(n)&&e.rbind(n,r,null,null,null,i)();return}u.server?u._storageCookieEnabled()?(a=u.server+"?"+u.uriGetItem+"&"+u.COOKIE_ID+"="+u._readCookie()+"&keys="+encodeURIComponent(e.JSON.stringify(t))+"&callback={callback}",e.jsonp(a,{on:{success:function(t){var s=this,u=t.result,a=e.Object.keys(u);e.Array.each(a,function(e,t,n){u[e]=s._getCorrectItemType(u[e])},s),e.rbind(n,r,null,e.Lang.isObject(o)?e.merge(o,u):u,t.notfound,i)()},failure:function(){e.Lang.isFunction(n)&&e.rbind(n,r,(s?s+" + ":"")+"failed to connect to server",o,t,i)()},timeout:function(){e.Lang.isFunction(n)&&e.rbind(n,r,(s?s+" + ":"")+"connection time-out server",o,t,i)()}},context:u,timeout:u._serverTimeout})):e.Lang.isFunction(n)&&e.rbind(n,r,(s?s+" + ":"")+"Cookie-errror: You must accept Cookies in order to store data",o,t,i)():e.Lang.isFunction(n)&&e.rbind(n,r,(s?s+" + ":"")+"setRemoteStorageServer is not set in the right way",o,t,i)()},length:function(e,t,n){var r=this;r.storageMode===r.MODE_SERVER?r._lengthServer(e,t,n,0):r.serverStoragePosible()?r._lengthLocal(function(i,s){r._lengthServer(e,t,n,s&&!i?s:0,i)},r):r._lengthLocal(e,t,n)},_lengthLocal:function(t,n,r){var i=this,s=0,o=null,u;if(i.storageMode===i.MODE_HTML5||i.storageMode===i.MODE_GECKO){try{s=i.storageDriver.length}catch(a){o=a.message}e.rbind(t,n,o,s,r)()}else if(i.storageMode===i.MODE_DB||i.storageMode===i.MODE_USERDATA)if(i.initialised_DB_USER_DATA){for(u in i.data)i.data.hasOwnProperty(u)&&(s+=1);e.rbind(t,n,null,s,r)()}else e.on(i.EVT_READY,function(){var o;for(o in i.data)i.data.hasOwnProperty(o)&&(s+=1);e.rbind(t,n,null,s,r)()},i);else e.Lang.isFunction(t)&&e.rbind(t,n,"no appropriate storageMode for _lengthLocal",0,r)()},_lengthServer:function(t,n,r,i,s){var o=this,u,a;if(!o._serverBkpExists){e.Lang.isFunction(t)&&e.rbind(t,n,null,0,r)();return}o.server?o._storageCookieEnabled()?(u=o.server+"?"+o.uriGetLength+"&"+o.COOKIE_ID+"="+o._readCookie()+"&callback={callback}",e.jsonp(u,{on:{success:function(s){s=parseInt(s,10),e.rbind(t,n,null,(e.Lang.isNumber(s)?s:0)+(i||0),r)()},failure:function(){e.Lang.isFunction(t)&&e.rbind(t,n,(s?s+" + ":"")+"failed to connect to server",0,r)()},timeout:function(){e.Lang.isFunction(t)&&e.rbind(t,n,(s?s+" + ":"")+"connection time-out server",0,r)()}},context:o,timeout:o._serverTimeout})):e.Lang.isFunction(t)&&e.rbind(t,n,(s?s+" + ":"")+"Cookie-errror: You must accept Cookies in order to store data",0,r)():e.Lang.isFunction(t)&&e.rbind(t,n,(s?s+" + ":"")+"setRemoteStorageServer is not set in the right way",0,r)()},removeItem:function(e,t,n,r){var i=this;i.storageMode===i.MODE_SERVER?i._removeItemServer(e,t,n,r):i.serverStoragePosible()?i._removeItemLocal(e,function(s){i._removeItemServer(e,t,n,r,s)},i):i._removeItemLocal(e,t,n,r)},_removeItemLocal:function(t,n,r,i){var s=this,o=null;if(s.storageMode===s.MODE_DB||s.storageMode===s.MODE_USERDATA)s.initialised_DB_USER_DATA?(delete s.data[t],s._setItemLocal_OldBrowsers(null,null,n,r,i)):e.on(s.EVT_READY,function(){delete s.data[t],s._setItemLocal_OldBrowsers(null,null,n,r,i)},s);else if(s.storageMode===s.MODE_HTML5||s.storageMode===s.MODE_GECKO){try{s.storageDriver.removeItem(t)}catch(u){o=u.message}e.Lang.isFunction(n)&&e.rbind(n,r,o,i)()}else e.Lang.isFunction(n)&&e.rbind(n,r,"no appropriate storageMode for _removeItemLocal",i)()},_removeItemServer:function(t,n,r,i,s){var o=this,u,a=e.Lang.isArray(t),f;if(!o._serverBkpExists){e.Lang.isFunction(n)&&e.rbind(n,r,null,i)();return}o.server?o._storageCookieEnabled()?(u=o.server+"?"+o.uriRemoveItem+"&"+o.COOKIE_ID+"="+o._readCookie()+"&"+(a?"keys":"key")+"="+encodeURIComponent(a?e.JSON.stringify(t):t)+"&callback={callback}",e.jsonp(u,{on:{success:function(t){e.Lang.isFunction(n)&&e.rbind(n,r,s,i)(),t&&(o._serverBkpExists=t>0)},failure:function(){e.Lang.isFunction(n)&&e.rbind(n,r,(s?s+" + ":"")+"failed to connect to server",i)()},timeout:function(){e.Lang.isFunction(n)&&e.rbind(n,r,(s?s+" + ":"")+"connection time-out server",i)()}},context:o,timeout:o._serverTimeout})):e.Lang.isFunction(n)&&e.rbind(n,r,(s?s+" + ":"")+"Cookie-errror: You must accept Cookies in order to store data",i)():e.Lang.isFunction(n)&&e.rbind(n,r,(s?s+" + ":"")+"setRemoteStorageServer is not set in the right way",i)()},removeItems:function(e,t,n,r){var i=this;i.storageMode===i.MODE_SERVER?i._removeItemsServer(e,t,n,r):i.serverStoragePosible()?i._removeItemsLocal(e,function(s){i._removeItemsServer(e,t,n,r,s)},i):i._removeItemsLocal(e,t,n,r)},_removeItemsLocal:function(t,n,r,i){var s=this,o=e.Lang.isArray(t),u=null;if(!o){e.Lang.isFunction(n)&&e.rbind(n,r,"Supplied keys is not an array",i)();return}if(s.storageMode===s.MODE_DB||s.storageMode===s.MODE_USERDATA)s.initialised_DB_USER_DATA?(e.Array.each(t,function(e,t,n){delete s.data[e]},s),s._setItemLocal_OldBrowsers(null,null,n,r,i)):e.on(s.EVT_READY,function(){e.Array.each(t,function(e,t,n){delete s.data[e]},s),s._setItemLocal_OldBrowsers(null,null,n,r,i)},s);else if(s.storageMode===s.MODE_HTML5||s.storageMode===s.MODE_GECKO){try{e.Array.each(t,function(e,t,n){s.storageDriver.removeItem(e)},s)}catch(a){u=a.message}e.Lang.isFunction
(n)&&e.rbind(n,r,u,i)()}else e.Lang.isFunction(n)&&e.rbind(n,r,"no appropriate storageMode for _removeItemLocal",i)()},_removeItemsServer:function(t,n,r,i,s){if(!e.Lang.isArray(t)){e.Lang.isFunction(n)&&e.rbind(n,r,"Supplied keys is not an array",i)();return}this._removeItemServer(t,n,r,i,s)},setItem:function(t,n,r,i,s){var o=this;if(!e.Lang.isString(t)){e.Lang.isFunction(r)&&e.rbind(r,i,"no valid key(String) is given",s)();return}e.Lang.isValue(n)?o.storageMode===o.MODE_SERVER?o._setItemServer(t,n,r,i,s):o.serverStoragePosible()?o._setItemLocal(t,n,function(e){e?o._setItemServer(t,n,r,i,s,e):o._removeItemServer(t,r,i,s)},o):o._setItemLocal(t,n,r,i,s):o.removeItem(t,r,i,s)},_setItemLocal:function(t,n,r,i,s){var o=this,u=null,a=o._transformItemType(n,!1);if(!a){e.Lang.isFunction(r)&&e.rbind(r,i,"key: "+t+" --> value is null: key is not stored",s)();return}if(o.storageMode===o.MODE_DB||o.storageMode===o.MODE_USERDATA)o._setItemLocal_OldBrowsers(t,a,r,i,s);else if(o.storageMode===o.MODE_HTML5||o.storageMode===o.MODE_GECKO){try{o.storageDriver.setItem(t,a)}catch(f){u=f.message}e.Lang.isFunction(r)&&e.rbind(r,i,u,s)()}else e.Lang.isFunction(r)&&e.rbind(r,i,"no appropriate storageMode for _setItemLocal",s)()},_setItemServer:function(t,n,r,i,s,o){var u=this,a,f=u._transformItemType(n,!0);if(!f){e.Lang.isFunction(r)&&e.rbind(r,i,"key: "+t+" --> value is null: key is not stored",s)();return}u.server?u._storageCookieEnabled()?(a=u.server+"?"+u.uriSetItem+"&"+u.COOKIE_ID+"="+u._readCookie()+"&key="+encodeURIComponent(t)+"&value="+encodeURIComponent(f)+"&callback={callback}",e.jsonp(a,{on:{success:function(t){e.Lang.isFunction(r)&&e.rbind(r,i,o,s)(),u._serverBkpExists=!0},failure:function(){e.Lang.isFunction(r)&&e.rbind(r,i,(o?o+" + ":"")+"failed to connect to server",s)()},timeout:function(){e.Lang.isFunction(r)&&e.rbind(r,i,(o?o+" + ":"")+"connection time-out server",s)()}},context:u,timeout:u._serverTimeout})):e.Lang.isFunction(r)&&e.rbind(r,i,(o?o+" + ":"")+"Cookie-errror: You must accept Cookies in order to store data",s)():e.Lang.isFunction(r)&&e.rbind(r,i,(o?o+" + ":"")+"setRemoteStorageServer is not set in the right way",s)()},setItems:function(t,n,r,i){var s=this;s.storageMode===s.MODE_SERVER?s._setItemsServer(t,n,r,i):s.serverStoragePosible()?s._setItemsLocal(t,function(t,o,u){var a=e.Lang.isArray(u)&&u.length>0;o&&(s._removeItemsServer(o,!1,r,i),!a&&e.Lang.isFunction(n)&&e.rbind(n,r,t,o,u,i)()),a&&s._setItemsServer(u,n,r,i,t,o)},s):s._setItemsLocal(t,n,r,i)},_setItemsLocal:function(t,n,r,i){var s=this,o=null,u=[],a=[],f=e.Lang.isArray(t),l=new e.Parallel;if(s.storageMode===s.MODE_NOOP||s.storageMode===s.MODE_SERVER||!f){!f,e.Lang.isFunction(n)&&e.rbind(n,r,f?"no appropriate storageMode for _setItemsLocal":"Supplied keyvaluepairs is not an array",null,null,i)();return}e.Array.each(t,function(t,n,r){e.Lang.isArray(t)&&t.length===2?s._setItemLocal(t[0],t[1],l.add(function(e){e?a.push(t):u.push(t[0])}),s):o="keyvaluepairs subitem is not a 2-dim-array"},s),l.done(function(){e.Lang.isFunction(n)&&e.rbind(n,r,o,u,a,i)()})},_setItemsServer:function(t,n,r,i,s,o){var u=this,a;o||(o=[]),u.server?(e.Array.each(t,function(t,n,r){e.Lang.isArray(t)&&t.length===2&&(t[1]=u._transformItemType(t[1],!0))},u),u._storageCookieEnabled()?(a=u.server+"?"+u.uriSetItem+"&"+u.COOKIE_ID+"="+u._readCookie()+"&keyvalues="+encodeURIComponent(e.JSON.stringify(t))+"&callback={callback}",e.jsonp(a,{on:{success:function(a){e.Lang.isFunction(n)&&(e.Array.each(t,function(t,n,r){e.Lang.isArray(t)&&o.push(t[0])},u),e.rbind(n,r,s,o,null,i)()),u._serverBkpExists=!0},failure:function(){e.Lang.isFunction(n)&&e.rbind(n,r,(s?s+" + ":"")+"failed to connect to server",o,t,i)()},timeout:function(){e.Lang.isFunction(n)&&e.rbind(n,r,(s?s+" + ":"")+"connection time-out server",o,t,i)()}},context:u,timeout:u._serverTimeout})):e.Lang.isFunction(n)&&e.rbind(n,r,(s?s+" + ":"")+"Cookie-errror: You must accept Cookies in order to store data",o,t,i)()):e.Lang.isFunction(n)&&e.rbind(n,r,(s?s+" + ":"")+"setRemoteStorageServer is not set in the right way",o,t,i)()},setRemoteStorageServer:function(t,n,r,i,s,o,u,a){var f=this;e.Lang.isString(t)&&t!==f.server&&(f.server=t,f.uriSetItem=n,f.uriGetItem=r,f.uriGetLength=i,f.uriRemoveItem=s,f.uriClear=o,a&&(f._serverTimeout=a),e.Lang.isBoolean(u)&&u&&(f.storageMode=f.MODE_SERVER),f._serverStorageCanbemade=!0,f._serverBkpExists=!0,f._lengthServer(function(e,t){!e&&t?f._serverBkpExists=t>0:f._serverStorageCanbemade=!1},f))},_transformItemType:function(t,n){var r=this,i;return e.Lang.isString(t)&&(i=r.TYPE_STRING+t),e.Lang.isNumber(t)?i=Math.round(t)===t?r.TYPE_INT+t:r.TYPE_FLOAT+t:e.Lang.isBoolean(t)?i=r.TYPE_BOOLEAN+(t?"1":"0"):e.Lang.isArray(t)?i=r.TYPE_ARRAY+e.JSON.stringify(t):e.Lang.isDate(t)?i=r.TYPE_DATE+t.getTime():e.Lang.type(t)==="regexp"?i=r.TYPE_REGEXP+'{"source":"'+t.source+'","global":'+t.global+',"ignoreCase":'+t.ignoreCase+',"lastIndex":'+t.lastIndex+',"multiline":'+t.multiline+"}":e.Lang.isObject(t)&&(i=r.TYPE_OBJECT+e.JSON.stringify(t)),i=i.replace(/\\n/g,"").replace(/\\r/g,""),n?i.replace(/"/g,'\\"').replace(/'/g,"\\'"):i},_getCorrectItemType:function(t){var n=this,r,i,s,o;if(!e.Lang.isString(t))return t;o=t.substr(0,1),i=t.substr(1);if(o===n.TYPE_STRING)r=i;else if(o===n.TYPE_INT)r=parseInt(i,10);else if(o===n.TYPE_FLOAT)r=parseFloat(i);else if(o===n.TYPE_BOOLEAN)r=i==="1";else if(o===n.TYPE_ARRAY)try{r=e.JSON.parse(i)}catch(u){r=i}else if(o===n.TYPE_DATE)r=new Date,r.setTime(i);else if(o===n.TYPE_REGEXP)try{s=e.JSON.parse(i),r=new RegExp(s.source,(s.global?"g":"")+(s.ignoreCase?"i":"")+(s.multiline?"m":"")),r.lastIndex=s.lastIndex}catch(a){r=i}else if(o===n.TYPE_OBJECT)try{r=e.JSON.parse(i)}catch(f){r=i}return r},_setItemLocal_OldBrowsers:function(t,n,r,i,s){var o=this;o.initialised_DB_USER_DATA?o._setItemLocal_OldBrowsers_ReadySafe(t,n,r,i,s):e.on(o.EVT_READY,o._setItemLocal_OldBrowsers_ReadySafe,o,t,n,r,i,s)},_setItemLocal_OldBrowsers_ReadySafe:function(t,n,r,i,s){var o=this,u=null,a=e.JSON
.stringify(o.data);t&&n&&(o.data[t]=n);try{o.storageMode===o.MODE_DB&&o.storageDriver.transaction(function(e){e.executeSql("REPLACE INTO "+o.DB_NAME+" (name, value) VALUES ('data', ?)",[a])}),o.storageMode===o.MODE_USERDATA&&(o.storageDriver.setAttribute(o.USERDATA_NAME,a),o.storageDriver.save(o.USERDATA_PATH))}catch(f){u=f.message}e.Lang.isFunction(r)&&e.rbind(r,i,u,s)()},serverStoragePosible:function(){var e=this;return e.server&&e._serverStorageCanbemade&&e._storageCookieEnabled()},_storageCookieEnabled:function(){var t=this,n=e.Cookie.exists(t.COOKIE_ID);return n||(t._setCookie(),n=e.Cookie.exists(t.COOKIE_ID)),n},_readCookie:function(){var t=this,n=e.Cookie.get(t.COOKIE_ID);return n},_setCookie:function(){var t=this,n=(new Date).getTime(),r=Math.random();e.Cookie.set(t.COOKIE_ID,n.toString()+Math.round(1e4*r).toString(),{path:"/",expires:new Date("January 01, 2099")})}}),e.Global.ItsaStorage||(e.Global.ItsaStorage=new e.ITSASTORAGE),e.ItsaStorage=e.Global.ItsaStorage},"@VERSION@",{requires:["yui-base","base-build","base-base","event-base","event-custom","event-custom-complex","json","jsonp","cookie","parallel"]});
