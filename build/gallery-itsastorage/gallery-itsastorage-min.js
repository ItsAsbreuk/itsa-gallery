YUI.add("gallery-itsastorage",function(e,t){"use strict";function T(){T.superclass.constructor.apply(this,arguments)}var n=e.config.doc,r=e.config.win,i=e.JSON,s=e.namespace("ITSAStorageLite"),o="yui_itsastorage_lite",u="YUI ITSAStorageLite data",a=1048576,f="1.0",l="ready",c=0,h=1,p=2,d=3,v=4,m="yui_itsastorage_lite",g="data",y=/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z/,b={},w,E;try{r.localStorage?E=h:r.globalStorage?E=p:r.openDatabase&&navigator.userAgent.indexOf("Chrome")===-1?E=d:e.UA.ie>=5?E=v:E=c}catch(S){E=c}e.StorageFullError=function(t){e.StorageFullError.superclass.constructor.call(t),this.name="StorageFullError",this.message=t||"Maximum storage capacity reached",e.UA.ie&&(this.description=this.message)},e.extend(e.StorageFullError,Error),e.augment(s,e.EventTarget,!0,null,{emitFacade:!0,prefix:"storage-lite",preventable:!1}),s.publish(l,{fireOnce:!0,emitFacade:!0}),e.mix(s,{clear:function(){},getItem:function(){return null},length:function(){return 0},removeItem:function(){},setItem:function(){}}),E===h||E===p?(e.mix(s,{length:function(){return w.length},removeItem:function(e){w.removeItem(e)},setItem:function(e,t,n){w.setItem(e,n?i.stringify(t):t)}},!0),E===h?(w=r.localStorage,e.Node.DOM_EVENTS.pageshow=1,e.on("pageshow",function(){w=r.localStorage}),e.mix(s,{clear:function(){w.clear()},getItem:function(e,t){try{return t?i.parse(w.getItem(e),y):w.getItem(e)}catch(n){return null}}},!0)):E===p&&(w=r.globalStorage[r.location.hostname],e.mix(s,{clear:function(){for(var e in w)w.hasOwnProperty(e)&&(w.removeItem(e),delete w[e])},getItem:function(e,t){try{return t?i.parse(w[e].value,y):w[e].value}catch(n){return null}}},!0)),s.fire(l)):E===d||E===v?(e.mix(s,{clear:function(){b={},s._save()},getItem:function(e){return b.hasOwnProperty(e)?b[e]:null},length:function(){var e=0,t;for(t in b)b.hasOwnProperty(t)&&(e+=1);return e},removeItem:function(e){delete b[e],s._save()},setItem:function(e,t){b[e]=t,s._save()}},!0),E===d?(w=r.openDatabase(o,f,u,a),e.mix(s,{_save:function(){w.transaction(function(e){e.executeSql("REPLACE INTO "+o+" (name, value) VALUES ('data', ?)",[i.stringify(b)])})}},!0),w.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS "+o+"(name TEXT PRIMARY KEY, value TEXT NOT NULL)"),e.executeSql("SELECT value FROM "+o+" WHERE name = 'data'",[],function(e,t){if(t.rows.length)try{b=i.parse(t.rows.item(0).value,y)}catch(n){b={}}s.fire(l)})})):E===v&&(w=n.createElement("span"),w.addBehavior("#default#userData"),e.mix(s,{_save:function(){var t=i.stringify(b);n.body.appendChild(w);try{w.setAttribute(g,t),w.save(m)}catch(r){throw new e.StorageFullError}finally{n.body.removeChild(w)}}},!0),e.on("domready",function(){n.body.appendChild(w),w.load(m);try{b=i.parse(w.getAttribute(g)||"{}",y)}catch(e){b={}}finally{n.body.removeChild(w)}s.fire(l)}))):s.fire(l,{noop:!0});var x=e.ITSAStorageLite;T.NAME="itsastorage",e.ITSAStorageClass=e.extend(T,e.Base),T.prototype.initializer=function(){var t=this;t._ready=new e.Promise(function(e,t){x.on("storage-lite:ready",function(n){n.noop?t("noop"):e()})})},T.prototype.clear=function(){var e=this;return e._ready.then(function(){x.clear()})},T.prototype.getItem=function(e){var t=this;return t._ready.then(function(){var t=x.getItem(e,!0),n;t&&t.expire&&(n=(new Date).getTime(),t.expire<n&&(x.removeItem(e),t=null));if(!t)throw new Error("item not found");return t.value})},T.prototype.length=function(){var e=this;return e._ready.then(function(){return x.length()})},T.prototype.removeItem=function(e){var t=this;return t._ready.then(function(){x.removeItem(e)})},T.prototype.setItem=function(e,t,n){var r=this;return r._ready.then(function(){var r={value:t};n&&(r.expire=n.getTime()),x.setItem(e,r,!0)})},e.Global.ITSAStorage||(e.Global.ITSAStorage=new T),e.ITSAStorage=e.Global.ITSAStorage},"@VERSION@",{requires:["yui-base","base-base","promise","gallery-itsautils"]});
