YUI.add("gallery-itsadatetimepicker",function(e,t){"use strict";var n=e.Lang,r=e.Node,i=e.Array,s="itsa-datetimepicker",o=s+"-loading",u=s+"-panel",a=s+"-timechanged",f=1e3,l=s+"-datepicker",c=s+"-timepicker",h=c+"-hidden",p="Select date",d="Select date and time",v="Select time",m="yui3-button",g="itsa-button-datetime",y=s+"-icondate",b=s+"-icontime",w=s+"-icondatetime",E='<button class="'+m+" "+g+'"><span class="'+y+'"></span></button>',S='<button class="'+m+" "+g+'"><span class="'+w+'"></span></button>',x='<button class="'+m+" "+g+'"><span class="'+b+'"></span></button>',T="_datetimepicker:",N=T+"selectdate",C=T+"selected",k=T+"cancel",L=function(e){return parseInt(e,10)};e.ITSADateTimePicker=e.Base.create("itsadatetimepicker",e.Base,[],{panel:null,calendar:null,timedial:null,_eventhandlers:[],_panelRendererDelay:null,_window:null,_timeNode:null,_timeFormat:null,initializer:function(){var t=this;t._window=e.one("window"),t._renderUI(),t._bindUI(),e.one("body").removeClass(o)},dateNode:function(){return r.create(E)},datetimeNode:function(){return r.create(S)},getDate:function(t,n){var r=this,i;return r._saveShow(1,t,n),i=new e.Promise(function(t,n){var s,o;s=e.once(N,function(e){o.detach();var n=e.newDate;n.setMilliseconds(0),n.setSeconds(0),n.setMinutes(0),n.setHours(0),r._hide(),t(n),i=null}),o=e.once(k,function(){s.detach(),r.calendar.hide(),n(new Error("canceled")),i=null})}),i},getDateTime:function(t,n){var r=this,i;return r._saveShow(2,t,n),i=new e.Promise(function(t,n){var s,o;s=e.once(C,function(){o.detach();var e=r.calendar.get("selectedDates")[0],n=L(r.timedial.get("value")),s=Math.floor(n/60),u=n-60*s;e.setMilliseconds(0),e.setSeconds(0),e.setMinutes(u),e.setHours(s),r._hide(),t(e),i=null}),o=e.once(k,function(){s.detach(),r.calendar.hide(),r._toggleTimePicker(!1),n(new Error("canceled")),i=null})}),i},getTime:function(t,n){var r=this,i;return r._saveShow(3,t,n),i=new e.Promise(function(t,n){var s,o;s=e.once(C,function(){o.detach();var e=L(r.timedial.get("value")),n=Math.floor(e/60),s=e-60*n,u=new Date(1900,0,1,n,s,0,0);r._hide(),t(u),i=null}),o=e.once(k,function(){s.detach(),r._toggleTimePicker(!1),n(new Error("canceled")),i=null})}),i},timeNode:function(){return r.create(x)},destructor:function(){var e=this;e._clearEventhandlers(),e._panelRendererDelay&&e._panelRendererDelay.cancel(),e.timedial.destroy(),e.calendar.destroy()},_bindUI:function(){var t=this,n=t._eventhandlers,r=t.panel;r.onceAfter("render",function(){n.push(r.get("boundingBox").one(".yui3-button-close").on("click",function(){e.fire(k)})),t._fillPanel()}),t._panelRendererDelay=e.later(f,t,function(){t._panelRendererDelay=null,r.render()}),n.push(e.one("body").delegate("click",function(){},"."+g))},_clearEventhandlers:function(){i.each(this._eventhandlers,function(e){e.detach()})},_createTimeDial:function(){var t=this,n=t.panel.get("contentBox"),r;t.timedial=r=new e.Dial({min:0,max:1440,stepsPerRevolution:720,strings:{label:"0:00",resetStr:"Reset",tooltipHandle:"Drag to set time"},value:0}),r.onceAfter("render",function(){t._timeNode=n.one(".yui3-dial-label-string")}),r.render(n.one("#"+c)),t._eventhandlers.push(r.on("valueChange",function(e){var n=parseInt(e.newVal,10),r=Math.floor(n/60),i=n-60*r,s=t._timeNode;s.setHTML(t._renderDialTime(r,i)),s.addClass(a)}))},_createCalendar:function(){var t=this;t.calendar=new e.Calendar({height:"250px",width:"250px",showPrevMonth:!0,showNextMonth:!0,visible:!1,date:new Date}),t._eventhandlers.push(t.calendar.on("selectionChange",e.rbind(t._calendarNewDate,t))),t.calendar.render(t.panel.get("contentBox").one("#"+l))},_calendarNewDate:function(t){var n=this,r;n.calendar.get("visible")&&(r=t.newSelection[0],e.fire(N,{newDate:r}))},_fillPanel:function(){var t=this,n=t.panel,r=n.get("boundingBox"),i;r.addClass(u),t._createCalendar(),t._createTimeDial(),i={value:"Select",action:function(t){t.preventDefault(),e.fire(C)},section:e.WidgetStdMod.FOOTER},n.addButton(i)},_hide:function(){var e=this;e.calendar.hide(),e._toggleTimePicker(!1),e.panel.hide()},_renderDialTime:function(t,n){var r=this,i=new Date(1900,0,1,t,n,0,0);return e.Date.format(i,{format:r._timeFormat||"%H:%M"})},_renderUI:function(){var t=this;t.panel=new e.Panel({zIndex:15e3,modal:!1,visible:!1,render:!1,fillHeight:null,bodyContent:'<div id="'+l+'"></div><div id="'+c+'"></div>'})},_saveShow:function(e,t,n){var r=this,i=r.panel;i.get("rendered")?r._show(e,t,n):i.onceAfter("render",function(){r._show(e,t,n)}),r._panelRendererDelay&&(r._panelRendererDelay.cancel(),i.render())},_show:function(t,r,i){var s=this,o=s.panel,u=r||new Date,f=s._timeNode,l=i&&i.modal,c=i&&i.alignToNode,h,m,g,y,b,w,E,S,x,T,N,C;o.get("visible")&&(e.fire(k),s.panel.hide()),t<3?(s.calendar.deselectDates(),s.calendar.selectDates(u),n.isObject(i)&&(S={customRenderer:i.customRenderer||{},showPrevMonth:i.showPrevMonth||!1,showNextMonth:i.showNextMonth||!1,headerRenderer:i.headerRenderer||"%B %Y",minimumDate:i.minimumDate||null,maximumDate:i.maximumDate||null,enabledDatesRule:i.enabledDatesRule||null,disabledDatesRule:i.disabledDatesRule||null},s.calendar.setAttrs(S)),s.calendar.show()):s.calendar.hide(),t>1?(n.isObject(i)&&n.isString(i.timeformat)?s._timeFormat=i.timeformat:s._timeFormat=null,T=u.getHours(),x=u.getMinutes(),N=x+60*T,s.timedial.set("value",N),s.timedial._originalValue=N,f.setHTML(s._renderDialTime(T,x)),f.removeClass(a),s._toggleTimePicker(!0)):s._toggleTimePicker(!1);if(c instanceof e.Node){m=s._window;if(m){g=L(m.get("winWidth")),y=L(m.get("docScrollX"));switch(t){case 1:C=285;break;case 2:C=155;break;case 3:C=415}b=Math.max(o.get("boundingBox").get("offsetWidth"),C),w=c.getX(),E=c.get("offsetWidth"),h=w+E+b<y+g||w+E<b}o.align(c,h?[e.WidgetPositionAlign.TL,e.WidgetPositionAlign.TR]:[e.WidgetPositionAlign.TR,e.WidgetPositionAlign.BR])}else o.centered();n.isBoolean(l)?o.set("modal",l):o.set("modal",!1);switch(t){case 1:o.set("headerContent",i&&i.title||p);break;case 2:o.set("headerContent",i&&i.title||d);break;case 3:o.set("headerContent"
,i&&i.title||v)}i&&n.isBoolean(i.dragable)?i.dragable&&!o.hasPlugin("dd")?(o.plug(e.Plugin.Drag),o.dd.addHandle(".yui3-widget-hd")):o.hasPlugin("dd")&&o.unplug("dd"):o.hasPlugin("dd")&&o.unplug("dd"),o.show()},_toggleTimePicker:function(e){var t=this;t.timedial.get("boundingBox").toggleClass(h,!e),t.panel.get("contentBox").one(".yui3-widget-ft").toggleClass(h,!e)}},{ATTRS:{}}),e.Global.ItsaDateTimePicker||(e.Global.ItsaDateTimePicker=new e.ITSADateTimePicker),e.ItsaDateTimePicker=e.Global.ItsaDateTimePicker},"@VERSION@",{requires:["base","node-base","node-screen","panel","calendar","dial","promise","cssbutton","datatype-date-format","dd-plugin"],skinnable:!0});
