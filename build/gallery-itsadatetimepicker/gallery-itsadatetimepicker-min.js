YUI.add("gallery-itsadatetimepicker",function(e,t){"use strict";var n=e.Lang,r=e.Node,i=e.Array,s="itsa-datetimepicker",o=s+"-loading",u=s+"-unclosable",a=s+"-panel",f=s+"-timechanged",l=1e3,c=s+"-datepicker",h=s+"-timepicker",p=h+"-hidden",d="Select date",v="Select date and time",m="Select time",g="yui3-button",y="itsa-button-datetime",b=s+"-icondate",w=s+"-icontime",E=s+"-icondatetime",S='<button class="'+g+" "+y+'"><span class="'+b+'"></span></button>',x='<button class="'+g+" "+y+'"><span class="'+E+'"></span></button>',T='<button class="'+g+" "+y+'"><span class="'+w+'"></span></button>',N="_datetimepicker:",C=N+"selectdate",k=N+"selected",L=N+"cancel",A=function(e){return parseInt(e,10)};e.ITSADateTimePicker=e.Base.create("itsadatetimepicker",e.Base,[],{panel:null,calendar:null,timedial:null,_closebutton:null,_eventhandlers:[],_panelRendererDelay:null,_timeNode:null,_timeFormat:null,_unclosable:null,_window:null,initializer:function(){var t=this;t._window=e.one("window"),t._renderUI(),t._bindUI(),e.one("body").removeClass(o)},dateNode:function(){return r.create(S)},datetimeNode:function(){return r.create(x)},getDate:function(t,n){var r=this,i;return r._saveShow(1,t,n),i=new e.Promise(function(t,n){var s,o;s=e.once(C,function(e){o.detach();var n=e.newDate;n.setMilliseconds(0),n.setSeconds(0),n.setMinutes(0),n.setHours(0),r._hide(),t(n),i=null}),o=e.once(L,function(){s.detach(),r.calendar.hide(),n(new Error("canceled")),i=null})}),i},getDateTime:function(t,n){var r=this,i;return r._saveShow(2,t,n),i=new e.Promise(function(t,n){var s,o;s=e.once(k,function(){o.detach();var e=r.calendar.get("selectedDates")[0],n=A(r.timedial.get("value")),s=Math.floor(n/60),u=n-60*s;e.setMilliseconds(0),e.setSeconds(0),e.setMinutes(u),e.setHours(s),r._hide(),t(e),i=null}),o=e.once(L,function(){s.detach(),r.calendar.hide(),r._toggleTimePicker(!1),n(new Error("canceled")),i=null})}),i},getTime:function(t,n){var r=this,i;return r._saveShow(3,t,n),i=new e.Promise(function(t,n){var s,o;s=e.once(k,function(){o.detach();var e=A(r.timedial.get("value")),n=Math.floor(e/60),s=e-60*n,u=new Date(1900,0,1,n,s,0,0);r._hide(),t(u),i=null}),o=e.once(L,function(){s.detach(),r._toggleTimePicker(!1),n(new Error("canceled")),i=null})}),i},timeNode:function(){return r.create(T)},destructor:function(){var e=this;e._clearEventhandlers(),e._panelRendererDelay&&e._panelRendererDelay.cancel(),e.timedial.destroy(),e.calendar.destroy()},_bindUI:function(){var t=this,n=t._eventhandlers,r=t.panel;r.onceAfter("render",function(){var i;t._closebutton=i=r.get("boundingBox").one(".yui3-button-close"),n.push(i.on("click",function(){t._unclosable||e.fire(L)})),t._fillPanel()}),t._panelRendererDelay=e.later(l,t,function(){t._panelRendererDelay=null,r.render()}),n.push(e.one("body").delegate("click",function(){},"."+y))},_clearEventhandlers:function(){var e=this._eventhandlers;i.each(e,function(e){e.detach()}),e.length=0},_createTimeDial:function(){var t=this,n=t.panel.get("contentBox"),r;t.timedial=r=new e.Dial({min:0,max:1440,stepsPerRevolution:720,strings:{label:"0:00",resetStr:"Reset",tooltipHandle:"Drag to set time"},value:0}),r.onceAfter("render",function(){t._timeNode=n.one(".yui3-dial-label-string")}),r.render(n.one("#"+h)),t._eventhandlers.push(r.on("valueChange",function(e){var n=parseInt(e.newVal,10),r=Math.floor(n/60),i=n-60*r,s=t._timeNode;s.setHTML(t._renderDialTime(r,i)),s.addClass(f)}))},_createCalendar:function(){var t=this;t.calendar=new e.Calendar({height:"250px",width:"250px",showPrevMonth:!0,showNextMonth:!0,visible:!1,date:new Date}),t._eventhandlers.push(t.calendar.on("dateClick",e.rbind(t._calendarNewDate,t))),t.calendar.render(t.panel.get("contentBox").one("#"+c))},_calendarNewDate:function(t){var n=this,r;n.calendar.get("visible")&&(r=t.date,e.fire(C,{newDate:r}))},_fillPanel:function(){var t=this,n=t.panel,r=n.get("boundingBox"),i;r.addClass(a),t._createCalendar(),t._createTimeDial(),i={value:"Select",action:function(t){t.preventDefault(),e.fire(k)},section:e.WidgetStdMod.FOOTER},n.addButton(i)},_hide:function(){var e=this;e.calendar.hide(),e._toggleTimePicker(!1),e.panel.hide()},_renderDialTime:function(t,n){var r=this,i=new Date(1900,0,1,t,n,0,0);return e.Date.format(i,{format:r._timeFormat||"%H:%M"})},_renderUI:function(){var t=this;t.panel=new e.Panel({zIndex:15e3,modal:!1,visible:!1,render:!1,fillHeight:null,bodyContent:'<div id="'+c+'"></div><div id="'+h+'"></div>'})},_saveShow:function(e,t,n){var r=this,i=r.panel;i.get("rendered")?r._show(e,t,n):i.onceAfter("render",function(){r._show(e,t,n)}),r._panelRendererDelay&&(r._panelRendererDelay.cancel(),i.render())},_show:function(t,r,i){var s=this,o=s.panel,a=r||new Date,l=s._timeNode,c=i&&i.modal||!1,h=i&&i.forceSelectdate||!1,p=i&&i.alignToNode||!1,g,y,b,w,E,S,x,T,N,C,k,O;o.get("visible")&&(e.fire(L),s.panel.hide()),t<3?(s.calendar.deselectDates(),s.calendar.selectDates(a),n.isObject(i)&&(T={customRenderer:i.customRenderer||{},showPrevMonth:i.showPrevMonth||!1,showNextMonth:i.showNextMonth||!1,headerRenderer:i.headerRenderer||"%B %Y",minimumDate:i.minimumDate||null,maximumDate:i.maximumDate||null,enabledDatesRule:i.enabledDatesRule||null,disabledDatesRule:i.disabledDatesRule||null},s.calendar.setAttrs(T)),s.calendar.show()):s.calendar.hide(),t>1?(n.isObject(i)&&n.isString(i.timeformat)?s._timeFormat=i.timeformat:s._timeFormat=null,C=a.getHours(),N=a.getMinutes(),k=N+60*C,s.timedial.set("value",k),s.timedial._originalValue=k,l.setHTML(s._renderDialTime(C,N)),l.removeClass(f),s._toggleTimePicker(!0)):s._toggleTimePicker(!1);if(p instanceof e.Node){y=s._window;if(y){b=A(y.get("winWidth")),w=A(y.get("docScrollX"));switch(t){case 1:O=285;break;case 2:O=155;break;case 3:O=415}E=Math.max(o.get("boundingBox").get("offsetWidth"),O),S=p.getX(),x=p.get("offsetWidth"),g=S+x+E<w+b||S+x<E}o.align(p,g?[e.WidgetPositionAlign.TL,e.WidgetPositionAlign.TR]:[e.WidgetPositionAlign.TR,e.WidgetPositionAlign.BR])}else o.centered();n.isBoolean(c)?o.set("modal",c):o.set("modal",!1);switch(
t){case 1:o.set("headerContent",i&&i.title||d);break;case 2:o.set("headerContent",i&&i.title||v);break;case 3:o.set("headerContent",i&&i.title||m)}i&&n.isBoolean(i.dragable)?i.dragable&&!o.hasPlugin("dd")?(o.plug(e.Plugin.Drag),o.dd.addHandle(".yui3-widget-hd")):o.hasPlugin("dd")&&o.unplug("dd"):o.hasPlugin("dd")&&o.unplug("dd"),s._unclosable=h,s._closebutton.toggleClass(u,h),o.show()},_toggleTimePicker:function(e){var t=this;t.timedial.get("boundingBox").toggleClass(p,!e),t.panel.get("contentBox").one(".yui3-widget-ft").toggleClass(p,!e)}},{ATTRS:{}}),e.Global.ItsaDateTimePicker||(e.Global.ItsaDateTimePicker=new e.ITSADateTimePicker),e.ItsaDateTimePicker=e.Global.ItsaDateTimePicker},"@VERSION@",{requires:["base","node-base","node-screen","panel","calendar","dial","promise","cssbutton","datatype-date-format","dd-plugin"],skinnable:!0});
