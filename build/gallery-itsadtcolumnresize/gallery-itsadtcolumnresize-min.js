YUI.add("gallery-itsadtcolumnresize",function(e,t){"use strict";var n=e.Lang,r="itsa-resizable-col",i="yui3-datatable-itsacolresizing",s=2;e.namespace("Plugin").ITSADTColumnResize=e.Base.create("itsadtcolumnresize",e.Plugin.Base,[],{_eventhandlers:[],datatable:null,_badColWidth:null,_dtColgroupNode:null,_dtBoundingBox:null,_dtContentBox:null,_dtXScroller:null,_dtYScroller:null,_dtYScrollerContainer:null,_dtYScrollBar:null,_dtRealDataTableHeader:null,_dtScrollHeader:null,_dtScrollX:null,_dtScrollY:null,_dtNoScroll:null,_dtScrollXY:null,_resizeApproved:!1,_busyResize:!1,_leftThNode:null,_leftThX:null,_mouseOffset:null,_leftColIndex:null,_lastColIndex:null,_initialColWidth:null,_posibleExpandingLastCell:null,_scrollbarOffset:0,_dtBkpWidth:null,_dtWidthPercent:null,_bodyNode:null,_comingFromResize:null,_unselectableBkpList:[],_lastColExpanded:0,initializer:function(t){var n=this;n.datatable=n.get("host"),n._badColWidth=e.Features.test("table","badColWidth"),n.datatable.get("rendered")?n._render():n.afterHostEvent("render",n._render,n)},_render:function(){var t=this,n=t.datatable,r=n.get("scrollable"),i=r==="x"||r==="xy"||r===!0;t._dtBkpWidth=n.get("width"),typeof t._dtBkpWidth=="string"&&t._dtBkpWidth.length>0&&!i?e.use("datatable-scroll",e.bind(function(e){n.set("scrollable",n.get("scrollable")==="y"?"xy":"x"),this._bindUI()},t)):t._bindUI()},_bindUI:function(){var t=this,r=t.datatable,i=t._eventhandlers,s=r.get("sortable"),o,u;t._justifyTableWidth(),u=t._dtScrollHeader||t._dtRealDataTableHeader,i.push(u.delegate("mousemove",t._checkResizeAprovement,"th",t)),i.push(u.on("mouseleave",t._checkEndResizeApprovement,t)),i.push(u.delegate("mousedown",t._startResize,"th",t)),i.push(t._bodyNode.on(["mouseup","mouseleave"],t._stopResize,t)),i.push(r.after(["renderView","columnsChange","scrollableChange","widthChange"],t._justifyTableWidth,t)),n.isBoolean(s)&&s&&(o=r._eventHandles.sortUITrigger,o&&(o.detach(),o=null),r._theadNode&&(i.push(r.delegate("keydown",e.rbind(t._triggerSort,t),"."+r.getClassName("sortable","column"))),i.push(r.delegate("click",e.rbind(t._triggerSort,t),function(){return!t._comingFromResize&&this.hasClass(r.getClassName("sortable","column"))}))))},_triggerSort:function(t){var n=this,r=n.datatable,i,o=n._dtContentBox;n._dtScrollX?(o.setStyle("width",parseInt(n._dtRealDataTable.getStyle("width"),10)+s+"px"),e.bind("_onUITriggerSort",r,t)(),o.setStyle("width","")):n._dtScrollY||n._dtNoScroll?(i=n._dtScrollY?n._dtYScrollerContainer:n._dtRealDataTable,r.set("width",parseInt(i.getStyle("width"),10)+s+"px"),e.bind("_onUITriggerSort",r,t)(),r.set("width",n._dtBkpWidth)):e.bind("_onUITriggerSort",r,t)()},_startResize:function(e){var t=this,n,r=t._dtBoundingBox,i=t._dtYScrollerContainer,s,o,u,a,f,l,c,h,p;t._resizeApproved&&(t._busyResize=!0,t._comingFromResize=!0,t._resizeEvent=t._bodyNode.on("mousemove",t._resizeColumn,t),n=t.datatable,s=t.get("resizeMargin"),o=Math.round(s/2),u=e.currentTarget,a=u.next("th")===null,l=e.pageX,c=u.get("offsetWidth")-(i?parseInt(u.getStyle("paddingRight"),10):0),h=u.getX(),p=l>h+c-(a?s:o),p?(t._leftThNode=u,t._leftThX=h,t._mouseOffset=h+c-l):(t._leftThNode=u.previous("th"),t._leftThX=t._leftThNode.getX(),t._mouseOffset=h-l),f=u.get("parentNode").all("th"),t._leftColIndex=f.indexOf(t._leftThNode),t._initialColWidth=t.getColumnWidth(t._leftColIndex),t._changeUnselectableIE(!0))},_stopResize:function(t){var n=this,r=n.datatable,i;n._busyResize&&(n._resizeEvent&&n._resizeEvent.detach(),i=n.getColumnWidth(n._leftColIndex),n._busyResize=!1,n._changeUnselectableIE(!1),n._checkResizeAprovement(t),t.halt(),n._initialColWidth!==i&&r.fire("colWidthChange",{colIndex:n._leftColIndex,prevVal:n._initialColWidth,newVal:i}),e.later(200,n,function(){n._comingFromResize=!1}))},_checkResizeAprovement:function(e){var t=this;if(t.get("active")&&!t._busyResize){var n=t.datatable,s=n.get("boundingBox"),o=e.currentTarget,u=o.next("th")===null,a=o.getX(),f=e.pageX,l=o.get("offsetWidth")-(t._dtYScrollerContainer?parseInt(o.getStyle("paddingRight"),10):0),c,h,p,d,v=t.get("resizeMargin"),m=Math.round(v/2),g;c=f-a,h=a+l-f,p=c<m,d=h<(u?v:m),g=p&&o.previous("th")===null,t._resizeApproved=(p||d)&&!g&&(t.get("allColsSortable")||(p?o.previous("th"):o).hasClass(r)),s.toggleClass(i,t._resizeApproved)}},_resizeColumn:function(e){if(this._busyResize){var t=this,n,r=t._dtXScroller,i=t._leftColIndex,s=t._lastColIndex,o=t.getColumnWidth(i),u=t._lastColExpanded,a,f,l=Math.round(e.pageX-t._leftThX+t._mouseOffset);n=i===s&&r&&r.getStyle("overflowX")==="hidden"&&l<o,n||(a=t.setColumnWidth(i,l),i!==s?u>0&&a>o&&(f=Math.min(u,a-o),t.setColumnWidth(s,t.getColumnWidth(s)-f),t._lastColExpanded-=f):t._lastColExpanded=0)}},_checkEndResizeApprovement:function(e){var t=this;t._resizeApproved&&!t._busyResize&&t._endResizeApprovement()},_endResizeApprovement:function(){var e=this;e._resizeApproved=!1,e.datatable.get("boundingBox").toggleClass(i,!1)},_justifyTableWidth:function(){var t=this,i=t.datatable,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N=t._dtBkpWidth,C=0,k=0;t._bodyNode=e.one("body"),t._dtBoundingBox=s=i.get("boundingBox"),t._dtWidthPercent=N.substr(N.length-1)==="%",x=i.get("scrollable"),T=x==="y"||x==="xy"||x===!0,T&&t._dtWidthPercent&&(t._dtBkpWidth=N=s.get("offsetWidth")+"px",i.set("width",N),t._dtWidthPercent=!1),t._dtContentBox=o=i.get("contentBox"),t._dtColgroupNode=o.one("colgroup"),t._dtRealDataTable=u=o.one("."+i.getClassName("table")),t._dtXScroller=c=o.one("."+i.getClassName("x","scroller")),t._dtYScroller=h=o.one("."+i.getClassName("y","scroller")),t._dtYScrollerContainer=f=o.one("."+i.getClassName("y","scroller","container")),t._dtYScrollBar=l=o.one("."+i.getClassName("scrollbar")),t._dtRealDataTableHeader=a=u.one("."+i.getClassName("columns")),t._dtScrollHeader=y=f&&f.one("."+i.getClassName("scroll","columns")),t._dtScrollX=p=c!==null&&!f,t._dtScrollY=d=!c&&f!==null,t._dtNoScroll=v=!c&&!f,t._dtScrollXY=m=c!==null&&f!==null,g=f||u,b=a.all("th"),t._lastColIndex=b.size()-1,g.setStyle("width","1px"),v||t._justifySortableColumns(),b.each(function(e,s,o){k+=t.getColumnWidth(s),!d&&!m&&(S=i.getColumn(s),e.toggleClass(r,n.isBoolean(S.resizable)&&S.resizable))});if(d||m)E=f&&y.all("th"),t._scrollbarOffset=C=E&&parseInt(E.item(E.size()-1).getStyle("paddingRight"),10)||0,k+=C,y.all("th").each(function(e,t,s){S=i.getColumn(t),e.toggleClass(r,n.isBoolean(S.resizable)&&S.resizable)});p&&(u.setStyle("width",k+"px"),t._setVisibilityXScroller()),m&&(f.setStyle("width",k+"px"),h.setStyle("width",k+"px"),l.setStyle("width","16px"),u.setStyle("width",""),t._setVisibilityXScroller(),l.setStyle("left",parseInt(c.getStyle("width"),10)-15+"px")),d&&(f.setStyle("width",k+"px"),h.setStyle("width",k+"px"),u.setStyle("width","")),v&&u.setStyle("width",k+"px")},_changeUnselectableIE:function(t){var n=this,r=n._dtScrollHeader||n._dtRealDataTableHeader,i=r&&r.all("th"),s=n._unselectableBkpList,o;e.UA.ie>0&&(o=s.length>0,i.each(function(e,r,i){t&&!o&&n._unselectableBkpList.push(e.get("unselectable")),e.setAttribute("unselectable",t?"on":s.length>r?s[r]:"")},n))},_justifySortableColumns:function(){var e=this,t;e._posibleExpandingLastCell=!0,t=e._dtRealDataTableHeader.all("th"),t.each(function(t,n,r){e.setColumnWidth(n,e.getColumnWidth(n))}),e._posibleExpandingLastCell=!1},_setVisibilityXScroller:function(){var e=this,t,n,r=e._dtXScroller;r&&(n=e._dtYScrollerContainer||e._dtRealDataTable,t=parseInt(r.getStyle("width"),10)-parseInt(n.getStyle("width"),10),r.setStyle("overflowX",t<0?"scroll":"hidden"),t>=0&&e._leftColIndex!==e._lastColIndex&&e._expandLastCell(t))},_expandLastCell:function(e){var t=this,n=t._lastColIndex,r=t.getColumnWidth(n),i=t.setColumnWidth(n,r+e);t._lastColExpanded+=i-r},setColumnWidth:function(t,n){var r=this,i=r.datatable,s=r._dtContentBox,o=r._dtColgroupNode,u=o&&o.all("col"),a=u&&u.item(t),f=r._dtRealDataTable,l=r._dtXScroller,c=r._dtYScroller,h=r._dtYScrollerContainer,p=r._dtYScrollBar,d=r._dtScrollX,v=r._dtScrollY,m=r._dtNoScroll,g=r._dtScrollXY,y,b,w,E,S,x,T,N,C,k,L,A,O,M=r._dtScrollHeader,_,D;return a&&n&&e.Lang.isNumber(n)&&n>=r.get("minColWidth")?(N=r._badColWidth,k=function(e,t,n){return parseInt(n?e.getStyle(t):e.getComputedStyle(t),10)|0},A=function(){var e=i.getCell([0,t])||a,n=0;return N&&(n=k(e,"paddingLeft")+k(e,"paddingRight")+k(e,"borderLeftWidth")+k(e,"borderRightWidth")),Math.max(k(e,"width",!0),e.get("offsetWidth"),k(a,"width",!0)+n)},L=function(e,n){var r=0,s;N&&(s=i.getCell([0,t]),s&&(r=k(s,"paddingLeft")+k(s,"paddingRight")+k(s,"borderLeftWidth")+k(s,"borderRightWidth"))),n-=r,e.setStyle("width",n+"px")},C=-A(),d?b=f.getStyle("width")==="100%"?s:f:v||g?b=h:b=f,x=k(b,"width",!0),S=u?u.size()-1:0,S>0?(w=u.item(t===S?0:S),E=k(w,"width",!0),w.setStyle("width","")):(y=h||f,y.setStyle("width","1px"),v&&f.setStyle("width","1px")),L(a,n),n=A(),i.getColumn(t).width=n+"px",S>0&&E>0&&w.setStyle("width",E+"px"),C+=x+n,g&&(h.setStyle("width",C+"px"),O=k(c,"width",!0)+C-x+r._scrollbarOffset,c.setStyle("width",O+"px"),_=M.all(".yui3-datatable-scroll-liner").item(t),D=_.get("parentNode"),O=N?n:n-k(_,"paddingLeft")-k(_,"paddingRight")-k(D,"borderLeftWidth")-k(D,"borderRightWidth"),L(_,O),f.setStyle("width","")),v&&(h.setStyle("width",C+"px"),p.setStyle("left",C-15+"px"),O=k(c,"width",!0)+C-x,c.setStyle("width",O+"px"),_=M.all(".yui3-datatable-scroll-liner").item(t),D=_.get("parentNode"),O=N?n:n-k(_,"paddingLeft")-k(_,"paddingRight")-k(D,"borderLeftWidth")-k(D,"borderRightWidth"),L(_,O),f.setStyle("width","")),d&&f.setStyle("width",C+"px"),m&&f.setStyle("width",C+"px"),d||g?r._posibleExpandingLastCell||(r._posibleExpandingLastCell=!0,r._setVisibilityXScroller(),r._posibleExpandingLastCell=!1):i.get("boundingBox").setStyle("width","")):n=-1,n},getColumnWidth:function(e){var t=this,r=t.datatable,i=r.getColumn(e),s,o,u=0,a;return i&&i.width&&(u=parseInt(i.width,10)||0),typeof e=="string"?s=t._dtContentBox.one("#"+r.getClassName("col")+"-"+e):n.isNumber(e)&&(o=t._dtRealDataTableHeader,s=o&&o.all("th").item(e)),a=Math.max(u,s&&s.get("offsetWidth")+(t._dtYScrollerContainer?-parseInt(s.getStyle("paddingLeft"),10)-parseInt(s.getStyle("paddingRight"),10):0)),Math.max(u,a)},_clearEventhandlers:function(){var t=this;e.Array.each(t._eventhandlers,function(e,t,n){e.detach()})},destructor:function(){var t=this,r=t.datatable,s=r._eventHandles,o=r.get("sortable");t._resizeEvent&&t._resizeEvent.detach(),t._clearEventhandlers(),t._dtBoundingBox.removeClass(i),n.isBoolean(o)&&o&&(s.sortUITrigger=r.delegate(["click","keydown"],e.rbind("_onUITriggerSort",r),"."+r.getClassName("sortable","column")))}},{NS:"itsadtcr",ATTRS:{resizeMargin:{value:10,validator:function(t){return e.Lang.isNumber(t)&&t>=2&&t<=60}},minColWidth:{value:0,validator:function(t){return e.Lang.isNumber(t)&&t>=0}},active:{value:!0,validator:function(t){return e.Lang.isBoolean(t)}},allColsSortable:{value:!0,validator:function(t){return e.Lang.isBoolean(t)}}}})},"@VERSION@",{requires:["base-build","plugin","node-base","node-screen","node-event-delegate","event-mouseenter","event-custom","event-resize","datatable-column-widths"],skinnable:!0});
