YUI.add("gallery-itsadtcolumnresize",function(e,t){"use strict";var n=e.Lang,r=e.Array,i="itsa-resizable-col",s="yui3-datatable-itsacolresizing",o="itsa_width_percented",u="itsa_expansion",a="itsa_defined_col_width_data",f="yes",l="no",c=2;e.namespace("Plugin").ITSADTColumnResize=e.Base.create("itsadtcolumnresize",e.Plugin.Base,[],{_eventhandlers:[],_resizeEventhandlers:[],_allColsResizable:null,datatable:null,_badColWidth:null,_dtWidthDefined:null,_dtColNodes:null,_dtBoundingBox:null,_dtContentBox:null,_dtXScroller:null,_dtYScroller:null,_dtYScrollBar:null,_dtYScrollerContainer:null,_dtRealDataTableHeader:null,_dtScrollHeader:null,_dtScrollLiners:null,_dtScrollY:null,_resizeApproved:!1,_busyResize:!1,_leftThNode:null,_leftThX:null,_mouseOffset:null,_leftColIndex:null,_lastColIndex:null,_initialColWidth:null,_busyDistributeRemainingSpace:null,_busyTransformAllColumnWidthToPixels:null,_scrollbarOffset:0,_bodyNode:null,_comingFromResize:null,_widthChangeInternally:null,_unselectableBkpList:[],_distributedSpace:0,_notSpecCols:[],initializer:function(){var t=this;t.datatable=t.get("host"),t._badColWidth=e.Features.test("table","badColWidth"),t.datatable.get("rendered")?t._render():t.afterHostEvent("render",t._render,t)},transformToPercent:function(e){var t=this,n,r;t._dtWidthDefined&&!t.columnWidthIsPercent(e)&&(n=t.getColumnWidthPercent(e,!0),r=t.getColumnExpansion(e),t.setColumnWidth(e,n,r))},transformToPixels:function(e){var t=this,n,r;t._dtWidthDefined&&!t.columnWidthIsPixels(e)&&(n=t.getColumnWidthPx(e,!0),r=t.getColumnExpansion(e),t.setColumnWidth(e,n,r))},transformToUndefinedWidth:function(e){var t=this,n,r;t._dtWidthDefined&&!t.columnWidthIsUndefined(e)&&(r=t.getColumnWidthPx(e),t.setColumnWidth(e,r),n=this._getThCel(e),n&&n.setData(a,l))},columnWidthIsPercent:function(e){var t=this._getThCel(e),n=t&&t.getData(o)||"";return n.length>0},columnWidthIsPixels:function(e){var t=this._getThCel(e),n=t&&t.getData(o)||"",r=t&&t.getData(a)||f;return r&&n.length===0},columnWidthIsUndefined:function(e){var t=this._getThCel(e),n=t&&t.getData(a)||f;return!n},getColumnConfigWidth:function(e){var t=this,n=t.datatable,i=n.getColumn(e),s=n.get("columns"),u=r.indexOf(s,i),a=t._dtRealDataTableTHNodes,f=a&&a.item(u),l=f&&f.getData(o)||"";return i&&(l.length>0?l:i.width)||null},getColumnWidthPx:function(e,t){var r=this,i=r.datatable,s=i.getColumn(e),o=r._dtRealDataTableTHNodes,a=0,f=0,l;return s&&s.width&&(f=parseInt(s.width,10)||0),typeof e=="string"?l=r._dtContentBox.one("#"+i.getClassName("col")+"-"+e):n.isNumber(e)&&(l=o&&o.item(e)),a=t?l&&l.getData(u)||0:0,r._busyDistributeRemainingSpace||(f=Math.max(f,l&&l.get("offsetWidth")||0)),f-a},getColumnWidthPercent:function(e,t){var n=this,r=parseInt(n._dtXScroller.getStyle("width"),10)+c,i=n.getColumnWidthPx(e,t);return(100*r/i).toFixed(2)+"%"},getColumnExpansion:function(e){var t=this,r=t._dtRealDataTableTHNodes,i;return typeof e=="string"?i=t._dtContentBox.one("#"+t.datatable.getClassName("col")+"-"+e):n.isNumber(e)&&(i=r&&r.item(e)),i&&i.getData(u)||0},setColumnWidth:function(t,r,i){var s=this,l=n.isNumber(t)?t:s._getColIndexFromName(t),h=s.getColumnWidthPx(l),p=s.datatable,d=s._dtContentBox,v=s._dtColNodes,m=v&&v.item(l),g=s._dtRealDataTable,y=s._dtYScrollerContainer,b=s._dtScrollY,w=s._dtRealDataTableTHNodes,E=w&&w.item(l),S=E&&E.getData(u)||0,x=s._busyResize,T=parseInt(s._dtXScroller.getStyle("width"),10),N=T+c,C=s._busyTransformAllColumnWidthToPixels,k=p.getColumn(l),L=E&&E.getData(o)||"",A=L.length>0,O=r&&r.substr&&r.substr(r.length-1)==="%",M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K;return i=i||0,!s._dtWidthDefined&&O?r=s.get("minColWidth"):r=O?parseFloat(r):parseInt(r,10),V=O?L!==r+"%":r!==h,$=O!==A,J=i!==S,j=s._badColWidth,m&&E&&e.Lang.isNumber(r)&&(V||$||J||C)&&r>=s.get("minColWidth")?(I=function(e,t,n){return parseInt(n?e.getStyle(t):e.getComputedStyle(t),10)||0},q=function(e,t){var n=0,r;j&&(r=p.getCell([0,l]),r&&(n=I(r,"paddingLeft")+I(r,"paddingRight")+I(r,"borderLeftWidth")+I(r,"borderRightWidth"))),t-=n,e.setStyle("width",t+"px")},R=function(e,t){var n;!C&&i===0&&(O?(E.setData(o,e+"%"),e=Math.round(N*e/100)):E.setData(o,null)),t&&(e+=i,n=E.getData(u)||0,E.setData(u,i),s._distributedSpace+=i-n,!C&&i===0&&E.setData(a,f)),k&&(k.width=e+"px"),q(m,e)},x||(K=A?s.getColumnWidthPercent(l):h),b?_=y:_=g.getStyle("width")==="100%"?d:g,B=I(_,"width",!0),H=v?v.size()-1:0,H>0?(D=v.item(l===H?0:H),P=I(D,"width",!0),D.setStyle("width","")):(M=y||g,M.setStyle("width","1px"),b&&g.setStyle("width","1px")),R(r,!0),X=(O?Math.round(N*r/100):r)+i,r=s.getColumnWidthPx(l),X!==r&&R(O?Math.round(100*r/N):r,!1),H>0?P>0&&D.setStyle("width",P+"px"):(M.setStyle("width",T+"px"),b&&g.setStyle("width",parseInt(y.getStyle("width"),10)+"px")),F=B+r-h,r!==h||C?b?(z=s._dtScrollLiners.item(l),W=z.get("parentNode"),U=j?r:r-I(z,"paddingLeft")-I(z,"paddingRight")-I(W,"borderLeftWidth")-I(W,"borderRightWidth"),q(z,U),!s._busyDistributeRemainingSpace&&!s._busyTransformAllColumnWidthToPixels&&(s._dtWidthDefined?(y.setStyle("width",F+"px"),s._checkRemainingColSpace()):s._syncYScrollerUI(F))):!s._busyDistributeRemainingSpace&&!s._busyTransformAllColumnWidthToPixels&&(g.setStyle("width",F+"px"),s._dtWidthDefined?(g.setStyle("width",F+"px"),s._checkRemainingColSpace()):(s._setDTWidthFromInternal(F+c),s._dtXScroller.setStyle("width",F+"px"),s._dtBoundingBox.setStyle("width",F+c+"px"))):H===0&&M.setStyle("width",h+"px"),O&&(r=(100*r/N).toFixed(2)+"%"),x||p.fire("colWidthChange",{colIndex:l,prevVal:K,newVal:r})):r=L||h,r},syncTableUI:function(){var e=this;e._widthChangeInternally||(e._widthChangeInternally=!0,e._justifyTableWidth()),e._widthChangeInternally=!1},destructor:function(){var t=this,r=t.datatable,i=r._eventHandles,o=r.get("sortable");t._resizeEvent&&t._resizeEvent.detach(),t._clearEventhandlers(),t._clearResizeEventhandlers(),t._dtBoundingBox.removeClass(s),n.isBoolean(o)&&o&&(i.sortUITrigger=r.delegate(["click","keydown"],e.rbind("_onUITriggerSort",r),"."+r.getClassName("sortable","column")))},_render:function(){var t=this,n=t.datatable,r=n.get("scrollable"),i=r==="x"||r==="xy"||r===!0;i?t._initUI():e.use("datatable-scroll",e.bind(function(e){n.set("scrollable",n.get("scrollable")==="y"?"xy":"x"),this._initUI()},t))},_initUI:function(){var e=this,t=e.datatable;t.get("width")===""?(e._dtWidthDefined=!1,e._setDTWidthFromInternal(1)):e._dtWidthDefined=!0,e._initPrivateVars(),e._justifyTableWidth(),e._bindUI()},_bindUI:function(){var t=this,r=t.datatable,i=t._eventhandlers,s=r.get("sortable"),o;t._activateColResizer({newVal:r.get("colsresizable")}),i.push(r.after(["colsresizableChange"],t._activateColResizer,t)),i.push(r.after(["renderView","columnsChange","dataChange","scrollableChange"],t.syncTableUI,t)),i.push(r.after(["widthChange"],t._justifyTableAfterTableWidthChange,t)),r._scrollResizeHandle&&r._scrollResizeHandle.detach(),r._scrollResizeHandle=e.on("resize",t._syncScrollUIPercentedDT,null,t),n.isBoolean(s)&&s&&(o=r._eventHandles.sortUITrigger,o&&(o.detach(),o=null),r._theadNode&&(i.push(r.delegate("keydown",e.rbind(t._triggerSort,t),"."+r.getClassName("sortable","column"))),i.push(r.delegate("click",e.rbind(t._triggerSort,t),function(){return!t._comingFromResize&&this.hasClass(r.getClassName("sortable","column"))}))))},_activateColResizer:function(e){var t=this,r=e.newVal,i=t._resizeEventhandlers,s=n.isBoolean(r),o=t._dtScrollHeader||t._dtRealDataTableHeader;s&&!r?t._clearResizeEventhandlers():(t._allColsResizable=s&&r,i.push(o.delegate(["mousemove","touchstart"],t._checkResizeAprovement,"th",t)),i.push(o.on("mouseleave",t._checkEndResizeApprovement,t)),i.push(o.delegate(["mousedown","touchstart"],t._startResize,"th",t)),i.push(t._bodyNode.on(["mouseup","mouseleave","touchend"],t._stopResize,t)))},_syncScrollUIPercentedDT:function(){var t=this,n=t.datatable;t._resizeEventMayOccur?(e.rbind(n._syncScrollUI,n)(),t.syncTableUI()):t._resizeEventMayOccur=!0},_triggerSort:function(t){var n=this,r=n.datatable,i=n._dtContentBox,s=n._dtYScrollerContainer,o=n._dtRealDataTable,u,a;n._dtScrollY?(u=parseInt(s.getStyle("width"),10),a=parseInt(o.getStyle("width"),10),e.bind("_onUITriggerSort",r,t)(),s.setStyle("width",u+"px"),o.setStyle("width",a+"px"),n._dtYScrollBar.setStyle("left",parseInt(n._dtXScroller.getStyle("width"),10)-15+"px")):(i.setStyle("width",parseInt(n._dtRealDataTable.getStyle("width"),10)+c+"px"),e.bind("_onUITriggerSort",r,t)(),i.setStyle("width",""))},_startResize:function(t){var n=this,r,i=n._dtYScrollerContainer,s,o,u,a,f,l,c,h,p;n._resizeApproved&&(n._busyResize=!0,n._comingFromResize=!0,n._resizeEvent=n._bodyNode.on(["mousemove","touchmove"],n._resizeColumn,n),r=n.datatable,s=e.UA.mobile?n.get("resizeMarginTouchDevice"):n.get("resizeMargin"),o=Math.round(s/2),u=t.currentTarget,a=u.next("th")===null,l=t.pageX,c=u.get("offsetWidth")-(i?parseInt(u.getStyle("paddingRight"),10):0),h=u.getX(),p=l>h+c-(a?s:o),p?(n._leftThNode=u,n._leftThX=h,n._mouseOffset=h+c-l):(n._leftThNode=u.previous("th"),n._leftThX=n._leftThNode.getX(),n._mouseOffset=h-l),f=u.get("parentNode").all("th"),n._leftColIndex=f.indexOf(n._leftThNode),n._initialColWidth=n.getColumnWidthPx(n._leftColIndex),n._changeUnselectableIE(!0))},_stopResize:function(t){var n=this,r=n.datatable,i;n._busyResize&&(n._resizeEvent&&n._resizeEvent.detach(),i=n.getColumnWidthPx(n._leftColIndex),n._busyResize=!1,n._changeUnselectableIE(!1),n._checkResizeAprovement(t),t.halt(),n._initialColWidth!==i&&r.fire("colWidthChange",{colIndex:n._leftColIndex,prevVal:n._initialColWidth,newVal:i}),e.later(200,n,function(){n._comingFromResize=!1}))},_checkResizeAprovement:function(t){if(!this._busyResize){var n=this,r=n.datatable,o=r.get("boundingBox"),u=t.currentTarget,a=u.next("th")===null,f=u.getX(),l=t.pageX,c=u.get("offsetWidth")-(n._dtYScrollerContainer?parseInt(u.getStyle("paddingRight"),10):0),h=e.UA.mobile?n.get("resizeMarginTouchDevice"):n.get("resizeMargin"),p=Math.round(h/2),d,v,m,g,y;d=l-f,v=f+c-l,m=d<p,g=v<(a?h:p),y=m&&u.previous("th")===null,n._resizeApproved=(m||g)&&!y&&(n._allColsResizable||(m?u.previous("th"):u).hasClass(i)),o.toggleClass(s,n._resizeApproved)}},_resizeColumn:function(e){if(this._busyResize){e.preventDefault();var t=this,n=t._leftColIndex,r=t._lastColIndex,i=t.getColumnWidthPx(n),s=Math.round(e.pageX-t._leftThX+t._mouseOffset),o=t._distributedSpace,u,a,f,l,h,p;n===r&&(f=t._dtYScrollerContainer||t._dtRealDataTable,l=parseInt(t._dtXScroller.getStyle("width"),10),p=parseInt(f.getStyle("width"),10),u=t._dtWidthDefined&&l>=p&&s<i&&o===0),u||(t._dtWidthDefined&&n===r&&s<i&&(s=i-Math.min(i-s,p-l+o)),t.columnWidthIsPercent(n)&&t._dtWidthDefined&&(h=parseInt(t._dtXScroller.getStyle("width"),10)+c,s=(100*s/h).toFixed(2)+"%",i=(100*i/h).toFixed(2)+"%"),a=t.setColumnWidth(n,s),i!==a&&t.datatable.fire("resize:colWidthChange",{colIndex:n,prevVal:i,newVal:a}))}},_checkEndResizeApprovement:function(){var e=this;e._resizeApproved&&!e._busyResize&&e._endResizeApprovement()},_endResizeApprovement:function(){var e=this;e._resizeApproved=!1,e.datatable.get("boundingBox").toggleClass(s,!1)},_initPrivateVars:function(){var t=this,n=t.datatable,r=n.get("scrollable"),i,s,o,u,a,f;t._bodyNode=e.one("body"),t._dtBoundingBox=n.get("boundingBox"),t._dtContentBox=i=n.get("contentBox"),t._dtRealDataTable=s=i.one("."+n.getClassName("table")),t._dtXScroller=i.one("."+n.getClassName("x","scroller")),t._dtYScroller=i.one("."+n.getClassName("y","scroller")),t._dtYScrollerContainer=u=i.one("."+n.getClassName("y","scroller","container")),t._dtYScrollBar=i.one("."+n.getClassName("scrollbar")),t._dtRealDataTableHeader=a=s.one("."+n.getClassName("columns")),t._dtRealDataTableTHNodes=a.all("th"),f=i.one("colgroup"),t._dtColNodes=f&&f.all("col"),t._dtScrollHeader=o=u&&u.one("."+n.getClassName("scroll","columns")),t._dtScrollLiners=o&&o.all("."+n.getClassName("scroll","liner")),t._dtScrollY=r==="y"||r==="xy"||r===!0},_justifyTableAfterTableWidthChange:function(){var e=this,t=e.datatable;e._busyResize||(t.get("width")===""?(e._dtWidthDefined=!1,e._setDTWidthFromInternal(1)):e._dtWidthDefined=!0,e.syncTableUI())},_justifyTableWidth:function(){var e=this,t=e.datatable,r=e._dtRealDataTable,s=e._dtYScrollerContainer,o=e._dtYScrollBar,u=e._dtXScroller,a=e._dtScrollY,f=e._dtScrollHeader,l=e._dtRealDataTableTHNodes,h=e._dtWidthDefined,p=0,d,v,m,g;h||u.setStyle("overflowX","hidden"),e._lastColIndex=m=l.size()-1,r.setStyle("width","1px"),a&&s.setStyle("width","1px"),g=e._transformAllColumnWidthToPixels(),e._distributedSpace>0&&(e._distributedSpace=0),a&&(d=s&&f.all("th"),e._scrollbarOffset=p=d&&parseInt(d.item(d.size()-1).getStyle("paddingRight"),10)||0,g+=p,s.setStyle("width",g+"px")),r.setStyle("width",g+"px"),g=Math.max(g,parseInt(u.getStyle("width"),10)),a?(f.all("th").each(function(e,r){v=t.getColumn(r),e.toggleClass(i,n.isBoolean(v.resizable)&&v.resizable)}),o.setStyle("width","16px"),e._syncYScrollerUI(g)):(l.each(function(e,r){v=t.getColumn(r),e.toggleClass(i,n.isBoolean(v.resizable)&&v.resizable)}),h?e._checkRemainingColSpace():e._setDTWidthFromInternal(g+c))},_changeUnselectableIE:function(t){var n=this,r=n._dtScrollHeader||n._dtRealDataTableHeader,i=r&&r.all("th"),s=n._unselectableBkpList,o;e.UA.ie>0&&(o=s.length>0,i.each(function(e,r){t&&!o&&n._unselectableBkpList.push(e.get("unselectable")||""),e.setAttribute("unselectable",t?"on":s.length>r?s[r]:"")},n))},_transformAllColumnWidthToPixels:function(){var e=this,t=e.datatable,n=parseInt(e._dtXScroller.getStyle("width"),10)+c,i=e._notSpecCols,s=0,h=0,p=e._dtRealDataTableTHNodes,d,v,m,g,y,b,w,E,S,x;return e._busyTransformAllColumnWidthToPixels=!0,i.length=0,p.each(function(r,c){m=t.getColumn(c),v=m&&m.width,g=v&&v.substr(v.length-1)==="%",b=p&&p.item(c),E=b&&b.getData(u)||0,w=b&&b.getData(o)||"",x=w.length>0,S=b&&b.getData(a)||f,S===f&&(g||x?(x&&(v=w),b&&b.setData(o,v),e._dtWidthDefined?v=m.width=Math.round(n*parseFloat(v)/100)+"px":v=null):b&&b.setData(o,null)),v&&S===f?(d=parseInt(v,10)-E,s+=e.setColumnWidth(c,d)):(i.push(c),b&&b.setData(a,l))}),i.length>0&&(h=0,r.each(i,function(t){h+=e.setColumnWidth(t,e.getColumnWidthPx(t,!0))})),y=s+h,e._busyTransformAllColumnWidthToPixels=!1,y},_checkRemainingColSpace:function(e){var t=this,n=t._dtXScroller,r=t._distributedSpace,i=parseInt(n.getStyle("width"),10),s,o,u;t._dtWidthDefined&&(t._busyDistributeRemainingSpace=!0,o=t._dtYScrollerContainer||t._dtRealDataTable,u=e||parseInt(o.getStyle("width"),10),s=r+i-u,n.setStyle("overflowX",s<0?"scroll":"hidden"),s=Math.max(0,s),o.setStyle("width",i+"px"),t._distributeRemainingSpace(s),t._busyDistributeRemainingSpace=!1,u=u+s-r,t._dtScrollY?t._syncYScrollerUI(u,!0):t._dtRealDataTable.setStyle("width",u+"px"),t._distributedSpace=s)},_distributeRemainingSpace:function(e){var t=this,n=t._notSpecCols,i=n.length,s,o;i>0?(s=Math.round(e/i),o=s+e-s*i,r.each(n,function(e,n){var r=n===i-1?o:s;t.setColumnWidth(e,t.getColumnWidthPx(e,!0),r)})):t._expandLastCell(e)},_expandLastCell:function(e){var t=this,n=t._lastColIndex;t.setColumnWidth(n,t.getColumnWidthPx(n,!0),e)},_syncYScrollerUI:function(e,t){var n=this,r=n._dtRealDataTable,i=n._dtYScrollerContainer,s,o;n._busyDistributeRemainingSpace||(n._dtWidthDefined?(o=parseInt(n._dtXScroller.getStyle("width"),10),e=Math.max(e,o),r.setStyle("width",e-n._scrollbarOffset+"px")):(n._setDTWidthFromInternal(e+c),n._dtXScroller.setStyle("width",e+"px"),n._dtBoundingBox.setStyle("width",e+c+"px")),s=parseInt(i.getStyle("width"),10),i.setStyle("width",e+"px"),n._dtYScroller.setStyle("width",e+"px"),t||n._checkRemainingColSpace(s),n._dtWidthDefined||n.datatable._syncScrollUI(),n._dtYScrollBar.setStyle("left",parseInt(n._dtXScroller.getStyle("width"),10)-15+"px"))},_getThCel:function(e){var t=this,r=t._dtRealDataTableTHNodes,i;return n.isNumber(e)||(i=t._getColIndexFromName(e)),r&&r.item(i||e)},_getColIndexFromName:function(e){var t=this,n,i,s,o;return typeof e=="string"&&(n=t.datatable,i=n.getColumn(e),s=n.get("columns"),o=r.indexOf(s,i)),o||-1},_setDTWidthFromInternal:function(e){var t=this,n=t.datatable,r=t._dtRealDataTable,i;t._dtWidthDefined||(i=r&&parseInt(r.getStyle("width"),10),t._widthChangeInternally=!0,n.set("width",e+"px"),t._widthChangeInternally=!1,t._dtWidthDefined=!1,r&&r.setStyle("width",Math.max(i,parseInt(t._dtXScroller.getStyle("width"),10))+"px"))},_clearResizeEventhandlers:function(){r.each(this._resizeEventhandlers,function(e){e.detach()})},_clearEventhandlers:function(){r.each(this._eventhandlers,function(e){e.detach()})}},{NS:"itsadtcr",ATTRS:{resizeMargin:{value:10,validator:function(t){return e.Lang.isNumber(t)&&t>=2&&t<=60}},resizeMarginTouchDevice:{value:20,validator:function(t){return e.Lang.isNumber(t)&&t>=2&&t<=60}},minColWidth:{value:0,validator:function(t){return e.Lang.isNumber(t)&&t>=0}}}})},"@VERSION@",{requires:["base-build","plugin","node-base","node-screen","node-event-delegate","event-mouseenter","event-custom","event-resize","event-touch","datatable-column-widths"],skinnable:!0});
