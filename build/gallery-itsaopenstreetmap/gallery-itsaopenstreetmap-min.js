YUI.add("gallery-itsaopenstreetmap",function(e,t){"use strict";e.ITSAOpenStreetMap=e.Base.create("itsaopenstreetmap",e.Widget,[],{doLoadImagesOutsieViewPort:!1,autoresizeLayer:!0,mapid:null,oldX:0,oldY:0,layerMadeVisible:!1,currentLatitude:null,currentLongitude:null,currentZoomLevel:null,imageque:null,dragStarted:!1,pauzedBySubRoutine:!1,q:new e.AsyncQueue,restartque:null,osXLion:!1,zoomInByScrollPermitted:!0,zoomOutByScrollPermitted:!0,markers:[],scrollEvent:null,mobiledevice:!1,macUser:!1,_zoomTimer:null,pasiveTimeAfterZoom:200,minimumZoomValue:1,TILE_SIZE:256,TIME_OUT_VIEW:1e4,QUESTION_MARKED_IMAGE_ALLOWED:!0,initializer:function(){var t=this,n;n=function(){var t,n,r,i,s,o=!1;return e.UA.os==="macintosh"&&(t=e.UA.userAgent,n=new RegExp("OS X \\d+[\\._]?\\d*[\\._]?\\d*","i"),r=t.match(n),r!==null&&(i=r[0].substring(5),i=i.replace(/_/g,"."),s=parseFloat(i),s>10.6999&&(o=!0))),o},t.mapid=e.guid(),t.mobiledevice=e.UA.mobile!==null,t.osXLion=n(),t.macUser=e.UA.os==="macintosh",t.macUser&&(t.pasiveTimeAfterZoom=1250)},addMarker:function(t){var n=this;t||(t={}),e.use("gallery-itsamapmarker",function(e){e.on("contentready",function(t){var r;t.host=e.one("#map_markers_"+n.mapid),r=n.markers.length,n.markers[r]=new e.ITSAMapMarker(t),n.markers[r].render(n.currentZoomLevel)},"#map_"+n.mapid,n,t)})},centerLayerBasedUponMarkers:function(e,t,n){var r,i=0,s=0,o=0,u=0,a,f,l,c,h,p,d,v,m,g,y,b=!1,w;r=this;if(n)p=r._getMarkerObj(n),p&&(r.currentLatitude=p.get("lat"),r.currentLongitude=p.get("lon"));else{f=r.markers.length,f>0&&(l=r.markers[0],i=l.get("lat"),o=l.get("lon"),s=i,u=o);for(a=1;a<f;a++)l=r.markers[a],c=l.get("lat"),h=l.get("lon"),c<i&&(i=c),c>s&&(s=c),h<o&&(o=h),h>u&&(u=h);r.currentLatitude=(i+s)/2,r.currentLongitude=(o+u)/2}if(e){if(n)d=t;else{d=3,w=40,v=r._getViewPortWidth()-2*w,m=r._getViewPortHeight()-2*w;for(d=t;d>0&&!b;d--)g=Math.abs(r.TILE_SIZE*(r._long2tileNOTROUNDED(u,d)-r._long2tileNOTROUNDED(o,d))),y=Math.abs(r.TILE_SIZE*(r._lat2tileNOTROUNDED(s,d)-r._lat2tileNOTROUNDED(i,d))),b=g<v&&y<m}r.viewZoomLayer(d)}else r.loadImagesActiveLayer(!1,!0)},zoomOutLayerToFitBasedUponMarkers:function(e,t){var n,r=0,i=0,s=0,o=0,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N=!1,C,k,L,A,O,M,_;n=this;if(n.dragStarted)return;C=15,k=150,L=140,A=0;if(t&&!t.isEmpty()){_=!0;for(u=0;u<t.size();u++){O=t.item(u),M=O.getData("deviceid");if(M){f=n._getMarkerObj(M);if(f){l=f.get("lat"),c=f.get("lon");if(_||l<r)r=l;if(_||l>i)i=l;if(_||c<s)s=c;if(_||c>o)o=c;_=!1}}}}else{d=n.markers,a=d.length,a>0&&(f=d[0],r=f.get("lat"),s=f.get("lon"),i=r,o=s);for(u=1;u<a;u++)f=d[u],l=f.get("lat"),c=f.get("lon"),l<r&&(r=l),l>i&&(i=l),c<s&&(s=c),c>o&&(o=c)}g=Math.round(n._getViewPortWidth()/2)-C,y=Math.round(n._getViewPortWidth()/2)-k,w=Math.round(n._getViewPortHeight()/2)-L,b=Math.round(n._getViewPortHeight()/2)-A,h=n.currentZoomLevel,v=n.TILE_SIZE*n._long2tileNOTROUNDED(n.currentLongitude,h),m=n.TILE_SIZE*n._lat2tileNOTROUNDED(n.currentLatitude,h),T=n.TILE_SIZE*n._lat2tileNOTROUNDED(r,h),x=n.TILE_SIZE*n._lat2tileNOTROUNDED(i,h),E=n.TILE_SIZE*n._long2tileNOTROUNDED(s,h),S=n.TILE_SIZE*n._long2tileNOTROUNDED(o,h),N=E>v-g&&S<v+y&&x>m-w&&T<m+b,N||(e=!0),e&&(n.currentLatitude=(r+i)/2,n.currentLongitude=(s+o)/2,v=n.TILE_SIZE*n._long2tileNOTROUNDED(n.currentLongitude,h),m=n.TILE_SIZE*n._lat2tileNOTROUNDED(n.currentLatitude,h)),a<2?N=!0:N=E>v-g&&S<v+y&&x>m-w&&T<m+b;if(!N){for(p=h-1;p>0&&!N;p--)v=n.TILE_SIZE*n._long2tileNOTROUNDED(n.currentLongitude,p),m=n.TILE_SIZE*n._lat2tileNOTROUNDED(n.currentLatitude,p),T=n.TILE_SIZE*n._lat2tileNOTROUNDED(r,p),x=n.TILE_SIZE*n._lat2tileNOTROUNDED(i,p),E=n.TILE_SIZE*n._long2tileNOTROUNDED(s,p),S=n.TILE_SIZE*n._long2tileNOTROUNDED(o,p),N=E>v-g&&S<v+y&&x>m-w&&T<m+b;n.viewZoomLayer(p+1)}else e&&n.loadImagesActiveLayer(!1,!0)},updateMarker:function(e){var t=this,n;e&&e.markerid&&(n=t._getMarkerObj(e.markerid),n&&(e.lat&&n.set("lat",e.lat),e.lon&&n.set("lon",e.lon),e.position&&n.set("position",e.position),(e.size||e.size===0)&&n.set("size",e.size),(e.status||e.status===0)&&n.set("status",e.status),e.selected?n.set("selected",1):n.set("selected",0),e.error?n.set("error",1):n.set("error",0),e.zIndex&&n.set("zIndex",e.zIndex),e.gmt&&n.set("gmt",e.gmt),e.battery&&n.set("battery",e.battery),e.accu&&n.set("accu",e.accu),e.gsm&&n.set("gsm",e.gsm),e.speed&&n.set("speed",e.speed),e.distance&&n.set("distance",e.distance),e.md1&&n.set("md1",e.md1),e.md2&&n.set("md2",e.md2),n.syncUI(),e.showInfo!==undefined&&n.set("showInfo",e.showInfo)))},_getMarkerObjOldFunc:function(e){var t,n,r=null;t=this;for(n=0;n<t.markers.length&&!r;n++)t.markers[n].get("markerid")===e&&(r=t.markers[n]);return r},_getMarkerObj:function(e){var t,n,r=null;return t=this,n=t._getMarkerIndex(e),n!==-1&&(r=t.markers[n]),r},_getMarkerIndex:function(e){var t,n,r=!1;t=this;for(n=0;n<t.markers.length&&!r;n++)r=t.markers[n].get("markerid")===e;return r?n--:n=-1,n},getMarkersCount:function(){return this.markers.length},clearOneMarker:function(e){var t,n,r;t=this,r=t._getMarkerIndex(e),r!==-1&&(n=t._getMarkerObj(e),t.markers.splice(r,1),n&&n.destroy())},clearAllMarkers:function(){var e,t;e=this;for(t=0;t<e.markers.length;t++)e.markers[t].destroy();e.markers.length=0},clearAllMarkerInfo:function(){var e,t;e=this;for(t=0;t<e.markers.length;t++)e.markers[t].hideInfo()},renderUI:function(){var t,n,r,i,s,o,u,a;t=this,t._hideMap(),t.mobiledevice&&(a=e.one("meta[name=viewport]"),a?a.set("content","user-scalable=0"):e.one("head").prepend('<meta name="viewport" content="user-scalable=0" />')),i=parseInt(t.get("xpos"),10),s=parseInt(t.get("ypos"),10),o=Math.round(i/2),u=Math.round(s/2),t.currentLatitude=t.get("lat"),t.currentLongitude=t.get("lon"),t.currentZoomLevel=t.get("zoomLevel"),t.get("boundingBox").setStyle("overflow","hidden"),r="<div class='cmasmapshadowleft' style='left:"+i+"px; top:"+s+"px;'></div>",r+="<div class='cmasmapshadowtop' style='left:"+i+"px; top:"+s+"px;'></div>",r+="<div id='map_"+t.mapid+"' class='cmasmap'>";for(n=0;n<=17;n++)r+="<div id='map_zoom"+n+"_"+
t.mapid+"' class='cmasmap'></div>";r+="</div>",i+=15,s+=30,t.mobiledevice?(r+="<div id='movecontainer_"+t.mapid+"' class='cmasmovecontainer cmasmobile' style='left:"+i+"px; top:"+s+"px;'>",r+="<div id='movehome_"+t.mapid+"' class='cmasmapcontrol cmasmobile' style='top:1px;'></div>",r+="<div id='zoomin_"+t.mapid+"' class='cmasmapcontrol cmasmobile' style='top:66px;'></div>",r+="<div id='zoomout_"+t.mapid+"' class='cmasmapcontrol cmasmobile' style='top:132px;'></div>",r+="</div>"):(r+="<div id='movecontainer_"+t.mapid+"' class='cmasmovecontainer' style='left:"+i+"px; top:"+s+"px;'>",r+="<div id='moveup_"+t.mapid+"' class='cmasmapcontrol' style='left:22px; top:4px;'></div>",r+="<div id='movedown_"+t.mapid+"' class='cmasmapcontrol' style='left:22px; top:40px;'></div>",r+="<div id='moveleft_"+t.mapid+"' class='cmasmapcontrol' style='left:4px; top:22px;'></div>",r+="<div id='moveright_"+t.mapid+"' class='cmasmapcontrol' style='left:40px; top:22px;'></div>",r+="<div id='movehome_"+t.mapid+"' class='cmasmapcontrol' style='left:22px; top:22px;'></div>",r+="</div>",i+=17,s+=80,r+="<div id='zoomcontainer_"+t.mapid+"' class='cmaszoomcontainer' style='left:"+i+"px; top:"+s+"px;'>",r+="<div id='zoomin_"+t.mapid+"' class='cmasmapcontrol' style='left:5px; top:6px;'></div>",r+="<div id='zoomout_"+t.mapid+"' class='cmasmapcontrol' style='left:5px; top:205px;'></div>",r+="<div id='zoomhandleconstraint_"+t.mapid+"' class='cmaszoomhandleconstraint'>",r+="<div id='zoomhandle_"+t.mapid+"' class='cmaszoomhandle'></div>",r+="</div>",r+="</div>"),r+="<div id='busywait_"+t.mapid+"' class='cmaswait' style='left:"+o+"px; top:"+u+"px;'></div>",r+="<div id='busyfade_"+t.mapid+"' class='cmasfade'></div>",t.get("contentBox").setContent(r)},bindUI:function(){var t=this,n=e.one("#map_"+t.mapid),r=new e.DD.Drag({node:n}),i;r.on("drag:start",t._handleMapDragStart,t),r.on("drag:end",t._handleMapDragEnd,t),n.on("mousedown",t._handleMapDragMousedown,t),n.on("mouseup",t._handleMapDragMouseup,t),e.on("click",t.moveHome,"#movehome_"+t.mapid,t),e.on("click",t._handleZoomIn,"#zoomin_"+t.mapid,t),e.on("click",t._handleZoomOut,"#zoomout_"+t.mapid,t),t.mobiledevice||(i=(new e.DD.Drag({node:"#zoomhandle_"+t.mapid})).plug(e.Plugin.DDConstrained,{constrain2node:"#zoomhandleconstraint_"+t.mapid,tickY:10,stickY:!0}),i.on("drag:drag",t._handleDragZoomHandle,t),e.on("click",t._handleMoveUp,"#moveup_"+t.mapid,t),e.on("click",t._handleMoveDown,"#movedown_"+t.mapid,t),e.on("click",t._handleMoveLeft,"#moveleft_"+t.mapid,t),e.on("click",t._handleMoveRight,"#moveright_"+t.mapid,t),e.on("mouseenter",t._handleOverZoomHandleConstraint,"#zoomhandleconstraint_"+t.mapid,t),e.on("mouseleave",t._handleMapLeaveZoomArea,"#zoomhandleconstraint_"+t.mapid,t),e.on("mouseenter",t._handleOverZoomIn,"#zoomin_"+t.mapid,t),e.on("mouseenter",t._handleOverZoomOut,"#zoomout_"+t.mapid,t),e.on("mouseleave",t._handleMapLeaveZoomArea,"#zoomin_"+t.mapid,t),e.on("mouseleave",t._handleMapLeaveZoomArea,"#zoomout_"+t.mapid,t),t.scrollEvent=e.on("mousewheel",e.bind(t._handleMouseScroll,t)))},syncUI:function(){var e=this;e._repositionZoomHandle(),e.loadImagesActiveLayer(e.get("showWaitDuringStartup"),!0),e._handleMapDragEnd()},loadImagesActiveLayer:function(e,t){var n=this;e&&n.showlayerwait(),n.q.pause(),n.q.remove("imagesviewport"),n.q.add({id:"imagesviewport",fn:n._loadImagesViewPort,context:n}),t&&(n.q.remove("imagesoutsideviewport"),n.q.add({id:"imagesoutsideviewport",fn:n._loadImagesOutsideViewPort,context:n})),n.layerMadeVisible||n.q.add({id:"makelayervisible",fn:n._setMapNodeVisible,context:n}),e&&(n.q.add({id:"redefinemarkerlayer",fn:n._moveLayerMarkerToActiveZoomMap,context:n}),n.q.add({id:"hidelayerwait",fn:n.hidelayerwait,context:n})),n.q.add({id:"zoomlayervisible",fn:n._setCurrentZoomedMapVisible,context:n}),n.q.add({id:"repositionlayer",fn:n.repositionLayer,context:n}),t&&n.q.promote("imagesoutsideviewport"),n.layerMadeVisible||(n.q.promote("makelayervisible"),n.layerMadeVisible=!0),e&&(n.q.promote("hidelayerwait"),n.q.promote("redefinemarkerlayer")),n.q.promote("zoomlayervisible"),n.q.promote("repositionlayer"),n.q.promote("imagesviewport"),n.pauzedBySubRoutine||n.q.run()},loadImagesOtherLayer:function(e){var t=this;if(e===t.currentZoomLevel)return;t.q.pause(),t.q.remove("imagesviewport"+e),t.q.add({id:"imagesviewport"+e,fn:t._loadImagesOtherLayer,context:t,args:e}),t.pauzedBySubRoutine||t.q.run()},_loadImagesViewPort:function(){this._loadImages(1)},_loadImagesOutsideViewPort:function(){var e=this;e.doLoadImagesOutsieViewPort&&e._loadImages(2)},_loadImagesOtherLayer:function(e){this._loadImages(3,e)},_loadImages:function(t,n){var r=this,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N;t===3?S=n:S=r.currentZoomLevel,h=r.zoomedMap(S),p=r._getOffsetx(r.currentLongitude,S),d=r._getOffsety(r.currentLatitude,S),t===2?(E=r.get("contentBox"),v=2*E.get("winWidth")+Math.abs(p)+r._getViewPortWidth()+r.TILE_SIZE,m=2*E.get("winHeight")+Math.abs(d)+r._getViewPortHeight()+r.TILE_SIZE):(v=r._getViewPortWidth()+Math.abs(p),m=r._getViewPortHeight()+Math.abs(d)),g=Math.ceil(v/r.TILE_SIZE)+1,y=Math.ceil(m/r.TILE_SIZE)+1,o=r._getMinX(g,r.currentLongitude,S),a=r._getMinY(y,r.currentLatitude,S),u=o+g-1,f=a+y-1,N=r._getMaxTilePos(S),u=Math.min(u,N),f=Math.min(f,N),x=0;for(s=a;s<=f;s++){c=(s-1)*r.TILE_SIZE;for(i=o;i<=u;i++)e.one("#tile_"+r.mapid+"_"+S+"_"+i+"_"+s)||x++}if(x===0)return;r.pauzedBySubRoutine=!0,r.q.pause(),r.imageque=x,r.restartque=e.later(r.TIME_OUT_VIEW,r,r._restartQueByTimer);for(s=a;s<=f;s++){c=(s-1)*r.TILE_SIZE;for(i=o;i<=u;i++)e.one("#tile_"+r.mapid+"_"+S+"_"+i+"_"+s)||(l=(i-1)*r.TILE_SIZE,b="tile_"+r.mapid+"_"+i+"_"+s,T=e.Node.create("<div id='tile_"+r.mapid+"_"+S+"_"+i+"_"+s+"' class='cmastile' style='left:"+l+"px; top:"+c+"px;'><img id='"+b+"' vspace=0 hspace=0 src='"+r.getTileServer(i)+S+"/"+i+"/"+s+".png"+r._getTimeStamp(!0,r.get("tileserver"))+"' alt='' /></div>"),w=T.one("#"+b),w.on("load",r._checkRestartQue,r),w.on("error",r._errorImageLoad,r,r.getTileBackupServer(i)+
S+"/"+i+"/"+s+".png"+r._getTimeStamp(!0,r.get("tilebackupserver"))),h.append(T))}},_errorImageLoad:function(e,t){var n=this,r=e.target;r.detach("error",n._errorImageLoad),r.on("error",n._checkRestartQue,n),r.set("src",t)},currentZoomedMap:function(){var e=this;return e.zoomedMap(e.currentZoomLevel)},zoomedMap:function(t){return e.one("#map_zoom"+t+"_"+this.mapid)},_setCurrentZoomedMapVisible:function(){var e=this,t;for(t=0;t<=17;t++)t===e.currentZoomLevel?e.zoomedMap(t).setStyle("visibility","inherit"):e.zoomedMap(t).setStyle("visibility","")},_moveLayerMarkerToActiveZoomMap:function(){var e=this;e.itsamapmarker&&e.itsamapmarker.repositionMarkers()},_handleMoveUp:function(){var e=this;e._moveMap(0,-e.get("moveStep"))},_handleMoveDown:function(){var e=this;e._moveMap(0,e.get("moveStep"))},_handleMoveLeft:function(){var e=this;e._moveMap(-e.get("moveStep"),0)},_handleMoveRight:function(){var e=this;e._moveMap(e.get("moveStep"),0)},loadHomePosition:function(){var t,n,r;t=this,n={method:"GET",on:{success:e.bind(t._loadHomeSuccess,t)},headers:{"X-Transaction":"IOcall"},data:"ajax=38"},r=e.io(e.config.cmas2plusid,n)},_loadHomeSuccess:function(t,n){var r,i;r=this;try{i=e.JSON.parse(n.responseText),r.set("lat",i.lat),r.set("lon",i.lon),r.set("zoomLevel",i.zoomlevel),r.currentLatitude=r.get("lat"),r.currentLongitude=r.get("lon"),r.moveHome(),r.q.pause(),r.q.remove("loadHome"),r.q.add({id:"loadHome",fn:r._showMap,context:r}),r.q.run()}catch(s){}},_showMap:function(){var e,t;e=this,t=e.get("boundingBox"),t.removeClass("cmasnodisplay")},_hideMap:function(){var e,t;e=this,t=e.get("boundingBox"),t.addClass("cmasnodisplay")},moveHome:function(){var e=this;e.currentLatitude=e.get("lat"),e.currentLongitude=e.get("lon"),e.viewZoomLayer(e.get("zoomLevel"))},getLat:function(){return this.currentLatitude},getLon:function(){return this.currentLongitude},_handleMouseScroll:function(t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v;n=this,v=n.get("boundingBox");if(!n._mouseInScrollArea(t)||v.hasClass("cmasnodisplay"))return;d=t.wheelDelta,r=n.osXLion,r&&(d=-1*d),t.preventDefault(),i=n.getMouseLat(t),s=n.getMouseLon(t),l=n._long2tileNOTROUNDED(s,n.currentZoomLevel),c=n._lat2tileNOTROUNDED(i,n.currentZoomLevel),a=n._long2tileNOTROUNDED(n.currentLongitude,n.currentZoomLevel),f=n._lat2tileNOTROUNDED(n.currentLatitude,n.currentZoomLevel),u=l-a,o=c-f,d>0?n.zoomInByScrollPermitted?d>=n.minimumZoomValue&&(n.zoomInByScrollPermitted=!1,n.zoomOutByScrollPermitted=!0,n._zoomTimer&&n._zoomTimer.cancel(),n._zoomTimer=e.later(n.pasiveTimeAfterZoom,n,n._reactivatePermissionZoomIn),h=a+u/2,p=f+o/2,n.currentLongitude=n._tile2long(h,n.currentZoomLevel),n.currentLatitude=n._tile2lat(p,n.currentZoomLevel),n._handleZoomIn()):n.macUser||(n._zoomTimer&&n._zoomTimer.cancel(),n._zoomTimer=e.later(n.pasiveTimeAfterZoom,n,n._reactivatePermissionZoomIn)):n.zoomOutByScrollPermitted?d<=-1*n.minimumZoomValue&&(n.zoomOutByScrollPermitted=!1,n.zoomInByScrollPermitted=!0,n._zoomTimer&&n._zoomTimer.cancel(),n._zoomTimer=e.later(n.pasiveTimeAfterZoom,n,n._reactivatePermissionZoomOut),h=a-u,p=f-o,n.currentLongitude=n._tile2long(h,n.currentZoomLevel),n.currentLatitude=n._tile2lat(p,n.currentZoomLevel),n._handleZoomOut()):n.macUser||(n._zoomTimer&&n._zoomTimer.cancel(),n._zoomTimer=e.later(n.pasiveTimeAfterZoom,n,n._reactivatePermissionZoomOut))},_mouseInScrollArea:function(e){return e.clientX>300&&e.clientY>100},_reactivatePermissionZoomIn:function(){this.zoomInByScrollPermitted=!0},_reactivatePermissionZoomOut:function(){this.zoomOutByScrollPermitted=!0},_handleZoomIn:function(){var e=this,t=e.currentZoomLevel+1;if(t>17)return;e.viewZoomLayer(t),e._handleOverZoomIn()},_handleZoomOut:function(){var e=this,t=e.currentZoomLevel-1;if(t<0)return;e.viewZoomLayer(t),e._handleOverZoomIn()},_handleOverZoomHandleConstraint:function(){var e=this,t,n,r;if(e.dragStarted)return;n=Math.min(17,e.currentZoomLevel+e.get("zoomInPreLoadLevels")),r=Math.max(0,e.currentZoomLevel-e.get("zoomOutPreLoadLevels"));for(t=r;t<=n;t++)e.loadImagesOtherLayer(t)},_handleOverZoomIn:function(){var e=this,t,n;if(e.dragStarted)return;n=Math.min(17,e.currentZoomLevel+e.get("zoomInPreLoadLevels"));for(t=e.currentZoomLevel+1;t<=n;t++)e.loadImagesOtherLayer(t)},_handleOverZoomOut:function(){var e=this,t,n;if(e.dragStarted)return;n=Math.max(0,e.currentZoomLevel-e.get("zoomOutPreLoadLevels"));for(t=e.currentZoomLevel-1;t>=n;t--)e.loadImagesOtherLayer(t)},_handleMapDragStart:function(){var t=this,n=e.one("#map_"+t.mapid);t.dragStarted=!0,t.oldX=n.getX(),t.oldY=n.getY()},_handleMapDragEnd:function(){var t,n,r,i;t=this,t.dragStarted=!1,n=e.one("#map_"+t.mapid),r=n.getX()-t.oldX,i=n.getY()-t.oldY,e.later(100,t,t._storePixelMovement,[r,i])},_handleMapDragMousedown:function(){var t=this,n=e.one("#map_"+t.mapid);t.oldX=n.getX(),t.oldY=n.getY(),n.setStyle("cursor","move")},_handleMapDragMouseup:function(){var t=this,n=e.one("#map_"+t.mapid);n.setStyle("cursor","")},_handleMapLeaveZoomArea:function(){var e=this;if(e.dragStarted)return;e.loadImagesActiveLayer(!1,!0)},_storePixelMovement:function(e,t){var n=this,r=n._long2tileNOTROUNDED(n.currentLongitude,n.currentZoomLevel),i=n._lat2tileNOTROUNDED(n.currentLatitude,n.currentZoomLevel);e/=n.TILE_SIZE,t/=n.TILE_SIZE,r-=e,i-=t,n.currentLongitude=n._tile2long(r,n.currentZoomLevel),n.currentLatitude=n._tile2lat(i,n.currentZoomLevel),n.loadImagesActiveLayer(!1,!0)},_moveMap:function(t,n){var r=this,i=e.one("#map_"+r.mapid),s=parseInt(i.getStyle("left"),10)-t,o=parseInt(i.getStyle("top"),10)-n;i.transition({easing:r.get("easing"),duration:r.get("moveDuration"),left:s+"px",top:o+"px"},e.rbind(function(){this._storePixelMovement(-t,-n)},r))},_handleDragZoomHandle:function(){var t=this,n=Math.round((170-parseInt(e.one("#zoomhandle_"+t.mapid).getStyle("top"),10))/10);t.viewZoomLayer(n),t._handleOverZoomIn(),t._handleOverZoomOut()},getMouseLat:function(e){var t,n,r,i,s;return t=this,n=e.clientY-parseInt(t.get("ypos"),10),i=n-t._getViewPortCenterY(),s=i/t.TILE_SIZE,r=t._lat2tileNOTROUNDED
(t.currentLatitude,t.currentZoomLevel),t._tile2lat(r+s,t.currentZoomLevel)},getMouseLon:function(e){var t,n,r,i,s;return t=this,n=e.clientX-parseInt(t.get("xpos"),10),i=n-t._getViewPortCenterX(),s=i/t.TILE_SIZE,r=t._long2tileNOTROUNDED(t.currentLongitude,t.currentZoomLevel),t._tile2long(r+s,t.currentZoomLevel)},repositionLayer:function(t){t||(t=this.currentZoomLevel);var n=this,r=e.one("#map_"+n.mapid),i=n._long2tileNOTROUNDED(n.currentLongitude,t),s=Math.floor(i),o=Math.round(n.TILE_SIZE*(i-s)),u=n._lat2tileNOTROUNDED(n.currentLatitude,t),a=Math.floor(u),f=Math.round(n.TILE_SIZE*(u-a)),l=parseInt(r.getStyle("left"),10)/Math.pow(2,n.currentZoomLevel-t),c=parseInt(r.getStyle("top"),10)/Math.pow(2,n.currentZoomLevel-t),h=parseInt(n.get("xpos"),10)+n._getViewPortCenterX()-o-n.TILE_SIZE*(s-1)-l,p=parseInt(n.get("ypos"),10)+n._getViewPortCenterY()-f-n.TILE_SIZE*(a-1)-c,d=e.one("#map_zoom"+t+"_"+n.mapid);d.setStyle("left",h+"px"),d.setStyle("top",p+"px"),n.itsamapmarker&&(n.itsamapmarker._markerlayer.setStyle("left",h+"px"),n.itsamapmarker._markerlayer.setStyle("top",p+"px"))},viewZoomLayer:function(t){var n=this,r;if(t<0||t>17)return;if(e.UA.ie>0&&t>13)return;r=t!==n.currentZoomLevel,n.currentZoomLevel=t,n._repositionZoomHandle(),n.pauzedBySubRoutine&&(n.restartque&&n.restartque.cancel(),n.pauzedBySubRoutine=!1,n.q.run()),n.loadImagesActiveLayer(r,!1)},_repositionZoomHandle:function(){var t=this,n,r;if(t.mobiledevice)return;n=e.one("#zoomhandle_"+t.mapid),r=170-10*t.currentZoomLevel,n.setStyle("top",r+"px")},showlayerwait:function(){var t=this;e.one("#busyfade_"+t.mapid).setStyle("display","block"),e.one("#busywait_"+t.mapid).setStyle("display","block")},hidelayerwait:function(){var t=this;e.one("#busyfade_"+t.mapid).setStyle("display","none"),e.one("#busywait_"+t.mapid).setStyle("display","none")},_getViewPortWidth:function(){var e,t,n;return e=this,t=e.get("boundingBox"),t.hasClass("cmasnodisplay")?(t.setStyle("visibility","hidden"),t.removeClass("cmasnodisplay"),n=parseInt(t.getStyle("width"),10),t.addClass("cmasnodisplay"),t.setStyle("visibility","")):n=parseInt(t.getStyle("width"),10),n-parseInt(e.get("xpos"),10)},_getViewPortHeight:function(){var e,t,n;return e=this,t=e.get("boundingBox"),t.hasClass("cmasnodisplay")?(t.setStyle("visibility","hidden"),t.removeClass("cmasnodisplay"),n=parseInt(t.getStyle("height"),10),t.addClass("cmasnodisplay"),t.setStyle("visibility","")):n=parseInt(t.getStyle("height"),10),n-parseInt(e.get("ypos"),10)},_getViewPortCenterX:function(){return Math.round(.5*this._getViewPortWidth())},_getViewPortCenterY:function(){return Math.round(.5*this._getViewPortHeight())},_getMinX:function(e,t,n){var r=this,i,s=r._long2tileNOTROUNDED(t,n),o=Math.floor(s);return e%2===0?s-o<.5?i=o-Math.round(e/2):i=o-Math.round(e/2)+1:i=o-Math.floor(e/2),Math.max(i,0)},_getMinY:function(e,t,n){var r=this,i,s=r._lat2tileNOTROUNDED(t,n),o=Math.floor(s);return e%2===0?s-o<.5?i=o-Math.round(e/2):i=o-Math.round(e/2)+1:i=o-Math.floor(e/2),Math.max(i,0)},_getMaxTilePos:function(e){return Math.pow(2,e)-1},_checkRestartQue:function(){var e=this;if(!e.pauzedBySubRoutine)return;e.imageque--,e.imageque===0&&(e.pauzedBySubRoutine=!1,e.restartque&&e.restartque.cancel(),e.q.run())},_restartQueByTimer:function(){var e=this;if(!e.pauzedBySubRoutine)return;e.pauzedBySubRoutine=!1,e.q.run()},_setMapNodeVisible:function(){e.one("#map_"+this.mapid).setStyle("visibility","visible")},_getOffsetx:function(e,t){var n=this,r=n._long2tileNOTROUNDED(e,t),i=Math.floor(r);return Math.round(n.TILE_SIZE*(r-i))},_getOffsety:function(e,t){var n=this,r=n._lat2tileNOTROUNDED(e,t),i=Math.floor(r);return Math.round(n.TILE_SIZE*(r-i))},_long2tileNOTROUNDED:function(e,t){return(e+180)/360*Math.pow(2,t)},_lat2tileNOTROUNDED:function(e,t){return(1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,t)},_long2tile:function(e,t){return Math.floor(this._long2tileNOTROUNDED(e,t))},_lat2tile:function(e,t){return Math.floor(this._lat2tileNOTROUNDED(e,t))},_tile2long:function(e,t){return e/Math.pow(2,t)*360-180},_tile2lat:function(e,t){var n=Math.PI-2*Math.PI*e/Math.pow(2,t);return 180/Math.PI*Math.atan(.5*(Math.exp(n)-Math.exp(-n)))},getTileServer:function(e){var t=this;return t._getTileServer(e,t.get("tileserver"))},getTileBackupServer:function(e){var t=this;return t._getTileServer(e,t.get("tilebackupserver"))},_getTileServer:function(e,t){var n=this,r,i,s,o,u,a,f;t==="brongegevens"&&(f=n._getTimeStamp(!1,t),s="http://a."+f+".tile.mapnik.brongegevens.nl/",o="http://b."+f+".tile.mapnik.brongegevens.nl/",u="http://c."+f+".tile.mapnik.brongegevens.nl/",a="http://d."+f+".tile.mapnik.brongegevens.nl/"),t==="mapnik"&&(s="http://a.tile.openstreetmap.org/",o="http://b.tile.openstreetmap.org/",u="http://c.tile.openstreetmap.org/",a="http://a.tile.openstreetmap.org/"),t==="osma"&&(s="http://a.tah.openstreetmap.org/Tiles/tile/",o="http://b.tah.openstreetmap.org/Tiles/tile/",u="http://c.tah.openstreetmap.org/Tiles/tile/",a="http://a.tah.openstreetmap.org/Tiles/tile/"),t==="mapquest"&&(s="http://otile1.mqcdn.com/tiles/1.0.0/osm/",o="http://otile2.mqcdn.com/tiles/1.0.0/osm/",u="http://otile3.mqcdn.com/tiles/1.0.0/osm/",a="http://otile4.mqcdn.com/tiles/1.0.0/osm/");if(s==="")return"";r=e%4;switch(r){case 1:i=o;break;case 2:i=u;break;case 3:i=a;break;default:i=s}return i},_getTimeStamp:function(e,t){if(t==="brongegevens"&&e)return"";if(e&&!this.QUESTION_MARKED_IMAGE_ALLOWED)return"";var n=this,r,i,s,o,u;return r=new Date,i=r.getTime(),s=864e5,o=s*n.get("tilecacheddays"),e?u="?":u="",u+Math.round(i/o)},destructor:function(){var e=this;e._zoomTimer&&e._zoomTimer.cancel(),e.scrollEvent&&e.scrollEvent.detach(),e.clearAllMarkers()}},{ATTRS:{showWaitDuringStartup:{value:!0},zoomLevel:{value:7,validator:e.Lang.isNumber},tileserver:{value:"brongegevens"},tilebackupserver:{value:"mapnik"},lat:{value:52.149},lon:{value:5.645},moveStep:{value:256},zoomInPreLoadLevels:{value:5},zoomOutPreLoadLevels:{value:1},easing:{value:"ease-out"
},moveDuration:{value:.25},tilecacheddays:{value:7},xpos:{value:0},ypos:{value:0}}})},"@VERSION@",{requires:["widget","dd-drag","dd-constrain","event","async-queue","transition","event-resize","node"],skinnable:!0});
