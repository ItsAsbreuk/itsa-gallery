YUI.add("gallery-itsamodelsyncpromise",function(e,t){"use strict";function l(){}function c(){}var n=e.Array,r=6e4,i="Model sync-method did not return a callback in time. Please read the Docs how to setup the sync-method.",s="error",o="submit",u="load",a="save",f=function(t){var n;try{n=e.JSON.parse(t)}catch(r){}return n};e.mix(l.prototype,{submitPromise:function(t,n){t=t||{};var u=this,a=new e.Promise(function(f,l){var c=e.later(n||r,u,function(){var e={src:"submit",options:t,error:i};u.fire(s,e),l(new Error(i))});u.sync("submit",t,function(e,n){c&&c.cancel();if(a.getStatus()==="pending"){var r={options:t,response:n};e?(r.error=e,r.src="submit",u.fire(s,r),l(new Error(e))):(u._submitEvent||(u._submitEvent=u.publish(o,{preventable:!1})),u.fire(o,r),f(n,t))}})});return a},loadPromise:function(t,n){t=t||{};var o=this,a=new e.Promise(function(l,c){var h=e.later(n||r,o,function(){var e={src:"load",options:t,error:i};o.fire(s,e),c(new Error(i))});o.sync("read",t,function(e,n){h&&h.cancel();if(a.getStatus()==="pending"){var r,i={options:t,response:n};e?(i.error=e,i.src="load",o.fire(s,i),c(new Error(e))):(o._loadEvent||(o._loadEvent=o.publish(u,{preventable:!1})),r=i.parsed=f(n),o.setAttrs(r,t),o.changed={},o.fire(u,i),l(n,t))}})});return a},savePromise:function(t,n){t=t||{};var o=this,u=new e.Promise(function(l,c){var h={options:t,src:"save"},p;o._validate(o.toJSON(),function(d){d?(h.error=d,o.fire(s,h),c(new Error(d))):(p=e.later(n||r,o,function(){var e={error:i};o.fire(s,e),c(new Error(i))}),o.sync(o.isNew()?"create":"update",t,function(e,n){p&&p.cancel();if(u.getStatus()==="pending"){var r;h.response=n,e?(h.error=e,h.src="save",o.fire(s,h),c(new Error(e))):(o._saveEvent||(o._saveEvent=o.publish(a,{preventable:!1})),r=h.parsed=f(n),o.setAttrs(r,t),o.changed={},o.fire(a,h),l(n,t))}}))})});return u},destroyPromise:function(t,o){t=t||{};var u=this,a=new e.Promise(function(f,l){var c=e.later(o||r,u,function(){var e={error:i};u.fire(s,e),l(new Error(i))});u.onceAfter("destroy",function(){function e(){n.each(u.lists.concat(),function(e){e.remove(u,t)})}t.remove||t["delete"]?u.sync("delete",t,function(n){c&&c.cancel();if(a.getStatus()==="pending")if(n){var r={error:n,src:"destroy",options:t};u.fire(s,r),l(new Error(n))}else e(),f(t)}):(c&&c.cancel(),a.getStatus()==="pending"&&(e(),f(t)))})});return e.Model.superclass.destroy.call(u),a}},!0),e.ITSAModelSyncPromise=l,e.Base.mix(e.Model,[l]),e.mix(c.prototype,{loadPromise:function(t,n){t=t||{};var o=this,a=new e.Promise(function(l,c){var h=e.later(n||r,o,function(){var e={src:"load",options:t,error:i};o.fire(s,e),c(new Error(i))});o.sync("read",t,function(e,n){h&&h.cancel();if(a.getStatus()==="pending"){var r,i={options:t,response:n};e?(i.error=e,i.src="load",o.fire(s,i),c(new Error(e))):(o._loadEvent||(o._loadEvent=o.publish(u,{preventable:!1})),r=i.parsed=f(n),o.reset(r,t),o.fire(u,i),l(n,t))}})});return a}},!0),e.ITSAModellistSyncPromise=c,e.Base.mix(e.ModelList,[c])},"@VERSION@",{requires:["yui-base","base-base","base-build","node-base","json-parse","promise","model","model-list","yui-later"]});
