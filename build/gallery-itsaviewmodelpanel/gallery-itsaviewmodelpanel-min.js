YUI.add("gallery-itsaviewmodelpanel",function(e,t){"use strict";var n,r=e.Lang,i="destroyed",s="contentBox",o="rendered",u="gallery-",a="View",f="body"+a,l="footer",c=l+a,h="template",p=l+"Template",d="itsa-focused",v="editable",m="model",g="focused",y="visible",b="Change",w="close",E="click",S=w+E,x="button",T=x+":hide",N="boolean",C="string",k="load",L="submit",A="delete",O="save",M="destroy",_="value",D="reset",P="focusManaged",H="itsatabkeymanager",B="noHideOnLoad",j="noHideOnReset",F="disabled",I="pure-"+x+"-"+F,q="focusnext",R={ok:!0,retry:!0,save:!0,submit:!0};n=e.ITSAViewModelPanel=e.Base.create("itsaviewmodelpanel",e.ITSAPanel,[],null,{ATTRS:{bodyView:{value:null,writeOnce:!0},editable:{value:!1,validator:function(e){return typeof e===N}},focusManaged:{value:!0,validator:function(e){return typeof e===N}},footerTemplate:{value:null,validator:function(e){return typeof e===C}},footerView:{value:null,writeOnce:!0},headerView:{value:null,readOnly:!0},hideOnBtn:{value:!0,validator:function(e){return typeof e===N}},noHideOnLoad:{value:!0,validator:function(e){return typeof e===N}},noHideOnReset:{value:!0,validator:function(e){return typeof e===N}},model:{value:{},validator:function(t){return t===null||r.isObject(t)||typeof t===C||t instanceof e.Model}},template:{value:null,validator:function(e){return typeof e===C}}}}),n.prototype.initializer=function(){var t=this,n=t.get(m),r=t.get(p);t._eventhandlers=[],t._set(f,new e.ITSAViewModel({model:n,template:t.get(h),editable:t.get(v),styled:!1,focusManaged:!1,partOfMultiView:!0})),r&&t._set(c,new e.ITSAViewModel({model:n,template:r,editable:!1,styled:!1,focusManaged:!1,partOfMultiView:!0})),t.publish(q,{defaultFn:e.bind(t._defFn_focusnext,t),emitFacade:!0}),t.get(y)&&t.get(v)&&t.get(s).addClass(d)},n.prototype.addCustomBtn=function(e,t,n){var r=this,i=r.get(f),s=r.get(c);i.addCustomBtn(e,t,n),s&&s.addCustomBtn(e,t,n)},n.prototype.bindUI=function(){var t=this,r=t.get(s),i,o,u;n.superclass.bindUI.apply(t),i=t._eventhandlers,o=t.get(f),u=t.get(c),o.addTarget(t),t._setFocusManager(t.get(P)),i.push(t.after(v+b,function(e){o.set(v,e.newVal),t.get(s).toggleClass(d,e.newVal&&t.get(y))})),i.push(t.after(y+b,function(e){t.get(s).toggleClass(d,e.newVal&&t.get(v))})),i.push(t.after(p+b,function(e){u.set(h,e.newVal)})),i.push(t.after(m+b,function(e){o.set(m,e.newVal),u.set(m,e.newVal)})),i.push(t.after(h+b,function(e){o.set(h,e.newVal)})),i.push(t.after("*:viewrendered",function(){e.later(250,null,function(){var e=r.itsatabkeymanager;e&&(e.refresh(r),t.get(y)&&(t.unlockPanel(),e.focusInitialItem()))})})),i.push(t.after(P+b,function(e){t._setFocusManager(e.newVal)})),i.push(o.on(q,function(e){if(e.target!==t){var n=q,r={type:n,model:t.get(m),modelEventFacade:e,target:t};t.fire(n,r)}})),i.push(t.after(["*:"+S,"*:"+x+w],function(e){t.fire(T,{buttonNode:e.target})})),i.push(t.after(g+b,function(e){var n=r.itsatabkeymanager,i=e.newVal&&t.get(y)&&t.get(v);t.get(s).toggleClass(d,i),i&&n&&n._retreiveFocus()})),i.push(t.after(["*:"+k,"*:"+D],function(n){var i=r.itsatabkeymanager,s=n.target;s instanceof e.Model&&i&&t.get(y)&&(s.enableUI(),i.focusInitialItem())})),i.push(t.after(p+b,function(n){var r=n.newVal,i=n.prevVal;r&&!i&&t._set(c,new e.ITSAViewModel({model:t.get(m),template:r,editable:!1,styled:!1,focusManaged:!1,partOfMultiView:!0})),i&&!r&&i.destroy()&&t._set(c,null)})),i.push(t.after(["*:"+E],function(e){var n=e.buttonNode,r=n&&n.get(_);n&&t.get("hideOnBtn")&&r!==w&&(!t.get(j)||r!==D)&&(!t.get(B)||r!==k)&&t.fire(T,{buttonNode:n})})),i.push(t._header.delegate(E,function(e){var n=e.target,r=n.get(_);t.get("hideOnBtn")&&r!==w&&(!t.get(j)||r!==D)&&(!t.get(B)||r!==k)&&t.fire(T,{buttonNode:n})},x)),i.push(t.on(T,function(e){var n=t.get(m),r=t.get(v),i=e.buttonNode,s=i.get(_);R[s]&&r&&n&&n.toJSONUI&&!n.validated()&&e.preventDefault()})),i.push(t.on(["*:"+L,"*:"+O,"*:"+k,"*:"+M],function(n){var i=n.promise,s=n.target,o=n.type.split(":")[1],u=n.options,a=o===M&&(u.remove||u[A]),f;console.log(n.type);if(!a&&s instanceof e.Model){console.log("about to lock"),t.lockPanel();if(o===L||o===O)f=s.getAttrs(),s.UIToModel();t._setSpin(o,!0),o===M||i.then(function(){console.log("lock back from promise resolved"),(o===k||o===L||o===O)&&s.setResetAttrs()},function(){return console.log("lock back from promise rejected"),(o===L||o===O)&&s.setAttrs(f),!0}).then(function(){var e=r.itsatabkeymanager;t._setSpin(o,!1),t.unlockPanel(),e&&e.focusInitialItem()})}}))},n.prototype.lockPanel=function(){var e=this,t=e.get(f),n=e.get(c);t.lockView(),n?n.lockView():e._footercont.all("button").addClass(I)},n.prototype.unlockPanel=function(){var e=this,t=e.get(f),n=e.get(c);t.unlockView(),n?n.unlockView():e._footercont.all("button").removeClass(I)},n.prototype.removeButtonLabel=function(e){var t=this,n=t.get(f),r=t.get(c);n.removeButtonLabel(e),r&&r.removeButtonLabel(e)},n.prototype.removeCustomBtn=function(e){var t=this,n=t.get(f),r=t.get(c);n.removeCustomBtn(e),r&&r.removeCustomBtn(e)},n.prototype.removeHotKey=function(e){var t=this,n=t.get(f),r=t.get(c);n.removeHotKey(e),r&&r.removeHotKey(e)},n.prototype.setButtonLabel=function(e,t){var n=this,r=n.get(f),i=n.get(c);r.setButtonLabel(e,t),i&&i.setButtonLabel(e,t)},n.prototype.setHotKey=function(e,t){var n=this,r=n.get(f),i=n.get(c);r.setHotKey(e,t),i&&i.setHotKey(e,t)},n.prototype.syncUI=function(){var e=this,t=e.get(f),n=e.get(c);e.get(o)&&(t.render(),n&&n.render())},n.prototype.translate=function(e){return this.get(f).translate(e)},n.prototype.destructor=function(){var e=this,t=e.get(s),n=e.get(f),r=e.get(c);e._clearEventhandlers(),n.removeTarget(e),t.hasPlugin(H)&&t.unplug(H),n&&n.destroy(),r&&r.destroy()},n.prototype._defFn_focusnext=function(){var e=this,t=e.get(s).itsatabkeymanager;t&&t.next()},n.prototype._setFocusManager=function(t){var n=this,r=n.get(s),o=r.itsatabkeymanager;t?e.use(u+H,function(){n.get(i)||(o?o.refresh(r):(r.plug(e.Plugin.ITSATabKeyManager),o=r.itsatabkeymanager),r.hasClass(d)&&o.focusInitialItem())}):o&&r.unplug(H)},
n.prototype._setSpin=function(e,t){var n=this,r=n.get(s).all('[data-buttonsubtype="'+e+'"] i');r.toggleClass("itsaicon-form-loading",t),r.toggleClass("itsa-busy",t)}},"@VERSION@",{requires:["node-pluginhost","base-build","base-base","event-outside","model","gallery-itsapanel","gallery-itsaviewmodel"]});
